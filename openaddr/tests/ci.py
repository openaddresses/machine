# coding=utf8
from __future__ import print_function

from os import environ, remove, stat, close, utime
from os.path import join, splitext
from shutil import rmtree
from tempfile import mkdtemp, mkstemp
from urllib.parse import parse_qsl, urlparse, urljoin
from base64 import b64decode, b64encode
from datetime import timedelta, datetime
from zipfile import ZipFile
from io import BytesIO, StringIO
from mock import patch
from time import sleep
from uuid import uuid4

import hmac, hashlib, mock, subprocess, gzip
import unittest, json, os, sys, itertools, logging

from flask import Flask
from requests import get, ConnectionError
from httmock import HTTMock, response

DATABASE_URL = os.environ.get('DATABASE_URL', 'postgres:///hooked_on_sources')

from ..ci import (
    db_connect, db_cursor, db_queue, recreate_db, work,
    pop_task_from_donequeue, pop_task_from_taskqueue, pop_task_from_duequeue,
    create_queued_job, TASK_QUEUE, DONE_QUEUE, DUE_QUEUE,
    enqueue_sources, find_batch_sources, render_set_maps, render_index_maps,
    is_merged_to_master, get_commit_info, HEARTBEAT_QUEUE, flush_heartbeat_queue,
    get_recent_workers, load_config, get_batch_run_times, webauth,
    process_github_payload, skip_payload, is_rerun_payload, update_job_comments,
    reset_logger
    )

from ..ci.objects import (
    add_job, write_job, read_job, read_jobs, Job,
    Set, add_set, complete_set, update_set_renders, read_set, read_sets,
    add_run, set_run, copy_run, get_completed_file_run, get_completed_run,
    old_read_completed_set_runs, read_completed_set_runs, read_latest_set,
    read_run, read_completed_runs_to_date, read_latest_run, Run, RunState,
    read_completed_source_runs, read_completed_set_runs_count,
    result_dictionary2runstate
    )

from ..ci.collect import (
    is_us_northeast, is_us_midwest, is_us_south, is_us_west, is_europe, is_asia,
    is_south_america, is_north_america, add_source_to_zipfile, CollectorPublisher,
    prepare_collections, add_csv_to_zipfile, write_to_s3, MULTIPART_CHUNK_SIZE
    )

from ..ci.tileindex import (
    iterate_runs_points, iterate_point_blocks, populate_tiles, lonlat_key, Tile, Point
    )

from ..jobs import JOB_TIMEOUT
from ..ci.work import make_source_filename, assemble_runstate, MAGIC_OK_MESSAGE
from ..ci.webhooks import apply_webhooks_blueprint
from ..ci.webapi import apply_webapi_blueprint
from .. import LocalProcessedResult
from . import FakeS3

def en64(bytes):
    ''' Convert bytes to base64 unicode string.
    '''
    return b64encode(bytes).decode('utf8')

def de64(string):
    ''' Convert base64 to unicode string.
    '''
    return b64decode(string).decode('utf8')

def signed(data, valid=True):
    ''' Get a signature header for a string of data.
    '''
    key = b'world' if valid else b'nothing'
    hash = hmac.new(key, data.encode('utf8'), hashlib.sha1)
    signature = 'sha1={}'.format(hash.hexdigest())
    
    return {'X-Hub-Signature': signature}

class TestObjects (unittest.TestCase):

    def setUp(self):
        self.db = mock.Mock()
    
    def test_runstate(self):
        ''' Check initialization of RunState
        '''
        keys = ('source', 'cache', 'sample', 'geometry type', 'processed',
            'address count', 'version', 'fingerprint', 'cache time',
            'output', 'process time', 'website', 'skipped', 'license',
            'share-alike', 'attribution required', 'attribution name',
            'run id')
        
        for key in keys:
            value = str(uuid4())
            state = RunState({key: value})
            self.assertEqual(state.get(key), value)
            
            attr = key.replace(' ', '_').replace('-', '_')
            self.assertEqual(getattr(state, attr), value)

        # special case for run id
        value = str(uuid4())
        state = RunState({'run id': value})
        self.assertEqual(state.get('run id'), value)
        self.assertEqual(state.run_id, value)

        # special case for source problem
        value = None
        state = RunState({'source problem': value})
        self.assertEqual(state.get('source problem'), value)
        self.assertEqual(state.source_problem, value)

        # special case for code version
        value = str(uuid4())
        state = RunState({'code version': value})
        self.assertEqual(state.get('code version'), value)
        self.assertEqual(state.code_version, value)

        # special case for tests passed
        value = str(uuid4())
        state = RunState({'tests passed': value})
        self.assertEqual(state.get('tests passed'), value)
        self.assertEqual(state.tests_passed, value)

    def test_add_job(self):
        ''' Check behavior of objects.add_job()
        '''
        results = {'sources/file.json': {'message': 'Yo', 'state': RunState({'source': 'file.txt'})}}
        add_job(self.db, 'xyz', True, {}, {}, results, 'o', 'a', 'http://', 'https://')

        self.db.execute.assert_called_once_with(
               '''INSERT INTO jobs
                  (task_files, file_states, file_results, github_owner,
                   github_repository, github_status_url, github_comments_url,
                   status, id, datetime_start)
                  VALUES (%s::json, %s::json, %s::json, %s, %s, %s, %s, %s, %s, NOW())''',
                  ('{}', '{}', '{"sources/file.json": {"message": "Yo", "state": {"source": "file.txt"}}}',
                   'o', 'a', 'http://', 'https://', True, 'xyz'))

    def test_result_dictionary2runstate(self):
        '''
        '''
        result1 = {'message': 'Yo', 'state': {'source': 'Hello'}}
        result1b = result_dictionary2runstate(result1)
        self.assertEqual(result1b['message'], 'Yo')
        self.assertEqual(result1b['state'].source, 'Hello')

        result2 = {'message': 'Yo', 'output': {'source': 'Hello'}}
        result2b = result_dictionary2runstate(result2)
        self.assertEqual(result2b['message'], 'Yo')
        self.assertEqual(result2b['state'].source, 'Hello')

        result3 = {'message': 'Yo'}
        result3b = result_dictionary2runstate(result3)
        self.assertEqual(result3b['message'], 'Yo')
        self.assertIsNone(result3b['state'].source)

        result4 = None
        result4b = result_dictionary2runstate(result4)
        self.assertIsNone(result4b)
    
    def test_write_job_success(self):
        ''' Check behavior of objects.write_job()
        '''
        results = {'sources/file.json': {'message': 'Yo', 'state': RunState({'source': 'file.txt'})}}
        write_job(self.db, 'xyz', True, {}, {}, results, 'o', 'a', 'http://', 'https://')

        self.db.execute.assert_called_once_with(
               '''UPDATE jobs
                  SET task_files=%s::json, file_states=%s::json,
                      file_results=%s::json, github_owner=%s, github_repository=%s,
                      github_status_url=%s, github_comments_url=%s, status=%s,
                      datetime_end=CASE WHEN %s THEN NOW() ELSE null END
                  WHERE id = %s''',
                  ('{}', '{}', '{"sources/file.json": {"message": "Yo", "state": {"source": "file.txt"}}}',
                   'o', 'a', 'http://', 'https://', True, True, 'xyz'))

    def test_write_job_failure(self):
        ''' Check behavior of objects.write_job()
        '''
        results = {'sources/file.json': {'message': 'Yo', 'state': RunState({'source': 'file.txt'})}}
        write_job(self.db, 'xyz', False, {}, {}, results, 'o', 'a', 'http://', 'https://')

        self.db.execute.assert_called_once_with(
               '''UPDATE jobs
                  SET task_files=%s::json, file_states=%s::json,
                      file_results=%s::json, github_owner=%s, github_repository=%s,
                      github_status_url=%s, github_comments_url=%s, status=%s,
                      datetime_end=CASE WHEN %s THEN NOW() ELSE null END
                  WHERE id = %s''',
                  ('{}', '{}', '{"sources/file.json": {"message": "Yo", "state": {"source": "file.txt"}}}',
                   'o', 'a', 'http://', 'https://', False, True, 'xyz'))

    def test_write_job_ongoing(self):
        ''' Check behavior of objects.write_job()
        '''
        results = {'sources/file.json': {'message': 'Yo', 'state': RunState({'source': 'file.txt'})}}
        write_job(self.db, 'xyz', None, {}, {}, results, 'o', 'a', 'http://', 'https://')

        self.db.execute.assert_called_once_with(
               '''UPDATE jobs
                  SET task_files=%s::json, file_states=%s::json,
                      file_results=%s::json, github_owner=%s, github_repository=%s,
                      github_status_url=%s, github_comments_url=%s, status=%s,
                      datetime_end=CASE WHEN %s THEN NOW() ELSE null END
                  WHERE id = %s''',
                  ('{}', '{}', '{"sources/file.json": {"message": "Yo", "state": {"source": "file.txt"}}}',
                   'o', 'a', 'http://', 'https://', None, False, 'xyz'))

    def test_read_job_yes(self):
        ''' Check behavior of objects.read_job()
        '''
        self.db.fetchone.return_value = True, {}, {}, {"sources/file.json": {"message": "Yo", "state": {"source": "file.txt"}}}, 'o', 'a', 'http://', 'https://', None, None
        
        job = read_job(self.db, 'xyz')
        self.assertEqual(job.id, 'xyz')
        self.assertEqual(job.status, True)
        self.assertEqual(job.github_owner, 'o')
        self.assertEqual(job.github_repository, 'a')
        self.assertEqual(job.github_status_url, 'http://')
        self.assertEqual(job.github_comments_url, 'https://')
        self.assertIn('sources/file.json', job.file_results)
        self.assertEqual(job.file_results['sources/file.json']['message'], 'Yo')
        self.assertEqual(job.file_results['sources/file.json']['state'].source, 'file.txt')
        self.assertIsNone(job.datetime_start)
        self.assertIsNone(job.datetime_end)

        self.db.execute.assert_called_once_with(
               '''SELECT status, task_files, file_states, file_results,
                         github_owner, github_repository, github_status_url,
                         github_comments_url, datetime_start, datetime_end
                  FROM jobs WHERE id = %s
                  LIMIT 1''',
                  ('xyz', ))

    def test_read_job_old(self):
        ''' Check old-dict behavior of objects.read_job()
        '''
        self.db.fetchone.return_value = True, {}, {}, {"sources/file.json": {"message": "Yo", "output": {"source": "file.txt"}}}, 'o', 'a', 'http://', 'https://', None, None
        
        job = read_job(self.db, 'xyz')
        self.assertIn('sources/file.json', job.file_results)
        self.assertEqual(job.file_results['sources/file.json']['message'], 'Yo')
        self.assertEqual(job.file_results['sources/file.json']['state'].source, 'file.txt')

    def test_read_job_no(self):
        ''' Check behavior of objects.read_job()
        '''
        self.db.fetchone.return_value = None
        
        nothing = read_job(self.db, 'xyz')
        self.assertIsNone(nothing)

        self.db.execute.assert_called_once_with(
               '''SELECT status, task_files, file_states, file_results,
                         github_owner, github_repository, github_status_url,
                         github_comments_url, datetime_start, datetime_end
                  FROM jobs WHERE id = %s
                  LIMIT 1''',
                  ('xyz', ))

    def test_read_jobs(self):
        ''' Check behavior of objects.read_jobs()
        '''
        self.db.fetchall.return_value = (('xyz', True, {}, {}, {"sources/file.json": {"message": "Yo", "state": {"source": "file.txt"}}}, 'o', 'a', 'http://', 'https://', None, None), )
        
        (job, ) = read_jobs(self.db, None)
        self.assertEqual(job.id, 'xyz')
        self.assertEqual(job.status, True)
        self.assertIn('sources/file.json', job.file_results)
        self.assertEqual(job.file_results['sources/file.json']['message'], 'Yo')
        self.assertEqual(job.file_results['sources/file.json']['state'].source, 'file.txt')

        self.db.execute.assert_called_once_with(
               '''SELECT id, status, task_files, file_states, file_results,
                         github_owner, github_repository, github_status_url,
                         github_comments_url, datetime_start, datetime_end
                  --
                  -- Select sequence value from jobs based on ID. Null sequence
                  -- values will be excluded by this comparison to an integer.
                  --
                  FROM jobs WHERE sequence < COALESCE((SELECT sequence FROM jobs WHERE id = %s), 2^64)
                  ORDER BY sequence DESC LIMIT 25''',
                  (None, ))

    @patch('openaddr.ci.objects.read_set')
    def test_add_set(self, read_set):
        ''' Check behavior of objects.add_set()
        '''
        self.db.fetchone.return_value = (123, )
        read_set.return_value = Set(123, None, None, None, None, None, None, None, None, None)

        set = add_set(self.db, 'oa', 'openaddresses')
        self.assertEqual(set.id, 123)

        self.db.execute.assert_has_calls([mock.call(
               '''INSERT INTO sets
                  (owner, repository, datetime_start)
                  VALUES (%s, %s, NOW())''',
                  ('oa', 'openaddresses')
               ), mock.call("SELECT CURRVAL('ints')", )
               ])
        
        read_set.assert_called_with(self.db, 123)

    def test_complete_set(self):
        ''' Check behavior of objects.complete_set()
        '''
        complete_set(self.db, 123, 'abc')

        self.db.execute.assert_called_once_with(
               '''UPDATE sets
                  SET datetime_end = NOW(), commit_sha = %s
                  WHERE id = %s''',
                  ('abc', 123))

    def test_update_set_renders(self):
        ''' Check behavior of objects.update_set_renders()
        '''
        update_set_renders(self.db, 123, 'http://w', 'http://usa', 'http://eu', 'http://json')

        self.db.execute.assert_called_once_with(
               '''UPDATE sets
                  SET render_world = %s, render_usa = %s, render_europe = %s, render_geojson = %s
                  WHERE id = %s''',
                  ('http://w', 'http://usa', 'http://eu', 'http://json', 123))

    def test_get_latest_set(self):
        ''' 
        '''
        self.db.fetchone.return_value = 123, '', None, None, '', '', '', '', 'oa', 'openaddresses'
        
        set = read_latest_set(self.db, 'oa', 'oa')
        self.assertEqual(set.id, 123)
        self.assertEqual(set.owner, 'oa')

        self.db.execute.assert_called_once_with(
               '''SELECT id, commit_sha, datetime_start, datetime_end,
                         render_world, render_europe, render_usa, render_geojson,
                         owner, repository
                  FROM sets
                  WHERE owner = %s AND repository = %s
                    AND datetime_end IS NOT NULL
                  ORDER BY datetime_start DESC
                  LIMIT 1''',
                  ('oa', 'oa'))

    def test_read_set_yes(self):
        ''' Check behavior of objects.read_set()
        '''
        self.db.fetchone.return_value = 123, '', None, None, '', '', '', '', 'oa', 'openaddresses'
        
        set = read_set(self.db, 123)
        self.assertEqual(set.id, 123)
        self.assertEqual(set.owner, 'oa')

        self.db.execute.assert_called_once_with(
               '''SELECT id, commit_sha, datetime_start, datetime_end,
                         render_world, render_europe, render_usa, render_geojson,
                         owner, repository
                  FROM sets WHERE id = %s
                  LIMIT 1''',
                  (123, ))

    def test_read_set_no(self):
        ''' Check behavior of objects.read_set()
        '''
        self.db.fetchone.return_value = None
        
        nothing = read_set(self.db, 123)
        self.assertIsNone(nothing)

        self.db.execute.assert_called_once_with(
               '''SELECT id, commit_sha, datetime_start, datetime_end,
                         render_world, render_europe, render_usa, render_geojson,
                         owner, repository
                  FROM sets WHERE id = %s
                  LIMIT 1''',
                  (123, ))

    def test_read_sets(self):
        ''' Check behavior of objects.read_sets()
        '''
        self.db.fetchall.return_value = ((123, '', None, None, None, None, None, None, 'oa', None), )
        
        (set, ) = read_sets(self.db, None)
        self.assertEqual(set.id, 123)
        self.assertEqual(set.owner, 'oa')

        self.db.execute.assert_called_once_with(
               '''SELECT id, commit_sha, datetime_start, datetime_end,
                         render_world, render_europe, render_usa, render_geojson,
                         owner, repository
                  FROM sets WHERE id < COALESCE(%s, 2^64)
                  ORDER BY id DESC LIMIT 25''',
                  (None, ))

    def test_add_run(self):
        ''' Check behavior of objects.add_run()
        '''
        self.db.fetchone.return_value = (456, )

        run_id = add_run(self.db)
        self.assertEqual(run_id, 456)

        self.db.execute.assert_has_calls([
               mock.call("INSERT INTO runs (datetime_tz) VALUES (NOW())"),
               mock.call("SELECT currval('ints')")
               ])
    
    def test_set_run(self):
        ''' Check behavior of objects.add_set()
        '''
        set_run(self.db, 456, '', '', b'', RunState({'code version': 'x.y.z'}), True, 'xyz', '', '', False, 123)

        self.db.execute.assert_called_once_with(
               '''UPDATE runs SET
                  source_path = %s, source_data = %s, source_id = %s,
                  state = %s::json, status = %s, worker_id = %s,
                  code_version = %s, job_id = %s, commit_sha = %s,
                  is_merged = %s, set_id = %s, datetime_tz = NOW()
                  WHERE id = %s''',
                  ('', b'', '',
                   '{"code version": "x.y.z"}', True, '',
                   'x.y.z', 'xyz', '', False,
                   123, 456))

    def test_copy_run(self):
        ''' Check behavior of objects.copy_run()
        '''
        self.db.fetchone.return_value = (456, )
        
        run_id = copy_run(self.db, 456, 'xyz', '', 123)
        self.assertEqual(run_id, 456)

        self.db.execute.assert_has_calls([mock.call(
               '''INSERT INTO runs
                  (copy_of, source_path, source_id, source_data, state, status,
                   worker_id, code_version, job_id, commit_sha, is_merged, set_id, datetime_tz)
                  SELECT id, source_path, source_id, source_data, state, status,
                         worker_id, code_version, %s, %s, NULL, %s, NOW()
                  FROM runs
                  WHERE id = %s''',
                  ('xyz', '', 123, 456)
               ), mock.call("SELECT currval('ints')", )
               ])
    
    def test_read_run_yes(self):
        ''' Check behavior of objects.read_run()
        '''
        self.db.fetchone.return_value = (123, 'sources/whatever.json', '', b'',
            None, {}, True, None, 'x.y.z', '', None, None, '', False)
        
        run = read_run(self.db, 123)
        self.assertEqual(run.id, 123)

        self.db.execute.assert_called_once_with(
               '''SELECT id, source_path, source_id, source_data, datetime_tz,
                         state, status, copy_of, code_version, worker_id,
                         job_id, set_id, commit_sha, is_merged
                  FROM runs WHERE id = %s
                  LIMIT 1''',
                  (123, ))

    def test_read_run_yes_without_source_data(self):
        ''' Check behavior of objects.read_run()
        '''
        self.db.fetchone.return_value = (123, 'sources/whatever.json', '', None,
            None, {}, True, None, 'x.y.z', '', None, None, '', False)
        
        run = read_run(self.db, 123)
        self.assertEqual(run.id, 123)

        self.db.execute.assert_called_once_with(
               '''SELECT id, source_path, source_id, source_data, datetime_tz,
                         state, status, copy_of, code_version, worker_id,
                         job_id, set_id, commit_sha, is_merged
                  FROM runs WHERE id = %s
                  LIMIT 1''',
                  (123, ))

    def test_read_run_no(self):
        ''' Check behavior of objects.read_run()
        '''
        self.db.fetchone.return_value = None
        
        nothing = read_run(self.db, 123)
        self.assertIsNone(nothing)

        self.db.execute.assert_called_once_with(
               '''SELECT id, source_path, source_id, source_data, datetime_tz,
                         state, status, copy_of, code_version, worker_id,
                         job_id, set_id, commit_sha, is_merged
                  FROM runs WHERE id = %s
                  LIMIT 1''',
                  (123, ))

    def test_get_completed_file_run_yes(self):
        ''' Check behavior of objects.get_completed_file_run_yes()
        '''
        self.db.fetchone.return_value = (456, {'source': 'example'}, True)
        
        run_id, state, status = get_completed_file_run(self.db, 'abc', timedelta(0))
        self.assertEqual(run_id, 456)
        self.assertEqual(state.source, 'example')
        self.assertIs(status, True)

        self.db.execute.assert_called_once_with(
               '''SELECT id, state, status FROM runs
                  WHERE source_id = %s
                    AND datetime_tz > NOW() - INTERVAL %s
                    AND status IS NOT NULL
                    AND copy_of IS NULL
                  ORDER BY id DESC LIMIT 1''',
                  ('abc', timedelta(0)))

    def test_get_completed_file_run_no(self):
        ''' Check behavior of objects.get_completed_file_run_no()
        '''
        self.db.fetchone.return_value = None
        
        nothing = get_completed_file_run(self.db, 'abc', timedelta(0))
        self.assertIsNone(nothing)

        self.db.execute.assert_called_once_with(
               '''SELECT id, state, status FROM runs
                  WHERE source_id = %s
                    AND datetime_tz > NOW() - INTERVAL %s
                    AND status IS NOT NULL
                    AND copy_of IS NULL
                  ORDER BY id DESC LIMIT 1''',
                  ('abc', timedelta(0)))

    def test_get_completed_run_yes(self):
        ''' Check behavior of objects.get_completed_run_yes()
        '''
        self.db.fetchone.return_value = (456, True)
        now = datetime.now()
        
        run_id, status = get_completed_run(self.db, 456, now)
        self.assertEqual(run_id, 456)

        self.db.execute.assert_called_once_with(
               '''SELECT id, status FROM runs
                  WHERE id = %s AND status IS NOT NULL
                    AND datetime_tz >= %s
                    LIMIT 1''',
                  (456, now))

    def test_get_completed_run_no(self):
        ''' Check behavior of objects.get_completed_run_no()
        '''
        self.db.fetchone.return_value = None
        now = datetime.now()
        
        nothing = get_completed_run(self.db, 456, now)
        self.assertIsNone(nothing)

        self.db.execute.assert_called_once_with(
               '''SELECT id, status FROM runs
                  WHERE id = %s AND status IS NOT NULL
                    AND datetime_tz >= %s
                    LIMIT 1''',
                  (456, now))

    def test_old_read_completed_set_runs(self):
        ''' Check behavior of objects.old_read_completed_set_runs()
        '''
        self.db.fetchall.return_value = (('abc', 'pl', b'', True), )
        
        ((source_id, source_path, source_data, status), ) = old_read_completed_set_runs(self.db, 123)
        self.assertEqual(source_id, 'abc')
        self.assertEqual(source_path, 'pl')
        self.assertEqual(source_data, b'')
        self.assertEqual(status, True)

        self.db.execute.assert_called_once_with(
               '''SELECT source_id, source_path, source_data, status FROM runs
                  WHERE set_id = %s AND status IS NOT NULL''',
                  (123, ))

    def test_read_completed_set_runs(self):
        ''' Check behavior of objects.read_completed_set_runs()
        '''
        self.db.fetchall.return_value = (('abc', 'sources/whatever.json', 'jkl',
            b'', None, {}, True, None, '', '', 'mno', 123, 'abc', False), )
        
        runs = read_completed_set_runs(self.db, 123)
        self.assertEqual(runs[0].id, 'abc')
        self.assertEqual(runs[0].source_path, 'sources/whatever.json')
        self.assertEqual(runs[0].source_data, b'')
        self.assertEqual(runs[0].status, True)
        self.assertFalse(runs[0].is_merged)

        self.db.execute.assert_called_once_with(
               '''SELECT id, source_path, source_id, source_data, datetime_tz,
                         state, status, copy_of, code_version, worker_id,
                         job_id, set_id, commit_sha, is_merged FROM runs
                  WHERE set_id = %s AND status IS NOT NULL''',
                  (123, ))
    
    def test_read_completed_set_runs_count(self):
        ''' Check behavior of objects.read_completed_set_runs_count()
        '''
        self.db.fetchone.return_value = (99, )
        
        count = read_completed_set_runs_count(self.db, 123)
        self.assertEqual(count, 99)

        self.db.execute.assert_called_once_with(
               '''SELECT COUNT(*) FROM runs
                  WHERE set_id = %s AND status IS NOT NULL''',
                  (123, ))
    
    def test_read_completed_source_runs(self):
        ''' Check behavior of objects.read_completed_source_runs()
        '''
        self.db.fetchall.return_value = (
            ('abc', 'sources/whatever.json', 'jkl', b'', None, {}, True,
             'def', '', '', 'mno', 123, 'abc', False),
            ('def', 'sources/whatever.json', 'jkl', b'', None, {}, True,
             None, '', '', 'mno', 123, 'abc', False),
            ('ghi', 'sources/whatever.json', 'jkl', b'', None, {}, True,
             None, '', '', 'mno', 123, 'abc', False),
            )
        
        runs = read_completed_source_runs(self.db, 'sources/whatever.json')
        self.assertEqual(len(runs), 2)
        self.assertEqual(runs[0].id, 'abc')
        self.assertEqual(runs[0].source_path, 'sources/whatever.json')
        self.assertEqual(runs[0].source_data, b'')
        self.assertEqual(runs[0].status, True)
        self.assertFalse(runs[0].is_merged)
        self.assertEqual(runs[1].id, 'ghi')

        self.db.execute.assert_called_once_with(
               '''SELECT id, source_path, source_id, source_data, datetime_tz,
                         state, status, copy_of, code_version, worker_id,
                         job_id, set_id, commit_sha, is_merged FROM runs
                  WHERE source_path = %s AND status IS NOT NULL
                    AND (is_merged or is_merged is null)
                  ORDER BY id DESC''',
                  ('sources/whatever.json', ))
    
    def test_read_completed_runs_to_date_missing_set(self):
        ''' Check when read_completed_runs_to_date() called with missing set.
        '''
        with patch('openaddr.ci.objects.read_set') as read_set:
            read_set.return_value = None
            runs = read_completed_runs_to_date(self.db, 123)
            self.assertIsNone(runs)
            self.db.execute.assert_not_called()
    
    def test_read_completed_runs_to_date_incomplete_set(self):
        ''' Check when read_completed_runs_to_date() called with unfinished set.
        '''
        with patch('openaddr.ci.objects.read_set') as read_set:
            read_set.return_value = Set(123, '', datetime.now(), None,
                                        None, None, None, None, None, None)

            runs = read_completed_runs_to_date(self.db, 123)
            self.assertIsNone(runs)
            self.db.execute.assert_not_called()
    
    def test_read_completed_runs_to_date_complete_set(self):
        ''' Check when read_completed_runs_to_date() called with finished set.
        '''
        queries = []
        
        def fake_execute(q, *args, **kwargs):
            # Build up a list of queries so we can fetchall() the right rows.
            queries.append(q)

        def fake_fetchall():
            if len(queries) == 1:
                return [
                    (403, u'sources/fails-second-time.json'),
                    (501, u'sources/works-both-times.json'),
                    (502, u'sources/works-second-time.json'),
                    ]
            if len(queries) == 2:
                return [
                    (402, u'sources/works-second-time.json'),
                    (503, u'sources/fails-second-time.json'),
                    (504, u'sources/fails-both-times.json'),
                    ]
            if len(queries) == 3:
                _ = None
                return [
                    (403, u'sources/fails-second-time.json', _, b'', _, _, _, _, _, _, _, 123, _, _),
                    (501, u'sources/works-both-times.json', _, b'', _, _, _, _, _, _, _, 123, _, _),
                    (502, u'sources/works-second-time.json', _, b'', _, _, _, _, _, _, _, 123, _, _),
                    (504, u'sources/fails-both-times.json', _, b'', _, _, _, _, _, _, _, 123, _, _),
                    ]
        
        with patch('openaddr.ci.objects.read_set') as read_set:
            read_set.return_value = Set(123, '', datetime.now(), datetime.now(),
                                        None, None, None, None, None, None)
            
            self.db.execute.side_effect = fake_execute
            self.db.fetchall.side_effect = fake_fetchall

            runs = read_completed_runs_to_date(self.db, 123)

        exec1, exec2, exec3 = self.db.execute.mock_calls
        (e1_query, e1_args), (e2_query, e2_args), (e3_query, e3_args) \
            = exec1[1][:], exec2[1][:], exec3[1][:]
        
        self.assertEqual(e1_query, 
               '''SELECT MAX(id), source_path FROM runs
                  WHERE source_path IN (
                      -- Get all source paths for successful runs in this set.
                      SELECT source_path FROM runs
                      WHERE set_id = %s
                    )
                    -- Get only successful, merged runs.
                    AND status = true
                    AND (is_merged = true OR is_merged IS NULL)
                  GROUP BY source_path''')

        self.assertEqual(e2_query, 
               '''SELECT MAX(id), source_path FROM runs
                  WHERE source_path IN (
                      -- Get all source paths for failed runs in this set.
                      SELECT source_path FROM runs
                      WHERE set_id = %s
                    )
                    -- Get only unsuccessful, merged runs.
                    AND status = false
                    AND (is_merged = true OR is_merged IS NULL)
                  GROUP BY source_path''')

        self.assertEqual(e3_query, 
               '''SELECT id, source_path, source_id, source_data, datetime_tz,
                         state, status, copy_of, code_version, worker_id,
                         job_id, set_id, commit_sha, is_merged
                  FROM runs
                  WHERE id IN %s''')

        self.assertEqual(e1_args, (123, ))
        self.assertEqual(e2_args, (123, ))
        self.assertEqual(e3_args, ((403, 501, 502, 504), ))

        self.assertEqual(len(runs), 4)

    def test_get_latest_run(self):
        ''' 
        '''
        queries = []
        
        def fake_execute(q, *args, **kwargs):
            # Build up a list of queries so we can fetchall() the right rows.
            queries.append(q)

        def fake_fetchone():
            if len(queries) == 1:
                return (99, )
            if len(queries) == 2:
                return (None, )
            if len(queries) == 3:
                return (-99, )
            if len(queries) == 4:
                return (None, )
            if len(queries) == 5:
                return (None, )
        
        with patch('openaddr.ci.objects.read_run') as read_run:
            self.db.execute.side_effect = fake_execute
            self.db.fetchone.side_effect = fake_fetchone

            read_latest_run(self.db, 'sources/a1.json')
            self.assertEqual(len(read_run.mock_calls), 1, 'Should see one new call to read_run()')
            self.assertEqual(read_run.mock_calls[-1][1][1], 99)
            self.assertEqual(len(self.db.execute.mock_calls), 1)

            read_latest_run(self.db, 'sources/a1.json')
            self.assertEqual(len(read_run.mock_calls), 2, 'Should see one new call to read_run()')
            self.assertEqual(read_run.mock_calls[-1][1][1], -99)
            self.assertEqual(len(self.db.execute.mock_calls), 3)

            read_latest_run(self.db, 'sources/a1.json')
            self.assertEqual(len(read_run.mock_calls), 2, 'Should not see a new call to read_run()')
            self.assertEqual(len(self.db.execute.mock_calls), 5)

class TestAPI (unittest.TestCase):

    def setUp(self):
        '''
        '''
        os.environ['GITHUB_TOKEN'] = ''
        os.environ['DATABASE_URL'] = DATABASE_URL
        os.environ['WEBHOOK_SECRETS'] = 'hello,world'
        os.environ['AWS_ACCESS_KEY_ID'] = '12345'
        os.environ['AWS_SECRET_ACCESS_KEY'] = '67890'
        os.environ['AWS_S3_BUCKET'] = 'data.openaddresses.io'

        app = Flask(__name__)
        app.config.update(load_config(), MINIMUM_LOGLEVEL=logging.CRITICAL)
        apply_webapi_blueprint(app)
        apply_webhooks_blueprint(app)

        recreate_db.recreate(app.config['DATABASE_URL'])
        
        with db_connect(app.config['DATABASE_URL']) as conn:
            with db_cursor(conn) as db:
                db.executemany('''INSERT INTO zips
                                  (datetime, is_current, content_length, collection, license_attr, url)
                                  VALUES (NOW(), %s, %s, %s, %s, %s)''',
                               [(True, 1234, 'global', '', 'http://s3.amazonaws.com/data.openaddresses.io/openaddr-collected-global.zip'),
                                (True, 2345, 'global', 'sa', 'http://s3.amazonaws.com/data.openaddresses.io/openaddr-collected-global-sa.zip'),
                                (True, 3456, 'us_west', '', 'http://s3.amazonaws.com/data.openaddresses.io/openaddr-collected-us_west.zip'),
                                (True, 456, 'us_west', 'sa', 'http://s3.amazonaws.com/data.openaddresses.io/openaddr-collected-us_west-sa.zip'),
                                (False, 5678, 'europe', '', 'http://s3.amazonaws.com/data.openaddresses.io/openaddr-collected-europe-sa.zip')])
                
                db.execute('''INSERT INTO sets
                              (id, owner, repository, commit_sha, datetime_start, datetime_end, render_world, render_europe, render_usa, render_geojson)
                              VALUES
                              (1, 'openaddresses', 'openaddresses', NULL, '2016-03-05 19:31:21.030958-08', NULL, NULL, NULL, NULL, NULL),
                              (2, 'openaddresses', 'openaddresses', 'zz', '2016-03-04 19:31:21.030958-08', '2016-03-05 19:31:21.030958-08', 'http://s3.amazonaws.com/data.openaddresses.io/--/world.png', 'http://s3.amazonaws.com/data.openaddresses.io/--/europe.png', 'http://s3.amazonaws.com/data.openaddresses.io/--/usa.png', 'http://s3.amazonaws.com/data.openaddresses.io/--/world.geojson'),
                              (3, 'openaddresses', 'openaddresses', NULL, '2016-02-27 19:31:21.030958-08', '2016-03-05 19:31:21.030958-08', NULL, NULL, NULL, NULL)
                              ''')
                
                db.execute('''INSERT INTO runs
                              (id, source_path, source_id, source_data, datetime_tz, state, status, copy_of, code_version, worker_id, job_id, set_id, commit_sha, is_merged)
                              VALUES
                              (1, 'sources/a1.json', 'abc', '\x646566', '2016-03-05 19:31:21.03762-08', '{"website": "http://a1.example.com", "skipped": "b", "sample": "d", "fingerprint": "j", "address count": "h", "license": "CC-BY-SA", "cache": "c", "source": "a1.json", "version": "i", "geometry type": "g", "cache time": "k", "output": "n", "process time": "m", "processed": "l"}', true, NULL, 'x.y.z', NULL, NULL, 2, NULL, true),
                              (2, 'sources/a2.json', 'ghi', '\x6a6b6c', '2016-03-05 19:31:21.03762-08', '{"website": "http://example.com/a2", "skipped": "b", "sample": "d", "fingerprint": "j", "address count": "h", "attribution required": "true", "license": "ODbL", "cache": "c", "source": "a2.json", "version": "i", "geometry type": "g", "cache time": "k", "output": "n", "attribution name": "A2 GmbH", "process time": "m", "processed": "l"}', true, NULL, 'x.y.z', NULL, NULL, 2, NULL, true),
                              (3, 'sources/a3.json', 'ghi', '\x6a6b6c', '2016-03-05 19:31:21.03762-08', '{"website": "http://a3.example.org", "skipped": "b", "share-alike": "true", "sample": "d", "fingerprint": "j", "address count": "h", "attribution required": "true", "license": "CC0", "cache": "c", "source": "a3.json", "version": "i", "geometry type": "g", "cache time": "k", "output": "n", "attribution name": "A3 Inc.", "process time": "m", "processed": "l"}', true, NULL, 'x.y.z', NULL, NULL, 2, NULL, true),
                              (4, 'sources/a3.json', 'ghi', '\x6a6b6c', '2016-03-05 19:31:21.03762-08', '{"website": "http://example.org/a3", "skipped": "b", "share-alike": "true", "sample": "d", "fingerprint": "j", "address count": "h", "attribution required": "true", "license": "CC0", "cache": "zzz", "source": "a3.json", "version": "i", "geometry type": "g", "cache time": "k", "output": "n", "attribution name": "A3 Inc.", "process time": "m", "processed": "l"}', true, NULL, 'x.y.z', NULL, NULL, NULL, NULL, false)
                              ''')

        self.client = app.test_client()
    
    def tearDown(self):
        '''
        '''
        del os.environ['GITHUB_TOKEN']
        del os.environ['DATABASE_URL']
        del os.environ['WEBHOOK_SECRETS']
        del os.environ['AWS_ACCESS_KEY_ID']
        del os.environ['AWS_SECRET_ACCESS_KEY']
        del os.environ['AWS_S3_BUCKET']
        
        reset_logger()

    def test_data_index(self):
        '''
        '''
        got = self.client.get('index.json', headers=dict(Origin='http://example.com'))
        self.assertIn('Access-Control-Allow-Origin', got.headers)

        index = json.loads(got.data.decode('utf8'))
        colls = index.get('collections', {})
        
        self.assertEqual(index['run_states_url'], 'http://localhost/state.txt')
        self.assertEqual(index['latest_run_processed_url'], 'http://localhost/latest/run/{source}.zip')
        self.assertEqual(index['licenses_url'], 'http://localhost/latest/licenses.json')
        self.assertEqual(index['tileindex_url'], 'http://localhost/tiles/{lon}/{lat}.zip')
        self.assertEqual(index['latest_set_url'], 'http://localhost/sets/2.json')
        
        self.assertEqual(colls['global']['']['url'], 'http://data.openaddresses.io/openaddr-collected-global.zip')
        self.assertEqual(colls['global']['sa']['url'], 'http://data.openaddresses.io/openaddr-collected-global-sa.zip')
        self.assertEqual(colls['us_west']['']['url'], 'http://data.openaddresses.io/openaddr-collected-us_west.zip')
        self.assertEqual(colls['global']['']['content_length'], 1234)
        self.assertEqual(colls['global']['sa']['content_length'], 2345)
        self.assertEqual(colls['us_west']['']['content_length'], 3456)
        self.assertEqual(colls['global']['']['license'], 'Freely Shareable')
        self.assertEqual(colls['global']['sa']['license'], 'Share-Alike Required')
        self.assertEqual(colls['us_west']['']['license'], 'Freely Shareable')
        self.assertNotIn('sa', colls['us_west'])
        self.assertNotIn('europe', colls)
        
        self.assertEqual(index['render_world_url'], 'http://data.openaddresses.io/render-world.png')
        self.assertEqual(index['render_europe_url'], 'http://data.openaddresses.io/render-europe.png')
        self.assertEqual(index['render_usa_url'], 'http://data.openaddresses.io/render-usa.png')
        self.assertEqual(index['render_geojson_url'], 'http://data.openaddresses.io/render-world.geojson')
    
    def test_latest_licenses(self):
        '''
        '''
        got = self.client.get('latest/licenses.json', headers=dict(Origin='http://example.com'))
        self.assertIn('Access-Control-Allow-Origin', got.headers)

        licenses = json.loads(got.data.decode('utf8'))['licenses']
        licenses.sort(key=lambda l: l['sources'][0][0])
        
        self.assertEqual(len(licenses[0]['sources']), 1)
        self.assertEqual(licenses[0]['sources'][0][0], 'a1.json')
        self.assertEqual(licenses[0]['sources'][0][1], 'http://a1.example.com')
        self.assertIsNone(licenses[0]['attribution'])
        self.assertEqual(licenses[0]['license'], 'CC-BY-SA')

        self.assertEqual(len(licenses[1]['sources']), 1)
        self.assertEqual(licenses[1]['sources'][0][0], 'a2.json')
        self.assertEqual(licenses[1]['sources'][0][1], 'http://example.com/a2')
        self.assertEqual(licenses[1]['attribution'], 'A2 GmbH')
        self.assertEqual(licenses[1]['license'], 'ODbL')
        
        self.assertEqual(len(licenses[2]['sources']), 1)
        self.assertEqual(licenses[2]['sources'][0][0], 'a3.json')
        self.assertEqual(licenses[2]['sources'][0][1], 'http://a3.example.org')
        self.assertEqual(licenses[2]['attribution'], 'A3 Inc.')
        self.assertEqual(licenses[2]['license'], 'CC0')

        self.assertEqual(len(licenses), 3)
    
    def test_state_txt(self):
        now = datetime.now()
        yesterday = now - timedelta(days=1)
        last_week = now - timedelta(days=7)
        
        # Old-style run predating attribution columns.
        run_state1 = {
            'source': 'a1.json', 'skipped': 'b', 'cache': 'c', 'sample': 'd',
            'website': 'e', 'license': 'f', 'geometry type': 'g',
            'address count': 'h', 'version': 'i', 'fingerprint': 'j',
            'cache time': 'k', 'processed': 'l', 'process time': 'm',
            'output': 'n'
            }
        
        # New-style run including attribution columns.
        run_state2 = {k: v for (k, v) in run_state1.items()}
        run_state2['attribution required'] = 'true'
        run_state2['attribution name'] = 'A2 GmbH'
        run_state2['source'] = 'a2.json'
        
        # Newer-style run including share-alike columns.
        run_state3 = {k: v for (k, v) in run_state2.items()}
        run_state3['share-alike'] = 'true'
        run_state3['attribution name'] = 'A3 Inc.'
        run_state3['source'] = 'a3.json'

        # Unmerged and should never show up.
        run_state4 = {k: v for (k, v) in run_state3.items()}
        run_state4['cache'] = 'zzz'
        
        for path in ('/state.txt', '/sets/2/state.txt'):
            got2 = self.client.get(path, headers=dict(Origin='http://example.com'))
            self.assertIn('Access-Control-Allow-Origin', got2.headers)

            self.assertEqual(got2.status_code, 200)
        
            # El-Cheapo CSV parser.
            lines = got2.data.decode('utf8').split('\r\n')[:4]
            head, row1, row2, row3 = [row.split('\t') for row in lines]
            got_state1 = dict(zip(head, row1))
            got_state2 = dict(zip(head, row2))
            got_state3 = dict(zip(head, row3))
            
            self.assertEqual(got_state1['code version'], 'x.y.z')
            self.assertEqual(got_state2['code version'], 'x.y.z')
            self.assertEqual(got_state3['code version'], 'x.y.z')
        
            for key in ('source', 'cache', 'sample', 'geometry type', 'address count',
                        'version', 'fingerprint', 'cache time', 'processed', 'output',
                        'process time', 'attribution required', 'attribution name',
                        'share-alike', 'process hash'):
                self.assertIn(key, got_state1)
                self.assertIn(key, got_state2)
        
            for (key, value) in got_state1.items():
                if key in run_state1:
                    self.assertEqual(value, run_state1[key])
        
            for (key, value) in got_state2.items():
                if key in run_state2:
                    self.assertEqual(value, run_state2[key])
        
            for (key, value) in got_state3.items():
                if key in run_state3:
                    self.assertEqual(value, run_state3[key])
    
    def test_set_data(self):
        '''
        '''
        got = self.client.get('/sets/2.json')
        data = json.loads(got.data.decode('utf8'))
        
        self.assertEqual(data['id'], 2)
        self.assertEqual(data['commit_sha'], 'zz')
        self.assertIn('datetime_start', data)
        self.assertIn('datetime_end', data)

        self.assertEqual(data['render_world_url'], 'http://data.openaddresses.io/--/world.png')
        self.assertEqual(data['render_europe_url'], 'http://data.openaddresses.io/--/europe.png')
        self.assertEqual(data['render_usa_url'], 'http://data.openaddresses.io/--/usa.png')
        self.assertEqual(data['render_geojson_url'], 'http://data.openaddresses.io/--/world.geojson')
    
    def test_tile_redirects(self):
        '''
        '''
        got1 = self.client.get('tiles/-123/37.zip')
        self.assertEqual(got1.status_code, 302)
        self.assertIn('tiles/-123.0/37.0.zip', got1.headers['location'])

        got2 = self.client.get('tiles/-123.001/37.001.zip')
        self.assertEqual(got2.status_code, 302)
        self.assertIn('tiles/-124.0/37.0.zip', got2.headers['location'])

        got3 = self.client.get('tiles/-123.100/37.100.zip')
        self.assertEqual(got3.status_code, 302)
        self.assertIn('tiles/-124.0/37.0.zip', got3.headers['location'])

        got4 = self.client.get('tiles/-123/yo.zip')
        self.assertEqual(got4.status_code, 404)

        got5 = self.client.get('tiles/yo/37.zip')
        self.assertEqual(got5.status_code, 404)

        got6 = self.client.get('tiles/999/37.zip')
        self.assertEqual(got6.status_code, 404)

        got7 = self.client.get('tiles/-123/999.zip')
        self.assertEqual(got7.status_code, 404)

class TestAuth (unittest.TestCase):
    
    def test_serializer(self):
        secret = str(uuid4())
        message = str(uuid4())
        
        self.assertEqual(message, webauth.unserialize(secret, webauth.serialize(secret, message)))
    
    def test_s3_upload_form_fields(self):
        expires = datetime(1970, 1, 1, 0, 0, 0)
        bucketname = str(uuid4())
        subdir = 'jrandom/123'
        redirect = str(uuid4())
        s3 = mock.Mock()
        s3.access_key, s3.secret_key = str(uuid4()), str(uuid4())
        s3.provider.security_token = None

        with patch('hmac.new') as hmac_new:
            digest = str(uuid4()).encode('ascii')
            hmac_new.return_value.digest.return_value = digest
            fields = webauth.s3_upload_form_fields(expires, bucketname, subdir, redirect, s3)
        
        self.assertEqual(hmac_new.mock_calls[0][1][0].decode('utf8'), s3.secret_key)
        self.assertEqual(fields['signature'], b64encode(digest).decode('utf8'))
        self.assertEqual(fields['access_key'], s3.access_key)
        self.assertEqual(fields['key'], 'cache/uploads/jrandom/123/${filename}')
        self.assertEqual(fields['acl'], 'public-read')
        self.assertNotIn('x-amz-security-token', fields)
        
        policy = json.loads(b64decode(fields['policy']).decode('utf8'))
        
        self.assertEqual(policy,
            {
                'expiration': '1970-01-01T00:00:00Z',
                'conditions': [
                    {'bucket': bucketname},
                    ['starts-with', '$key', 'cache/uploads/jrandom/123/'],
                    {'acl': 'public-read'},
                    {'success_action_redirect': redirect},
                    ['content-length-range', 16, webauth.MAX_UPLOAD_SIZE]
                ]
            })

        s3.provider.security_token = str(uuid4())

        with patch('hmac.new') as hmac_new:
            digest = str(uuid4()).encode('ascii')
            hmac_new.return_value.digest.return_value = digest
            fields = webauth.s3_upload_form_fields(expires, bucketname, subdir, redirect, s3)
        
        self.assertEqual(fields['security_token'], s3.provider.security_token)
        
        policy = json.loads(b64decode(fields['policy']).decode('utf8'))
        self.assertIn({'x-amz-security-token': s3.provider.security_token}, policy['conditions'])
    
    def test_exchange_tokens(self):
        code, client_id, secret = str(uuid4()), str(uuid4()), str(uuid4())
        
        def response_content_error(url, request):
            if (request.method, url.hostname, url.path) == ('POST', 'github.com', '/login/oauth/access_token'):
                return response(400, b'{"error": "no good"}', headers={'Content-Type': 'application/json'})
            raise Exception()
        
        with HTTMock(response_content_error):
            with self.assertRaises(RuntimeError) as err:
                token = webauth.exchange_tokens(code, client_id, secret)
            self.assertIn("no good", str(err.exception))
        
        def response_content_missing(url, request):
            if (request.method, url.hostname, url.path) == ('POST', 'github.com', '/login/oauth/access_token'):
                return response(200, b'{"what": "no no no"}', headers={'Content-Type': 'application/json'})
            raise Exception()
        
        with HTTMock(response_content_missing):
            with self.assertRaises(RuntimeError) as err:
                token = webauth.exchange_tokens(code, client_id, secret)
            self.assertIn('missing `access_token`', str(err.exception))
        
        def response_content_okay(url, request):
            if (request.method, url.hostname, url.path) == ('POST', 'github.com', '/login/oauth/access_token'):
                return response(200, b'{"scope": "", "token_type": "bearer", "access_token": "nnnnggh"}', headers={'Content-Type': 'application/json'})
            raise Exception()
        
        with HTTMock(response_content_okay):
            token = webauth.exchange_tokens(code, client_id, secret)
            self.assertEqual('nnnnggh', token['access_token'])
    
    def test_user_information(self):
        def response_content_unauth(url, request):
            if (request.method, url.hostname, url.path) == ('GET', 'api.github.com', '/user'):
                return response(401, b'{}', headers={'Content-Type': 'application/json'})
            raise Exception()
        
        with HTTMock(response_content_unauth):
            login, avatar, orged = webauth.user_information('nnnnggh')
            self.assertIsNone(login)
            self.assertIsNone(avatar)
            self.assertIsNone(orged)

        def response_content_unorged(url, request):
            if (request.method, url.hostname, url.path) == ('GET', 'api.github.com', '/user'):
                return response(200, b'{"login": "migurski", "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", "organizations_url": "https://api.github.com/users/migurski/orgs"}', headers={'Content-Type': 'application/json'})

            if (request.method, url.hostname, url.path) == ('GET', 'api.github.com', '/orgs/openaddresses/members/migurski'):
                return response(404, b'')

            raise Exception()
        
        with HTTMock(response_content_unorged):
            login, avatar, orged = webauth.user_information('nnnnggh')
            self.assertEqual(login, 'migurski')
            self.assertEqual(avatar, 'https://avatars.githubusercontent.com/u/58730?v=3')
            self.assertFalse(orged)

        def response_content_orged(url, request):
            if (request.method, url.hostname, url.path) == ('GET', 'api.github.com', '/user'):
                return response(200, b'{"login": "migurski", "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", "organizations_url": "https://api.github.com/users/migurski/orgs"}', headers={'Content-Type': 'application/json'})

            if (request.method, url.hostname, url.path) == ('GET', 'api.github.com', '/orgs/openaddresses/members/migurski'):
                return response(204, b'')

            raise Exception()
        
        with HTTMock(response_content_orged):
            login, avatar, orged = webauth.user_information('nnnnggh')
            self.assertEqual(login, 'migurski')
            self.assertEqual(avatar, 'https://avatars.githubusercontent.com/u/58730?v=3')
            self.assertTrue(orged)
    
    def test_callback_url(self):
        req1 = mock.Mock()
        req1.url = 'http://example.org/auth'
        req1.host, req1.path = 'example.org', '/auth'
        req1.headers = {}
        url1 = webauth.callback_url(req1, 'http://www.example.com/callback')
        self.assertEqual(url1, 'http://www.example.com/callback')
        
        req2 = mock.Mock()
        req2.url = 'http://example.org/auth'
        req2.host, req2.path = 'example.org', '/auth'
        req2.headers = {}
        url2 = webauth.callback_url(req2, '/callback')
        self.assertEqual(url2, 'http://example.org/callback')
        
        req3 = mock.Mock()
        req3.url = 'http://example.org/auth'
        req3.host, req3.path = 'example.org', '/auth'
        req3.headers = {'X-Forwarded-Proto': 'https'}
        url3 = webauth.callback_url(req3, '/callback')
        self.assertEqual(url3, 'https://example.org/callback')
        
        req4 = mock.Mock()
        req4.url = 'http://example.org/auth'
        req4.host, req4.path = 'example.org', u'/auth'
        req4.headers = {'X-Forwarded-Proto': 'https'}
        url4 = webauth.callback_url(req4, '/callback')
        self.assertEqual(url4, 'https://example.org/callback')
        
        req5 = mock.Mock()
        req5.url = 'http://example.org/auth'
        req5.host, req5.path = 'example.org', u'/auth'
        req5.headers = {'X-Forwarded-Proto': u'https'}
        url5 = webauth.callback_url(req5, '/callback')
        self.assertEqual(url5, 'https://example.org/callback')
        
        req6 = mock.Mock()
        req6.url = 'http://example.org/auth'
        req6.host, req6.path = 'example.org', u'/auth'
        req6.headers = {'X-Forwarded-Proto': u'https'}
        url6 = webauth.callback_url(req6, u'/callback')
        self.assertEqual(url6, 'https://example.org/callback')
    
    def test_upload_cache(self):
        '''
        '''
        os.environ['GITHUB_TOKEN'] = ''
        os.environ['DATABASE_URL'] = DATABASE_URL
        os.environ['WEBHOOK_SECRETS'] = 'hello,world'
        os.environ['AWS_ACCESS_KEY_ID'] = '12345'
        os.environ['AWS_SECRET_ACCESS_KEY'] = '67890'
        os.environ['GITHUB_SECRET'] = 'whatever'

        def response_content_nothing(url, request):
            raise Exception()
        
        with HTTMock(response_content_nothing):
            app = Flask('openaddr.ci.web')
            app.config.update(load_config(), MINIMUM_LOGLEVEL=logging.CRITICAL)
            apply_webhooks_blueprint(app)
            webauth.apply_webauth_blueprint(app)
        
            client = app.test_client()
        
            got1 = client.get('/upload-cache')
            self.assertEqual(got1.status_code, 200)
            self.assertIn(b'<form action="/auth/login" method="post">', got1.data)
        
        posted = client.post('/auth/login', headers={'Referer': '/upload-cache'})
        self.assertEqual(posted.status_code, 303)
        self.assertIn('Location', posted.headers)
        args = dict(parse_qsl(urlparse(posted.headers.get('Location')).query))
        state = args['state']
        
        def response_content_okay(url, request):
            if (request.method, url.hostname, url.path) == ('POST', 'github.com', '/login/oauth/access_token'):
                return response(200, b'{"scope": "", "token_type": "bearer", "access_token": "nnnnggh"}', headers={'Content-Type': 'application/json'})
            raise Exception()
        
        with HTTMock(response_content_okay):
            got2 = client.get('/auth/callback?code=whatever&state={}'.format(state))
            self.assertEqual(got2.status_code, 302)
            self.assertIn('Location', got2.headers)
        
        def response_content_user(url, request):
            if (request.method, url.hostname, url.path) == ('GET', 'api.github.com', '/user'):
                return response(200, b'{"login": "migurski", "avatar_url": "http://example.com/cat.gif", "organizations_url": "https://api.github.com/users/migurski/orgs"}', headers={'Content-Type': 'application/json'})
            if (request.method, url.hostname, url.path) == ('GET', 'api.github.com', '/orgs/openaddresses/members/migurski'):
                return response(204, b'{}')
            raise Exception()

        with HTTMock(response_content_user):
            got3 = client.get('/upload-cache')
            self.assertEqual(got3.status_code, 200)
            self.assertIn(b'<form action="/auth/logout" method="post">', got3.data)
            self.assertIn(b'<img src="http://example.com/cat.gif">', got3.data)
            self.assertIn(b'<button>LOG OUT migurski</button>', got3.data)
            self.assertIn(b'<input type="hidden" name="AWSAccessKeyId" value="12345">', got3.data)

        del os.environ['GITHUB_TOKEN']
        del os.environ['DATABASE_URL']
        del os.environ['WEBHOOK_SECRETS']
        del os.environ['AWS_ACCESS_KEY_ID']
        del os.environ['AWS_SECRET_ACCESS_KEY']
        del os.environ['GITHUB_SECRET']
        reset_logger()

class TestHook (unittest.TestCase):

    def setUp(self):
        '''
        '''
        os.environ['GITHUB_TOKEN'] = ''
        os.environ['DATABASE_URL'] = DATABASE_URL
        os.environ['WEBHOOK_SECRETS'] = 'hello,world'
        os.environ['AWS_ACCESS_KEY_ID'] = '12345'
        os.environ['AWS_SECRET_ACCESS_KEY'] = '67890'
        os.environ['DOTMAPS_BASE_URL'] = 'https://dotmaps.example.com/yo/'

        self.app = Flask(__name__)
        self.app.config.update(load_config(), MINIMUM_LOGLEVEL=logging.CRITICAL)
        apply_webhooks_blueprint(self.app)

        recreate_db.recreate(self.app.config['DATABASE_URL'])

        self.output_dir = mkdtemp(prefix='TestHook-')
        self.database_url = self.app.config['DATABASE_URL']
        self.github_auth = self.app.config['GITHUB_AUTH']
        self.client = self.app.test_client()
        self.last_status_state = None
        self.last_status_message = None
        self.s3 = FakeS3()
    
    def tearDown(self):
        '''
        '''
        del os.environ['GITHUB_TOKEN']
        del os.environ['DATABASE_URL']
        del os.environ['WEBHOOK_SECRETS']
        del os.environ['AWS_ACCESS_KEY_ID']
        del os.environ['AWS_SECRET_ACCESS_KEY']

        rmtree(self.output_dir)
        remove(self.s3._fake_keys)
        reset_logger()
    
    def test_skip_payload(self):
        '''
        '''
        self.assertFalse(skip_payload(dict(action='opened', pull_request=True)), 'Should not skip a PR')
        self.assertTrue(skip_payload(dict(action='closed', pull_request=True)), 'Should skip closed PR')

        self.assertFalse(skip_payload(dict(commits=True, head_commit=True)), 'Should not skip a commit')
        self.assertFalse(skip_payload(dict(commits=True, head_commit=True, deleted=False)), 'Should not skip a commit')
        self.assertTrue(skip_payload(dict(commits=True, head_commit=True, deleted=True)), 'Should skip a deleted commit')

        self.assertFalse(skip_payload(dict(action='created', comment=dict(body='Re-run this please.'), issue=dict(pull_request=True))), 'Should not skip a request to re-run a PR')
        self.assertFalse(skip_payload(dict(action='created', comment=dict(body='rerun this please.'), issue=dict(pull_request=True))), 'Should not skip a request to re-run a PR')
        self.assertFalse(skip_payload(dict(action='created', comment=dict(body='Rerun this, please...\nor else.'), issue=dict(pull_request=True))), 'Should not skip a request to re-run a PR')
        self.assertFalse(skip_payload(dict(action='created', comment=dict(body='Many feelings.\nRerun this, please...\nor else.'), issue=dict(pull_request=True))), 'Should not skip a request to re-run a PR')
        self.assertTrue(skip_payload(dict(action='created', comment=dict(body='I have so many feelings about this.'), issue=dict(pull_request=True))), 'Should skip a random PR comment')
        self.assertTrue(skip_payload(dict(action='created', comment=dict(body='Re-run this please.'), issue=dict())), 'Should skip a non-PR comment')
        self.assertTrue(skip_payload(dict(action='deleted', comment=dict(body='Re-run this please.'), issue=dict(pull_request=True))), 'Should skip a deleted comment')

        self.assertTrue(skip_payload(dict()))
    
    def test_is_rerun_payload(self):
        '''
        '''
        self.assertFalse(is_rerun_payload(dict(action='opened', pull_request=True)), 'A PR is not a re-run')
        self.assertFalse(is_rerun_payload(dict(action='closed', pull_request=True)), 'A PR is not a re-run')

        self.assertFalse(is_rerun_payload(dict(commits=True, head_commit=True)), 'A commit is not a re-run')
        self.assertFalse(is_rerun_payload(dict(commits=True, head_commit=True, deleted=False)), 'A commit is not a re-run')
        self.assertFalse(is_rerun_payload(dict(commits=True, head_commit=True, deleted=True)), 'A commit is not a re-run')

        self.assertTrue(is_rerun_payload(dict(action='created', comment=dict(body='Re-run this please.'), issue=dict(pull_request=True))), 'Should not skip a request to re-run a PR')
        self.assertTrue(is_rerun_payload(dict(action='created', comment=dict(body='rerun this please.'), issue=dict(pull_request=True))), 'Should not skip a request to re-run a PR')
        self.assertTrue(is_rerun_payload(dict(action='created', comment=dict(body='Rerun this, please...\nor else.'), issue=dict(pull_request=True))), 'Should not skip a request to re-run a PR')
        self.assertTrue(is_rerun_payload(dict(action='created', comment=dict(body='Many feelings.\nRerun this, please...\nor else.'), issue=dict(pull_request=True))), 'Should not skip a request to re-run a PR')
        self.assertFalse(is_rerun_payload(dict(action='created', comment=dict(body='I have so many feelings about this.'), issue=dict(pull_request=True))), 'A random comment is not a re-run')
        self.assertFalse(is_rerun_payload(dict(action='created', comment=dict(body='Re-run this please.'), issue=dict())), 'A non-PR comment is not a re-run')
        self.assertFalse(is_rerun_payload(dict(action='deleted', comment=dict(body='Re-run this please.'), issue=dict(pull_request=True))), 'A deleted comment is not a re-run')

        self.assertFalse(is_rerun_payload(dict()))
    
    def test_get_commit_info(self):
        '''
        '''
        logger = mock.Mock()
        
        data1 = '''{\r          "after": "e91fbc420f08890960f50f863626e1062f922522", \r          "base_ref": null, \r          "before": "c52204fd40f17f9da243df09e6d1107d48768afd", \r          "commits": [\r            {\r              "added": [\r                "sources/us-ca-alameda_county.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "e91fbc420f08890960f50f863626e1062f922522", \r              "message": "Added first source", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:16:12-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/e91fbc420f08890960f50f863626e1062f922522"\r            }\r          ], \r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/c52204fd40f1...e91fbc420f08", \r          "created": false, \r          "deleted": false, \r          "forced": false, \r          "head_commit": {\r            "added": [\r              "sources/us-ca-alameda_county.json"\r            ], \r            "author": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "committer": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "distinct": true, \r            "id": "e91fbc420f08890960f50f863626e1062f922522", \r            "message": "Added first source", \r            "modified": [], \r            "removed": [], \r            "timestamp": "2015-04-25T17:16:12-07:00", \r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/e91fbc420f08890960f50f863626e1062f922522"\r          }, \r          "organization": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3", \r            "description": "The free and open global address collection ", \r            "events_url": "https://api.github.com/orgs/openaddresses/events", \r            "id": 6895392, \r            "login": "openaddresses", \r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}", \r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}", \r            "repos_url": "https://api.github.com/orgs/openaddresses/repos", \r            "url": "https://api.github.com/orgs/openaddresses"\r          }, \r          "pusher": {\r            "email": "mike-github@teczno.com", \r            "name": "migurski"\r          }, \r          "ref": "refs/heads/master", \r          "repository": {\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}", \r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}", \r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}", \r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}", \r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git", \r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}", \r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}", \r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}", \r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}", \r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}", \r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors", \r            "created_at": 1430006167, \r            "default_branch": "master", \r            "description": "Temporary repository for testing Github webhook features", \r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads", \r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events", \r            "fork": false, \r            "forks": 0, \r            "forks_count": 0, \r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks", \r            "full_name": "openaddresses/hooked-on-sources", \r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}", \r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}", \r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}", \r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git", \r            "has_downloads": true, \r            "has_issues": true, \r            "has_pages": false, \r            "has_wiki": true, \r            "homepage": null, \r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks", \r            "html_url": "https://github.com/openaddresses/hooked-on-sources", \r            "id": 34590951, \r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}", \r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}", \r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}", \r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}", \r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}", \r            "language": null, \r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages", \r            "master_branch": "master", \r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges", \r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}", \r            "mirror_url": null, \r            "name": "hooked-on-sources", \r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}", \r            "open_issues": 0, \r            "open_issues_count": 0, \r            "organization": "openaddresses", \r            "owner": {\r              "email": "openaddresses@gmail.com", \r              "name": "openaddresses"\r            }, \r            "private": false, \r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}", \r            "pushed_at": 1430007676, \r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}", \r            "size": 0, \r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git", \r            "stargazers": 0, \r            "stargazers_count": 0, \r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers", \r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}", \r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers", \r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription", \r            "svn_url": "https://github.com/openaddresses/hooked-on-sources", \r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags", \r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams", \r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}", \r            "updated_at": "2015-04-25T23:56:07Z", \r            "url": "https://github.com/openaddresses/hooked-on-sources", \r            "watchers": 0, \r            "watchers_count": 0\r          }, \r          "sender": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r            "events_url": "https://api.github.com/users/migurski/events{/privacy}", \r            "followers_url": "https://api.github.com/users/migurski/followers", \r            "following_url": "https://api.github.com/users/migurski/following{/other_user}", \r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}", \r            "gravatar_id": "", \r            "html_url": "https://github.com/migurski", \r            "id": 58730, \r            "login": "migurski", \r            "organizations_url": "https://api.github.com/users/migurski/orgs", \r            "received_events_url": "https://api.github.com/users/migurski/received_events", \r            "repos_url": "https://api.github.com/users/migurski/repos", \r            "site_admin": false, \r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}", \r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r            "type": "User", \r            "url": "https://api.github.com/users/migurski"\r          }\r        }'''
        owner1, repo1, commit1, surl1, curl1 = get_commit_info(logger, json.loads(data1), None)
        self.assertEqual((owner1, repo1), ('openaddresses', 'hooked-on-sources'))
        self.assertEqual(commit1, 'e91fbc420f08890960f50f863626e1062f922522')
        self.assertIn(commit1, surl1)
        self.assertIsNone(curl1, 'Not looking for comment URLs in push events')
        
        data2 = '''{\r          "after": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r          "base_ref": null, \r          "before": "e91fbc420f08890960f50f863626e1062f922522", \r          "commits": [\r            {\r              "added": [\r                "sources/us-ca-san_francisco.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "73a81c5b337bd393273a222f1cd191d7e634df51", \r              "message": "Added SF", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:25:45-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r            }, \r            {\r              "added": [\r                "sources/us-ca-berkeley.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r              "message": "Added Berkeley", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:25:55-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r            }\r          ], \r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/e91fbc420f08...ded44ed5f173", \r          "created": false, \r          "deleted": false, \r          "forced": false, \r          "head_commit": {\r            "added": [\r              "sources/us-ca-berkeley.json"\r            ], \r            "author": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "committer": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "distinct": true, \r            "id": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r            "message": "Added Berkeley", \r            "modified": [], \r            "removed": [], \r            "timestamp": "2015-04-25T17:25:55-07:00", \r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r          }, \r          "organization": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3", \r            "description": "The free and open global address collection ", \r            "events_url": "https://api.github.com/orgs/openaddresses/events", \r            "id": 6895392, \r            "login": "openaddresses", \r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}", \r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}", \r            "repos_url": "https://api.github.com/orgs/openaddresses/repos", \r            "url": "https://api.github.com/orgs/openaddresses"\r          }, \r          "pusher": {\r            "email": "mike-github@teczno.com", \r            "name": "migurski"\r          }, \r          "ref": "refs/heads/master", \r          "repository": {\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}", \r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}", \r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}", \r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}", \r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git", \r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}", \r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}", \r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}", \r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}", \r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}", \r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors", \r            "created_at": 1430006167, \r            "default_branch": "master", \r            "description": "Temporary repository for testing Github webhook features", \r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads", \r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events", \r            "fork": false, \r            "forks": 0, \r            "forks_count": 0, \r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks", \r            "full_name": "openaddresses/hooked-on-sources", \r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}", \r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}", \r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}", \r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git", \r            "has_downloads": true, \r            "has_issues": true, \r            "has_pages": false, \r            "has_wiki": true, \r            "homepage": null, \r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks", \r            "html_url": "https://github.com/openaddresses/hooked-on-sources", \r            "id": 34590951, \r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}", \r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}", \r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}", \r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}", \r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}", \r            "language": null, \r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages", \r            "master_branch": "master", \r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges", \r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}", \r            "mirror_url": null, \r            "name": "hooked-on-sources", \r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}", \r            "open_issues": 0, \r            "open_issues_count": 0, \r            "organization": "openaddresses", \r            "owner": {\r              "email": "openaddresses@gmail.com", \r              "name": "openaddresses"\r            }, \r            "private": false, \r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}", \r            "pushed_at": 1430007964, \r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}", \r            "size": 0, \r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git", \r            "stargazers": 0, \r            "stargazers_count": 0, \r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers", \r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}", \r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers", \r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription", \r            "svn_url": "https://github.com/openaddresses/hooked-on-sources", \r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags", \r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams", \r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}", \r            "updated_at": "2015-04-25T23:56:07Z", \r            "url": "https://github.com/openaddresses/hooked-on-sources", \r            "watchers": 0, \r            "watchers_count": 0\r          }, \r          "sender": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r            "events_url": "https://api.github.com/users/migurski/events{/privacy}", \r            "followers_url": "https://api.github.com/users/migurski/followers", \r            "following_url": "https://api.github.com/users/migurski/following{/other_user}", \r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}", \r            "gravatar_id": "", \r            "html_url": "https://github.com/migurski", \r            "id": 58730, \r            "login": "migurski", \r            "organizations_url": "https://api.github.com/users/migurski/orgs", \r            "received_events_url": "https://api.github.com/users/migurski/received_events", \r            "repos_url": "https://api.github.com/users/migurski/repos", \r            "site_admin": false, \r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}", \r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r            "type": "User", \r            "url": "https://api.github.com/users/migurski"\r          }\r        }'''
        owner2, repo2, commit2, surl2, curl2 = get_commit_info(logger, json.loads(data2), None)
        self.assertEqual((owner2, repo2), ('openaddresses', 'hooked-on-sources'))
        self.assertEqual(commit2, 'ded44ed5f1733bb93d84f94afe9383e2d47bbbaa')
        self.assertIn(commit2, surl2)
        self.assertIsNone(curl2, 'Not looking for comment URLs in push events')

        data3 = '''{\r          "ref": "refs/heads/branch",\r          "before": "b659130053b85cd3993b1a4653da1bf6231ec0b4",\r          "after": "e5f1dcae83ab1ef1f736b969da617311f7f11564",\r          "created": false,\r          "deleted": false,\r          "forced": false,\r          "base_ref": null,\r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/b659130053b8...e5f1dcae83ab",\r          "commits": [\r            {\r              "id": "0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r              "distinct": true,\r              "message": "Added Polish source",\r              "timestamp": "2015-04-25T17:52:39-07:00",\r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r              "author": {\r                "name": "Michal Migurski",\r                "email": "mike@teczno.com",\r                "username": "migurski"\r              },\r              "committer": {\r                "name": "Michal Migurski",\r                "email": "mike@teczno.com",\r                "username": "migurski"\r              },\r              "added": [\r                "sources/pl-dolnoslaskie.json"\r              ],\r              "removed": [\r\r              ],\r              "modified": [\r\r              ]\r            },\r            {\r              "id": "e5f1dcae83ab1ef1f736b969da617311f7f11564",\r              "distinct": true,\r              "message": "Removed Polish source",\r              "timestamp": "2015-04-25T17:52:46-07:00",\r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r              "author": {\r                "name": "Michal Migurski",\r                "email": "mike@teczno.com",\r                "username": "migurski"\r              },\r              "committer": {\r                "name": "Michal Migurski",\r                "email": "mike@teczno.com",\r                "username": "migurski"\r              },\r              "added": [\r\r              ],\r              "removed": [\r                "sources/pl-dolnoslaskie.json"\r              ],\r              "modified": [\r\r              ]\r            }\r          ],\r          "head_commit": {\r            "id": "e5f1dcae83ab1ef1f736b969da617311f7f11564",\r            "distinct": true,\r            "message": "Removed Polish source",\r            "timestamp": "2015-04-25T17:52:46-07:00",\r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r            "author": {\r              "name": "Michal Migurski",\r              "email": "mike@teczno.com",\r              "username": "migurski"\r            },\r            "committer": {\r              "name": "Michal Migurski",\r              "email": "mike@teczno.com",\r              "username": "migurski"\r            },\r            "added": [\r\r            ],\r            "removed": [\r              "sources/pl-dolnoslaskie.json"\r            ],\r            "modified": [\r\r            ]\r          },\r          "repository": {\r            "id": 34590951,\r            "name": "hooked-on-sources",\r            "full_name": "openaddresses/hooked-on-sources",\r            "owner": {\r              "name": "openaddresses",\r              "email": "openaddresses@gmail.com"\r            },\r            "private": false,\r            "html_url": "https://github.com/openaddresses/hooked-on-sources",\r            "description": "Temporary repository for testing Github webhook features",\r            "fork": false,\r            "url": "https://github.com/openaddresses/hooked-on-sources",\r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r            "created_at": 1430006167,\r            "updated_at": "2015-04-25T23:56:07Z",\r            "pushed_at": 1430009572,\r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r            "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r            "homepage": null,\r            "size": 0,\r            "stargazers_count": 0,\r            "watchers_count": 0,\r            "language": null,\r            "has_issues": true,\r            "has_downloads": true,\r            "has_wiki": true,\r            "has_pages": false,\r            "forks_count": 0,\r            "mirror_url": null,\r            "open_issues_count": 1,\r            "forks": 0,\r            "open_issues": 1,\r            "watchers": 0,\r            "default_branch": "master",\r            "stargazers": 0,\r            "master_branch": "master",\r            "organization": "openaddresses"\r          },\r          "pusher": {\r            "name": "migurski",\r            "email": "mike-github@teczno.com"\r          },\r          "organization": {\r            "login": "openaddresses",\r            "id": 6895392,\r            "url": "https://api.github.com/orgs/openaddresses",\r            "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r            "events_url": "https://api.github.com/orgs/openaddresses/events",\r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r            "description": "The free and open global address collection "\r          },\r          "sender": {\r            "login": "migurski",\r            "id": 58730,\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r            "gravatar_id": "",\r            "url": "https://api.github.com/users/migurski",\r            "html_url": "https://github.com/migurski",\r            "followers_url": "https://api.github.com/users/migurski/followers",\r            "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r            "organizations_url": "https://api.github.com/users/migurski/orgs",\r            "repos_url": "https://api.github.com/users/migurski/repos",\r            "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r            "received_events_url": "https://api.github.com/users/migurski/received_events",\r            "type": "User",\r            "site_admin": false\r          }\r        }'''
        owner3, repo3, commit3, surl3, curl3 = get_commit_info(logger, json.loads(data3), None)
        self.assertEqual((owner3, repo3), ('openaddresses', 'hooked-on-sources'))
        self.assertEqual(commit3, 'e5f1dcae83ab1ef1f736b969da617311f7f11564')
        self.assertIn(commit3, surl3)
        self.assertIsNone(curl3, 'Not looking for comment URLs in push events')

        data4 = '''{\r  "ref": "refs/heads/master",\r  "before": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r  "after": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r  "created": false,\r  "deleted": false,\r  "forced": false,\r  "base_ref": null,\r  "compare": "https://github.com/openaddresses/hooked-on-sources/compare/b450dcbb6f4c...3147668047a0",\r  "commits": [\r    {\r      "id": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "distinct": true,\r      "message": "Empty commit",\r      "timestamp": "2015-04-26T18:36:22-07:00",\r      "url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r\r      ]\r    }\r  ],\r  "head_commit": {\r    "id": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "distinct": true,\r    "message": "Empty commit",\r    "timestamp": "2015-04-26T18:36:22-07:00",\r    "url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "author": {\r      "name": "Michal Migurski",\r      "email": "mike@teczno.com",\r      "username": "migurski"\r    },\r    "committer": {\r      "name": "Michal Migurski",\r      "email": "mike@teczno.com",\r      "username": "migurski"\r    },\r    "added": [\r\r    ],\r    "removed": [\r\r    ],\r    "modified": [\r\r    ]\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "name": "openaddresses",\r      "email": "openaddresses@gmail.com"\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://github.com/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": 1430006167,\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": 1430098587,\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 0,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 0,\r    "mirror_url": null,\r    "open_issues_count": 1,\r    "forks": 0,\r    "open_issues": 1,\r    "watchers": 0,\r    "default_branch": "master",\r    "stargazers": 0,\r    "master_branch": "master",\r    "organization": "openaddresses"\r  },\r  "pusher": {\r    "name": "migurski",\r    "email": "mike-github@teczno.com"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        owner4, repo4, commit4, surl4, curl4 = get_commit_info(logger, json.loads(data4), None)
        self.assertEqual((owner4, repo4), ('openaddresses', 'hooked-on-sources'))
        self.assertEqual(commit4, '3147668047a0bec6d481c0e42995f7c5e5eac637')
        self.assertIn(commit4, surl4)
        self.assertIsNone(curl4, 'Not looking for comment URLs in push events')

        data5 = u'''{\r  "action": "opened",\r  "number": 4,\r  "pull_request": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4",\r    "id": 38716878,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/4",\r    "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.diff",\r    "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.patch",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4",\r    "number": 4,\r    "state": "open",\r    "locked": false,\r    "title": "Added La Réunion",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "body": "",\r    "created_at": "2015-06-27T22:51:14Z",\r    "updated_at": "2015-06-27T22:51:14Z",\r    "closed_at": null,\r    "merged_at": null,\r    "merge_commit_sha": null,\r    "assignee": null,\r    "milestone": null,\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits",\r    "review_comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments",\r    "review_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r    "head": {\r      "label": "migurski:master",\r      "ref": "master",\r      "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "user": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 38178103,\r        "name": "hooked-on-sources",\r        "full_name": "migurski/hooked-on-sources",\r        "owner": {\r          "login": "migurski",\r          "id": 58730,\r          "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/migurski",\r          "html_url": "https://github.com/migurski",\r          "followers_url": "https://api.github.com/users/migurski/followers",\r          "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r          "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r          "organizations_url": "https://api.github.com/users/migurski/orgs",\r          "repos_url": "https://api.github.com/users/migurski/repos",\r          "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/migurski/received_events",\r          "type": "User",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/migurski/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": true,\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/migurski/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/migurski/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/migurski/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/migurski/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/migurski/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/migurski/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/migurski/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/migurski/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/migurski/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/migurski/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/migurski/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/migurski/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/migurski/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/migurski/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/migurski/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/migurski/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/migurski/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/migurski/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/migurski/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/migurski/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/migurski/hooked-on-sources/releases{/id}",\r        "created_at": "2015-06-27T22:47:37Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:48:55Z",\r        "git_url": "git://github.com/migurski/hooked-on-sources.git",\r        "ssh_url": "git@github.com:migurski/hooked-on-sources.git",\r        "clone_url": "https://github.com/migurski/hooked-on-sources.git",\r        "svn_url": "https://github.com/migurski/hooked-on-sources",\r        "homepage": null,\r        "size": 192,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": false,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 0,\r        "mirror_url": null,\r        "open_issues_count": 0,\r        "forks": 0,\r        "open_issues": 0,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "base": {\r      "label": "openaddresses:master",\r      "ref": "master",\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "user": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 34590951,\r        "name": "hooked-on-sources",\r        "full_name": "openaddresses/hooked-on-sources",\r        "owner": {\r          "login": "openaddresses",\r          "id": 6895392,\r          "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/openaddresses",\r          "html_url": "https://github.com/openaddresses",\r          "followers_url": "https://api.github.com/users/openaddresses/followers",\r          "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r          "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r          "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r          "repos_url": "https://api.github.com/users/openaddresses/repos",\r          "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r          "type": "Organization",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/openaddresses/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": false,\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r        "created_at": "2015-04-25T23:56:07Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:49:30Z",\r        "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r        "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r        "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r        "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r        "homepage": null,\r        "size": 192,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": true,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 1,\r        "mirror_url": null,\r        "open_issues_count": 3,\r        "forks": 1,\r        "open_issues": 3,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "_links": {\r      "self": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4"\r      },\r      "html": {\r        "href": "https://github.com/openaddresses/hooked-on-sources/pull/4"\r      },\r      "issue": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4"\r      },\r      "comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments"\r      },\r      "review_comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments"\r      },\r      "review_comment": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}"\r      },\r      "commits": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits"\r      },\r      "statuses": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    },\r    "merged": false,\r    "mergeable": null,\r    "mergeable_state": "unknown",\r    "merged_by": null,\r    "comments": 0,\r    "review_comments": 0,\r    "commits": 1,\r    "additions": 22,\r    "deletions": 0,\r    "changed_files": 1\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": "2015-06-27T22:49:30Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 192,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 3,\r    "forks": 1,\r    "open_issues": 3,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        owner5, repo5, commit5, surl5, curl5 = get_commit_info(logger, json.loads(data5), None)
        self.assertEqual((owner5, repo5), ('openaddresses', 'hooked-on-sources'))
        self.assertEqual(commit5, 'aed74b0784f696c3cf10e8e260865ae18ffd3aa8')
        self.assertIn(commit5, surl5)
        self.assertIn('issues/4/comments', curl5)

        data6 = u'''{\r  "action": "synchronize",\r  "number": 4,\r  "pull_request": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4",\r    "id": 38716878,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/4",\r    "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.diff",\r    "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.patch",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4",\r    "number": 4,\r    "state": "open",\r    "locked": false,\r    "title": "Added La Réunion",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "body": "",\r    "created_at": "2015-06-27T22:51:14Z",\r    "updated_at": "2015-06-27T22:53:18Z",\r    "closed_at": null,\r    "merged_at": null,\r    "merge_commit_sha": "5a8e302cbb901925da71ab186308aa5aa2393ebe",\r    "assignee": null,\r    "milestone": null,\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits",\r    "review_comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments",\r    "review_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add",\r    "head": {\r      "label": "migurski:master",\r      "ref": "master",\r      "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "user": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 38178103,\r        "name": "hooked-on-sources",\r        "full_name": "migurski/hooked-on-sources",\r        "owner": {\r          "login": "migurski",\r          "id": 58730,\r          "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/migurski",\r          "html_url": "https://github.com/migurski",\r          "followers_url": "https://api.github.com/users/migurski/followers",\r          "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r          "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r          "organizations_url": "https://api.github.com/users/migurski/orgs",\r          "repos_url": "https://api.github.com/users/migurski/repos",\r          "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/migurski/received_events",\r          "type": "User",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/migurski/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": true,\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/migurski/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/migurski/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/migurski/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/migurski/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/migurski/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/migurski/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/migurski/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/migurski/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/migurski/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/migurski/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/migurski/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/migurski/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/migurski/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/migurski/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/migurski/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/migurski/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/migurski/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/migurski/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/migurski/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/migurski/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/migurski/hooked-on-sources/releases{/id}",\r        "created_at": "2015-06-27T22:47:37Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:53:18Z",\r        "git_url": "git://github.com/migurski/hooked-on-sources.git",\r        "ssh_url": "git@github.com:migurski/hooked-on-sources.git",\r        "clone_url": "https://github.com/migurski/hooked-on-sources.git",\r        "svn_url": "https://github.com/migurski/hooked-on-sources",\r        "homepage": null,\r        "size": 192,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": false,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 0,\r        "mirror_url": null,\r        "open_issues_count": 0,\r        "forks": 0,\r        "open_issues": 0,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "base": {\r      "label": "openaddresses:master",\r      "ref": "master",\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "user": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 34590951,\r        "name": "hooked-on-sources",\r        "full_name": "openaddresses/hooked-on-sources",\r        "owner": {\r          "login": "openaddresses",\r          "id": 6895392,\r          "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/openaddresses",\r          "html_url": "https://github.com/openaddresses",\r          "followers_url": "https://api.github.com/users/openaddresses/followers",\r          "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r          "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r          "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r          "repos_url": "https://api.github.com/users/openaddresses/repos",\r          "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r          "type": "Organization",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/openaddresses/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": false,\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r        "created_at": "2015-04-25T23:56:07Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:51:15Z",\r        "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r        "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r        "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r        "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r        "homepage": null,\r        "size": 192,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": true,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 1,\r        "mirror_url": null,\r        "open_issues_count": 3,\r        "forks": 1,\r        "open_issues": 3,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "_links": {\r      "self": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4"\r      },\r      "html": {\r        "href": "https://github.com/openaddresses/hooked-on-sources/pull/4"\r      },\r      "issue": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4"\r      },\r      "comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments"\r      },\r      "review_comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments"\r      },\r      "review_comment": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}"\r      },\r      "commits": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits"\r      },\r      "statuses": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add"\r      }\r    },\r    "merged": false,\r    "mergeable": null,\r    "mergeable_state": "unknown",\r    "merged_by": null,\r    "comments": 0,\r    "review_comments": 0,\r    "commits": 2,\r    "additions": 23,\r    "deletions": 0,\r    "changed_files": 1\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": "2015-06-27T22:51:15Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 192,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 3,\r    "forks": 1,\r    "open_issues": 3,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        owner6, repo6, commit6, surl6, curl6 = get_commit_info(logger, json.loads(data6), None)
        self.assertEqual((owner6, repo6), ('openaddresses', 'hooked-on-sources'))
        self.assertEqual(commit6, '6460668909a85d9db8df871d91e9b25bc5192add')
        self.assertIn(commit6, surl6)
        self.assertIn('issues/4/comments', curl6)

        data7 = u'''{\r  "ref": "refs/heads/master",\r  "before": "c3c7de37f96d38534dc6297a2483c218994241b6",\r  "after": "8dd262c2f30a70b27e371869c54315b1abc32247",\r  "created": false,\r  "deleted": false,\r  "forced": false,\r  "base_ref": null,\r  "compare": "https://github.com/openaddresses/hooked-on-sources/compare/c3c7de37f96d...8dd262c2f30a",\r  "commits": [\r    {\r      "id": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "distinct": true,\r      "message": "Added La Réunion",\r      "timestamp": "2015-06-27T15:48:33-07:00",\r      "url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r        "sources/fr/la-réunion.json"\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r\r      ]\r    },\r    {\r      "id": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "distinct": true,\r      "message": "Added Latin-1 encoding",\r      "timestamp": "2015-06-27T15:53:19-07:00",\r      "url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r        "sources/fr/la-réunion.json"\r      ]\r    },\r    {\r      "id": "8dd262c2f30a70b27e371869c54315b1abc32247",\r      "distinct": true,\r      "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r      "timestamp": "2015-06-27T15:55:38-07:00",\r      "url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r        "sources/fr/la-réunion.json"\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r\r      ]\r    }\r  ],\r  "head_commit": {\r    "id": "8dd262c2f30a70b27e371869c54315b1abc32247",\r    "distinct": true,\r    "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r    "timestamp": "2015-06-27T15:55:38-07:00",\r    "url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r    "author": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "username": "migurski"\r    },\r    "committer": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "username": "migurski"\r    },\r    "added": [\r      "sources/fr/la-réunion.json"\r    ],\r    "removed": [\r\r    ],\r    "modified": [\r\r    ]\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "name": "openaddresses",\r      "email": "openaddresses@gmail.com"\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://github.com/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": 1430006167,\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": 1435445738,\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 268,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 2,\r    "forks": 1,\r    "open_issues": 2,\r    "watchers": 0,\r    "default_branch": "master",\r    "stargazers": 0,\r    "master_branch": "master",\r    "organization": "openaddresses"\r  },\r  "pusher": {\r    "name": "migurski",\r    "email": "mike-github@teczno.com"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        owner7, repo7, commit7, surl7, curl7 = get_commit_info(logger, json.loads(data7), None)
        self.assertEqual((owner7, repo7), ('openaddresses', 'hooked-on-sources'))
        self.assertEqual(commit7, '8dd262c2f30a70b27e371869c54315b1abc32247')
        self.assertIn(commit7, surl7)
        self.assertIsNone(curl7, 'Not looking for comment URLs in push events')

        data8 = u'''{\r  "action": "closed",\r  "number": 4,\r  "pull_request": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4",\r    "id": 38716878,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/4",\r    "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.diff",\r    "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.patch",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4",\r    "number": 4,\r    "state": "closed",\r    "locked": false,\r    "title": "Added La Réunion",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "body": "",\r    "created_at": "2015-06-27T22:51:14Z",\r    "updated_at": "2015-06-27T22:55:38Z",\r    "closed_at": "2015-06-27T22:55:38Z",\r    "merged_at": "2015-06-27T22:55:38Z",\r    "merge_commit_sha": "a24d66f118649a3ff5bf5731f5c54933b94cac8d",\r    "assignee": null,\r    "milestone": null,\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits",\r    "review_comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments",\r    "review_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add",\r    "head": {\r      "label": "migurski:master",\r      "ref": "master",\r      "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "user": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 38178103,\r        "name": "hooked-on-sources",\r        "full_name": "migurski/hooked-on-sources",\r        "owner": {\r          "login": "migurski",\r          "id": 58730,\r          "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/migurski",\r          "html_url": "https://github.com/migurski",\r          "followers_url": "https://api.github.com/users/migurski/followers",\r          "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r          "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r          "organizations_url": "https://api.github.com/users/migurski/orgs",\r          "repos_url": "https://api.github.com/users/migurski/repos",\r          "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/migurski/received_events",\r          "type": "User",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/migurski/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": true,\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/migurski/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/migurski/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/migurski/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/migurski/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/migurski/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/migurski/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/migurski/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/migurski/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/migurski/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/migurski/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/migurski/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/migurski/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/migurski/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/migurski/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/migurski/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/migurski/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/migurski/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/migurski/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/migurski/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/migurski/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/migurski/hooked-on-sources/releases{/id}",\r        "created_at": "2015-06-27T22:47:37Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:53:18Z",\r        "git_url": "git://github.com/migurski/hooked-on-sources.git",\r        "ssh_url": "git@github.com:migurski/hooked-on-sources.git",\r        "clone_url": "https://github.com/migurski/hooked-on-sources.git",\r        "svn_url": "https://github.com/migurski/hooked-on-sources",\r        "homepage": null,\r        "size": 88,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": false,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 0,\r        "mirror_url": null,\r        "open_issues_count": 0,\r        "forks": 0,\r        "open_issues": 0,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "base": {\r      "label": "openaddresses:master",\r      "ref": "master",\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "user": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 34590951,\r        "name": "hooked-on-sources",\r        "full_name": "openaddresses/hooked-on-sources",\r        "owner": {\r          "login": "openaddresses",\r          "id": 6895392,\r          "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/openaddresses",\r          "html_url": "https://github.com/openaddresses",\r          "followers_url": "https://api.github.com/users/openaddresses/followers",\r          "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r          "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r          "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r          "repos_url": "https://api.github.com/users/openaddresses/repos",\r          "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r          "type": "Organization",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/openaddresses/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": false,\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r        "created_at": "2015-04-25T23:56:07Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:55:38Z",\r        "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r        "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r        "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r        "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r        "homepage": null,\r        "size": 268,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": true,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 1,\r        "mirror_url": null,\r        "open_issues_count": 2,\r        "forks": 1,\r        "open_issues": 2,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "_links": {\r      "self": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4"\r      },\r      "html": {\r        "href": "https://github.com/openaddresses/hooked-on-sources/pull/4"\r      },\r      "issue": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4"\r      },\r      "comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments"\r      },\r      "review_comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments"\r      },\r      "review_comment": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}"\r      },\r      "commits": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits"\r      },\r      "statuses": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add"\r      }\r    },\r    "merged": true,\r    "mergeable": null,\r    "mergeable_state": "unknown",\r    "merged_by": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "comments": 0,\r    "review_comments": 0,\r    "commits": 2,\r    "additions": 23,\r    "deletions": 0,\r    "changed_files": 1\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": "2015-06-27T22:55:38Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 268,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 2,\r    "forks": 1,\r    "open_issues": 2,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        owner8, repo8, commit8, surl8, curl8 = get_commit_info(logger, json.loads(data8), None)
        self.assertEqual((owner8, repo8), ('openaddresses', 'hooked-on-sources'))
        self.assertEqual(commit8, '6460668909a85d9db8df871d91e9b25bc5192add')
        self.assertIn(commit8, surl8)
        self.assertIn('issues/4/comments', curl8)

        data9 = '''{\r  "ref": "refs/heads/master",\r  "before": "6a7b18728673fc7621bb46ed1a445611f33324f9",\r  "after": "bba8f709793f96750fed223d44ba373a92540b2a",\r  "created": false,\r  "deleted": false,\r  "forced": false,\r  "base_ref": null,\r  "compare": "https://github.com/openaddresses/openaddresses/compare/6a7b18728673...bba8f709793f",\r  "commits": [\r    {\r      "id": "e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r      "distinct": true,\r      "message": "Update San Diego County coverage (rename as county, update as county, add source details)",\r      "timestamp": "2015-06-21T12:45:12-07:00",\r      "url": "https://github.com/openaddresses/openaddresses/commit/e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r      "author": {\r        "name": "Dave Guarino",\r        "email": "dave@codeforamerica.org",\r        "username": "daguar"\r      },\r      "committer": {\r        "name": "Dave Guarino",\r        "email": "dave@codeforamerica.org",\r        "username": "daguar"\r      },\r      "added": [\r        "sources/us-ca-san_diego_county.json"\r      ],\r      "removed": [\r        "sources/us-ca-san_diego.json"\r      ],\r      "modified": [\r\r      ]\r    },\r    {\r      "id": "f85074d543622ef1fac7a80a059a50176f2a6e08",\r      "distinct": true,\r      "message": "Fix San Diego County changes (key should be 'note' not 'notes')",\r      "timestamp": "2015-06-21T13:07:58-07:00",\r      "url": "https://github.com/openaddresses/openaddresses/commit/f85074d543622ef1fac7a80a059a50176f2a6e08",\r      "author": {\r        "name": "Dave Guarino",\r        "email": "dave@codeforamerica.org",\r        "username": "daguar"\r      },\r      "committer": {\r        "name": "Dave Guarino",\r        "email": "dave@codeforamerica.org",\r        "username": "daguar"\r      },\r      "added": [\r\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r        "sources/us-ca-san_diego_county.json"\r      ]\r    },\r    {\r      "id": "bba8f709793f96750fed223d44ba373a92540b2a",\r      "distinct": true,\r      "message": "Merge pull request #1036 from daguar/fix-coverage-of-san-diego-county\\n\\nUpdate San Diego County coverage and details",\r      "timestamp": "2015-06-21T13:25:01-07:00",\r      "url": "https://github.com/openaddresses/openaddresses/commit/bba8f709793f96750fed223d44ba373a92540b2a",\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r        "sources/us-ca-san_diego_county.json"\r      ],\r      "removed": [\r        "sources/us-ca-san_diego.json"\r      ],\r      "modified": [\r\r      ]\r    }\r  ],\r  "head_commit": {\r    "id": "bba8f709793f96750fed223d44ba373a92540b2a",\r    "distinct": true,\r    "message": "Merge pull request #1036 from daguar/fix-coverage-of-san-diego-county\\n\\nUpdate San Diego County coverage and details",\r    "timestamp": "2015-06-21T13:25:01-07:00",\r    "url": "https://github.com/openaddresses/openaddresses/commit/bba8f709793f96750fed223d44ba373a92540b2a",\r    "author": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "username": "migurski"\r    },\r    "committer": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "username": "migurski"\r    },\r    "added": [\r      "sources/us-ca-san_diego_county.json"\r    ],\r    "removed": [\r      "sources/us-ca-san_diego.json"\r    ],\r    "modified": [\r\r    ]\r  },\r  "repository": {\r    "id": 16594532,\r    "name": "openaddresses",\r    "full_name": "openaddresses/openaddresses",\r    "owner": {\r      "name": "openaddresses",\r      "email": "openaddresses@gmail.com"\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/openaddresses",\r    "description": "A repository of address data.",\r    "fork": false,\r    "url": "https://github.com/openaddresses/openaddresses",\r    "forks_url": "https://api.github.com/repos/openaddresses/openaddresses/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/openaddresses/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/openaddresses/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/openaddresses/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/openaddresses/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/openaddresses/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/openaddresses/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/openaddresses/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/openaddresses/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/openaddresses/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/openaddresses/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/openaddresses/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/openaddresses/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/openaddresses/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/openaddresses/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/openaddresses/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/openaddresses/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/openaddresses/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/openaddresses/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/openaddresses/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/openaddresses/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/openaddresses/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/openaddresses/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/openaddresses/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/openaddresses/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/openaddresses/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/openaddresses/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/openaddresses/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/openaddresses/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/openaddresses/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/openaddresses/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/openaddresses/releases{/id}",\r    "created_at": 1391722160,\r    "updated_at": "2015-06-18T09:14:44Z",\r    "pushed_at": 1434918301,\r    "git_url": "git://github.com/openaddresses/openaddresses.git",\r    "ssh_url": "git@github.com:openaddresses/openaddresses.git",\r    "clone_url": "https://github.com/openaddresses/openaddresses.git",\r    "svn_url": "https://github.com/openaddresses/openaddresses",\r    "homepage": "http://openaddresses.io/",\r    "size": 10029,\r    "stargazers_count": 276,\r    "watchers_count": 276,\r    "language": "JavaScript",\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 315,\r    "mirror_url": null,\r    "open_issues_count": 216,\r    "forks": 315,\r    "open_issues": 216,\r    "watchers": 276,\r    "default_branch": "master",\r    "stargazers": 276,\r    "master_branch": "master",\r    "organization": "openaddresses"\r  },\r  "pusher": {\r    "name": "migurski",\r    "email": "mike-github@teczno.com"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        owner9, repo9, commit9, surl9, curl9 = get_commit_info(logger, json.loads(data9), None)
        self.assertEqual((owner9, repo9), ('openaddresses', 'openaddresses'))
        self.assertEqual(commit9, 'bba8f709793f96750fed223d44ba373a92540b2a')
        self.assertIn(commit9, surl9)
        self.assertIsNone(curl9, 'Not looking for comment URLs in push events')

        with HTTMock(self.response_content):
            data10 = '''{\r  "action": "created",\r  "issue": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r    "repository_url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/labels{/name}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/comments",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/events",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2",\r    "id": 72723825,\r    "number": 2,\r    "title": "Testing this time with a PR",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "labels": [\r\r    ],\r    "state": "open",\r    "locked": false,\r    "assignee": null,\r    "assignees": [\r\r    ],\r    "milestone": null,\r    "comments": 1,\r    "created_at": "2015-05-03T00:35:48Z",\r    "updated_at": "2016-09-21T02:58:43Z",\r    "closed_at": null,\r    "pull_request": {\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/2",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2",\r      "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/2.diff",\r      "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/2.patch"\r    },\r    "body": ""\r  },\r  "comment": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/248497705",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2#issuecomment-248497705",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r    "id": 248497705,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-09-21T02:58:43Z",\r    "updated_at": "2016-09-21T02:58:43Z",\r    "body": "Maybe this comment will go through."\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "deployments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/deployments",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": "2015-06-27T22:55:38Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 230,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 2,\r    "forks": 1,\r    "open_issues": 2,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "hooks_url": "https://api.github.com/orgs/openaddresses/hooks",\r    "issues_url": "https://api.github.com/orgs/openaddresses/issues",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
            owner10, repo10, commit10, surl10, curl10 = get_commit_info(logger, json.loads(data10), None)
            self.assertEqual((owner10, repo10), ('openaddresses', 'hooked-on-sources'))
            self.assertEqual(commit10, '37e992e9f2aa14265588ca8b214e001e1628f53c')
            self.assertIn(commit10, surl10)
            self.assertIn('issues/2/comments', curl10)
    
    def response_content(self, url, request):
        '''
        '''
        query = dict(parse_qsl(url.query))
        MHP = request.method, url.hostname, url.path
        GH, response_headers = 'api.github.com', {'Content-Type': 'application/json; charset=utf-8'}
        
        if MHP == ('GET', GH, '/'):
            data = u'''{\r  "current_user_url": "https://api.github.com/user",\r  "current_user_authorizations_html_url": "https://github.com/settings/connections/applications{/client_id}",\r  "authorizations_url": "https://api.github.com/authorizations",\r  "code_search_url": "https://api.github.com/search/code?q={query}{&page,per_page,sort,order}",\r  "emails_url": "https://api.github.com/user/emails",\r  "emojis_url": "https://api.github.com/emojis",\r  "events_url": "https://api.github.com/events",\r  "feeds_url": "https://api.github.com/feeds",\r  "following_url": "https://api.github.com/user/following{/target}",\r  "gists_url": "https://api.github.com/gists{/gist_id}",\r  "hub_url": "https://api.github.com/hub",\r  "issue_search_url": "https://api.github.com/search/issues?q={query}{&page,per_page,sort,order}",\r  "issues_url": "https://api.github.com/issues",\r  "keys_url": "https://api.github.com/user/keys",\r  "notifications_url": "https://api.github.com/notifications",\r  "organization_repositories_url": "https://api.github.com/orgs/{org}/repos{?type,page,per_page,sort}",\r  "organization_url": "https://api.github.com/orgs/{org}",\r  "public_gists_url": "https://api.github.com/gists/public",\r  "rate_limit_url": "https://api.github.com/rate_limit",\r  "repository_url": "https://api.github.com/repos/{owner}/{repo}",\r  "repository_search_url": "https://api.github.com/search/repositories?q={query}{&page,per_page,sort,order}",\r  "current_user_repositories_url": "https://api.github.com/user/repos{?type,page,per_page,sort}",\r  "starred_url": "https://api.github.com/user/starred{/owner}{/repo}",\r  "starred_gists_url": "https://api.github.com/gists/starred",\r  "team_url": "https://api.github.com/teams",\r  "user_url": "https://api.github.com/users/{user}",\r  "user_organizations_url": "https://api.github.com/user/orgs",\r  "user_repositories_url": "https://api.github.com/users/{user}/repos{?type,page,per_page,sort}",\r  "user_search_url": "https://api.github.com/search/users?q={query}{&page,per_page,sort,order}"\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources'):
            data = u'''{\r  "id": 34590951,\r  "name": "hooked-on-sources",\r  "full_name": "openaddresses/hooked-on-sources",\r  "owner": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/openaddresses",\r    "html_url": "https://github.com/openaddresses",\r    "followers_url": "https://api.github.com/users/openaddresses/followers",\r    "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r    "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r    "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r    "repos_url": "https://api.github.com/users/openaddresses/repos",\r    "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r    "type": "Organization",\r    "site_admin": false\r  },\r  "private": false,\r  "html_url": "https://github.com/openaddresses/hooked-on-sources",\r  "description": "Temporary repository for testing Github webhook features",\r  "fork": false,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r  "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r  "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r  "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r  "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r  "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r  "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r  "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r  "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r  "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r  "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r  "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r  "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r  "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r  "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r  "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r  "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r  "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r  "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r  "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r  "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r  "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r  "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r  "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r  "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r  "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r  "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r  "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r  "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r  "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r  "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r  "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r  "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r  "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r  "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r  "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r  "created_at": "2015-04-25T23:56:07Z",\r  "updated_at": "2015-04-25T23:56:07Z",\r  "pushed_at": "2015-06-27T22:55:38Z",\r  "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r  "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r  "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r  "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r  "homepage": null,\r  "size": 230,\r  "stargazers_count": 0,\r  "watchers_count": 0,\r  "language": null,\r  "has_issues": true,\r  "has_downloads": true,\r  "has_wiki": true,\r  "has_pages": false,\r  "forks_count": 1,\r  "mirror_url": null,\r  "open_issues_count": 2,\r  "forks": 1,\r  "open_issues": 2,\r  "watchers": 0,\r  "default_branch": "master",\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/openaddresses",\r    "html_url": "https://github.com/openaddresses",\r    "followers_url": "https://api.github.com/users/openaddresses/followers",\r    "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r    "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r    "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r    "repos_url": "https://api.github.com/users/openaddresses/repos",\r    "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r    "type": "Organization",\r    "site_admin": false\r  },\r  "network_count": 1,\r  "subscribers_count": 10\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-alameda_county.json') and query.get('ref', '').startswith('e91fbc'):
            data = '''{\r              "name": "us-ca-alameda_county.json",\r              "path": "sources/us-ca-alameda_county.json",\r              "sha": "c9cd0ed30256ae64d5924b03b0423346501b92d8",\r              "size": 745,\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-alameda_county.json?ref=e91fbc420f08890960f50f863626e1062f922522",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/e91fbc420f08890960f50f863626e1062f922522/sources/us-ca-alameda_county.json",\r              "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r              "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/e91fbc420f08890960f50f863626e1062f922522/sources/us-ca-alameda_county.json",\r              "type": "file",\r              "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAgICJnZW9pZCI6ICIwNjAwMSIsCiAgICAgICAgICAgICJuYW1l\\nIjogIkFsYW1lZGEgQ291bnR5IiwKICAgICAgICAgICAgInN0YXRlIjogIkNh\\nbGlmb3JuaWEiCiAgICAgICAgfSwKICAgICAgICAiY291bnRyeSI6ICJ1cyIs\\nCiAgICAgICAgInN0YXRlIjogImNhIiwKICAgICAgICAiY291bnR5IjogIkFs\\nYW1lZGEiCiAgICB9LAogICAgImRhdGEiOiAiaHR0cHM6Ly9kYXRhLmFjZ292\\nLm9yZy9hcGkvZ2Vvc3BhdGlhbC84ZTRzLTdmNHY/bWV0aG9kPWV4cG9ydCZm\\nb3JtYXQ9T3JpZ2luYWwiLAogICAgImxpY2Vuc2UiOiAiaHR0cDovL3d3dy5h\\nY2dvdi5vcmcvYWNkYXRhL3Rlcm1zLmh0bSIsCiAgICAiYXR0cmlidXRpb24i\\nOiAiQWxhbWVkYSBDb3VudHkiLAogICAgInllYXIiOiAiIiwKICAgICJ0eXBl\\nIjogImh0dHAiLAogICAgImNvbXByZXNzaW9uIjogInppcCIsCiAgICAiY29u\\nZm9ybSI6IHsKICAgICAgICAibWVyZ2UiOiBbCiAgICAgICAgICAgICJmZWFu\\nbWUiLAogICAgICAgICAgICAiZmVhdHlwIgogICAgICAgIF0sCiAgICAgICAg\\nImxvbiI6ICJ4IiwKICAgICAgICAibGF0IjogInkiLAogICAgICAgICJudW1i\\nZXIiOiAic3RfbnVtIiwKICAgICAgICAic3RyZWV0IjogImF1dG9fc3RyZWV0\\nIiwKICAgICAgICAidHlwZSI6ICJzaGFwZWZpbGUiLAogICAgICAgICJwb3N0\\nY29kZSI6ICJ6aXBjb2RlIgogICAgfQp9Cg==\\n",\r              "encoding": "base64",\r              "_links": {\r                "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-alameda_county.json?ref=e91fbc420f08890960f50f863626e1062f922522",\r                "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r                "html": "https://github.com/openaddresses/hooked-on-sources/blob/e91fbc420f08890960f50f863626e1062f922522/sources/us-ca-alameda_county.json"\r              }\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json') and query.get('ref', '').startswith('ded44e'):
            data = '''{\r              "name": "us-ca-san_francisco.json",\r              "path": "sources/us-ca-san_francisco.json",\r              "sha": "cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r              "size": 519,\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json?ref=ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/sources/us-ca-san_francisco.json",\r              "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r              "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/sources/us-ca-san_francisco.json",\r              "type": "file",\r              "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJjb3VudHJ5IjogInVzIiwK\\nICAgICAgICAic3RhdGUiOiAiY2EiLAogICAgICAgICJjaXR5IjogIlNhbiBG\\ncmFuY2lzY28iCiAgICB9LAogICAgImF0dHJpYnV0aW9uIjogIkNpdHkgb2Yg\\nU2FuIEZyYW5jaXNjbyIsCiAgICAiZGF0YSI6ICJodHRwczovL2RhdGEuc2Zn\\nb3Yub3JnL2Rvd25sb2FkL2t2ZWotdzVrYi9aSVBQRUQlMjBTSEFQRUZJTEUi\\nLAogICAgImxpY2Vuc2UiOiAiIiwKICAgICJ5ZWFyIjogIiIsCiAgICAidHlw\\nZSI6ICJodHRwIiwKICAgICJjb21wcmVzc2lvbiI6ICJ6aXAiLAogICAgImNv\\nbmZvcm0iOiB7Cgkic3BsaXQiOiAiQUREUkVTUyIsCiAgICAgICAgImxvbiI6\\nICJ4IiwKICAgICAgICAibGF0IjogInkiLAogICAgICAgICJudW1iZXIiOiAi\\nYXV0b19udW1iZXIiLAogICAgICAgICJzdHJlZXQiOiAiYXV0b19zdHJlZXQi\\nLAogICAgICAgICJ0eXBlIjogInNoYXBlZmlsZSIsCiAgICAgICAgInBvc3Rj\\nb2RlIjogInppcGNvZGUiCiAgICB9Cn0K\\n",\r              "encoding": "base64",\r              "_links": {\r                "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json?ref=ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r                "html": "https://github.com/openaddresses/hooked-on-sources/blob/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/sources/us-ca-san_francisco.json"\r              }\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json') and query.get('ref', '').startswith('ded44e'):
            data = '''{\r              "name": "us-ca-berkeley.json",\r              "path": "sources/us-ca-berkeley.json",\r              "sha": "16464c39b59b5a09c6526da3afa9a5f57caabcad",\r              "size": 779,\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json?ref=ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/sources/us-ca-berkeley.json",\r              "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/16464c39b59b5a09c6526da3afa9a5f57caabcad",\r              "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/sources/us-ca-berkeley.json",\r              "type": "file",\r              "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAgICJnZW9pZCI6ICIwNjA2MDAwIiwKICAgICAgICAgICAgInBs\\nYWNlIjogIkJlcmtlbGV5IiwKICAgICAgICAgICAgInN0YXRlIjogIkNhbGlm\\nb3JuaWEiCiAgICAgICAgfSwKICAgICAgICAiY291bnRyeSI6ICJ1cyIsCiAg\\nICAgICAgInN0YXRlIjogImNhIiwKICAgICAgICAicGxhY2UiOiAiQmVya2Vs\\nZXkiCiAgICB9LAogICAgImF0dHJpYnV0aW9uIjogIkNpdHkgb2YgQmVya2Vs\\nZXkiLAogICAgImRhdGEiOiAiaHR0cDovL3d3dy5jaS5iZXJrZWxleS5jYS51\\ncy91cGxvYWRlZEZpbGVzL0lUL0dJUy9QYXJjZWxzLnppcCIsCiAgICAid2Vi\\nc2l0ZSI6ICJodHRwOi8vd3d3LmNpLmJlcmtlbGV5LmNhLnVzL2RhdGFjYXRh\\nbG9nLyIsCiAgICAidHlwZSI6ICJodHRwIiwKICAgICJjb21wcmVzc2lvbiI6\\nICJ6aXAiLAogICAgIm5vdGUiOiAiTWV0YWRhdGEgYXQgaHR0cDovL3d3dy5j\\naS5iZXJrZWxleS5jYS51cy91cGxvYWRlZEZpbGVzL0lUL0dJUy9QYXJjZWxz\\nLnNocCgxKS54bWwiLAogICAgImNvbmZvcm0iOiB7CiAgICAgICAgImxvbiI6\\nICJ4IiwKICAgICAgICAibGF0IjogInkiLAogICAgICAgICJudW1iZXIiOiAi\\nU3RyZWV0TnVtIiwKICAgICAgICAibWVyZ2UiOiBbIlN0cmVldE5hbWUiLCAi\\nU3RyZWV0U3VmeCIsICJEaXJlY3Rpb24iXSwKICAgICAgICAic3RyZWV0Ijog\\nImF1dG9fc3RyZWV0IiwKICAgICAgICAidHlwZSI6ICJzaGFwZWZpbGUtcG9s\\neWdvbiIKICAgIH0KfQo=\\n",\r              "encoding": "base64",\r              "_links": {\r                "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json?ref=ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/16464c39b59b5a09c6526da3afa9a5f57caabcad",\r                "html": "https://github.com/openaddresses/hooked-on-sources/blob/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/sources/us-ca-berkeley.json"\r              }\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-santa_clara_county.json') and query.get('ref', '').startswith('e5f1dc'):
            data = '''{\r              "name": "us-ca-santa_clara_county.json",\r              "path": "sources/us-ca-santa_clara_county.json",\r              "sha": "84abff13dba318189f1f4d5c1605478127ceff5c",\r              "size": 908,\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-santa_clara_county.json?ref=e5f1dcae83ab1ef1f736b969da617311f7f11564",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/e5f1dcae83ab1ef1f736b969da617311f7f11564/sources/us-ca-santa_clara_county.json",\r              "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/84abff13dba318189f1f4d5c1605478127ceff5c",\r              "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/e5f1dcae83ab1ef1f736b969da617311f7f11564/sources/us-ca-santa_clara_county.json",\r              "type": "file",\r              "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7Imdl\\nb2lkIjogIjA2MDg1IiwgIm5hbWUiOiAiU2FudGEgQ2xhcmEgQ291bnR5Iiwg\\nInN0YXRlIjogIkNhbGlmb3JuaWEifSwKICAgICAgICAiY291bnRyeSI6ICJ1\\ncyIsCiAgICAgICAgInN0YXRlIjogImNhIiwKICAgICAgICAiY291bnR5Ijog\\nIlNhbnRhIENsYXJhIgogICAgfSwKICAgICJjb25mb3JtIjogewogICAgICAg\\nICJ0eXBlIjogInNoYXBlZmlsZSIsCiAgICAgICAgInBvc3Rjb2RlIjogIlpJ\\nUENPREUiLAogICAgICAgICJjaXR5IjogIkNJVFkiLAogICAgICAgICJudW1i\\nZXIiOiAiSE9VU0VOVU1URSIsCiAgICAgICAgIm1lcmdlIjogWyJTVFJFRVRO\\nQU1FIiwgIlNUUkVFVFRZUEUiXSwKICAgICAgICAic3RyZWV0IjogImF1dG9f\\nc3RyZWV0IiwKICAgICAgICAibG9uIjogIngiLAogICAgICAgICJsYXQiOiAi\\neSIKICAgIH0sCiAgICAiYXR0cmlidXRpb24iOiAiU2FudGEgQ2xhcmEgQ291\\nbnR5IiwKICAgICJkYXRhIjogImh0dHBzOi8vZ2l0aHViLmNvbS9kYXRhZGVz\\nay91cy1jYS1zYW50YV9jbGFyYV9jb3VudHktZ2lzLXNocC9ibG9iL21hc3Rl\\nci9RNF9GWTE0X0FkZHJlc3NfUG9pbnQuemlwP3Jhdz10cnVlIiwKICAgICJ3\\nZWJzaXRlIjogImh0dHBzOi8vc2Z0cC5zY2Nnb3Yub3JnL2NvdXJpZXIvd2Vi\\nLzEwMDBAL3dtTG9naW4uaHRtbCIsCiAgICAidHlwZSI6ICJodHRwIiwKICAg\\nICJjb21wcmVzc2lvbiI6ICJ6aXAiLAogICAgIm5vdGUiOiAiRmlsZSBkb3du\\nbG9hZCBpcyBiZWhpbmQgYSByZWdpc3RyYXRpb24gd2FsbCBvbiBnb3Zlcm5t\\nZW50IHNpdGUgc28gdGhlIHppcCB3YXMgZG93bmxvYWRlZCBpbiBOb3ZlbWJl\\nciAyMDE0IGFuZCB1cGxvYWRlZCB0byBHaXRIdWIgZm9yIHB1YmxpYyBob3N0\\naW5nLiIKfQo=\\n",\r              "encoding": "base64",\r              "_links": {\r                "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-santa_clara_county.json?ref=e5f1dcae83ab1ef1f736b969da617311f7f11564",\r                "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/84abff13dba318189f1f4d5c1605478127ceff5c",\r                "html": "https://github.com/openaddresses/hooked-on-sources/blob/e5f1dcae83ab1ef1f736b969da617311f7f11564/sources/us-ca-santa_clara_county.json"\r              }\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-badjson_county.json') and query.get('ref', '').startswith('badjson'):
            data = '''{\r              "name": "us-ca-badjson_county.json",\r              "path": "sources/us-ca-badjson_county.json",\r              "sha": "c9cd0ed30256ae64d5924b03b0423346501b92d8",\r              "size": 745,\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-badjson_county.json?ref=badjson20f08890960f50f863626e1062f922522",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/badjson20f08890960f50f863626e1062f922522/sources/us-ca-badjson_county.json",\r              "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r              "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/badjson20f08890960f50f863626e1062f922522/sources/us-ca-badjson_county.json",\r              "type": "file",\r              "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAgICAgICAgICAgICJnZW9pZCI6ICIwNjAwMSIsCiAgICAgICAgICAgICJuYW1lIjogIkFsYW1lZGEgQ291bnR5IiwKICAgICAgICAgICAgInN0YXRlIjogIkNhbGlmb3JuaWEiCiAgICAgICAgfSwKICAgICAgICAiY291bnRyeSI6ICJ1cyIsCiAgICAgICAgInN0YXRlIjogImNhIiwKICAgICAgICAiY291bnR5IjogIkFsYW1lZGEiCiAgICB9CiAgICAiZGF0YSI6ICJodHRwczovL2RhdGEuYWNnb3Yub3JnL2FwaS9nZW9zcGF0aWFsLzhlNHMtN2Y0dj9tZXRob2Q9ZXhwb3J0JmZvcm1hdD1PcmlnaW5hbCIsCiAgICAibGljZW5zZSI6ICJodHRwOi8vd3d3LmFjZ292Lm9yZy9hY2RhdGEvdGVybXMuaHRtIiwKICAgICJhdHRyaWJ1dGlvbiI6ICJBbGFtZWRhIENvdW50eSIsCiAgICAieWVhciI6ICIiLAogICAgInR5cGUiOiAiaHR0cCIsCiAgICAiY29tcHJlc3Npb24iOiAiemlwIiwKICAgICJjb25mb3JtIjogewogICAgICAgICJtZXJnZSI6IFsKICAgICAgICAgICAgImZlYW5tZSIsCiAgICAgICAgICAgICJmZWF0eXAiCiAgICAgICAgXSwKICAgICAgICAibG9uIjogIngiLAogICAgICAgICJsYXQiOiAieSIsCiAgICAgICAgIm51bWJlciI6ICJzdF9udW0iLAogICAgICAgICJzdHJlZXQiOiAiYXV0b19zdHJlZXQiLAogICAgICAgICJ0eXBlIjogInNoYXBlZmlsZSIsCiAgICAgICAgInBvc3Rjb2RlIjogInppcGNvZGUiCiAgICB9Cn0K",\r              "encoding": "base64",\r              "_links": {\r                "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-badjson_county.json?ref=badjson20f08890960f50f863626e1062f922522",\r                "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r                "html": "https://github.com/openaddresses/hooked-on-sources/blob/badjson20f08890960f50f863626e1062f922522/sources/us-ca-badjson_county.json"\r              }\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-badutf8_county.json') and query.get('ref', '').startswith('badutf8'):
            data = '''{\r              "name": "us-ca-badutf8_county.json",\r              "path": "sources/us-ca-badutf8_county.json",\r              "sha": "c9cd0ed30256ae64d5924b03b0423346501b92d8",\r              "size": 745,\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-badutf8_county.json?ref=badutf820f08890960f50f863626e1062f922522",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/badutf820f08890960f50f863626e1062f922522/sources/us-ca-badutf8_county.json",\r              "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r              "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/badutf820f08890960f50f863626e1062f922522/sources/us-ca-badutf8_county.json",\r              "type": "file",\r              "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAgICAgICAgICAgICJnZW9pZCI6ICIwNjAwMSIsCiAgICAgICAgICAgICJuYW1lIjogIkFsYW1lZGEgQ/Z1bnR5IiwKICAgICAgICAgICAgInN0YXRlIjogIkNhbGlmb3JuaWEiCiAgICAgICAgfSwKICAgICAgICAiY291bnRyeSI6ICJ1cyIsCiAgICAgICAgInN0YXRlIjogImNhIiwKICAgICAgICAiY291bnR5IjogIkFsYW1lZGEiCiAgICB9LAogICAgImRhdGEiOiAiaHR0cHM6Ly9kYXRhLmFjZ292Lm9yZy9hcGkvZ2Vvc3BhdGlhbC84ZTRzLTdmNHY/bWV0aG9kPWV4cG9ydCZmb3JtYXQ9T3JpZ2luYWwiLAogICAgImxpY2Vuc2UiOiAiaHR0cDovL3d3dy5hY2dvdi5vcmcvYWNkYXRhL3Rlcm1zLmh0bSIsCiAgICAiYXR0cmlidXRpb24iOiAiQWxhbWVkYSBDb3VudHkiLAogICAgInllYXIiOiAiIiwKICAgICJ0eXBlIjogImh0dHAiLAogICAgImNvbXByZXNzaW9uIjogInppcCIsCiAgICAiY29uZm9ybSI6IHsKICAgICAgICAibWVyZ2UiOiBbCiAgICAgICAgICAgICJmZWFubWUiLAogICAgICAgICAgICAiZmVhdHlwIgogICAgICAgIF0sCiAgICAgICAgImxvbiI6ICJ4IiwKICAgICAgICAibGF0IjogInkiLAogICAgICAgICJudW1iZXIiOiAic3RfbnVtIiwKICAgICAgICAic3RyZWV0IjogImF1dG9fc3RyZWV0IiwKICAgICAgICAidHlwZSI6ICJzaGFwZWZpbGUiLAogICAgICAgICJwb3N0Y29kZSI6ICJ6aXBjb2RlIgogICAgfQp9Cg==",\r              "encoding": "base64",\r              "_links": {\r                "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-badutf8_county.json?ref=badutf820f08890960f50f863626e1062f922522",\r                "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r                "html": "https://github.com/openaddresses/hooked-on-sources/blob/badutf820f08890960f50f863626e1062f922522/sources/us-ca-badutf8_county.json"\r              }\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/daguar/openaddresses/contents/sources/us-ca-san_diego_county.json') and query.get('ref', '').startswith('f85074d'):
            data = '''{\r  "name": "us-ca-san_diego_county.json",\r  "path": "sources/us-ca-san_diego_county.json",\r  "sha": "0c7cf2f3e4cb5f0c07818a029e1decc9797ad3a1",\r  "size": 1119,\r  "url": "https://api.github.com/repos/daguar/openaddresses/contents/sources/us-ca-san_diego_county.json?ref=f85074d543622ef1fac7a80a059a50176f2a6e08",\r  "html_url": "https://github.com/daguar/openaddresses/blob/f85074d543622ef1fac7a80a059a50176f2a6e08/sources/us-ca-san_diego_county.json",\r  "git_url": "https://api.github.com/repos/daguar/openaddresses/git/blobs/0c7cf2f3e4cb5f0c07818a029e1decc9797ad3a1",\r  "download_url": "https://raw.githubusercontent.com/daguar/openaddresses/f85074d543622ef1fac7a80a059a50176f2a6e08/sources/us-ca-san_diego_county.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAiZ2VvaWQiOiAiMDYwNzMiLAogICAgICAgICAgIm5hbWUiOiAi\\nU2FuIERpZWdvIENvdW50eSIsCiAgICAgICAgICAic3RhdGUiOiAiQ2FsaWZv\\ncm5pYSIKICAgICAgICB9LAogICAgICAgICJjb3VudHJ5IjogInVzIiwKICAg\\nICAgICAic3RhdGUiOiAiY2EiLAogICAgICAgICJjb3VudHkiOiAiU2FuIERp\\nZWdvIgogICAgfSwKICAgICJhdHRyaWJ1dGlvbiI6ICJTYW4gRGllZ28gR2Vv\\nZ3JhcGhpYyBJbmZvcm1hdGlvbiBTb3VyY2UgLSBKUEEiLAogICAgImRhdGEi\\nOiAiaHR0cDovL3Jkdy5zYW5kYWcub3JnL2ZpbGVfc3RvcmUvQWRkcmVzcy9B\\nZGRyZXNzX0FQTi56aXAiLAogICAgImxpY2Vuc2UiOiAiaHR0cDovL3d3dy5z\\nYW5naXMub3JnL0xlZ2FsX05vdGljZS5odG0iLAogICAgIm5vdGUiOiAiTWV0\\nYWRhdGEgYXZhaWxhYmxlIGF0IGh0dHA6Ly9yZHcuc2FuZGFnLm9yZy9maWxl\\nX3N0b3JlJTVDQWRkcmVzcy9BZGRyZXNzX0FQTi5wZGYiLAogICAgIndlYnNp\\ndGUiOiAiaHR0cDovL3Jkdy5zYW5kYWcub3JnLyIsCiAgICAieWVhciI6ICIi\\nLAogICAgInR5cGUiOiAiaHR0cCIsCiAgICAiY29tcHJlc3Npb24iOiAiemlw\\nIiwKICAgICJjb25mb3JtIjogewogICAgICAgICJtZXJnZSI6IFsKICAgICAg\\nICAgICAgIkFERFJQRElSIiwKICAgICAgICAgICAgIkFERFJOQU1FIiwKICAg\\nICAgICAgICAgIkFERFJTRlgiLAogICAgICAgICAgICAiQUREUlBPU1REIgog\\nICAgICAgIF0sCiAgICAgICAgImxvbiI6ICJ4IiwKICAgICAgICAibGF0Ijog\\nInkiLAogICAgICAgICJhZHZhbmNlZF9tZXJnZSI6IHsKICAgICAgICAgICAg\\nImN1c3RvbV9udW1iZXIiOiB7CiAgICAgICAgICAgICAgICAic2VwYXJhdG9y\\nIjogIiAiLAogICAgICAgICAgICAgICAgImZpZWxkcyI6IFsiQUREUk5NQlIi\\nLCAiQUREUkZSQUMiXQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAg\\nICAibnVtYmVyIjogImN1c3RvbV9udW1iZXIiLAogICAgICAgICJzdHJlZXQi\\nOiAiYXV0b19zdHJlZXQiLAogICAgICAgICJ0eXBlIjogInNoYXBlZmlsZSIs\\nCiAgICAgICAgInBvc3Rjb2RlIjogImFkZHJ6aXAiCiAgICB9Cn0K\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/daguar/openaddresses/contents/sources/us-ca-san_diego_county.json?ref=f85074d543622ef1fac7a80a059a50176f2a6e08",\r    "git": "https://api.github.com/repos/daguar/openaddresses/git/blobs/0c7cf2f3e4cb5f0c07818a029e1decc9797ad3a1",\r    "html": "https://github.com/daguar/openaddresses/blob/f85074d543622ef1fac7a80a059a50176f2a6e08/sources/us-ca-san_diego_county.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/openaddresses/contents/sources/us-ca-san_diego_county.json') and query.get('ref', '').startswith('bba8f70'):
            data = '''{\r  "name": "us-ca-san_diego_county.json",\r  "path": "sources/us-ca-san_diego_county.json",\r  "sha": "0c7cf2f3e4cb5f0c07818a029e1decc9797ad3a1",\r  "size": 1119,\r  "url": "https://api.github.com/repos/openaddresses/openaddresses/contents/sources/us-ca-san_diego_county.json?ref=bba8f709793f96750fed223d44ba373a92540b2a",\r  "html_url": "https://github.com/openaddresses/openaddresses/blob/bba8f709793f96750fed223d44ba373a92540b2a/sources/us-ca-san_diego_county.json",\r  "git_url": "https://api.github.com/repos/openaddresses/openaddresses/git/blobs/0c7cf2f3e4cb5f0c07818a029e1decc9797ad3a1",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/openaddresses/bba8f709793f96750fed223d44ba373a92540b2a/sources/us-ca-san_diego_county.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAiZ2VvaWQiOiAiMDYwNzMiLAogICAgICAgICAgIm5hbWUiOiAi\\nU2FuIERpZWdvIENvdW50eSIsCiAgICAgICAgICAic3RhdGUiOiAiQ2FsaWZv\\ncm5pYSIKICAgICAgICB9LAogICAgICAgICJjb3VudHJ5IjogInVzIiwKICAg\\nICAgICAic3RhdGUiOiAiY2EiLAogICAgICAgICJjb3VudHkiOiAiU2FuIERp\\nZWdvIgogICAgfSwKICAgICJhdHRyaWJ1dGlvbiI6ICJTYW4gRGllZ28gR2Vv\\nZ3JhcGhpYyBJbmZvcm1hdGlvbiBTb3VyY2UgLSBKUEEiLAogICAgImRhdGEi\\nOiAiaHR0cDovL3Jkdy5zYW5kYWcub3JnL2ZpbGVfc3RvcmUvQWRkcmVzcy9B\\nZGRyZXNzX0FQTi56aXAiLAogICAgImxpY2Vuc2UiOiAiaHR0cDovL3d3dy5z\\nYW5naXMub3JnL0xlZ2FsX05vdGljZS5odG0iLAogICAgIm5vdGUiOiAiTWV0\\nYWRhdGEgYXZhaWxhYmxlIGF0IGh0dHA6Ly9yZHcuc2FuZGFnLm9yZy9maWxl\\nX3N0b3JlJTVDQWRkcmVzcy9BZGRyZXNzX0FQTi5wZGYiLAogICAgIndlYnNp\\ndGUiOiAiaHR0cDovL3Jkdy5zYW5kYWcub3JnLyIsCiAgICAieWVhciI6ICIi\\nLAogICAgInR5cGUiOiAiaHR0cCIsCiAgICAiY29tcHJlc3Npb24iOiAiemlw\\nIiwKICAgICJjb25mb3JtIjogewogICAgICAgICJtZXJnZSI6IFsKICAgICAg\\nICAgICAgIkFERFJQRElSIiwKICAgICAgICAgICAgIkFERFJOQU1FIiwKICAg\\nICAgICAgICAgIkFERFJTRlgiLAogICAgICAgICAgICAiQUREUlBPU1REIgog\\nICAgICAgIF0sCiAgICAgICAgImxvbiI6ICJ4IiwKICAgICAgICAibGF0Ijog\\nInkiLAogICAgICAgICJhZHZhbmNlZF9tZXJnZSI6IHsKICAgICAgICAgICAg\\nImN1c3RvbV9udW1iZXIiOiB7CiAgICAgICAgICAgICAgICAic2VwYXJhdG9y\\nIjogIiAiLAogICAgICAgICAgICAgICAgImZpZWxkcyI6IFsiQUREUk5NQlIi\\nLCAiQUREUkZSQUMiXQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAg\\nICAibnVtYmVyIjogImN1c3RvbV9udW1iZXIiLAogICAgICAgICJzdHJlZXQi\\nOiAiYXV0b19zdHJlZXQiLAogICAgICAgICJ0eXBlIjogInNoYXBlZmlsZSIs\\nCiAgICAgICAgInBvc3Rjb2RlIjogImFkZHJ6aXAiCiAgICB9Cn0K\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/openaddresses/contents/sources/us-ca-san_diego_county.json?ref=bba8f709793f96750fed223d44ba373a92540b2a",\r    "git": "https://api.github.com/repos/openaddresses/openaddresses/git/blobs/0c7cf2f3e4cb5f0c07818a029e1decc9797ad3a1",\r    "html": "https://github.com/openaddresses/openaddresses/blob/bba8f709793f96750fed223d44ba373a92540b2a/sources/us-ca-san_diego_county.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/migurski/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json') and query.get('ref', '').startswith('6460668'):
            data = u'''{\r  "name": "la-réunion.json",\r  "path": "sources/fr/la-réunion.json",\r  "sha": "a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r  "size": 603,\r  "url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=6460668909a85d9db8df871d91e9b25bc5192add",\r  "html_url": "https://github.com/migurski/hooked-on-sources/blob/6460668909a85d9db8df871d91e9b25bc5192add/sources/fr/la-r%C3%A9union.json",\r  "git_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs/a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r  "download_url": "https://raw.githubusercontent.com/migurski/hooked-on-sources/6460668909a85d9db8df871d91e9b25bc5192add/sources/fr/la-r%C3%A9union.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJJU08gMzE2NiI6IHsKICAg\\nICAgICAgICAgImFscGhhMiI6ICJGUi05NzQiCiAgICAgICAgfQogICAgfSwK\\nICAgICJ3ZWJzaXRlIjogImh0dHA6Ly9hZHJlc3NlLmRhdGEuZ291di5mci9k\\nb3dubG9hZC8iLAogICAgIm5vdGUiOiAiRG93bmxvYWRlZCBhbmQgY2FjaGVk\\nIDIwMTUtMDYtMTgiLAogICAgImRhdGEiOiAiaHR0cDovL2RhdGEub3BlbmFk\\nZHJlc3Nlcy5pby9jYWNoZS9mci9CQU5fbGljZW5jZV9ncmF0dWl0ZV9yZXBh\\ncnRhZ2VfOTc0LnppcCIsCiAgICAidHlwZSI6ICJodHRwIiwKICAgICJjb21w\\ncmVzc2lvbiI6ICJ6aXAiLAogICAgImNvbmZvcm0iOiB7CiAgICAgICAgInR5\\ncGUiOiAiY3N2IiwKICAgICAgICAiY3N2c3BsaXQiOiAiOyIsCiAgICAgICAg\\nIm51bWJlciI6ICJudW1lcm8iLAogICAgICAgICJzdHJlZXQiOiAibm9tX3Zv\\naWUiLAogICAgICAgICJsb24iOiAibG9uIiwKICAgICAgICAibGF0IjogImxh\\ndCIsCiAgICAgICAgImNpdHkiOiAibm9tX2NvbW11bmUiLAogICAgICAgICJw\\nb3N0Y29kZSI6ICJjb2RlX3Bvc3QiLAogICAgICAgICJlbmNvZGluZyI6ICJJ\\nU08tODg1OS0xIgogICAgfQp9\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/migurski/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=6460668909a85d9db8df871d91e9b25bc5192add",\r    "git": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs/a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r    "html": "https://github.com/migurski/hooked-on-sources/blob/6460668909a85d9db8df871d91e9b25bc5192add/sources/fr/la-r%C3%A9union.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json') and query.get('ref', '').startswith('8dd262c'):
            data = u'''{\r  "name": "la-réunion.json",\r  "path": "sources/fr/la-réunion.json",\r  "sha": "a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r  "size": 603,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJJU08gMzE2NiI6IHsKICAg\\nICAgICAgICAgImFscGhhMiI6ICJGUi05NzQiCiAgICAgICAgfQogICAgfSwK\\nICAgICJ3ZWJzaXRlIjogImh0dHA6Ly9hZHJlc3NlLmRhdGEuZ291di5mci9k\\nb3dubG9hZC8iLAogICAgIm5vdGUiOiAiRG93bmxvYWRlZCBhbmQgY2FjaGVk\\nIDIwMTUtMDYtMTgiLAogICAgImRhdGEiOiAiaHR0cDovL2RhdGEub3BlbmFk\\nZHJlc3Nlcy5pby9jYWNoZS9mci9CQU5fbGljZW5jZV9ncmF0dWl0ZV9yZXBh\\ncnRhZ2VfOTc0LnppcCIsCiAgICAidHlwZSI6ICJodHRwIiwKICAgICJjb21w\\ncmVzc2lvbiI6ICJ6aXAiLAogICAgImNvbmZvcm0iOiB7CiAgICAgICAgInR5\\ncGUiOiAiY3N2IiwKICAgICAgICAiY3N2c3BsaXQiOiAiOyIsCiAgICAgICAg\\nIm51bWJlciI6ICJudW1lcm8iLAogICAgICAgICJzdHJlZXQiOiAibm9tX3Zv\\naWUiLAogICAgICAgICJsb24iOiAibG9uIiwKICAgICAgICAibGF0IjogImxh\\ndCIsCiAgICAgICAgImNpdHkiOiAibm9tX2NvbW11bmUiLAogICAgICAgICJw\\nb3N0Y29kZSI6ICJjb2RlX3Bvc3QiLAogICAgICAgICJlbmNvZGluZyI6ICJJ\\nU08tODg1OS0xIgogICAgfQp9\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/migurski/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json') and query.get('ref', '').startswith('aed74b0'):
            data = u'''{\r  "name": "la-réunion.json",\r  "path": "sources/fr/la-réunion.json",\r  "sha": "fb6936692415f70d49cc922a9cf3c53c3e9a9756",\r  "size": 569,\r  "url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r  "html_url": "https://github.com/migurski/hooked-on-sources/blob/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/sources/fr/la-r%C3%A9union.json",\r  "git_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs/fb6936692415f70d49cc922a9cf3c53c3e9a9756",\r  "download_url": "https://raw.githubusercontent.com/migurski/hooked-on-sources/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/sources/fr/la-r%C3%A9union.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJJU08gMzE2NiI6IHsKICAg\\nICAgICAgICAgImFscGhhMiI6ICJGUi05NzQiCiAgICAgICAgfQogICAgfSwK\\nICAgICJ3ZWJzaXRlIjogImh0dHA6Ly9hZHJlc3NlLmRhdGEuZ291di5mci9k\\nb3dubG9hZC8iLAogICAgIm5vdGUiOiAiRG93bmxvYWRlZCBhbmQgY2FjaGVk\\nIDIwMTUtMDYtMTgiLAogICAgImRhdGEiOiAiaHR0cDovL2RhdGEub3BlbmFk\\nZHJlc3Nlcy5pby9jYWNoZS9mci9CQU5fbGljZW5jZV9ncmF0dWl0ZV9yZXBh\\ncnRhZ2VfOTc0LnppcCIsCiAgICAidHlwZSI6ICJodHRwIiwKICAgICJjb21w\\ncmVzc2lvbiI6ICJ6aXAiLAogICAgImNvbmZvcm0iOiB7CiAgICAgICAgInR5\\ncGUiOiAiY3N2IiwKICAgICAgICAiY3N2c3BsaXQiOiAiOyIsCiAgICAgICAg\\nIm51bWJlciI6ICJudW1lcm8iLAogICAgICAgICJzdHJlZXQiOiAibm9tX3Zv\\naWUiLAogICAgICAgICJsb24iOiAibG9uIiwKICAgICAgICAibGF0IjogImxh\\ndCIsCiAgICAgICAgImNpdHkiOiAibm9tX2NvbW11bmUiLAogICAgICAgICJw\\nb3N0Y29kZSI6ICJjb2RlX3Bvc3QiCiAgICB9Cn0=\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/migurski/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r    "git": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs/fb6936692415f70d49cc922a9cf3c53c3e9a9756",\r    "html": "https://github.com/migurski/hooked-on-sources/blob/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/sources/fr/la-r%C3%A9union.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json') and query.get('ref', '').startswith('37e992'):
            data = u'''{\r  "name": "us-ca-nevada_county.json",\r  "path": "sources/us-ca-nevada_county.json",\r  "sha": "83ba405aa5eb22e058c125ce97ea53845daa8254",\r  "size": 658,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=37e992e9f2aa14265588ca8b214e001e1628f53c",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/37e992e9f2aa14265588ca8b214e001e1628f53c/sources/us-ca-nevada_county.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/83ba405aa5eb22e058c125ce97ea53845daa8254",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/37e992e9f2aa14265588ca8b214e001e1628f53c/sources/us-ca-nevada_county.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAgICJnZW9pZCI6ICIwNjA1NyIsCiAgICAgICAgICAgICJuYW1l\\nIjogIk5ldmFkYSBDb3VudHkiLAogICAgICAgICAgICAic3RhdGUiOiAiQ2Fs\\naWZvcm5pYSIKICAgICAgICB9LAogICAgICAgICJjb3VudHJ5IjogInVzIiwK\\nICAgICAgICAic3RhdGUiOiAiY2EiLAogICAgICAgICJjb3VudHkiOiAiTmV2\\nYWRhIgogICAgfSwKICAgICJhdHRyaWJ1dGlvbiI6ICJOZXZhZGEgQ291bnR5\\nIiwKICAgICJkYXRhIjogImh0dHA6Ly93d3cubXluZXZhZGFjb3VudHkuY29t\\nL25jL2lncy9naXMvZG9jcy9EaWdpdGFsJTIwRGF0YSUyMExpYnJhcnkvQWRk\\ncmVzc1BvaW50LnppcCIsCiAgICAid2Vic2l0ZSI6ICJodHRwOi8vd3d3Lm15\\nbmV2YWRhY291bnR5LmNvbS9uYy9pZ3MvZ2lzL1BhZ2VzL01ldGFEYXRhLmFz\\ncHgiLAogICAgInR5cGUiOiAiaHR0cCIsCiAgICAiY29tcHJlc3Npb24iOiAi\\nemlwIiwKICAgICJjb25mb3JtIjogewogICAgICAgICJsb24iOiAieCIsCiAg\\nICAgICAgImxhdCI6ICJ5IiwKICAgICAgICAibnVtYmVyIjogInN0cmVldE51\\nbSIsCiAgICAgICAgInN0cmVldCI6ICJzdHJlZXROYW1lIiwKICAgICAgICAi\\ndHlwZSI6ICJzaGFwZWZpbGUiCiAgICB9Cn0KCg==\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=37e992e9f2aa14265588ca8b214e001e1628f53c",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/83ba405aa5eb22e058c125ce97ea53845daa8254",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/37e992e9f2aa14265588ca8b214e001e1628f53c/sources/us-ca-nevada_county.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/mx/m%C3%A9xico.json') and query.get('ref', '').startswith('5f3e77'):
            data = u'''{\r  "name": "méxico.json",\r  "path": "sources/mx/méxico.json",\r  "sha": "45746c69c9923e753f52646c1c32b55a22b343a5",\r  "size": 1046,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/mx/m%C3%A9xico.json?ref=5f3e772efd01b32133947473f1bab0c69e8166a0",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/5f3e772efd01b32133947473f1bab0c69e8166a0/sources/mx/m%C3%A9xico.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/45746c69c9923e753f52646c1c32b55a22b343a5",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/5f3e772efd01b32133947473f1bab0c69e8166a0/sources/mx/m%C3%A9xico.json",\r  "type": "file",\r  "content": "ewogICAgIndlYnNpdGUiOiAiaHR0cDovL2J1c2NhLmRhdG9zLmdvYi5teC8j\\nL2Nvbmp1bnRvcy9kaXJlY3RvcmlvLWVzdGFkaXN0aWNvLW5hY2lvbmFsLWRl\\nLXVuaWRhZGVzLWVjb25vbWljYXMtZGVudWUtcG9yLWVudGlkYWQtZmVkZXJh\\ndGl2YSIsCiAgICAiY29uZm9ybSI6IHsKICAgICAgICAiY2l0eSI6ICJNdW5p\\nY2lwaW8iLAogICAgICAgICJzdHJlZXQiOiAiTm9tYnJlIGRlIGxhIHZpYWxp\\nZGFkIiwKICAgICAgICAicmVnaW9uIjogIk3DqXhpY28iLAogICAgICAgICJs\\nb24iOiAiTG9uZ2l0dWQiLAogICAgICAgICJudW1iZXIiOiAiTsO6bWVybyBl\\neHRlcmlvciBvIGtpbMOzbWV0cm8iLAogICAgICAgICJwb3N0Y29kZSI6ICJD\\nw7NkaWdvIFBvc3RhbCIsCiAgICAgICAgImxhdCI6ICJMYXRpdHVkIiwKICAg\\nICAgICAidHlwZSI6ICJjc3YiCiAgICB9LAogICAgImF0dHJpYnV0aW9uIjog\\nIlNvdXJjZTogSU5FR0ksIERpcmVjdG9yaW8gRXN0YWTDrXN0aWNvIE5hY2lv\\nbmFsIGRlIFVuaWRhZGVzIEVjb27Ds21pY2FzIChERU5VRSkiLAogICAgImNv\\nbXByZXNzaW9uIjogInppcCIsCiAgICAibGljZW5zZSI6IHsKICAgICAgICAi\\ndXJsIjogImh0dHA6Ly9kYXRvcy5nb2IubXgvbGlicmV1c29teC8iLAogICAg\\nICAgICJhdHRyaWJ1dGlvbiI6IHRydWUsCiAgICAgICAgInNoYXJlLWFsaWtl\\nIjogZmFsc2UKICAgIH0sCiAgICAiZGF0YSI6ICJodHRwOi8vd3d3My5pbmVn\\naS5vcmcubXgvc2lzdGVtYXMvZGVzY2FyZ2EvZGVzY2FyZ2FhcmNoaXZvLmFz\\ncHg/ZmlsZT1ERU5VRSUyZkVudGlkYWRfZmVkZXJhdGl2YSUyZjE1X00lYzMl\\nYTl4aWNvJTJmZGVudWVfMTVfMjUwMjIwMTVfY3N2LnppcCIsCiAgICAiY292\\nZXJhZ2UiOiB7CiAgICAgICAgIklTTyAzMTY2IjogewogICAgICAgICAgICAi\\nYWxwaGEyIjogIk1YLU1FWCIsCiAgICAgICAgICAgICJjb3VudHJ5IjogIk1l\\neGljbyIsCiAgICAgICAgICAgICJzdGF0ZSI6ICJNw6l4aWNvIgogICAgICAg\\nIH0sCiAgICAgICAgImNvdW50cnkiOiAibXgiCiAgICB9LAogICAgInR5cGUi\\nOiAiaHR0cCIKfQo=\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/mx/m%C3%A9xico.json?ref=5f3e772efd01b32133947473f1bab0c69e8166a0",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/45746c69c9923e753f52646c1c32b55a22b343a5",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/5f3e772efd01b32133947473f1bab0c69e8166a0/sources/mx/m%C3%A9xico.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/master...e5f1dcae83ab1ef1f736b969da617311f7f11564'):
            data = '''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/master...e5f1dcae83ab1ef1f736b969da617311f7f11564",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...e5f1dcae83ab1ef1f736b969da617311f7f11564",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:b450dcb...openaddresses:e5f1dca",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...e5f1dcae83ab1ef1f736b969da617311f7f11564.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...e5f1dcae83ab1ef1f736b969da617311f7f11564.patch",\r  "base_commit": {\r    "sha": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-27T01:29:59Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-27T01:29:59Z"\r      },\r      "message": "Added Contra Costa county",\r      "tree": {\r        "sha": "f9e70a36019597c21c7a28bd16840588e6223a33",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f9e70a36019597c21c7a28bd16840588e6223a33"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b450dcbb6f4c61015b0a00290e984849f7d649de",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "message": "Added Berkeley",\r      "tree": {\r        "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r      }\r    ]\r  },\r  "status": "diverged",\r  "ahead_by": 3,\r  "behind_by": 1,\r  "total_commits": 3,\r  "commits": [\r    {\r      "sha": "b659130053b85cd3993b1a4653da1bf6231ec0b4",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:48:58Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:48:58Z"\r        },\r        "message": "Added Santa Clara County",\r        "tree": {\r          "sha": "f0cd9b347f69397fcc79fcc434f077bf19af9520",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f0cd9b347f69397fcc79fcc434f077bf19af9520"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/b659130053b85cd3993b1a4653da1bf6231ec0b4",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b659130053b85cd3993b1a4653da1bf6231ec0b4",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b659130053b85cd3993b1a4653da1bf6231ec0b4",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b659130053b85cd3993b1a4653da1bf6231ec0b4/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r        }\r      ]\r    },\r    {\r      "sha": "0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:52:39Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:52:39Z"\r        },\r        "message": "Added Polish source",\r        "tree": {\r          "sha": "cf52bd865006bc0cd3deaba1b87a4d679a3410e0",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/cf52bd865006bc0cd3deaba1b87a4d679a3410e0"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "b659130053b85cd3993b1a4653da1bf6231ec0b4",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b659130053b85cd3993b1a4653da1bf6231ec0b4",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b659130053b85cd3993b1a4653da1bf6231ec0b4"\r        }\r      ]\r    },\r    {\r      "sha": "e5f1dcae83ab1ef1f736b969da617311f7f11564",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:52:46Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:52:46Z"\r        },\r        "message": "Removed Polish source",\r        "tree": {\r          "sha": "f0cd9b347f69397fcc79fcc434f077bf19af9520",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f0cd9b347f69397fcc79fcc434f077bf19af9520"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e5f1dcae83ab1ef1f736b969da617311f7f11564/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "84abff13dba318189f1f4d5c1605478127ceff5c",\r      "filename": "sources/us-ca-santa_clara_county.json",\r      "status": "added",\r      "additions": 24,\r      "deletions": 0,\r      "changes": 24,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/e5f1dcae83ab1ef1f736b969da617311f7f11564/sources/us-ca-santa_clara_county.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/e5f1dcae83ab1ef1f736b969da617311f7f11564/sources/us-ca-santa_clara_county.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-santa_clara_county.json?ref=e5f1dcae83ab1ef1f736b969da617311f7f11564",\r      "patch": "@@ -0,0 +1,24 @@\\n+{\\n+    \\"coverage\\": {\\n+        \\"US Census\\": {\\"geoid\\": \\"06085\\", \\"name\\": \\"Santa Clara County\\", \\"state\\": \\"California\\"},\\n+        \\"country\\": \\"us\\",\\n+        \\"state\\": \\"ca\\",\\n+        \\"county\\": \\"Santa Clara\\"\\n+    },\\n+    \\"conform\\": {\\n+        \\"type\\": \\"shapefile\\",\\n+        \\"postcode\\": \\"ZIPCODE\\",\\n+        \\"city\\": \\"CITY\\",\\n+        \\"number\\": \\"HOUSENUMTE\\",\\n+        \\"merge\\": [\\"STREETNAME\\", \\"STREETTYPE\\"],\\n+        \\"street\\": \\"auto_street\\",\\n+        \\"lon\\": \\"x\\",\\n+        \\"lat\\": \\"y\\"\\n+    },\\n+    \\"attribution\\": \\"Santa Clara County\\",\\n+    \\"data\\": \\"https://github.com/datadesk/us-ca-santa_clara_county-gis-shp/blob/master/Q4_FY14_Address_Point.zip?raw=true\\",\\n+    \\"website\\": \\"https://sftp.sccgov.org/courier/web/1000@/wmLogin.html\\",\\n+    \\"type\\": \\"http\\",\\n+    \\"compression\\": \\"zip\\",\\n+    \\"note\\": \\"File download is behind a registration wall on government site so the zip was downloaded in November 2014 and uploaded to GitHub for public hosting.\\"\\n+}"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/master...e91fbc420f08890960f50f863626e1062f922522'):
            data = '''{\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/master...e91fbc420f08890960f50f863626e1062f922522",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...e91fbc420f08890960f50f863626e1062f922522",\r              "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:ded44ed...openaddresses:e91fbc4",\r              "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...e91fbc420f08890960f50f863626e1062f922522.diff",\r              "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...e91fbc420f08890960f50f863626e1062f922522.patch",\r              "base_commit": {\r                "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "commit": {\r                  "author": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "committer": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "message": "Added Berkeley",\r                  "tree": {\r                    "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r                  },\r                  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                  "comment_count": 0\r                },\r                "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r                "author": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "committer": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "parents": [\r                  {\r                    "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r                  }\r                ]\r              },\r              "merge_base_commit": {\r                "sha": "e91fbc420f08890960f50f863626e1062f922522",\r                "commit": {\r                  "author": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:16:12Z"\r                  },\r                  "committer": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:16:12Z"\r                  },\r                  "message": "Added first source",\r                  "tree": {\r                    "sha": "f5e85249cee39d0e84ed936d31a9c08c1eaaa539",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f5e85249cee39d0e84ed936d31a9c08c1eaaa539"\r                  },\r                  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/e91fbc420f08890960f50f863626e1062f922522",\r                  "comment_count": 0\r                },\r                "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e91fbc420f08890960f50f863626e1062f922522",\r                "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/e91fbc420f08890960f50f863626e1062f922522",\r                "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e91fbc420f08890960f50f863626e1062f922522/comments",\r                "author": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "committer": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "parents": [\r                  {\r                    "sha": "c52204fd40f17f9da243df09e6d1107d48768afd",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c52204fd40f17f9da243df09e6d1107d48768afd",\r                    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c52204fd40f17f9da243df09e6d1107d48768afd"\r                  }\r                ]\r              },\r              "status": "behind",\r              "ahead_by": 0,\r              "behind_by": 2,\r              "total_commits": 0,\r              "commits": [\r\r              ],\r              "files": [\r\r              ]\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/master...ded44ed5f1733bb93d84f94afe9383e2d47bbbaa'):
            data = '''{\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/master...ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r              "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:ded44ed...openaddresses:ded44ed",\r              "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...ded44ed5f1733bb93d84f94afe9383e2d47bbbaa.diff",\r              "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...ded44ed5f1733bb93d84f94afe9383e2d47bbbaa.patch",\r              "base_commit": {\r                "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "commit": {\r                  "author": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "committer": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "message": "Added Berkeley",\r                  "tree": {\r                    "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r                  },\r                  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                  "comment_count": 0\r                },\r                "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r                "author": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "committer": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "parents": [\r                  {\r                    "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r                  }\r                ]\r              },\r              "merge_base_commit": {\r                "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "commit": {\r                  "author": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "committer": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "message": "Added Berkeley",\r                  "tree": {\r                    "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r                  },\r                  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                  "comment_count": 0\r                },\r                "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r                "author": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "committer": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "parents": [\r                  {\r                    "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r                  }\r                ]\r              },\r              "status": "identical",\r              "ahead_by": 0,\r              "behind_by": 0,\r              "total_commits": 0,\r              "commits": [\r\r              ],\r              "files": [\r\r              ]\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...e5f1dcae83ab1ef1f736b969da617311f7f11564'):
            data = '''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...e5f1dcae83ab1ef1f736b969da617311f7f11564",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...e5f1dcae83ab1ef1f736b969da617311f7f11564",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:ded44ed...openaddresses:e5f1dca",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...e5f1dcae83ab1ef1f736b969da617311f7f11564.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...e5f1dcae83ab1ef1f736b969da617311f7f11564.patch",\r  "base_commit": {\r    "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "message": "Added Berkeley",\r      "tree": {\r        "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "message": "Added Berkeley",\r      "tree": {\r        "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 3,\r  "behind_by": 0,\r  "total_commits": 3,\r  "commits": [\r    {\r      "sha": "b659130053b85cd3993b1a4653da1bf6231ec0b4",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:48:58Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:48:58Z"\r        },\r        "message": "Added Santa Clara County",\r        "tree": {\r          "sha": "f0cd9b347f69397fcc79fcc434f077bf19af9520",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f0cd9b347f69397fcc79fcc434f077bf19af9520"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/b659130053b85cd3993b1a4653da1bf6231ec0b4",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b659130053b85cd3993b1a4653da1bf6231ec0b4",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b659130053b85cd3993b1a4653da1bf6231ec0b4",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b659130053b85cd3993b1a4653da1bf6231ec0b4/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r        }\r      ]\r    },\r    {\r      "sha": "0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:52:39Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:52:39Z"\r        },\r        "message": "Added Polish source",\r        "tree": {\r          "sha": "cf52bd865006bc0cd3deaba1b87a4d679a3410e0",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/cf52bd865006bc0cd3deaba1b87a4d679a3410e0"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "b659130053b85cd3993b1a4653da1bf6231ec0b4",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b659130053b85cd3993b1a4653da1bf6231ec0b4",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b659130053b85cd3993b1a4653da1bf6231ec0b4"\r        }\r      ]\r    },\r    {\r      "sha": "e5f1dcae83ab1ef1f736b969da617311f7f11564",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:52:46Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:52:46Z"\r        },\r        "message": "Removed Polish source",\r        "tree": {\r          "sha": "f0cd9b347f69397fcc79fcc434f077bf19af9520",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f0cd9b347f69397fcc79fcc434f077bf19af9520"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e5f1dcae83ab1ef1f736b969da617311f7f11564/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "84abff13dba318189f1f4d5c1605478127ceff5c",\r      "filename": "sources/us-ca-santa_clara_county.json",\r      "status": "added",\r      "additions": 24,\r      "deletions": 0,\r      "changes": 24,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/e5f1dcae83ab1ef1f736b969da617311f7f11564/sources/us-ca-santa_clara_county.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/e5f1dcae83ab1ef1f736b969da617311f7f11564/sources/us-ca-santa_clara_county.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-santa_clara_county.json?ref=e5f1dcae83ab1ef1f736b969da617311f7f11564",\r      "patch": "@@ -0,0 +1,24 @@\\n+{\\n+    \\"coverage\\": {\\n+        \\"US Census\\": {\\"geoid\\": \\"06085\\", \\"name\\": \\"Santa Clara County\\", \\"state\\": \\"California\\"},\\n+        \\"country\\": \\"us\\",\\n+        \\"state\\": \\"ca\\",\\n+        \\"county\\": \\"Santa Clara\\"\\n+    },\\n+    \\"conform\\": {\\n+        \\"type\\": \\"shapefile\\",\\n+        \\"postcode\\": \\"ZIPCODE\\",\\n+        \\"city\\": \\"CITY\\",\\n+        \\"number\\": \\"HOUSENUMTE\\",\\n+        \\"merge\\": [\\"STREETNAME\\", \\"STREETTYPE\\"],\\n+        \\"street\\": \\"auto_street\\",\\n+        \\"lon\\": \\"x\\",\\n+        \\"lat\\": \\"y\\"\\n+    },\\n+    \\"attribution\\": \\"Santa Clara County\\",\\n+    \\"data\\": \\"https://github.com/datadesk/us-ca-santa_clara_county-gis-shp/blob/master/Q4_FY14_Address_Point.zip?raw=true\\",\\n+    \\"website\\": \\"https://sftp.sccgov.org/courier/web/1000@/wmLogin.html\\",\\n+    \\"type\\": \\"http\\",\\n+    \\"compression\\": \\"zip\\",\\n+    \\"note\\": \\"File download is behind a registration wall on government site so the zip was downloaded in November 2014 and uploaded to GitHub for public hosting.\\"\\n+}"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/master...3147668047a0bec6d481c0e42995f7c5e5eac637'):
            data = '''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/master...3147668047a0bec6d481c0e42995f7c5e5eac637",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...3147668047a0bec6d481c0e42995f7c5e5eac637",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:3147668...openaddresses:3147668",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...3147668047a0bec6d481c0e42995f7c5e5eac637.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...3147668047a0bec6d481c0e42995f7c5e5eac637.patch",\r  "base_commit": {\r    "sha": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-27T01:36:22Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-27T01:36:22Z"\r      },\r      "message": "Empty commit",\r      "tree": {\r        "sha": "f9e70a36019597c21c7a28bd16840588e6223a33",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f9e70a36019597c21c7a28bd16840588e6223a33"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b450dcbb6f4c61015b0a00290e984849f7d649de"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-27T01:36:22Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-27T01:36:22Z"\r      },\r      "message": "Empty commit",\r      "tree": {\r        "sha": "f9e70a36019597c21c7a28bd16840588e6223a33",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f9e70a36019597c21c7a28bd16840588e6223a33"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b450dcbb6f4c61015b0a00290e984849f7d649de"\r      }\r    ]\r  },\r  "status": "identical",\r  "ahead_by": 0,\r  "behind_by": 0,\r  "total_commits": 0,\r  "commits": [\r\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/master...badjson20f08890960f50f863626e1062f922522'):
            data = '''{\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/master...badjson20f08890960f50f863626e1062f922522",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...badjson20f08890960f50f863626e1062f922522",\r              "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:ded44ed...openaddresses:e91fbc4",\r              "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...badjson20f08890960f50f863626e1062f922522.diff",\r              "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...badjson20f08890960f50f863626e1062f922522.patch",\r              "base_commit": {\r                "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "commit": {\r                  "author": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "committer": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "message": "Added Berkeley",\r                  "tree": {\r                    "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r                  },\r                  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                  "comment_count": 0\r                },\r                "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r                "author": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "committer": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "parents": [\r                  {\r                    "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r                  }\r                ]\r              },\r              "merge_base_commit": {\r                "sha": "badjson20f08890960f50f863626e1062f922522",\r                "commit": {\r                  "author": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:16:12Z"\r                  },\r                  "committer": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:16:12Z"\r                  },\r                  "message": "Added first source",\r                  "tree": {\r                    "sha": "f5e85249cee39d0e84ed936d31a9c08c1eaaa539",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f5e85249cee39d0e84ed936d31a9c08c1eaaa539"\r                  },\r                  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/badjson20f08890960f50f863626e1062f922522",\r                  "comment_count": 0\r                },\r                "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/badjson20f08890960f50f863626e1062f922522",\r                "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/badjson20f08890960f50f863626e1062f922522",\r                "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/badjson20f08890960f50f863626e1062f922522/comments",\r                "author": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "committer": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "parents": [\r                  {\r                    "sha": "c52204fd40f17f9da243df09e6d1107d48768afd",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c52204fd40f17f9da243df09e6d1107d48768afd",\r                    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c52204fd40f17f9da243df09e6d1107d48768afd"\r                  }\r                ]\r              },\r              "status": "behind",\r              "ahead_by": 0,\r              "behind_by": 2,\r              "total_commits": 0,\r              "commits": [\r\r              ],\r              "files": [\r\r              ]\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/master...badutf820f08890960f50f863626e1062f922522'):
            data = '''{\r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/master...badutf820f08890960f50f863626e1062f922522",\r              "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...badutf820f08890960f50f863626e1062f922522",\r              "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:ded44ed...openaddresses:e91fbc4",\r              "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...badutf820f08890960f50f863626e1062f922522.diff",\r              "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/master...badutf820f08890960f50f863626e1062f922522.patch",\r              "base_commit": {\r                "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "commit": {\r                  "author": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "committer": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:25:55Z"\r                  },\r                  "message": "Added Berkeley",\r                  "tree": {\r                    "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r                  },\r                  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                  "comment_count": 0\r                },\r                "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r                "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r                "author": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "committer": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "parents": [\r                  {\r                    "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r                    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r                  }\r                ]\r              },\r              "merge_base_commit": {\r                "sha": "badutf820f08890960f50f863626e1062f922522",\r                "commit": {\r                  "author": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:16:12Z"\r                  },\r                  "committer": {\r                    "name": "Michal Migurski",\r                    "email": "mike@teczno.com",\r                    "date": "2015-04-26T00:16:12Z"\r                  },\r                  "message": "Added first source",\r                  "tree": {\r                    "sha": "f5e85249cee39d0e84ed936d31a9c08c1eaaa539",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f5e85249cee39d0e84ed936d31a9c08c1eaaa539"\r                  },\r                  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/badutf820f08890960f50f863626e1062f922522",\r                  "comment_count": 0\r                },\r                "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/badutf820f08890960f50f863626e1062f922522",\r                "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/badutf820f08890960f50f863626e1062f922522",\r                "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/badutf820f08890960f50f863626e1062f922522/comments",\r                "author": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "committer": {\r                  "login": "migurski",\r                  "id": 58730,\r                  "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r                  "gravatar_id": "",\r                  "url": "https://api.github.com/users/migurski",\r                  "html_url": "https://github.com/migurski",\r                  "followers_url": "https://api.github.com/users/migurski/followers",\r                  "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r                  "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r                  "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r                  "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r                  "organizations_url": "https://api.github.com/users/migurski/orgs",\r                  "repos_url": "https://api.github.com/users/migurski/repos",\r                  "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r                  "received_events_url": "https://api.github.com/users/migurski/received_events",\r                  "type": "User",\r                  "site_admin": false\r                },\r                "parents": [\r                  {\r                    "sha": "c52204fd40f17f9da243df09e6d1107d48768afd",\r                    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c52204fd40f17f9da243df09e6d1107d48768afd",\r                    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c52204fd40f17f9da243df09e6d1107d48768afd"\r                  }\r                ]\r              },\r              "status": "behind",\r              "ahead_by": 0,\r              "behind_by": 2,\r              "total_commits": 0,\r              "commits": [\r\r              ],\r              "files": [\r\r              ]\r            }'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/daguar/openaddresses/compare/97922c724541b0446ea2c022f9f200b9989f1a75...f85074d543622ef1fac7a80a059a50176f2a6e08'):
            data = '''{\r  "url": "https://api.github.com/repos/daguar/openaddresses/compare/97922c724541b0446ea2c022f9f200b9989f1a75...f85074d543622ef1fac7a80a059a50176f2a6e08",\r  "html_url": "https://github.com/daguar/openaddresses/compare/97922c724541b0446ea2c022f9f200b9989f1a75...f85074d543622ef1fac7a80a059a50176f2a6e08",\r  "permalink_url": "https://github.com/daguar/openaddresses/compare/daguar:97922c7...daguar:f85074d",\r  "diff_url": "https://github.com/daguar/openaddresses/compare/97922c724541b0446ea2c022f9f200b9989f1a75...f85074d543622ef1fac7a80a059a50176f2a6e08.diff",\r  "patch_url": "https://github.com/daguar/openaddresses/compare/97922c724541b0446ea2c022f9f200b9989f1a75...f85074d543622ef1fac7a80a059a50176f2a6e08.patch",\r  "base_commit": {\r    "sha": "97922c724541b0446ea2c022f9f200b9989f1a75",\r    "commit": {\r      "author": {\r        "name": "Ian Dees",\r        "email": "ian.dees@gmail.com",\r        "date": "2015-06-17T14:02:23Z"\r      },\r      "committer": {\r        "name": "Ian Dees",\r        "email": "ian.dees@gmail.com",\r        "date": "2015-06-17T14:02:23Z"\r      },\r      "message": "Merge pull request #1033 from openaddresses/s3\\n\\nUse s3 links",\r      "tree": {\r        "sha": "edb40a8c43a8668b30f50594cd0d8e42dad93dbc",\r        "url": "https://api.github.com/repos/daguar/openaddresses/git/trees/edb40a8c43a8668b30f50594cd0d8e42dad93dbc"\r      },\r      "url": "https://api.github.com/repos/daguar/openaddresses/git/commits/97922c724541b0446ea2c022f9f200b9989f1a75",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/daguar/openaddresses/commits/97922c724541b0446ea2c022f9f200b9989f1a75",\r    "html_url": "https://github.com/daguar/openaddresses/commit/97922c724541b0446ea2c022f9f200b9989f1a75",\r    "comments_url": "https://api.github.com/repos/daguar/openaddresses/commits/97922c724541b0446ea2c022f9f200b9989f1a75/comments",\r    "author": {\r      "login": "iandees",\r      "id": 261584,\r      "avatar_url": "https://avatars.githubusercontent.com/u/261584?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/iandees",\r      "html_url": "https://github.com/iandees",\r      "followers_url": "https://api.github.com/users/iandees/followers",\r      "following_url": "https://api.github.com/users/iandees/following{/other_user}",\r      "gists_url": "https://api.github.com/users/iandees/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/iandees/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/iandees/subscriptions",\r      "organizations_url": "https://api.github.com/users/iandees/orgs",\r      "repos_url": "https://api.github.com/users/iandees/repos",\r      "events_url": "https://api.github.com/users/iandees/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/iandees/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "iandees",\r      "id": 261584,\r      "avatar_url": "https://avatars.githubusercontent.com/u/261584?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/iandees",\r      "html_url": "https://github.com/iandees",\r      "followers_url": "https://api.github.com/users/iandees/followers",\r      "following_url": "https://api.github.com/users/iandees/following{/other_user}",\r      "gists_url": "https://api.github.com/users/iandees/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/iandees/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/iandees/subscriptions",\r      "organizations_url": "https://api.github.com/users/iandees/orgs",\r      "repos_url": "https://api.github.com/users/iandees/repos",\r      "events_url": "https://api.github.com/users/iandees/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/iandees/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "de49ae99caa9759dbe08e1aaa892e8bf72079fee",\r        "url": "https://api.github.com/repos/daguar/openaddresses/commits/de49ae99caa9759dbe08e1aaa892e8bf72079fee",\r        "html_url": "https://github.com/daguar/openaddresses/commit/de49ae99caa9759dbe08e1aaa892e8bf72079fee"\r      },\r      {\r        "sha": "3b80e6c555deb08a0a86251216c50106ed9a10b7",\r        "url": "https://api.github.com/repos/daguar/openaddresses/commits/3b80e6c555deb08a0a86251216c50106ed9a10b7",\r        "html_url": "https://github.com/daguar/openaddresses/commit/3b80e6c555deb08a0a86251216c50106ed9a10b7"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "97922c724541b0446ea2c022f9f200b9989f1a75",\r    "commit": {\r      "author": {\r        "name": "Ian Dees",\r        "email": "ian.dees@gmail.com",\r        "date": "2015-06-17T14:02:23Z"\r      },\r      "committer": {\r        "name": "Ian Dees",\r        "email": "ian.dees@gmail.com",\r        "date": "2015-06-17T14:02:23Z"\r      },\r      "message": "Merge pull request #1033 from openaddresses/s3\\n\\nUse s3 links",\r      "tree": {\r        "sha": "edb40a8c43a8668b30f50594cd0d8e42dad93dbc",\r        "url": "https://api.github.com/repos/daguar/openaddresses/git/trees/edb40a8c43a8668b30f50594cd0d8e42dad93dbc"\r      },\r      "url": "https://api.github.com/repos/daguar/openaddresses/git/commits/97922c724541b0446ea2c022f9f200b9989f1a75",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/daguar/openaddresses/commits/97922c724541b0446ea2c022f9f200b9989f1a75",\r    "html_url": "https://github.com/daguar/openaddresses/commit/97922c724541b0446ea2c022f9f200b9989f1a75",\r    "comments_url": "https://api.github.com/repos/daguar/openaddresses/commits/97922c724541b0446ea2c022f9f200b9989f1a75/comments",\r    "author": {\r      "login": "iandees",\r      "id": 261584,\r      "avatar_url": "https://avatars.githubusercontent.com/u/261584?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/iandees",\r      "html_url": "https://github.com/iandees",\r      "followers_url": "https://api.github.com/users/iandees/followers",\r      "following_url": "https://api.github.com/users/iandees/following{/other_user}",\r      "gists_url": "https://api.github.com/users/iandees/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/iandees/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/iandees/subscriptions",\r      "organizations_url": "https://api.github.com/users/iandees/orgs",\r      "repos_url": "https://api.github.com/users/iandees/repos",\r      "events_url": "https://api.github.com/users/iandees/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/iandees/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "iandees",\r      "id": 261584,\r      "avatar_url": "https://avatars.githubusercontent.com/u/261584?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/iandees",\r      "html_url": "https://github.com/iandees",\r      "followers_url": "https://api.github.com/users/iandees/followers",\r      "following_url": "https://api.github.com/users/iandees/following{/other_user}",\r      "gists_url": "https://api.github.com/users/iandees/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/iandees/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/iandees/subscriptions",\r      "organizations_url": "https://api.github.com/users/iandees/orgs",\r      "repos_url": "https://api.github.com/users/iandees/repos",\r      "events_url": "https://api.github.com/users/iandees/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/iandees/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "de49ae99caa9759dbe08e1aaa892e8bf72079fee",\r        "url": "https://api.github.com/repos/daguar/openaddresses/commits/de49ae99caa9759dbe08e1aaa892e8bf72079fee",\r        "html_url": "https://github.com/daguar/openaddresses/commit/de49ae99caa9759dbe08e1aaa892e8bf72079fee"\r      },\r      {\r        "sha": "3b80e6c555deb08a0a86251216c50106ed9a10b7",\r        "url": "https://api.github.com/repos/daguar/openaddresses/commits/3b80e6c555deb08a0a86251216c50106ed9a10b7",\r        "html_url": "https://github.com/daguar/openaddresses/commit/3b80e6c555deb08a0a86251216c50106ed9a10b7"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 2,\r  "behind_by": 0,\r  "total_commits": 2,\r  "commits": [\r    {\r      "sha": "e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r      "commit": {\r        "author": {\r          "name": "Dave Guarino",\r          "email": "dave@codeforamerica.org",\r          "date": "2015-06-21T19:45:12Z"\r        },\r        "committer": {\r          "name": "Dave Guarino",\r          "email": "dave@codeforamerica.org",\r          "date": "2015-06-21T19:45:12Z"\r        },\r        "message": "Update San Diego County coverage (rename as county, update as county, add source details)",\r        "tree": {\r          "sha": "adbabad72436d3082dbc32f4976ade5ad4e18966",\r          "url": "https://api.github.com/repos/daguar/openaddresses/git/trees/adbabad72436d3082dbc32f4976ade5ad4e18966"\r        },\r        "url": "https://api.github.com/repos/daguar/openaddresses/git/commits/e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/daguar/openaddresses/commits/e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r      "html_url": "https://github.com/daguar/openaddresses/commit/e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r      "comments_url": "https://api.github.com/repos/daguar/openaddresses/commits/e1af73800eb25192099c4b1dd75bf0fbec3657fd/comments",\r      "author": {\r        "login": "daguar",\r        "id": 994938,\r        "avatar_url": "https://avatars.githubusercontent.com/u/994938?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/daguar",\r        "html_url": "https://github.com/daguar",\r        "followers_url": "https://api.github.com/users/daguar/followers",\r        "following_url": "https://api.github.com/users/daguar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/daguar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/daguar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/daguar/subscriptions",\r        "organizations_url": "https://api.github.com/users/daguar/orgs",\r        "repos_url": "https://api.github.com/users/daguar/repos",\r        "events_url": "https://api.github.com/users/daguar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/daguar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "daguar",\r        "id": 994938,\r        "avatar_url": "https://avatars.githubusercontent.com/u/994938?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/daguar",\r        "html_url": "https://github.com/daguar",\r        "followers_url": "https://api.github.com/users/daguar/followers",\r        "following_url": "https://api.github.com/users/daguar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/daguar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/daguar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/daguar/subscriptions",\r        "organizations_url": "https://api.github.com/users/daguar/orgs",\r        "repos_url": "https://api.github.com/users/daguar/repos",\r        "events_url": "https://api.github.com/users/daguar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/daguar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "97922c724541b0446ea2c022f9f200b9989f1a75",\r          "url": "https://api.github.com/repos/daguar/openaddresses/commits/97922c724541b0446ea2c022f9f200b9989f1a75",\r          "html_url": "https://github.com/daguar/openaddresses/commit/97922c724541b0446ea2c022f9f200b9989f1a75"\r        }\r      ]\r    },\r    {\r      "sha": "f85074d543622ef1fac7a80a059a50176f2a6e08",\r      "commit": {\r        "author": {\r          "name": "Dave Guarino",\r          "email": "dave@codeforamerica.org",\r          "date": "2015-06-21T20:07:58Z"\r        },\r        "committer": {\r          "name": "Dave Guarino",\r          "email": "dave@codeforamerica.org",\r          "date": "2015-06-21T20:07:58Z"\r        },\r        "message": "Fix San Diego County changes (key should be 'note' not 'notes')",\r        "tree": {\r          "sha": "9e6d99108995a58503407c104338e36c76cbbfe3",\r          "url": "https://api.github.com/repos/daguar/openaddresses/git/trees/9e6d99108995a58503407c104338e36c76cbbfe3"\r        },\r        "url": "https://api.github.com/repos/daguar/openaddresses/git/commits/f85074d543622ef1fac7a80a059a50176f2a6e08",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/daguar/openaddresses/commits/f85074d543622ef1fac7a80a059a50176f2a6e08",\r      "html_url": "https://github.com/daguar/openaddresses/commit/f85074d543622ef1fac7a80a059a50176f2a6e08",\r      "comments_url": "https://api.github.com/repos/daguar/openaddresses/commits/f85074d543622ef1fac7a80a059a50176f2a6e08/comments",\r      "author": {\r        "login": "daguar",\r        "id": 994938,\r        "avatar_url": "https://avatars.githubusercontent.com/u/994938?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/daguar",\r        "html_url": "https://github.com/daguar",\r        "followers_url": "https://api.github.com/users/daguar/followers",\r        "following_url": "https://api.github.com/users/daguar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/daguar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/daguar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/daguar/subscriptions",\r        "organizations_url": "https://api.github.com/users/daguar/orgs",\r        "repos_url": "https://api.github.com/users/daguar/repos",\r        "events_url": "https://api.github.com/users/daguar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/daguar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "daguar",\r        "id": 994938,\r        "avatar_url": "https://avatars.githubusercontent.com/u/994938?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/daguar",\r        "html_url": "https://github.com/daguar",\r        "followers_url": "https://api.github.com/users/daguar/followers",\r        "following_url": "https://api.github.com/users/daguar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/daguar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/daguar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/daguar/subscriptions",\r        "organizations_url": "https://api.github.com/users/daguar/orgs",\r        "repos_url": "https://api.github.com/users/daguar/repos",\r        "events_url": "https://api.github.com/users/daguar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/daguar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r          "url": "https://api.github.com/repos/daguar/openaddresses/commits/e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r          "html_url": "https://github.com/daguar/openaddresses/commit/e1af73800eb25192099c4b1dd75bf0fbec3657fd"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "0c7cf2f3e4cb5f0c07818a029e1decc9797ad3a1",\r      "filename": "sources/us-ca-san_diego_county.json",\r      "status": "renamed",\r      "additions": 10,\r      "deletions": 3,\r      "changes": 13,\r      "blob_url": "https://github.com/daguar/openaddresses/blob/f85074d543622ef1fac7a80a059a50176f2a6e08/sources/us-ca-san_diego_county.json",\r      "raw_url": "https://github.com/daguar/openaddresses/raw/f85074d543622ef1fac7a80a059a50176f2a6e08/sources/us-ca-san_diego_county.json",\r      "contents_url": "https://api.github.com/repos/daguar/openaddresses/contents/sources/us-ca-san_diego_county.json?ref=f85074d543622ef1fac7a80a059a50176f2a6e08",\r      "patch": "@@ -1,12 +1,19 @@\\n {\\n     \\"coverage\\": {\\n+        \\"US Census\\": {\\n+          \\"geoid\\": \\"06073\\",\\n+          \\"name\\": \\"San Diego County\\",\\n+          \\"state\\": \\"California\\"\\n+        },\\n         \\"country\\": \\"us\\",\\n         \\"state\\": \\"ca\\",\\n-        \\"city\\": \\"San Diego\\"\\n+        \\"county\\": \\"San Diego\\"\\n     },\\n-    \\"attribution\\": \\"City of San Diego\\",\\n+    \\"attribution\\": \\"San Diego Geographic Information Source - JPA\\",\\n     \\"data\\": \\"http://rdw.sandag.org/file_store/Address/Address_APN.zip\\",\\n-    \\"license\\": \\"http://rdw.sandag.org/\\",\\n+    \\"license\\": \\"http://www.sangis.org/Legal_Notice.htm\\",\\n+    \\"note\\": \\"Metadata available at http://rdw.sandag.org/file_store%5CAddress/Address_APN.pdf\\",\\n+    \\"website\\": \\"http://rdw.sandag.org/\\",\\n     \\"year\\": \\"\\",\\n     \\"type\\": \\"http\\",\\n     \\"compression\\": \\"zip\\",",\r      "previous_filename": "sources/us-ca-san_diego.json"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/openaddresses/compare/master...bba8f709793f96750fed223d44ba373a92540b2a'):
            data = '''{\r  "url": "https://api.github.com/repos/openaddresses/openaddresses/compare/master...bba8f709793f96750fed223d44ba373a92540b2a",\r  "html_url": "https://github.com/openaddresses/openaddresses/compare/master...bba8f709793f96750fed223d44ba373a92540b2a",\r  "permalink_url": "https://github.com/openaddresses/openaddresses/compare/openaddresses:bba8f70...openaddresses:bba8f70",\r  "diff_url": "https://github.com/openaddresses/openaddresses/compare/master...bba8f709793f96750fed223d44ba373a92540b2a.diff",\r  "patch_url": "https://github.com/openaddresses/openaddresses/compare/master...bba8f709793f96750fed223d44ba373a92540b2a.patch",\r  "base_commit": {\r    "sha": "bba8f709793f96750fed223d44ba373a92540b2a",\r    "commit": {\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-06-21T20:25:01Z"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-06-21T20:25:01Z"\r      },\r      "message": "Merge pull request #1036 from daguar/fix-coverage-of-san-diego-county\\n\\nUpdate San Diego County coverage and details",\r      "tree": {\r        "sha": "6ba53187095d883ba698d230ab808021dfb9c4b4",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees/6ba53187095d883ba698d230ab808021dfb9c4b4"\r      },\r      "url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits/bba8f709793f96750fed223d44ba373a92540b2a",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/bba8f709793f96750fed223d44ba373a92540b2a",\r    "html_url": "https://github.com/openaddresses/openaddresses/commit/bba8f709793f96750fed223d44ba373a92540b2a",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/commits/bba8f709793f96750fed223d44ba373a92540b2a/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "6a7b18728673fc7621bb46ed1a445611f33324f9",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/6a7b18728673fc7621bb46ed1a445611f33324f9",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/6a7b18728673fc7621bb46ed1a445611f33324f9"\r      },\r      {\r        "sha": "f85074d543622ef1fac7a80a059a50176f2a6e08",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/f85074d543622ef1fac7a80a059a50176f2a6e08",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/f85074d543622ef1fac7a80a059a50176f2a6e08"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "bba8f709793f96750fed223d44ba373a92540b2a",\r    "commit": {\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-06-21T20:25:01Z"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-06-21T20:25:01Z"\r      },\r      "message": "Merge pull request #1036 from daguar/fix-coverage-of-san-diego-county\\n\\nUpdate San Diego County coverage and details",\r      "tree": {\r        "sha": "6ba53187095d883ba698d230ab808021dfb9c4b4",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees/6ba53187095d883ba698d230ab808021dfb9c4b4"\r      },\r      "url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits/bba8f709793f96750fed223d44ba373a92540b2a",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/bba8f709793f96750fed223d44ba373a92540b2a",\r    "html_url": "https://github.com/openaddresses/openaddresses/commit/bba8f709793f96750fed223d44ba373a92540b2a",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/commits/bba8f709793f96750fed223d44ba373a92540b2a/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "6a7b18728673fc7621bb46ed1a445611f33324f9",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/6a7b18728673fc7621bb46ed1a445611f33324f9",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/6a7b18728673fc7621bb46ed1a445611f33324f9"\r      },\r      {\r        "sha": "f85074d543622ef1fac7a80a059a50176f2a6e08",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/f85074d543622ef1fac7a80a059a50176f2a6e08",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/f85074d543622ef1fac7a80a059a50176f2a6e08"\r      }\r    ]\r  },\r  "status": "identical",\r  "ahead_by": 0,\r  "behind_by": 0,\r  "total_commits": 0,\r  "commits": [\r\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...6460668909a85d9db8df871d91e9b25bc5192add'):
            data = u'''{\r  "url": "https://api.github.com/repos/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...6460668909a85d9db8df871d91e9b25bc5192add",\r  "html_url": "https://github.com/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...6460668909a85d9db8df871d91e9b25bc5192add",\r  "permalink_url": "https://github.com/migurski/hooked-on-sources/compare/migurski:c3c7de3...migurski:6460668",\r  "diff_url": "https://github.com/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...6460668909a85d9db8df871d91e9b25bc5192add.diff",\r  "patch_url": "https://github.com/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...6460668909a85d9db8df871d91e9b25bc5192add.patch",\r  "base_commit": {\r    "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r    "commit": {\r      "author": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "committer": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "message": "enqueue job",\r      "tree": {\r        "sha": "afc45c40d97283480591195bedc3f38225b3965e",\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees/afc45c40d97283480591195bedc3f38225b3965e"\r      },\r      "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "html_url": "https://github.com/migurski/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6/comments",\r    "author": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r        "html_url": "https://github.com/migurski/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r    "commit": {\r      "author": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "committer": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "message": "enqueue job",\r      "tree": {\r        "sha": "afc45c40d97283480591195bedc3f38225b3965e",\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees/afc45c40d97283480591195bedc3f38225b3965e"\r      },\r      "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "html_url": "https://github.com/migurski/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6/comments",\r    "author": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r        "html_url": "https://github.com/migurski/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 2,\r  "behind_by": 0,\r  "total_commits": 2,\r  "commits": [\r    {\r      "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:48:33Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:48:33Z"\r        },\r        "message": "Added La Réunion",\r        "tree": {\r          "sha": "da8a3bffb5115ac29690711852a21ce8df350cf7",\r          "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees/da8a3bffb5115ac29690711852a21ce8df350cf7"\r        },\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "html_url": "https://github.com/migurski/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/migurski/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        }\r      ]\r    },\r    {\r      "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:53:19Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:53:19Z"\r        },\r        "message": "Added Latin-1 encoding",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r      "html_url": "https://github.com/migurski/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r      "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r          "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r          "html_url": "https://github.com/migurski/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r      "filename": "sources/fr/la-réunion.json",\r      "status": "added",\r      "additions": 23,\r      "deletions": 0,\r      "changes": 23,\r      "blob_url": "https://github.com/migurski/hooked-on-sources/blob/6460668909a85d9db8df871d91e9b25bc5192add/sources/fr/la-r%C3%A9union.json",\r      "raw_url": "https://github.com/migurski/hooked-on-sources/raw/6460668909a85d9db8df871d91e9b25bc5192add/sources/fr/la-r%C3%A9union.json",\r      "contents_url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=6460668909a85d9db8df871d91e9b25bc5192add",\r      "patch": "@@ -0,0 +1,23 @@\\n+{\\n+    \\"coverage\\": {\\n+        \\"ISO 3166\\": {\\n+            \\"alpha2\\": \\"FR-974\\"\\n+        }\\n+    },\\n+    \\"website\\": \\"http://adresse.data.gouv.fr/download/\\",\\n+    \\"note\\": \\"Downloaded and cached 2015-06-18\\",\\n+    \\"data\\": \\"http://data.openaddresses.io/cache/fr/BAN_licence_gratuite_repartage_974.zip\\",\\n+    \\"type\\": \\"http\\",\\n+    \\"compression\\": \\"zip\\",\\n+    \\"conform\\": {\\n+        \\"type\\": \\"csv\\",\\n+        \\"csvsplit\\": \\";\\",\\n+        \\"number\\": \\"numero\\",\\n+        \\"street\\": \\"nom_voie\\",\\n+        \\"lon\\": \\"lon\\",\\n+        \\"lat\\": \\"lat\\",\\n+        \\"city\\": \\"nom_commune\\",\\n+        \\"postcode\\": \\"code_post\\",\\n+        \\"encoding\\": \\"ISO-8859-1\\"\\n+    }\\n+}\\n\\\\ No newline at end of file"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...37e992e9f2aa14265588ca8b214e001e1628f53c'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...37e992e9f2aa14265588ca8b214e001e1628f53c",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...37e992e9f2aa14265588ca8b214e001e1628f53c",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:c3c7de3...openaddresses:37e992e",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...37e992e9f2aa14265588ca8b214e001e1628f53c.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...37e992e9f2aa14265588ca8b214e001e1628f53c.patch",\r  "base_commit": {\r    "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r    "commit": {\r      "author": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "committer": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "message": "enqueue job",\r      "tree": {\r        "sha": "afc45c40d97283480591195bedc3f38225b3965e",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/afc45c40d97283480591195bedc3f38225b3965e"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6/comments",\r    "author": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r    "commit": {\r      "author": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "committer": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "message": "enqueue job",\r      "tree": {\r        "sha": "afc45c40d97283480591195bedc3f38225b3965e",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/afc45c40d97283480591195bedc3f38225b3965e"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6/comments",\r    "author": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 1,\r  "behind_by": 0,\r  "total_commits": 1,\r  "commits": [\r    {\r      "sha": "37e992e9f2aa14265588ca8b214e001e1628f53c",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-05-03T00:34:38Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-05-03T00:34:38Z"\r        },\r        "message": "testing",\r        "tree": {\r          "sha": "331d7e244306eb63e197e2b45bd607df313d1596",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/331d7e244306eb63e197e2b45bd607df313d1596"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/37e992e9f2aa14265588ca8b214e001e1628f53c",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/37e992e9f2aa14265588ca8b214e001e1628f53c",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/37e992e9f2aa14265588ca8b214e001e1628f53c",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/37e992e9f2aa14265588ca8b214e001e1628f53c/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "83ba405aa5eb22e058c125ce97ea53845daa8254",\r      "filename": "sources/us-ca-nevada_county.json",\r      "status": "modified",\r      "additions": 0,\r      "deletions": 1,\r      "changes": 1,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/37e992e9f2aa14265588ca8b214e001e1628f53c/sources/us-ca-nevada_county.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/37e992e9f2aa14265588ca8b214e001e1628f53c/sources/us-ca-nevada_county.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=37e992e9f2aa14265588ca8b214e001e1628f53c",\r      "patch": "@@ -23,4 +23,3 @@\\n     }\\n }\\n \\n-"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/master...8dd262c2f30a70b27e371869c54315b1abc32247'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:6460668...openaddresses:8dd262c",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247.patch",\r  "base_commit": {\r    "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "message": "Added Latin-1 encoding",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "message": "Added Latin-1 encoding",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 1,\r  "behind_by": 0,\r  "total_commits": 1,\r  "commits": [\r    {\r      "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r      "commit": {\r        "author": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "committer": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        },\r        {\r          "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add"\r        }\r      ]\r    }\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:6460668...openaddresses:8dd262c",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/6460668909a85d9db8df871d91e9b25bc5192add...8dd262c2f30a70b27e371869c54315b1abc32247.patch",\r  "base_commit": {\r    "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "message": "Added Latin-1 encoding",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "message": "Added Latin-1 encoding",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 1,\r  "behind_by": 0,\r  "total_commits": 1,\r  "commits": [\r    {\r      "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r      "commit": {\r        "author": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "committer": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        },\r        {\r          "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add"\r        }\r      ]\r    }\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...aed74b0784f696c3cf10e8e260865ae18ffd3aa8'):
            data = u'''{\r  "url": "https://api.github.com/repos/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r  "html_url": "https://github.com/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r  "permalink_url": "https://github.com/migurski/hooked-on-sources/compare/migurski:c3c7de3...migurski:aed74b0",\r  "diff_url": "https://github.com/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...aed74b0784f696c3cf10e8e260865ae18ffd3aa8.diff",\r  "patch_url": "https://github.com/migurski/hooked-on-sources/compare/c3c7de37f96d38534dc6297a2483c218994241b6...aed74b0784f696c3cf10e8e260865ae18ffd3aa8.patch",\r  "base_commit": {\r    "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r    "commit": {\r      "author": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "committer": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "message": "enqueue job",\r      "tree": {\r        "sha": "afc45c40d97283480591195bedc3f38225b3965e",\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees/afc45c40d97283480591195bedc3f38225b3965e"\r      },\r      "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "html_url": "https://github.com/migurski/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6/comments",\r    "author": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r        "html_url": "https://github.com/migurski/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r    "commit": {\r      "author": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "committer": {\r        "name": "Nelson Minar",\r        "email": "nelson@monkey.org",\r        "date": "2015-05-03T00:31:36Z"\r      },\r      "message": "enqueue job",\r      "tree": {\r        "sha": "afc45c40d97283480591195bedc3f38225b3965e",\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees/afc45c40d97283480591195bedc3f38225b3965e"\r      },\r      "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "html_url": "https://github.com/migurski/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6",\r    "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6/comments",\r    "author": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "NelsonMinar",\r      "id": 382136,\r      "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/NelsonMinar",\r      "html_url": "https://github.com/NelsonMinar",\r      "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r      "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r      "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r      "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r      "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r      "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r        "html_url": "https://github.com/migurski/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 1,\r  "behind_by": 0,\r  "total_commits": 1,\r  "commits": [\r    {\r      "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:48:33Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:48:33Z"\r        },\r        "message": "Added La Réunion",\r        "tree": {\r          "sha": "da8a3bffb5115ac29690711852a21ce8df350cf7",\r          "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees/da8a3bffb5115ac29690711852a21ce8df350cf7"\r        },\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "html_url": "https://github.com/migurski/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/migurski/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/migurski/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "fb6936692415f70d49cc922a9cf3c53c3e9a9756",\r      "filename": "sources/fr/la-réunion.json",\r      "status": "added",\r      "additions": 22,\r      "deletions": 0,\r      "changes": 22,\r      "blob_url": "https://github.com/migurski/hooked-on-sources/blob/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/sources/fr/la-r%C3%A9union.json",\r      "raw_url": "https://github.com/migurski/hooked-on-sources/raw/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/sources/fr/la-r%C3%A9union.json",\r      "contents_url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "patch": "@@ -0,0 +1,22 @@\\n+{\\n+    \\"coverage\\": {\\n+        \\"ISO 3166\\": {\\n+            \\"alpha2\\": \\"FR-974\\"\\n+        }\\n+    },\\n+    \\"website\\": \\"http://adresse.data.gouv.fr/download/\\",\\n+    \\"note\\": \\"Downloaded and cached 2015-06-18\\",\\n+    \\"data\\": \\"http://data.openaddresses.io/cache/fr/BAN_licence_gratuite_repartage_974.zip\\",\\n+    \\"type\\": \\"http\\",\\n+    \\"compression\\": \\"zip\\",\\n+    \\"conform\\": {\\n+        \\"type\\": \\"csv\\",\\n+        \\"csvsplit\\": \\";\\",\\n+        \\"number\\": \\"numero\\",\\n+        \\"street\\": \\"nom_voie\\",\\n+        \\"lon\\": \\"lon\\",\\n+        \\"lat\\": \\"lat\\",\\n+        \\"city\\": \\"nom_commune\\",\\n+        \\"postcode\\": \\"code_post\\"\\n+    }\\n+}\\n\\\\ No newline at end of file"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...master'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...master",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...master",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:ded44ed...openaddresses:8dd262c",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...master.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa...master.patch",\r  "base_commit": {\r    "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "message": "Added Berkeley",\r      "tree": {\r        "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:25:55Z"\r      },\r      "message": "Added Berkeley",\r      "tree": {\r        "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 13,\r  "behind_by": 0,\r  "total_commits": 13,\r  "commits": [\r    {\r      "sha": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-27T01:29:59Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-27T01:29:59Z"\r        },\r        "message": "Added Contra Costa county",\r        "tree": {\r          "sha": "f9e70a36019597c21c7a28bd16840588e6223a33",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f9e70a36019597c21c7a28bd16840588e6223a33"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b450dcbb6f4c61015b0a00290e984849f7d649de",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r        }\r      ]\r    },\r    {\r      "sha": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-27T01:36:22Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-27T01:36:22Z"\r        },\r        "message": "Empty commit",\r        "tree": {\r          "sha": "f9e70a36019597c21c7a28bd16840588e6223a33",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f9e70a36019597c21c7a28bd16840588e6223a33"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b450dcbb6f4c61015b0a00290e984849f7d649de"\r        }\r      ]\r    },\r    {\r      "sha": "b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:26:29Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:26:29Z"\r        },\r        "message": "test broken file",\r        "tree": {\r          "sha": "d4957e2bb6b7498a39ecc8da0b4f127e739c6d45",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/d4957e2bb6b7498a39ecc8da0b4f127e739c6d45"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b68239fb968dc6f8597a0f1ebbd0732f99903ef1/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637"\r        }\r      ]\r    },\r    {\r      "sha": "7d005a031d0bd70a2d2c603c11580375cc6e5657",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:34:03Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:34:03Z"\r        },\r        "message": "test",\r        "tree": {\r          "sha": "18bc28222de95b85daa6952d10cc1f8718294c07",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/18bc28222de95b85daa6952d10cc1f8718294c07"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/7d005a031d0bd70a2d2c603c11580375cc6e5657",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7d005a031d0bd70a2d2c603c11580375cc6e5657",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/7d005a031d0bd70a2d2c603c11580375cc6e5657",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7d005a031d0bd70a2d2c603c11580375cc6e5657/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b68239fb968dc6f8597a0f1ebbd0732f99903ef1"\r        }\r      ]\r    },\r    {\r      "sha": "069055534aa57ad5ad814576b21b0d084a529c20",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:40:57Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:40:57Z"\r        },\r        "message": "enqueue test",\r        "tree": {\r          "sha": "3105d9f8955c2e4e8720dda8abfd2e01d852b0df",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/3105d9f8955c2e4e8720dda8abfd2e01d852b0df"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/069055534aa57ad5ad814576b21b0d084a529c20",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/069055534aa57ad5ad814576b21b0d084a529c20",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/069055534aa57ad5ad814576b21b0d084a529c20",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/069055534aa57ad5ad814576b21b0d084a529c20/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "7d005a031d0bd70a2d2c603c11580375cc6e5657",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7d005a031d0bd70a2d2c603c11580375cc6e5657",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/7d005a031d0bd70a2d2c603c11580375cc6e5657"\r        }\r      ]\r    },\r    {\r      "sha": "2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:42:53Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:42:53Z"\r        },\r        "message": "enqueue test",\r        "tree": {\r          "sha": "356f187a95d243870254842e0421772257284762",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/356f187a95d243870254842e0421772257284762"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "069055534aa57ad5ad814576b21b0d084a529c20",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/069055534aa57ad5ad814576b21b0d084a529c20",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/069055534aa57ad5ad814576b21b0d084a529c20"\r        }\r      ]\r    },\r    {\r      "sha": "1c121048ae434e0b2e6832a2a8430b7780f5deec",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:04:19Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:04:19Z"\r        },\r        "message": "test commit",\r        "tree": {\r          "sha": "ce38f6d6fcc9b7a43f8f84c65eefb120923e05c3",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/ce38f6d6fcc9b7a43f8f84c65eefb120923e05c3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/1c121048ae434e0b2e6832a2a8430b7780f5deec",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/1c121048ae434e0b2e6832a2a8430b7780f5deec",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/1c121048ae434e0b2e6832a2a8430b7780f5deec",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/1c121048ae434e0b2e6832a2a8430b7780f5deec/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05"\r        }\r      ]\r    },\r    {\r      "sha": "7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:17:16Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:17:16Z"\r        },\r        "message": "clean up mess",\r        "tree": {\r          "sha": "dfda7e1da54ffce6f5952cc147437fc0489cf3bc",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/dfda7e1da54ffce6f5952cc147437fc0489cf3bc"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7b2bb2386dbc161a3841a1452e7dd3f935a219ac/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "1c121048ae434e0b2e6832a2a8430b7780f5deec",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/1c121048ae434e0b2e6832a2a8430b7780f5deec",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/1c121048ae434e0b2e6832a2a8430b7780f5deec"\r        }\r      ]\r    },\r    {\r      "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:17:40Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:17:40Z"\r        },\r        "message": "enqueue job",\r        "tree": {\r          "sha": "331d7e244306eb63e197e2b45bd607df313d1596",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/331d7e244306eb63e197e2b45bd607df313d1596"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/7b2bb2386dbc161a3841a1452e7dd3f935a219ac"\r        }\r      ]\r    },\r    {\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-03T00:31:36Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-03T00:31:36Z"\r        },\r        "message": "enqueue job",\r        "tree": {\r          "sha": "afc45c40d97283480591195bedc3f38225b3965e",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/afc45c40d97283480591195bedc3f38225b3965e"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f"\r        }\r      ]\r    },\r    {\r      "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:48:33Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:48:33Z"\r        },\r        "message": "Added La Réunion",\r        "tree": {\r          "sha": "da8a3bffb5115ac29690711852a21ce8df350cf7",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/da8a3bffb5115ac29690711852a21ce8df350cf7"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        }\r      ]\r    },\r    {\r      "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:53:19Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:53:19Z"\r        },\r        "message": "Added Latin-1 encoding",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r        }\r      ]\r    },\r    {\r      "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r      "commit": {\r        "author": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "committer": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        },\r        {\r          "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r      "filename": "sources/fr/la-réunion.json",\r      "status": "added",\r      "additions": 23,\r      "deletions": 0,\r      "changes": 23,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,23 @@\\n+{\\n+    \"coverage\": {\\n+        \"ISO 3166\": {\\n+            \"alpha2\": \"FR-974\"\\n+        }\\n+    },\\n+    \"website\": \"http://adresse.data.gouv.fr/download/\",\\n+    \"note\": \"Downloaded and cached 2015-06-18\",\\n+    \"data\": \"http://data.openaddresses.io/cache/fr/BAN_licence_gratuite_repartage_974.zip\",\\n+    \"type\": \"http\",\\n+    \"compression\": \"zip\",\\n+    \"conform\": {\\n+        \"type\": \"csv\",\\n+        \"csvsplit\": \";\",\\n+        \"number\": \"numero\",\\n+        \"street\": \"nom_voie\",\\n+        \"lon\": \"lon\",\\n+        \"lat\": \"lat\",\\n+        \"city\": \"nom_commune\",\\n+        \"postcode\": \"code_post\",\\n+        \"encoding\": \"ISO-8859-1\"\\n+    }\\n+}\\n\\ No newline at end of file"\r    },\r    {\r      "sha": "8010fecfae4eac9187e9e6a5c8f7dfcb2534e17c",\r      "filename": "sources/us-ca-contra_costa_county.json",\r      "status": "added",\r      "additions": 28,\r      "deletions": 0,\r      "changes": 28,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-contra_costa_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,28 @@\\n+{\\n+    \"coverage\": {\\n+        \"US Census\": {\\n+            \"geoid\": \"06013\",\\n+            \"name\": \"Contra Costa County\",\\n+            \"state\": \"California\"\\n+        },\\n+        \"country\": \"us\",\\n+        \"state\": \"ca\",\\n+        \"county\": \"Contra Costa\"\\n+    },\\n+    \"data\": \"http://www.ccmap.us/download/main.asp?idProduct=134492\",\\n+    \"website\": \"http://www.ccmap.us/catalog.asp?UserChoice=1&Layercntrl=0000000000000000000000#1\",\\n+    \"license\": \"http://www.ccmap.us/information.asp\",\\n+    \"attribution\": \"Contra Costa County\",\\n+    \"type\": \"http\",\\n+    \"compression\": \"zip\",\\n+    \"year\": \"2014\",\\n+    \"note\": \"Details for the dataset (eg, projection) can be found here http://www.ccmap.us/Details.asp?Product=134492\",\\n+    \"conform\": {\\n+        \"lon\": \"x\",\\n+        \"lat\": \"y\",\\n+        \"number\": \"S_STR_NBR\",\\n+        \"merge\": [\"S_STR_NM\", \"S_STR_SUF\"],\\n+        \"street\": \"auto_street\",\\n+        \"type\": \"shapefile\"\\n+    }\\n+}"\r    },\r    {\r      "sha": "2dc45c5b21b9149d16b47142ee06d5238be8bfd9",\r      "filename": "sources/us-ca-nevada_county.json",\r      "status": "added",\r      "additions": 26,\r      "deletions": 0,\r      "changes": 26,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,26 @@\\n+{\\n+    \"coverage\": {\\n+        \"US Census\": {\\n+            \"geoid\": \"06057\",\\n+            \"name\": \"Nevada County\",\\n+            \"state\": \"California\"\\n+        },\\n+        \"country\": \"us\",\\n+        \"state\": \"ca\",\\n+        \"county\": \"Nevada\"\\n+    },\\n+    \"attribution\": \"Nevada County\",\\n+    \"data\": \"http://www.mynevadacounty.com/nc/igs/gis/docs/Digital%20Data%20Library/AddressPoint.zip\",\\n+    \"website\": \"http://www.mynevadacounty.com/nc/igs/gis/Pages/MetaData.aspx\",\\n+    \"type\": \"http\",\\n+    \"compression\": \"zip\",\\n+    \"conform\": {\\n+        \"lon\": \"x\",\\n+        \"lat\": \"y\",\\n+        \"number\": \"streetNum\",\\n+        \"street\": \"streetName\",\\n+        \"type\": \"shapefile\"\\n+    }\\n+}\\n+\\n+"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/e91fbc420f08890960f50f863626e1062f922522...master'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/e91fbc420f08890960f50f863626e1062f922522...master",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/e91fbc420f08890960f50f863626e1062f922522...master",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:e91fbc4...openaddresses:8dd262c",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/e91fbc420f08890960f50f863626e1062f922522...master.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/e91fbc420f08890960f50f863626e1062f922522...master.patch",\r  "base_commit": {\r    "sha": "e91fbc420f08890960f50f863626e1062f922522",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:16:12Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:16:12Z"\r      },\r      "message": "Added first source",\r      "tree": {\r        "sha": "f5e85249cee39d0e84ed936d31a9c08c1eaaa539",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f5e85249cee39d0e84ed936d31a9c08c1eaaa539"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/e91fbc420f08890960f50f863626e1062f922522",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e91fbc420f08890960f50f863626e1062f922522",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/e91fbc420f08890960f50f863626e1062f922522",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e91fbc420f08890960f50f863626e1062f922522/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "c52204fd40f17f9da243df09e6d1107d48768afd",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c52204fd40f17f9da243df09e6d1107d48768afd",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c52204fd40f17f9da243df09e6d1107d48768afd"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "e91fbc420f08890960f50f863626e1062f922522",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:16:12Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-04-26T00:16:12Z"\r      },\r      "message": "Added first source",\r      "tree": {\r        "sha": "f5e85249cee39d0e84ed936d31a9c08c1eaaa539",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f5e85249cee39d0e84ed936d31a9c08c1eaaa539"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/e91fbc420f08890960f50f863626e1062f922522",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e91fbc420f08890960f50f863626e1062f922522",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/e91fbc420f08890960f50f863626e1062f922522",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e91fbc420f08890960f50f863626e1062f922522/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "c52204fd40f17f9da243df09e6d1107d48768afd",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c52204fd40f17f9da243df09e6d1107d48768afd",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c52204fd40f17f9da243df09e6d1107d48768afd"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 15,\r  "behind_by": 0,\r  "total_commits": 15,\r  "commits": [\r    {\r      "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:25:45Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:25:45Z"\r        },\r        "message": "Added SF",\r        "tree": {\r          "sha": "11a1269b6f35f26ce57b78d5f6c88452d6d411a5",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/11a1269b6f35f26ce57b78d5f6c88452d6d411a5"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "e91fbc420f08890960f50f863626e1062f922522",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/e91fbc420f08890960f50f863626e1062f922522",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/e91fbc420f08890960f50f863626e1062f922522"\r        }\r      ]\r    },\r    {\r      "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:25:55Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-26T00:25:55Z"\r        },\r        "message": "Added Berkeley",\r        "tree": {\r          "sha": "9d6ac64ea358034e23fba121f3833790f47b5d76",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/9d6ac64ea358034e23fba121f3833790f47b5d76"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "73a81c5b337bd393273a222f1cd191d7e634df51",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/73a81c5b337bd393273a222f1cd191d7e634df51",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r        }\r      ]\r    },\r    {\r      "sha": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-27T01:29:59Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-27T01:29:59Z"\r        },\r        "message": "Added Contra Costa county",\r        "tree": {\r          "sha": "f9e70a36019597c21c7a28bd16840588e6223a33",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f9e70a36019597c21c7a28bd16840588e6223a33"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b450dcbb6f4c61015b0a00290e984849f7d649de",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r        }\r      ]\r    },\r    {\r      "sha": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-27T01:36:22Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-04-27T01:36:22Z"\r        },\r        "message": "Empty commit",\r        "tree": {\r          "sha": "f9e70a36019597c21c7a28bd16840588e6223a33",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/f9e70a36019597c21c7a28bd16840588e6223a33"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b450dcbb6f4c61015b0a00290e984849f7d649de",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b450dcbb6f4c61015b0a00290e984849f7d649de"\r        }\r      ]\r    },\r    {\r      "sha": "b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:26:29Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:26:29Z"\r        },\r        "message": "test broken file",\r        "tree": {\r          "sha": "d4957e2bb6b7498a39ecc8da0b4f127e739c6d45",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/d4957e2bb6b7498a39ecc8da0b4f127e739c6d45"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b68239fb968dc6f8597a0f1ebbd0732f99903ef1/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/3147668047a0bec6d481c0e42995f7c5e5eac637",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637"\r        }\r      ]\r    },\r    {\r      "sha": "7d005a031d0bd70a2d2c603c11580375cc6e5657",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:34:03Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:34:03Z"\r        },\r        "message": "test",\r        "tree": {\r          "sha": "18bc28222de95b85daa6952d10cc1f8718294c07",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/18bc28222de95b85daa6952d10cc1f8718294c07"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/7d005a031d0bd70a2d2c603c11580375cc6e5657",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7d005a031d0bd70a2d2c603c11580375cc6e5657",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/7d005a031d0bd70a2d2c603c11580375cc6e5657",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7d005a031d0bd70a2d2c603c11580375cc6e5657/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/b68239fb968dc6f8597a0f1ebbd0732f99903ef1",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/b68239fb968dc6f8597a0f1ebbd0732f99903ef1"\r        }\r      ]\r    },\r    {\r      "sha": "069055534aa57ad5ad814576b21b0d084a529c20",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:40:57Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:40:57Z"\r        },\r        "message": "enqueue test",\r        "tree": {\r          "sha": "3105d9f8955c2e4e8720dda8abfd2e01d852b0df",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/3105d9f8955c2e4e8720dda8abfd2e01d852b0df"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/069055534aa57ad5ad814576b21b0d084a529c20",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/069055534aa57ad5ad814576b21b0d084a529c20",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/069055534aa57ad5ad814576b21b0d084a529c20",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/069055534aa57ad5ad814576b21b0d084a529c20/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "7d005a031d0bd70a2d2c603c11580375cc6e5657",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7d005a031d0bd70a2d2c603c11580375cc6e5657",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/7d005a031d0bd70a2d2c603c11580375cc6e5657"\r        }\r      ]\r    },\r    {\r      "sha": "2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:42:53Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T22:42:53Z"\r        },\r        "message": "enqueue test",\r        "tree": {\r          "sha": "356f187a95d243870254842e0421772257284762",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/356f187a95d243870254842e0421772257284762"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "069055534aa57ad5ad814576b21b0d084a529c20",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/069055534aa57ad5ad814576b21b0d084a529c20",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/069055534aa57ad5ad814576b21b0d084a529c20"\r        }\r      ]\r    },\r    {\r      "sha": "1c121048ae434e0b2e6832a2a8430b7780f5deec",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:04:19Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:04:19Z"\r        },\r        "message": "test commit",\r        "tree": {\r          "sha": "ce38f6d6fcc9b7a43f8f84c65eefb120923e05c3",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/ce38f6d6fcc9b7a43f8f84c65eefb120923e05c3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/1c121048ae434e0b2e6832a2a8430b7780f5deec",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/1c121048ae434e0b2e6832a2a8430b7780f5deec",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/1c121048ae434e0b2e6832a2a8430b7780f5deec",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/1c121048ae434e0b2e6832a2a8430b7780f5deec/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/2a295df1eb3a2e26dbab11b74f61e7e5fd214b05"\r        }\r      ]\r    },\r    {\r      "sha": "7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:17:16Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:17:16Z"\r        },\r        "message": "clean up mess",\r        "tree": {\r          "sha": "dfda7e1da54ffce6f5952cc147437fc0489cf3bc",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/dfda7e1da54ffce6f5952cc147437fc0489cf3bc"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7b2bb2386dbc161a3841a1452e7dd3f935a219ac/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "1c121048ae434e0b2e6832a2a8430b7780f5deec",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/1c121048ae434e0b2e6832a2a8430b7780f5deec",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/1c121048ae434e0b2e6832a2a8430b7780f5deec"\r        }\r      ]\r    },\r    {\r      "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:17:40Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-02T23:17:40Z"\r        },\r        "message": "enqueue job",\r        "tree": {\r          "sha": "331d7e244306eb63e197e2b45bd607df313d1596",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/331d7e244306eb63e197e2b45bd607df313d1596"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/7b2bb2386dbc161a3841a1452e7dd3f935a219ac",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/7b2bb2386dbc161a3841a1452e7dd3f935a219ac"\r        }\r      ]\r    },\r    {\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "commit": {\r        "author": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-03T00:31:36Z"\r        },\r        "committer": {\r          "name": "Nelson Minar",\r          "email": "nelson@monkey.org",\r          "date": "2015-05-03T00:31:36Z"\r        },\r        "message": "enqueue job",\r        "tree": {\r          "sha": "afc45c40d97283480591195bedc3f38225b3965e",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/afc45c40d97283480591195bedc3f38225b3965e"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6/comments",\r      "author": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "NelsonMinar",\r        "id": 382136,\r        "avatar_url": "https://avatars.githubusercontent.com/u/382136?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/NelsonMinar",\r        "html_url": "https://github.com/NelsonMinar",\r        "followers_url": "https://api.github.com/users/NelsonMinar/followers",\r        "following_url": "https://api.github.com/users/NelsonMinar/following{/other_user}",\r        "gists_url": "https://api.github.com/users/NelsonMinar/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/NelsonMinar/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/NelsonMinar/subscriptions",\r        "organizations_url": "https://api.github.com/users/NelsonMinar/orgs",\r        "repos_url": "https://api.github.com/users/NelsonMinar/repos",\r        "events_url": "https://api.github.com/users/NelsonMinar/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/NelsonMinar/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "d59d3c4d4869337afe4314f8310f587766a8981f",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/d59d3c4d4869337afe4314f8310f587766a8981f",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/d59d3c4d4869337afe4314f8310f587766a8981f"\r        }\r      ]\r    },\r    {\r      "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:48:33Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:48:33Z"\r        },\r        "message": "Added La Réunion",\r        "tree": {\r          "sha": "da8a3bffb5115ac29690711852a21ce8df350cf7",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/da8a3bffb5115ac29690711852a21ce8df350cf7"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        }\r      ]\r    },\r    {\r      "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "commit": {\r        "author": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:53:19Z"\r        },\r        "committer": {\r          "name": "Michal Migurski",\r          "email": "mike@teczno.com",\r          "date": "2015-06-27T22:53:19Z"\r        },\r        "message": "Added Latin-1 encoding",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r        }\r      ]\r    },\r    {\r      "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r      "commit": {\r        "author": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "committer": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        },\r        {\r          "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r      "filename": "sources/fr/la-réunion.json",\r      "status": "added",\r      "additions": 23,\r      "deletions": 0,\r      "changes": 23,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,23 @@\\n+{\\n+    \"coverage\": {\\n+        \"ISO 3166\": {\\n+            \"alpha2\": \"FR-974\"\\n+        }\\n+    },\\n+    \"website\": \"http://adresse.data.gouv.fr/download/\",\\n+    \"note\": \"Downloaded and cached 2015-06-18\",\\n+    \"data\": \"http://data.openaddresses.io/cache/fr/BAN_licence_gratuite_repartage_974.zip\",\\n+    \"type\": \"http\",\\n+    \"compression\": \"zip\",\\n+    \"conform\": {\\n+        \"type\": \"csv\",\\n+        \"csvsplit\": \";\",\\n+        \"number\": \"numero\",\\n+        \"street\": \"nom_voie\",\\n+        \"lon\": \"lon\",\\n+        \"lat\": \"lat\",\\n+        \"city\": \"nom_commune\",\\n+        \"postcode\": \"code_post\",\\n+        \"encoding\": \"ISO-8859-1\"\\n+    }\\n+}\\n\\ No newline at end of file"\r    },\r    {\r      "sha": "16464c39b59b5a09c6526da3afa9a5f57caabcad",\r      "filename": "sources/us-ca-berkeley.json",\r      "status": "added",\r      "additions": 26,\r      "deletions": 0,\r      "changes": 26,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-berkeley.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-berkeley.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,26 @@\\n+{\\n+    \"coverage\": {\\n+        \"US Census\": {\\n+            \"geoid\": \"0606000\",\\n+            \"place\": \"Berkeley\",\\n+            \"state\": \"California\"\\n+        },\\n+        \"country\": \"us\",\\n+        \"state\": \"ca\",\\n+        \"place\": \"Berkeley\"\\n+    },\\n+    \"attribution\": \"City of Berkeley\",\\n+    \"data\": \"http://www.ci.berkeley.ca.us/uploadedFiles/IT/GIS/Parcels.zip\",\\n+    \"website\": \"http://www.ci.berkeley.ca.us/datacatalog/\",\\n+    \"type\": \"http\",\\n+    \"compression\": \"zip\",\\n+    \"note\": \"Metadata at http://www.ci.berkeley.ca.us/uploadedFiles/IT/GIS/Parcels.shp(1).xml\",\\n+    \"conform\": {\\n+        \"lon\": \"x\",\\n+        \"lat\": \"y\",\\n+        \"number\": \"StreetNum\",\\n+        \"merge\": [\"StreetName\", \"StreetSufx\", \"Direction\"],\\n+        \"street\": \"auto_street\",\\n+        \"type\": \"shapefile-polygon\"\\n+    }\\n+}"\r    },\r    {\r      "sha": "8010fecfae4eac9187e9e6a5c8f7dfcb2534e17c",\r      "filename": "sources/us-ca-contra_costa_county.json",\r      "status": "added",\r      "additions": 28,\r      "deletions": 0,\r      "changes": 28,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-contra_costa_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,28 @@\\n+{\\n+    \"coverage\": {\\n+        \"US Census\": {\\n+            \"geoid\": \"06013\",\\n+            \"name\": \"Contra Costa County\",\\n+            \"state\": \"California\"\\n+        },\\n+        \"country\": \"us\",\\n+        \"state\": \"ca\",\\n+        \"county\": \"Contra Costa\"\\n+    },\\n+    \"data\": \"http://www.ccmap.us/download/main.asp?idProduct=134492\",\\n+    \"website\": \"http://www.ccmap.us/catalog.asp?UserChoice=1&Layercntrl=0000000000000000000000#1\",\\n+    \"license\": \"http://www.ccmap.us/information.asp\",\\n+    \"attribution\": \"Contra Costa County\",\\n+    \"type\": \"http\",\\n+    \"compression\": \"zip\",\\n+    \"year\": \"2014\",\\n+    \"note\": \"Details for the dataset (eg, projection) can be found here http://www.ccmap.us/Details.asp?Product=134492\",\\n+    \"conform\": {\\n+        \"lon\": \"x\",\\n+        \"lat\": \"y\",\\n+        \"number\": \"S_STR_NBR\",\\n+        \"merge\": [\"S_STR_NM\", \"S_STR_SUF\"],\\n+        \"street\": \"auto_street\",\\n+        \"type\": \"shapefile\"\\n+    }\\n+}"\r    },\r    {\r      "sha": "2dc45c5b21b9149d16b47142ee06d5238be8bfd9",\r      "filename": "sources/us-ca-nevada_county.json",\r      "status": "added",\r      "additions": 26,\r      "deletions": 0,\r      "changes": 26,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,26 @@\\n+{\\n+    \"coverage\": {\\n+        \"US Census\": {\\n+            \"geoid\": \"06057\",\\n+            \"name\": \"Nevada County\",\\n+            \"state\": \"California\"\\n+        },\\n+        \"country\": \"us\",\\n+        \"state\": \"ca\",\\n+        \"county\": \"Nevada\"\\n+    },\\n+    \"attribution\": \"Nevada County\",\\n+    \"data\": \"http://www.mynevadacounty.com/nc/igs/gis/docs/Digital%20Data%20Library/AddressPoint.zip\",\\n+    \"website\": \"http://www.mynevadacounty.com/nc/igs/gis/Pages/MetaData.aspx\",\\n+    \"type\": \"http\",\\n+    \"compression\": \"zip\",\\n+    \"conform\": {\\n+        \"lon\": \"x\",\\n+        \"lat\": \"y\",\\n+        \"number\": \"streetNum\",\\n+        \"street\": \"streetName\",\\n+        \"type\": \"shapefile\"\\n+    }\\n+}\\n+\\n+"\r    },\r    {\r      "sha": "cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r      "filename": "sources/us-ca-san_francisco.json",\r      "status": "added",\r      "additions": 22,\r      "deletions": 0,\r      "changes": 22,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-san_francisco.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-san_francisco.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,22 @@\\n+{\\n+    \"coverage\": {\\n+        \"country\": \"us\",\\n+        \"state\": \"ca\",\\n+        \"city\": \"San Francisco\"\\n+    },\\n+    \"attribution\": \"City of San Francisco\",\\n+    \"data\": \"https://data.sfgov.org/download/kvej-w5kb/ZIPPED%20SHAPEFILE\",\\n+    \"license\": \"\",\\n+    \"year\": \"\",\\n+    \"type\": \"http\",\\n+    \"compression\": \"zip\",\\n+    \"conform\": {\\n+\t\"split\": \"ADDRESS\",\\n+        \"lon\": \"x\",\\n+        \"lat\": \"y\",\\n+        \"number\": \"auto_number\",\\n+        \"street\": \"auto_street\",\\n+        \"type\": \"shapefile\",\\n+        \"postcode\": \"zipcode\"\\n+    }\\n+}"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/badjson20f08890960f50f863626e1062f922522...master'):
            data = u'''{\r  "message": "Not Found",\r  "documentation_url": "https://developer.github.com/v3/repos/commits/#compare-two-commits"\r}'''
            return response(404, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/26f01f34ec87cb4b7ab6dddb528540e2c5be250f...5f3e772efd01b32133947473f1bab0c69e8166a0'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/26f01f34ec87cb4b7ab6dddb528540e2c5be250f...5f3e772efd01b32133947473f1bab0c69e8166a0",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/26f01f34ec87cb4b7ab6dddb528540e2c5be250f...5f3e772efd01b32133947473f1bab0c69e8166a0",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:26f01f3...openaddresses:5f3e772",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/26f01f34ec87cb4b7ab6dddb528540e2c5be250f...5f3e772efd01b32133947473f1bab0c69e8166a0.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/26f01f34ec87cb4b7ab6dddb528540e2c5be250f...5f3e772efd01b32133947473f1bab0c69e8166a0.patch",\r  "base_commit": {\r    "sha": "26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r    "commit": {\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2016-10-16T19:54:15Z"\r      },\r      "committer": {\r        "name": "GitHub",\r        "email": "noreply@github.com",\r        "date": "2016-10-16T19:54:15Z"\r      },\r      "message": "Merge pull request #6 from openaddresses/migurski/berkeley-works\\\\\\n\\\\\\nAdded whitespace",\r      "tree": {\r        "sha": "08e2c79243ade7b1cda91850418acad61de7e5e7",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/08e2c79243ade7b1cda91850418acad61de7e5e7"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/26f01f34ec87cb4b7ab6dddb528540e2c5be250f/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "web-flow",\r      "id": 19864447,\r      "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/web-flow",\r      "html_url": "https://github.com/web-flow",\r      "followers_url": "https://api.github.com/users/web-flow/followers",\r      "following_url": "https://api.github.com/users/web-flow/following{/other_user}",\r      "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",\r      "organizations_url": "https://api.github.com/users/web-flow/orgs",\r      "repos_url": "https://api.github.com/users/web-flow/repos",\r      "events_url": "https://api.github.com/users/web-flow/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/web-flow/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247"\r      },\r      {\r        "sha": "4f229278c61d16b9daa15f2845033584e263e668",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/4f229278c61d16b9daa15f2845033584e263e668",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/4f229278c61d16b9daa15f2845033584e263e668"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r    "commit": {\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2016-10-16T19:54:15Z"\r      },\r      "committer": {\r        "name": "GitHub",\r        "email": "noreply@github.com",\r        "date": "2016-10-16T19:54:15Z"\r      },\r      "message": "Merge pull request #6 from openaddresses/migurski/berkeley-works\\\\\\n\\\\\\nAdded whitespace",\r      "tree": {\r        "sha": "08e2c79243ade7b1cda91850418acad61de7e5e7",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/08e2c79243ade7b1cda91850418acad61de7e5e7"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/26f01f34ec87cb4b7ab6dddb528540e2c5be250f/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "web-flow",\r      "id": 19864447,\r      "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/web-flow",\r      "html_url": "https://github.com/web-flow",\r      "followers_url": "https://api.github.com/users/web-flow/followers",\r      "following_url": "https://api.github.com/users/web-flow/following{/other_user}",\r      "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",\r      "organizations_url": "https://api.github.com/users/web-flow/orgs",\r      "repos_url": "https://api.github.com/users/web-flow/repos",\r      "events_url": "https://api.github.com/users/web-flow/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/web-flow/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247"\r      },\r      {\r        "sha": "4f229278c61d16b9daa15f2845033584e263e668",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/4f229278c61d16b9daa15f2845033584e263e668",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/4f229278c61d16b9daa15f2845033584e263e668"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 1,\r  "behind_by": 0,\r  "total_commits": 1,\r  "commits": [\r    {\r      "sha": "5f3e772efd01b32133947473f1bab0c69e8166a0",\r      "commit": {\r        "author": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2016-10-16T21:16:51Z"\r        },\r        "committer": {\r          "name": "GitHub",\r          "email": "noreply@github.com",\r          "date": "2016-10-16T21:16:51Z"\r        },\r        "message": "Create méxico.json",\r        "tree": {\r          "sha": "e66018e0c09c5ac1327a3a56c171f96956000986",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/e66018e0c09c5ac1327a3a56c171f96956000986"\r        },\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/5f3e772efd01b32133947473f1bab0c69e8166a0",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/5f3e772efd01b32133947473f1bab0c69e8166a0",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/5f3e772efd01b32133947473f1bab0c69e8166a0",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/5f3e772efd01b32133947473f1bab0c69e8166a0/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "web-flow",\r        "id": 19864447,\r        "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/web-flow",\r        "html_url": "https://github.com/web-flow",\r        "followers_url": "https://api.github.com/users/web-flow/followers",\r        "following_url": "https://api.github.com/users/web-flow/following{/other_user}",\r        "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",\r        "organizations_url": "https://api.github.com/users/web-flow/orgs",\r        "repos_url": "https://api.github.com/users/web-flow/repos",\r        "events_url": "https://api.github.com/users/web-flow/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/web-flow/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r          "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r          "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/26f01f34ec87cb4b7ab6dddb528540e2c5be250f"\r        }\r      ]\r    }\r  ],\r  "files": [\r    {\r      "sha": "45746c69c9923e753f52646c1c32b55a22b343a5",\r      "filename": "sources/mx/méxico.json",\r      "status": "added",\r      "additions": 30,\r      "deletions": 0,\r      "changes": 30,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/5f3e772efd01b32133947473f1bab0c69e8166a0/sources/mx/m%C3%A9xico.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/5f3e772efd01b32133947473f1bab0c69e8166a0/sources/mx/m%C3%A9xico.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/mx/m%C3%A9xico.json?ref=5f3e772efd01b32133947473f1bab0c69e8166a0",\r      "patch": "@@ -0,0 +1,30 @@\\\\\\n+{\\\\\\n+    \\\"website\\\": \\\"http://busca.datos.gob.mx/#/conjuntos/directorio-estadistico-nacional-de-unidades-economicas-denue-por-entidad-federativa\\\",\\\\\\n+    \\\"conform\\\": {\\\\\\n+        \\\"city\\\": \\\"Municipio\\\",\\\\\\n+        \\\"street\\\": \\\"Nombre de la vialidad\\\",\\\\\\n+        \\\"region\\\": \\\"México\\\",\\\\\\n+        \\\"lon\\\": \\\"Longitud\\\",\\\\\\n+        \\\"number\\\": \\\"Número exterior o kilómetro\\\",\\\\\\n+        \\\"postcode\\\": \\\"Código Postal\\\",\\\\\\n+        \\\"lat\\\": \\\"Latitud\\\",\\\\\\n+        \\\"type\\\": \\\"csv\\\"\\\\\\n+    },\\\\\\n+    \\\"attribution\\\": \\\"Source: INEGI, Directorio Estadístico Nacional de Unidades Económicas (DENUE)\\\",\\\\\\n+    \\\"compression\\\": \\\"zip\\\",\\\\\\n+    \\\"license\\\": {\\\\\\n+        \\\"url\\\": \\\"http://datos.gob.mx/libreusomx/\\\",\\\\\\n+        \\\"attribution\\\": true,\\\\\\n+        \\\"share-alike\\\": false\\\\\\n+    },\\\\\\n+    \\\"data\\\": \\\"http://www3.inegi.org.mx/sistemas/descarga/descargaarchivo.aspx?file=DENUE%2fEntidad_federativa%2f15_M%c3%a9xico%2fdenue_15_25022015_csv.zip\\\",\\\\\\n+    \\\"coverage\\\": {\\\\\\n+        \\\"ISO 3166\\\": {\\\\\\n+            \\\"alpha2\\\": \\\"MX-MEX\\\",\\\\\\n+            \\\"country\\\": \\\"Mexico\\\",\\\\\\n+            \\\"state\\\": \\\"México\\\"\\\\\\n+        },\\\\\\n+        \\\"country\\\": \\\"mx\\\"\\\\\\n+    },\\\\\\n+    \\\"type\\\": \\\"http\\\"\\\\\\n+}"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/pulls/2'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/2",\r  "id": 34594328,\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/2.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/2.patch",\r  "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r  "number": 2,\r  "state": "open",\r  "locked": false,\r  "title": "Testing this time with a PR",\r  "user": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  },\r  "body": "",\r  "created_at": "2015-05-03T00:35:48Z",\r  "updated_at": "2016-09-21T02:58:43Z",\r  "closed_at": null,\r  "merged_at": null,\r  "merge_commit_sha": "fb659f656de3987809f66cdc467e071c85eae7c9",\r  "assignee": null,\r  "assignees": [\r\r  ],\r  "milestone": null,\r  "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/2/commits",\r  "review_comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/2/comments",\r  "review_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}",\r  "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/comments",\r  "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/37e992e9f2aa14265588ca8b214e001e1628f53c",\r  "head": {\r    "label": "openaddresses:twiddle-nevada-county",\r    "ref": "twiddle-nevada-county",\r    "sha": "37e992e9f2aa14265588ca8b214e001e1628f53c",\r    "user": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "repo": {\r      "id": 34590951,\r      "name": "hooked-on-sources",\r      "full_name": "openaddresses/hooked-on-sources",\r      "owner": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "private": false,\r      "html_url": "https://github.com/openaddresses/hooked-on-sources",\r      "description": "Temporary repository for testing Github webhook features",\r      "fork": false,\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r      "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r      "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r      "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r      "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r      "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r      "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r      "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r      "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r      "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r      "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r      "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r      "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r      "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r      "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r      "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r      "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r      "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r      "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r      "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r      "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r      "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r      "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r      "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r      "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r      "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r      "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r      "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r      "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r      "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r      "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r      "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r      "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r      "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r      "deployments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/deployments",\r      "created_at": "2015-04-25T23:56:07Z",\r      "updated_at": "2015-04-25T23:56:07Z",\r      "pushed_at": "2015-06-27T22:55:38Z",\r      "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r      "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r      "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r      "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r      "homepage": null,\r      "size": 230,\r      "stargazers_count": 0,\r      "watchers_count": 0,\r      "language": null,\r      "has_issues": true,\r      "has_downloads": true,\r      "has_wiki": true,\r      "has_pages": false,\r      "forks_count": 1,\r      "mirror_url": null,\r      "open_issues_count": 3,\r      "forks": 1,\r      "open_issues": 3,\r      "watchers": 0,\r      "default_branch": "master"\r    }\r  },\r  "base": {\r    "label": "openaddresses:master",\r    "ref": "master",\r    "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r    "user": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "repo": {\r      "id": 34590951,\r      "name": "hooked-on-sources",\r      "full_name": "openaddresses/hooked-on-sources",\r      "owner": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "private": false,\r      "html_url": "https://github.com/openaddresses/hooked-on-sources",\r      "description": "Temporary repository for testing Github webhook features",\r      "fork": false,\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r      "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r      "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r      "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r      "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r      "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r      "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r      "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r      "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r      "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r      "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r      "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r      "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r      "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r      "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r      "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r      "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r      "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r      "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r      "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r      "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r      "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r      "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r      "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r      "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r      "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r      "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r      "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r      "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r      "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r      "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r      "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r      "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r      "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r      "deployments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/deployments",\r      "created_at": "2015-04-25T23:56:07Z",\r      "updated_at": "2015-04-25T23:56:07Z",\r      "pushed_at": "2015-06-27T22:55:38Z",\r      "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r      "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r      "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r      "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r      "homepage": null,\r      "size": 230,\r      "stargazers_count": 0,\r      "watchers_count": 0,\r      "language": null,\r      "has_issues": true,\r      "has_downloads": true,\r      "has_wiki": true,\r      "has_pages": false,\r      "forks_count": 1,\r      "mirror_url": null,\r      "open_issues_count": 3,\r      "forks": 1,\r      "open_issues": 3,\r      "watchers": 0,\r      "default_branch": "master"\r    }\r  },\r  "_links": {\r    "self": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/2"\r    },\r    "html": {\r      "href": "https://github.com/openaddresses/hooked-on-sources/pull/2"\r    },\r    "issue": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2"\r    },\r    "comments": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/comments"\r    },\r    "review_comments": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/2/comments"\r    },\r    "review_comment": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}"\r    },\r    "commits": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/2/commits"\r    },\r    "statuses": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/37e992e9f2aa14265588ca8b214e001e1628f53c"\r    }\r  },\r  "merged": false,\r  "mergeable": true,\r  "mergeable_state": "clean",\r  "merged_by": null,\r  "comments": 1,\r  "review_comments": 0,\r  "commits": 1,\r  "additions": 0,\r  "deletions": 1,\r  "changed_files": 1\r}'''
            return response(404, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/pulls/7'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/7",\r  "id": 89542367,\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/7.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/7.patch",\r  "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r  "number": 7,\r  "state": "open",\r  "locked": false,\r  "title": "Create méxico.json",\r  "user": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  },\r  "body": "",\r  "created_at": "2016-10-16T22:23:40Z",\r  "updated_at": "2016-11-11T00:09:23Z",\r  "closed_at": null,\r  "merged_at": null,\r  "merge_commit_sha": "d26a5b914b4ae161de9f7e85df687445e1ce7a50",\r  "assignee": null,\r  "assignees": [\r\r  ],\r  "milestone": null,\r  "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/7/commits",\r  "review_comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/7/comments",\r  "review_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}",\r  "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/comments",\r  "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/5f3e772efd01b32133947473f1bab0c69e8166a0",\r  "head": {\r    "label": "openaddresses:migurski-mexico",\r    "ref": "migurski-mexico",\r    "sha": "5f3e772efd01b32133947473f1bab0c69e8166a0",\r    "user": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "repo": {\r      "id": 34590951,\r      "name": "hooked-on-sources",\r      "full_name": "openaddresses/hooked-on-sources",\r      "owner": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "private": false,\r      "html_url": "https://github.com/openaddresses/hooked-on-sources",\r      "description": "Temporary repository for testing Github webhook features",\r      "fork": false,\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r      "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r      "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r      "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r      "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r      "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r      "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r      "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r      "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r      "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r      "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r      "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r      "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r      "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r      "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r      "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r      "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r      "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r      "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r      "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r      "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r      "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r      "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r      "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r      "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r      "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r      "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r      "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r      "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r      "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r      "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r      "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r      "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r      "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r      "deployments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/deployments",\r      "created_at": "2015-04-25T23:56:07Z",\r      "updated_at": "2016-10-16T19:54:18Z",\r      "pushed_at": "2016-10-16T22:23:40Z",\r      "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r      "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r      "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r      "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r      "homepage": null,\r      "size": 12,\r      "stargazers_count": 0,\r      "watchers_count": 0,\r      "language": null,\r      "has_issues": true,\r      "has_downloads": true,\r      "has_wiki": true,\r      "has_pages": false,\r      "forks_count": 1,\r      "mirror_url": null,\r      "open_issues_count": 4,\r      "forks": 1,\r      "open_issues": 4,\r      "watchers": 0,\r      "default_branch": "master"\r    }\r  },\r  "base": {\r    "label": "openaddresses:master",\r    "ref": "master",\r    "sha": "26f01f34ec87cb4b7ab6dddb528540e2c5be250f",\r    "user": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "repo": {\r      "id": 34590951,\r      "name": "hooked-on-sources",\r      "full_name": "openaddresses/hooked-on-sources",\r      "owner": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "private": false,\r      "html_url": "https://github.com/openaddresses/hooked-on-sources",\r      "description": "Temporary repository for testing Github webhook features",\r      "fork": false,\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r      "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r      "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r      "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r      "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r      "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r      "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r      "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r      "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r      "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r      "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r      "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r      "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r      "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r      "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r      "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r      "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r      "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r      "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r      "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r      "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r      "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r      "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r      "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r      "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r      "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r      "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r      "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r      "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r      "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r      "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r      "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r      "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r      "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r      "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r      "deployments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/deployments",\r      "created_at": "2015-04-25T23:56:07Z",\r      "updated_at": "2016-10-16T19:54:18Z",\r      "pushed_at": "2016-10-16T22:23:40Z",\r      "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r      "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r      "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r      "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r      "homepage": null,\r      "size": 12,\r      "stargazers_count": 0,\r      "watchers_count": 0,\r      "language": null,\r      "has_issues": true,\r      "has_downloads": true,\r      "has_wiki": true,\r      "has_pages": false,\r      "forks_count": 1,\r      "mirror_url": null,\r      "open_issues_count": 4,\r      "forks": 1,\r      "open_issues": 4,\r      "watchers": 0,\r      "default_branch": "master"\r    }\r  },\r  "_links": {\r    "self": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/7"\r    },\r    "html": {\r      "href": "https://github.com/openaddresses/hooked-on-sources/pull/7"\r    },\r    "issue": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7"\r    },\r    "comments": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/comments"\r    },\r    "review_comments": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/7/comments"\r    },\r    "review_comment": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}"\r    },\r    "commits": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/7/commits"\r    },\r    "statuses": {\r      "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/5f3e772efd01b32133947473f1bab0c69e8166a0"\r    }\r  },\r  "merged": false,\r  "mergeable": true,\r  "mergeable_state": "clean",\r  "merged_by": null,\r  "comments": 11,\r  "review_comments": 0,\r  "commits": 1,\r  "additions": 30,\r  "deletions": 0,\r  "changed_files": 1\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/issues/7/comments'):
            data = u'''[\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254079601",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-254079601",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 254079601,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T22:25:09Z",\r    "updated_at": "2016-10-16T22:25:09Z",\r    "body": "Rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254079694",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-254079694",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 254079694,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T22:26:45Z",\r    "updated_at": "2016-10-16T22:26:45Z",\r    "body": "Rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254079836",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-254079836",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 254079836,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T22:29:24Z",\r    "updated_at": "2016-10-16T22:29:24Z",\r    "body": "Rerun this please "\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254080048",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-254080048",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 254080048,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T22:33:54Z",\r    "updated_at": "2016-10-16T22:33:54Z",\r    "body": "rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254080224",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-254080224",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 254080224,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T22:37:06Z",\r    "updated_at": "2016-10-16T22:37:06Z",\r    "body": "rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254080468",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-254080468",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 254080468,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T22:41:14Z",\r    "updated_at": "2016-10-16T22:41:14Z",\r    "body": "rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254081474",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-254081474",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 254081474,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T22:58:38Z",\r    "updated_at": "2016-10-16T22:58:38Z",\r    "body": "rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/259728056",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-259728056",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 259728056,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-11-10T15:58:34Z",\r    "updated_at": "2016-11-10T15:58:34Z",\r    "body": "rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/259733971",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-259733971",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 259733971,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-11-10T16:18:57Z",\r    "updated_at": "2016-11-10T16:18:57Z",\r    "body": "rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/259734398",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-259734398",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 259734398,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-11-10T16:20:23Z",\r    "updated_at": "2016-11-10T16:20:23Z",\r    "body": "rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/259845585",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-259845585",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 259845585,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-11-11T00:09:23Z",\r    "updated_at": "2016-11-11T00:09:23Z",\r    "body": "![México](http://s3.amazonaws.com/data-testpreviews.openaddresses.io/runs/10/preview.png)"\r  }\r]'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/issues/2/comments'):
            data = u'''[\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/248497705",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2#issuecomment-248497705",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r    "id": 248497705,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-09-21T02:58:43Z",\r    "updated_at": "2016-09-21T02:58:43Z",\r    "body": "Maybe this comment will go through."\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254066201",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2#issuecomment-254066201",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r    "id": 254066201,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T18:55:30Z",\r    "updated_at": "2016-10-16T18:55:30Z",\r    "body": "Re-run this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254068566",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2#issuecomment-254068566",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r    "id": 254068566,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T19:30:44Z",\r    "updated_at": "2016-10-16T19:30:44Z",\r    "body": "rerun this please"\r  },\r  {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/254068765",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2#issuecomment-254068765",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r    "id": 254068765,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-10-16T19:34:06Z",\r    "updated_at": "2016-10-16T19:34:06Z",\r    "body": "rerun this please"\r  }\r]'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/issues/7/comments'):
            return response(401, u'{"error": "No test should add a comment here."}'.encode('utf8'), headers=response_headers)
        
        if MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/issues/2/comments'):
            input = json.loads(request.body)
            return response(201, u'{"url": "http://example.com/comments/1"}'.encode('utf8'), headers=response_headers)
        
        if MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/e5f1dcae83ab1ef1f736b969da617311f7f11564') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/e91fbc420f08890960f50f863626e1062f922522') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/3147668047a0bec6d481c0e42995f7c5e5eac637') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/badjson20f08890960f50f863626e1062f922522') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/badutf820f08890960f50f863626e1062f922522') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/8dd262c2f30a70b27e371869c54315b1abc32247') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/aed74b0784f696c3cf10e8e260865ae18ffd3aa8') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/37e992e9f2aa14265588ca8b214e001e1628f53c') \
        or MHP == ('POST', GH, '/repos/openaddresses/hooked-on-sources/statuses/5f3e772efd01b32133947473f1bab0c69e8166a0') \
        or MHP == ('POST', GH, '/repos/openaddresses/openaddresses/statuses/f85074d543622ef1fac7a80a059a50176f2a6e08') \
        or MHP == ('POST', GH, '/repos/openaddresses/openaddresses/statuses/bba8f709793f96750fed223d44ba373a92540b2a'):
            input = json.loads(request.body)
            self.last_status_state = input['state']
            self.last_status_message = input['description']
            self.assertEqual(input['context'], 'openaddresses/hooked')
            
            data = '''{{\r              "context": "openaddresses/hooked", \r              "created_at": "2015-04-26T23:45:39Z", \r              "creator": {{\r                "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r                "events_url": "https://api.github.com/users/migurski/events{{/privacy}}", \r                "followers_url": "https://api.github.com/users/migurski/followers", \r                "following_url": "https://api.github.com/users/migurski/following{{/other_user}}", \r                "gists_url": "https://api.github.com/users/migurski/gists{{/gist_id}}", \r                "gravatar_id": "", \r                "html_url": "https://github.com/migurski", \r                "id": 58730, \r                "login": "migurski", \r                "organizations_url": "https://api.github.com/users/migurski/orgs", \r                "received_events_url": "https://api.github.com/users/migurski/received_events", \r                "repos_url": "https://api.github.com/users/migurski/repos", \r                "site_admin": false, \r                "starred_url": "https://api.github.com/users/migurski/starred{{/owner}}{{/repo}}", \r                "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r                "type": "User", \r                "url": "https://api.github.com/users/migurski"\r              }}, \r              "description": "Checking ", \r              "id": 999999999, \r              "state": "{state}", \r              "target_url": null, \r              "updated_at": "2015-04-26T23:45:39Z", \r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/xxxxxxxxx"\r            }}'''
            return response(201, data.format(**input).encode('utf8'), headers=response_headers)
        
        print('Unknowable Request {} "{}"'.format(request.method, url.geturl()), file=sys.stderr)
        raise ValueError('Unknowable Request {} "{}"'.format(request.method, url.geturl()))
    
    @patch('openaddr.ci.HEARTBEAT_INTERVAL', new=timedelta(seconds=1))
    def test_webhook_queue_disabled(self):
        ''' Push a single commit while the queue is disabled.
        '''
        previous_flag, self.app.config['REJECT_NEW_JOBS'] = self.app.config['REJECT_NEW_JOBS'], True

        data = '''{   }'''
        
        with HTTMock(self.response_content):
            posted = self.client.post('/hook', data=data, headers=signed(data, valid=True))
        
        self.app.config['REJECT_NEW_JOBS'] = previous_flag
        self.assertEqual(posted.status_code, 503)
    
    @patch('openaddr.ci.HEARTBEAT_INTERVAL', new=timedelta(seconds=1))
    def test_webhook_badjson_content(self):
        ''' Push a single commit with bad JSON source directly to master.
        '''
        data = '''{\r          "after": "badjson20f08890960f50f863626e1062f922522", \r          "base_ref": null, \r          "before": "c52204fd40f17f9da243df09e6d1107d48768afd", \r          "commits": [\r            {\r              "added": [\r                "sources/us-ca-badjson_county.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "badjson20f08890960f50f863626e1062f922522", \r              "message": "Added first source", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:16:12-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/badjson20f08890960f50f863626e1062f922522"\r            }\r          ], \r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/c52204fd40f1...e91fbc420f08", \r          "created": false, \r          "deleted": false, \r          "forced": false, \r          "head_commit": {\r            "added": [\r              "sources/us-ca-badjson_county.json"\r            ], \r            "author": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "committer": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "distinct": true, \r            "id": "badjson20f08890960f50f863626e1062f922522", \r            "message": "Added first source", \r            "modified": [], \r            "removed": [], \r            "timestamp": "2015-04-25T17:16:12-07:00", \r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/badjson20f08890960f50f863626e1062f922522"\r          }, \r          "organization": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3", \r            "description": "The free and open global address collection ", \r            "events_url": "https://api.github.com/orgs/openaddresses/events", \r            "id": 6895392, \r            "login": "openaddresses", \r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}", \r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}", \r            "repos_url": "https://api.github.com/orgs/openaddresses/repos", \r            "url": "https://api.github.com/orgs/openaddresses"\r          }, \r          "pusher": {\r            "email": "mike-github@teczno.com", \r            "name": "migurski"\r          }, \r          "ref": "refs/heads/master", \r          "repository": {\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}", \r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}", \r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}", \r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}", \r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git", \r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}", \r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}", \r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}", \r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}", \r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}", \r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors", \r            "created_at": 1430006167, \r            "default_branch": "master", \r            "description": "Temporary repository for testing Github webhook features", \r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads", \r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events", \r            "fork": false, \r            "forks": 0, \r            "forks_count": 0, \r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks", \r            "full_name": "openaddresses/hooked-on-sources", \r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}", \r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}", \r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}", \r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git", \r            "has_downloads": true, \r            "has_issues": true, \r            "has_pages": false, \r            "has_wiki": true, \r            "homepage": null, \r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks", \r            "html_url": "https://github.com/openaddresses/hooked-on-sources", \r            "id": 34590951, \r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}", \r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}", \r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}", \r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}", \r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}", \r            "language": null, \r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages", \r            "master_branch": "master", \r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges", \r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}", \r            "mirror_url": null, \r            "name": "hooked-on-sources", \r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}", \r            "open_issues": 0, \r            "open_issues_count": 0, \r            "organization": "openaddresses", \r            "owner": {\r              "email": "openaddresses@gmail.com", \r              "name": "openaddresses"\r            }, \r            "private": false, \r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}", \r            "pushed_at": 1430007676, \r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}", \r            "size": 0, \r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git", \r            "stargazers": 0, \r            "stargazers_count": 0, \r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers", \r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}", \r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers", \r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription", \r            "svn_url": "https://github.com/openaddresses/hooked-on-sources", \r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags", \r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams", \r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}", \r            "updated_at": "2015-04-25T23:56:07Z", \r            "url": "https://github.com/openaddresses/hooked-on-sources", \r            "watchers": 0, \r            "watchers_count": 0\r          }, \r          "sender": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r            "events_url": "https://api.github.com/users/migurski/events{/privacy}", \r            "followers_url": "https://api.github.com/users/migurski/followers", \r            "following_url": "https://api.github.com/users/migurski/following{/other_user}", \r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}", \r            "gravatar_id": "", \r            "html_url": "https://github.com/migurski", \r            "id": 58730, \r            "login": "migurski", \r            "organizations_url": "https://api.github.com/users/migurski/orgs", \r            "received_events_url": "https://api.github.com/users/migurski/received_events", \r            "repos_url": "https://api.github.com/users/migurski/repos", \r            "site_admin": false, \r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}", \r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r            "type": "User", \r            "url": "https://api.github.com/users/migurski"\r          }\r        }'''
        
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)
            success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
            self.assertTrue(success)

        job_url = response.get('url')
        got_job = self.client.get(urlparse(job_url).path)
        got_jobs = self.client.get(urlparse(urljoin(job_url, u'./')).path)
        
        self.assertIn(u'http://example.com', job_url)
        self.assertEqual(got_job.status_code, 200)
        self.assertEqual(got_jobs.status_code, 200)
        self.assertEqual(self.last_status_state, 'pending')
        self.assertTrue('sources/us-ca-badjson_county.json' in response['files'], 'Bad JSON County source should be present in master commit')
        
        # Look for the task in the task queue.
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_q = db_queue(conn, TASK_QUEUE)
            done_q = db_queue(conn, DONE_QUEUE)
            due_q = db_queue(conn, DUE_QUEUE)
            beat_q = db_queue(conn, HEARTBEAT_QUEUE)
            pop_task_from_taskqueue(self.s3, task_q, done_q, due_q, beat_q, self.output_dir, None)
            pop_task_from_donequeue(done_q, self.github_auth)
            
        self.assertEqual(self.last_status_state, 'failure', 'Bad JSON should lead to failure')

    def test_webhook_badutf8_content(self):
        ''' Push a single commit with bad UTF8 source directly to master.
        '''
        data = '''{\r          "after": "badutf820f08890960f50f863626e1062f922522", \r          "base_ref": null, \r          "before": "c52204fd40f17f9da243df09e6d1107d48768afd", \r          "commits": [\r            {\r              "added": [\r                "sources/us-ca-badutf8_county.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "badutf820f08890960f50f863626e1062f922522", \r              "message": "Added first source", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:16:12-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/badutf820f08890960f50f863626e1062f922522"\r            }\r          ], \r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/c52204fd40f1...e91fbc420f08", \r          "created": false, \r          "deleted": false, \r          "forced": false, \r          "head_commit": {\r            "added": [\r              "sources/us-ca-badutf8_county.json"\r            ], \r            "author": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "committer": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "distinct": true, \r            "id": "badutf820f08890960f50f863626e1062f922522", \r            "message": "Added first source", \r            "modified": [], \r            "removed": [], \r            "timestamp": "2015-04-25T17:16:12-07:00", \r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/badutf820f08890960f50f863626e1062f922522"\r          }, \r          "organization": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3", \r            "description": "The free and open global address collection ", \r            "events_url": "https://api.github.com/orgs/openaddresses/events", \r            "id": 6895392, \r            "login": "openaddresses", \r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}", \r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}", \r            "repos_url": "https://api.github.com/orgs/openaddresses/repos", \r            "url": "https://api.github.com/orgs/openaddresses"\r          }, \r          "pusher": {\r            "email": "mike-github@teczno.com", \r            "name": "migurski"\r          }, \r          "ref": "refs/heads/master", \r          "repository": {\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}", \r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}", \r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}", \r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}", \r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git", \r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}", \r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}", \r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}", \r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}", \r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}", \r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors", \r            "created_at": 1430006167, \r            "default_branch": "master", \r            "description": "Temporary repository for testing Github webhook features", \r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads", \r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events", \r            "fork": false, \r            "forks": 0, \r            "forks_count": 0, \r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks", \r            "full_name": "openaddresses/hooked-on-sources", \r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}", \r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}", \r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}", \r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git", \r            "has_downloads": true, \r            "has_issues": true, \r            "has_pages": false, \r            "has_wiki": true, \r            "homepage": null, \r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks", \r            "html_url": "https://github.com/openaddresses/hooked-on-sources", \r            "id": 34590951, \r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}", \r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}", \r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}", \r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}", \r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}", \r            "language": null, \r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages", \r            "master_branch": "master", \r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges", \r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}", \r            "mirror_url": null, \r            "name": "hooked-on-sources", \r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}", \r            "open_issues": 0, \r            "open_issues_count": 0, \r            "organization": "openaddresses", \r            "owner": {\r              "email": "openaddresses@gmail.com", \r              "name": "openaddresses"\r            }, \r            "private": false, \r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}", \r            "pushed_at": 1430007676, \r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}", \r            "size": 0, \r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git", \r            "stargazers": 0, \r            "stargazers_count": 0, \r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers", \r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}", \r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers", \r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription", \r            "svn_url": "https://github.com/openaddresses/hooked-on-sources", \r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags", \r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams", \r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}", \r            "updated_at": "2015-04-25T23:56:07Z", \r            "url": "https://github.com/openaddresses/hooked-on-sources", \r            "watchers": 0, \r            "watchers_count": 0\r          }, \r          "sender": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r            "events_url": "https://api.github.com/users/migurski/events{/privacy}", \r            "followers_url": "https://api.github.com/users/migurski/followers", \r            "following_url": "https://api.github.com/users/migurski/following{/other_user}", \r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}", \r            "gravatar_id": "", \r            "html_url": "https://github.com/migurski", \r            "id": 58730, \r            "login": "migurski", \r            "organizations_url": "https://api.github.com/users/migurski/orgs", \r            "received_events_url": "https://api.github.com/users/migurski/received_events", \r            "repos_url": "https://api.github.com/users/migurski/repos", \r            "site_admin": false, \r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}", \r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r            "type": "User", \r            "url": "https://api.github.com/users/migurski"\r          }\r        }'''
        
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)
            success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
            self.assertTrue(success)

        job_url = response.get('url')
        got_job = self.client.get(urlparse(job_url).path)
        got_jobs = self.client.get(urlparse(urljoin(job_url, u'./')).path)
        
        self.assertIn(u'http://example.com', job_url)
        self.assertEqual(got_job.status_code, 200)
        self.assertEqual(got_jobs.status_code, 200)
        self.assertEqual(self.last_status_state, 'pending', 'Should be pending even though content is invalid UTF8')

    def test_webhook_good_signature(self):
        ''' Send a request to /hook with a valid signature.
        '''
        data = '''{   }'''
        
        with HTTMock(self.response_content):
            posted = self.client.post('/hook', data=data, headers=signed(data, valid=True))
        
        self.assertEqual(posted.status_code, 200)
        self.assertIn('X-Partial-Secret', posted.headers)

    def test_webhook_bad_signature(self):
        ''' Send a request to /hook with an invalid signature.
        '''
        data = '''{   }'''
        
        with HTTMock(self.response_content):
            posted = self.client.post('/hook', data=data, headers=signed(data, valid=False))
        
        self.assertEqual(posted.status_code, 401)
        self.assertNotIn('X-Partial-Secret', posted.headers)

    def test_webhook_missing_signature(self):
        ''' Send a request to /hook with no signature.
        '''
        data = '''{   }'''
        
        with HTTMock(self.response_content):
            posted = self.client.post('/hook', data=data)
        
        self.assertEqual(posted.status_code, 401)
        self.assertNotIn('X-Partial-Secret', posted.headers)

    def test_webhook_one_master_commit(self):
        ''' Push a single commit with Alameda County source directly to master.
        '''
        data = '''{\r          "after": "e91fbc420f08890960f50f863626e1062f922522", \r          "base_ref": null, \r          "before": "c52204fd40f17f9da243df09e6d1107d48768afd", \r          "commits": [\r            {\r              "added": [\r                "sources/us-ca-alameda_county.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "e91fbc420f08890960f50f863626e1062f922522", \r              "message": "Added first source", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:16:12-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/e91fbc420f08890960f50f863626e1062f922522"\r            }\r          ], \r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/c52204fd40f1...e91fbc420f08", \r          "created": false, \r          "deleted": false, \r          "forced": false, \r          "head_commit": {\r            "added": [\r              "sources/us-ca-alameda_county.json"\r            ], \r            "author": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "committer": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "distinct": true, \r            "id": "e91fbc420f08890960f50f863626e1062f922522", \r            "message": "Added first source", \r            "modified": [], \r            "removed": [], \r            "timestamp": "2015-04-25T17:16:12-07:00", \r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/e91fbc420f08890960f50f863626e1062f922522"\r          }, \r          "organization": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3", \r            "description": "The free and open global address collection ", \r            "events_url": "https://api.github.com/orgs/openaddresses/events", \r            "id": 6895392, \r            "login": "openaddresses", \r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}", \r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}", \r            "repos_url": "https://api.github.com/orgs/openaddresses/repos", \r            "url": "https://api.github.com/orgs/openaddresses"\r          }, \r          "pusher": {\r            "email": "mike-github@teczno.com", \r            "name": "migurski"\r          }, \r          "ref": "refs/heads/master", \r          "repository": {\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}", \r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}", \r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}", \r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}", \r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git", \r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}", \r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}", \r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}", \r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}", \r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}", \r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors", \r            "created_at": 1430006167, \r            "default_branch": "master", \r            "description": "Temporary repository for testing Github webhook features", \r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads", \r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events", \r            "fork": false, \r            "forks": 0, \r            "forks_count": 0, \r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks", \r            "full_name": "openaddresses/hooked-on-sources", \r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}", \r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}", \r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}", \r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git", \r            "has_downloads": true, \r            "has_issues": true, \r            "has_pages": false, \r            "has_wiki": true, \r            "homepage": null, \r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks", \r            "html_url": "https://github.com/openaddresses/hooked-on-sources", \r            "id": 34590951, \r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}", \r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}", \r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}", \r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}", \r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}", \r            "language": null, \r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages", \r            "master_branch": "master", \r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges", \r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}", \r            "mirror_url": null, \r            "name": "hooked-on-sources", \r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}", \r            "open_issues": 0, \r            "open_issues_count": 0, \r            "organization": "openaddresses", \r            "owner": {\r              "email": "openaddresses@gmail.com", \r              "name": "openaddresses"\r            }, \r            "private": false, \r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}", \r            "pushed_at": 1430007676, \r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}", \r            "size": 0, \r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git", \r            "stargazers": 0, \r            "stargazers_count": 0, \r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers", \r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}", \r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers", \r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription", \r            "svn_url": "https://github.com/openaddresses/hooked-on-sources", \r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags", \r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams", \r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}", \r            "updated_at": "2015-04-25T23:56:07Z", \r            "url": "https://github.com/openaddresses/hooked-on-sources", \r            "watchers": 0, \r            "watchers_count": 0\r          }, \r          "sender": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r            "events_url": "https://api.github.com/users/migurski/events{/privacy}", \r            "followers_url": "https://api.github.com/users/migurski/followers", \r            "following_url": "https://api.github.com/users/migurski/following{/other_user}", \r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}", \r            "gravatar_id": "", \r            "html_url": "https://github.com/migurski", \r            "id": 58730, \r            "login": "migurski", \r            "organizations_url": "https://api.github.com/users/migurski/orgs", \r            "received_events_url": "https://api.github.com/users/migurski/received_events", \r            "repos_url": "https://api.github.com/users/migurski/repos", \r            "site_admin": false, \r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}", \r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r            "type": "User", \r            "url": "https://api.github.com/users/migurski"\r          }\r        }'''
        
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)
            success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
            self.assertTrue(success)

        job_url = response.get('url')
        got_job = self.client.get(urlparse(job_url).path)
        got_jobs = self.client.get(urlparse(urljoin(job_url, u'./')).path)

        self.assertIn(u'http://example.com', job_url)
        self.assertEqual(got_job.status_code, 200)
        self.assertEqual(got_jobs.status_code, 200)
        self.assertEqual(self.last_status_state, 'pending')
        
        files = response['files'].items()
        smashed_contents = '\n'.join([name + '\n' + de64(b64) for (name, (b64, sha)) in files])
        self.assertTrue('us-ca-alameda_county' in smashed_contents, 'Alameda County source should be present in master commit')
        self.assertTrue('data.acgov.org' in smashed_contents, 'Alameda County domain name should be present in master commit')
        
        # Look for the task in the task queue.
        with db_connect(self.database_url) as conn:
            task = db_queue(conn, TASK_QUEUE).get()
            
        self.assertIn('us-ca-alameda_county', task.data['name'])
        self.assertTrue(task.data['render_preview'])
        
        # This is the JSON source payload, just make sure it parses.
        content = json.loads(de64(task.data['content_b64']))
        task.data['result'] = dict(message=MAGIC_OK_MESSAGE)
        task.data['run_id'] = None
        
        # Put back a completion task to the done queue.
        with db_connect(self.database_url) as conn:
            db_queue(conn, DONE_QUEUE).put(task.data)
        
            # Handle completion task and check with Github.
            with HTTMock(self.response_content):
                pop_task_from_donequeue(db_queue(conn, DONE_QUEUE), self.github_auth)
        
            # Check that Github knows the job to have been completed successfully.
            self.assertEqual(self.last_status_state, 'success')

    def test_webhook_two_master_commits_early_fail(self):
        ''' Push two commits with San Francisco and Berkeley sources directly to master.
        '''
        data = '''{\r          "after": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r          "base_ref": null, \r          "before": "e91fbc420f08890960f50f863626e1062f922522", \r          "commits": [\r            {\r              "added": [\r                "sources/us-ca-san_francisco.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "73a81c5b337bd393273a222f1cd191d7e634df51", \r              "message": "Added SF", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:25:45-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r            }, \r            {\r              "added": [\r                "sources/us-ca-berkeley.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r              "message": "Added Berkeley", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:25:55-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r            }\r          ], \r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/e91fbc420f08...ded44ed5f173", \r          "created": false, \r          "deleted": false, \r          "forced": false, \r          "head_commit": {\r            "added": [\r              "sources/us-ca-berkeley.json"\r            ], \r            "author": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "committer": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "distinct": true, \r            "id": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r            "message": "Added Berkeley", \r            "modified": [], \r            "removed": [], \r            "timestamp": "2015-04-25T17:25:55-07:00", \r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r          }, \r          "organization": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3", \r            "description": "The free and open global address collection ", \r            "events_url": "https://api.github.com/orgs/openaddresses/events", \r            "id": 6895392, \r            "login": "openaddresses", \r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}", \r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}", \r            "repos_url": "https://api.github.com/orgs/openaddresses/repos", \r            "url": "https://api.github.com/orgs/openaddresses"\r          }, \r          "pusher": {\r            "email": "mike-github@teczno.com", \r            "name": "migurski"\r          }, \r          "ref": "refs/heads/master", \r          "repository": {\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}", \r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}", \r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}", \r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}", \r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git", \r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}", \r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}", \r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}", \r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}", \r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}", \r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors", \r            "created_at": 1430006167, \r            "default_branch": "master", \r            "description": "Temporary repository for testing Github webhook features", \r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads", \r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events", \r            "fork": false, \r            "forks": 0, \r            "forks_count": 0, \r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks", \r            "full_name": "openaddresses/hooked-on-sources", \r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}", \r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}", \r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}", \r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git", \r            "has_downloads": true, \r            "has_issues": true, \r            "has_pages": false, \r            "has_wiki": true, \r            "homepage": null, \r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks", \r            "html_url": "https://github.com/openaddresses/hooked-on-sources", \r            "id": 34590951, \r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}", \r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}", \r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}", \r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}", \r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}", \r            "language": null, \r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages", \r            "master_branch": "master", \r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges", \r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}", \r            "mirror_url": null, \r            "name": "hooked-on-sources", \r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}", \r            "open_issues": 0, \r            "open_issues_count": 0, \r            "organization": "openaddresses", \r            "owner": {\r              "email": "openaddresses@gmail.com", \r              "name": "openaddresses"\r            }, \r            "private": false, \r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}", \r            "pushed_at": 1430007964, \r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}", \r            "size": 0, \r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git", \r            "stargazers": 0, \r            "stargazers_count": 0, \r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers", \r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}", \r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers", \r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription", \r            "svn_url": "https://github.com/openaddresses/hooked-on-sources", \r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags", \r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams", \r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}", \r            "updated_at": "2015-04-25T23:56:07Z", \r            "url": "https://github.com/openaddresses/hooked-on-sources", \r            "watchers": 0, \r            "watchers_count": 0\r          }, \r          "sender": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r            "events_url": "https://api.github.com/users/migurski/events{/privacy}", \r            "followers_url": "https://api.github.com/users/migurski/followers", \r            "following_url": "https://api.github.com/users/migurski/following{/other_user}", \r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}", \r            "gravatar_id": "", \r            "html_url": "https://github.com/migurski", \r            "id": 58730, \r            "login": "migurski", \r            "organizations_url": "https://api.github.com/users/migurski/orgs", \r            "received_events_url": "https://api.github.com/users/migurski/received_events", \r            "repos_url": "https://api.github.com/users/migurski/repos", \r            "site_admin": false, \r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}", \r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r            "type": "User", \r            "url": "https://api.github.com/users/migurski"\r          }\r        }'''
        
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)
            success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
            self.assertTrue(success)

        job_url = response.get('url')
        got_job = self.client.get(urlparse(job_url).path)
        got_jobs = self.client.get(urlparse(urljoin(job_url, u'./')).path)
        self.assertEqual(self.last_status_state, 'pending')
        self.assertIn(u'http://example.com', job_url)

        files = response['files'].items()
        smashed_contents = '\n'.join([name + '\n' + de64(b64) for (name, (b64, sha)) in files])
        self.assertTrue('us-ca-san_francisco' in smashed_contents, 'San Francisco source should be present in master commit')
        self.assertTrue('data.sfgov.org' in smashed_contents, 'San Francisco URL should be present in master commit')
        self.assertTrue('us-ca-berkeley' in smashed_contents, 'Berkeley source should be present in master commit')
        self.assertTrue('www.ci.berkeley.ca.us' in smashed_contents, 'Berkeley URL should be present in master commit')
        self.assertFalse('us-ca-alameda_county' in smashed_contents, 'Alameda County source should be absent from master commit')
        
        for message in ('Something went wrong', MAGIC_OK_MESSAGE):
            # Look for the task in the task queue.
            with db_connect(self.database_url) as conn:
                task = db_queue(conn, TASK_QUEUE).get()
            
            self.assertTrue('us-ca-san_francisco' in task.data['name'] or 'us-ca-berkeley' in task.data['name'])
        
            # This is the JSON source payload, just make sure it parses.
            content = json.loads(de64(task.data['content_b64']))
            task.data['result'] = dict(message=message)
            task.data['run_id'] = None
        
            # Put back a completion task to the done queue.
            with db_connect(self.database_url) as conn:
                db_queue(conn, DONE_QUEUE).put(task.data)
        
                # Handle completion tasks and check with Github.
                with HTTMock(self.response_content):
                    pop_task_from_donequeue(db_queue(conn, DONE_QUEUE), self.github_auth)
                
                # Check that Github already knows the job to have been completed unsuccessfully.
                self.assertEqual(self.last_status_state, 'failure')
                self.assertTrue('Failed' in self.last_status_message)

    def test_webhook_two_master_commits_late_fail(self):
        ''' Push two commits with San Francisco and Berkeley sources directly to master.
        '''
        data = '''{\r          "after": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r          "base_ref": null, \r          "before": "e91fbc420f08890960f50f863626e1062f922522", \r          "commits": [\r            {\r              "added": [\r                "sources/us-ca-san_francisco.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "73a81c5b337bd393273a222f1cd191d7e634df51", \r              "message": "Added SF", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:25:45-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/73a81c5b337bd393273a222f1cd191d7e634df51"\r            }, \r            {\r              "added": [\r                "sources/us-ca-berkeley.json"\r              ], \r              "author": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "committer": {\r                "email": "mike@teczno.com", \r                "name": "Michal Migurski", \r                "username": "migurski"\r              }, \r              "distinct": true, \r              "id": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r              "message": "Added Berkeley", \r              "modified": [], \r              "removed": [], \r              "timestamp": "2015-04-25T17:25:55-07:00", \r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r            }\r          ], \r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/e91fbc420f08...ded44ed5f173", \r          "created": false, \r          "deleted": false, \r          "forced": false, \r          "head_commit": {\r            "added": [\r              "sources/us-ca-berkeley.json"\r            ], \r            "author": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "committer": {\r              "email": "mike@teczno.com", \r              "name": "Michal Migurski", \r              "username": "migurski"\r            }, \r            "distinct": true, \r            "id": "ded44ed5f1733bb93d84f94afe9383e2d47bbbaa", \r            "message": "Added Berkeley", \r            "modified": [], \r            "removed": [], \r            "timestamp": "2015-04-25T17:25:55-07:00", \r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/ded44ed5f1733bb93d84f94afe9383e2d47bbbaa"\r          }, \r          "organization": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3", \r            "description": "The free and open global address collection ", \r            "events_url": "https://api.github.com/orgs/openaddresses/events", \r            "id": 6895392, \r            "login": "openaddresses", \r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}", \r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}", \r            "repos_url": "https://api.github.com/orgs/openaddresses/repos", \r            "url": "https://api.github.com/orgs/openaddresses"\r          }, \r          "pusher": {\r            "email": "mike-github@teczno.com", \r            "name": "migurski"\r          }, \r          "ref": "refs/heads/master", \r          "repository": {\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}", \r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}", \r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}", \r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}", \r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git", \r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}", \r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}", \r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}", \r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}", \r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}", \r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors", \r            "created_at": 1430006167, \r            "default_branch": "master", \r            "description": "Temporary repository for testing Github webhook features", \r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads", \r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events", \r            "fork": false, \r            "forks": 0, \r            "forks_count": 0, \r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks", \r            "full_name": "openaddresses/hooked-on-sources", \r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}", \r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}", \r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}", \r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git", \r            "has_downloads": true, \r            "has_issues": true, \r            "has_pages": false, \r            "has_wiki": true, \r            "homepage": null, \r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks", \r            "html_url": "https://github.com/openaddresses/hooked-on-sources", \r            "id": 34590951, \r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}", \r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}", \r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}", \r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}", \r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}", \r            "language": null, \r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages", \r            "master_branch": "master", \r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges", \r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}", \r            "mirror_url": null, \r            "name": "hooked-on-sources", \r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}", \r            "open_issues": 0, \r            "open_issues_count": 0, \r            "organization": "openaddresses", \r            "owner": {\r              "email": "openaddresses@gmail.com", \r              "name": "openaddresses"\r            }, \r            "private": false, \r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}", \r            "pushed_at": 1430007964, \r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}", \r            "size": 0, \r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git", \r            "stargazers": 0, \r            "stargazers_count": 0, \r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers", \r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}", \r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers", \r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription", \r            "svn_url": "https://github.com/openaddresses/hooked-on-sources", \r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags", \r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams", \r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}", \r            "updated_at": "2015-04-25T23:56:07Z", \r            "url": "https://github.com/openaddresses/hooked-on-sources", \r            "watchers": 0, \r            "watchers_count": 0\r          }, \r          "sender": {\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r            "events_url": "https://api.github.com/users/migurski/events{/privacy}", \r            "followers_url": "https://api.github.com/users/migurski/followers", \r            "following_url": "https://api.github.com/users/migurski/following{/other_user}", \r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}", \r            "gravatar_id": "", \r            "html_url": "https://github.com/migurski", \r            "id": 58730, \r            "login": "migurski", \r            "organizations_url": "https://api.github.com/users/migurski/orgs", \r            "received_events_url": "https://api.github.com/users/migurski/received_events", \r            "repos_url": "https://api.github.com/users/migurski/repos", \r            "site_admin": false, \r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}", \r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r            "type": "User", \r            "url": "https://api.github.com/users/migurski"\r          }\r        }'''
        
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)
            success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
            self.assertTrue(success)

        job_url = response.get('url')
        got_job = self.client.get(urlparse(job_url).path)
        got_jobs = self.client.get(urlparse(urljoin(job_url, u'./')).path)
        self.assertEqual(self.last_status_state, 'pending')
        self.assertIn(u'http://example.com', job_url)

        files = response['files'].items()
        smashed_contents = '\n'.join([name + '\n' + de64(b64) for (name, (b64, sha)) in files])
        self.assertTrue('us-ca-san_francisco' in smashed_contents, 'San Francisco source should be present in master commit')
        self.assertTrue('data.sfgov.org' in smashed_contents, 'San Francisco URL should be present in master commit')
        self.assertTrue('us-ca-berkeley' in smashed_contents, 'Berkeley source should be present in master commit')
        self.assertTrue('www.ci.berkeley.ca.us' in smashed_contents, 'Berkeley URL should be present in master commit')
        self.assertFalse('us-ca-alameda_county' in smashed_contents, 'Alameda County source should be absent from master commit')
        
        for (index, message) in enumerate((MAGIC_OK_MESSAGE, 'Something went wrong')):
            # Look for the task in the task queue.
            with db_connect(self.database_url) as conn:
                task = db_queue(conn, TASK_QUEUE).get()
            
            self.assertTrue('us-ca-san_francisco' in task.data['name'] or 'us-ca-berkeley' in task.data['name'])
        
            # This is the JSON source payload, just make sure it parses.
            content = json.loads(de64(task.data['content_b64']))
            task.data['result'] = dict(message=message)
            task.data['run_id'] = None
        
            # Put back a completion task to the done queue.
            with db_connect(self.database_url) as conn:
                db_queue(conn, DONE_QUEUE).put(task.data)
        
                # Handle completion tasks and check with Github.
                with HTTMock(self.response_content):
                    pop_task_from_donequeue(db_queue(conn, DONE_QUEUE), self.github_auth)
                
                if index == 0:
                    # Check that Github still thinks it's pending.
                    self.assertEqual(self.last_status_state, 'pending')
                else:
                    # Check that Github knows the job to have been completed unsuccessfully.
                    self.assertEqual(self.last_status_state, 'failure')
                    self.assertTrue('Failed' in self.last_status_message)

    def test_webhook_two_branch_commits(self):
        ''' Push two commits with addition and removal of Polish source to a branch.
        
            That branch includes a previously-added Santa Clara County source
            which should be checked.
        '''
        data = '''{\r          "ref": "refs/heads/branch",\r          "before": "b659130053b85cd3993b1a4653da1bf6231ec0b4",\r          "after": "e5f1dcae83ab1ef1f736b969da617311f7f11564",\r          "created": false,\r          "deleted": false,\r          "forced": false,\r          "base_ref": null,\r          "compare": "https://github.com/openaddresses/hooked-on-sources/compare/b659130053b8...e5f1dcae83ab",\r          "commits": [\r            {\r              "id": "0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r              "distinct": true,\r              "message": "Added Polish source",\r              "timestamp": "2015-04-25T17:52:39-07:00",\r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/0cbd51b8f6044e98c919dcabf93e3f4e1d58c035",\r              "author": {\r                "name": "Michal Migurski",\r                "email": "mike@teczno.com",\r                "username": "migurski"\r              },\r              "committer": {\r                "name": "Michal Migurski",\r                "email": "mike@teczno.com",\r                "username": "migurski"\r              },\r              "added": [\r                "sources/pl-dolnoslaskie.json"\r              ],\r              "removed": [\r\r              ],\r              "modified": [\r\r              ]\r            },\r            {\r              "id": "e5f1dcae83ab1ef1f736b969da617311f7f11564",\r              "distinct": true,\r              "message": "Removed Polish source",\r              "timestamp": "2015-04-25T17:52:46-07:00",\r              "url": "https://github.com/openaddresses/hooked-on-sources/commit/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r              "author": {\r                "name": "Michal Migurski",\r                "email": "mike@teczno.com",\r                "username": "migurski"\r              },\r              "committer": {\r                "name": "Michal Migurski",\r                "email": "mike@teczno.com",\r                "username": "migurski"\r              },\r              "added": [\r\r              ],\r              "removed": [\r                "sources/pl-dolnoslaskie.json"\r              ],\r              "modified": [\r\r              ]\r            }\r          ],\r          "head_commit": {\r            "id": "e5f1dcae83ab1ef1f736b969da617311f7f11564",\r            "distinct": true,\r            "message": "Removed Polish source",\r            "timestamp": "2015-04-25T17:52:46-07:00",\r            "url": "https://github.com/openaddresses/hooked-on-sources/commit/e5f1dcae83ab1ef1f736b969da617311f7f11564",\r            "author": {\r              "name": "Michal Migurski",\r              "email": "mike@teczno.com",\r              "username": "migurski"\r            },\r            "committer": {\r              "name": "Michal Migurski",\r              "email": "mike@teczno.com",\r              "username": "migurski"\r            },\r            "added": [\r\r            ],\r            "removed": [\r              "sources/pl-dolnoslaskie.json"\r            ],\r            "modified": [\r\r            ]\r          },\r          "repository": {\r            "id": 34590951,\r            "name": "hooked-on-sources",\r            "full_name": "openaddresses/hooked-on-sources",\r            "owner": {\r              "name": "openaddresses",\r              "email": "openaddresses@gmail.com"\r            },\r            "private": false,\r            "html_url": "https://github.com/openaddresses/hooked-on-sources",\r            "description": "Temporary repository for testing Github webhook features",\r            "fork": false,\r            "url": "https://github.com/openaddresses/hooked-on-sources",\r            "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r            "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r            "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r            "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r            "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r            "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r            "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r            "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r            "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r            "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r            "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r            "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r            "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r            "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r            "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r            "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r            "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r            "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r            "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r            "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r            "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r            "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r            "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r            "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r            "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r            "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r            "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r            "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r            "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r            "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r            "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r            "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r            "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r            "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r            "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r            "created_at": 1430006167,\r            "updated_at": "2015-04-25T23:56:07Z",\r            "pushed_at": 1430009572,\r            "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r            "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r            "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r            "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r            "homepage": null,\r            "size": 0,\r            "stargazers_count": 0,\r            "watchers_count": 0,\r            "language": null,\r            "has_issues": true,\r            "has_downloads": true,\r            "has_wiki": true,\r            "has_pages": false,\r            "forks_count": 0,\r            "mirror_url": null,\r            "open_issues_count": 1,\r            "forks": 0,\r            "open_issues": 1,\r            "watchers": 0,\r            "default_branch": "master",\r            "stargazers": 0,\r            "master_branch": "master",\r            "organization": "openaddresses"\r          },\r          "pusher": {\r            "name": "migurski",\r            "email": "mike-github@teczno.com"\r          },\r          "organization": {\r            "login": "openaddresses",\r            "id": 6895392,\r            "url": "https://api.github.com/orgs/openaddresses",\r            "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r            "events_url": "https://api.github.com/orgs/openaddresses/events",\r            "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r            "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r            "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r            "description": "The free and open global address collection "\r          },\r          "sender": {\r            "login": "migurski",\r            "id": 58730,\r            "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r            "gravatar_id": "",\r            "url": "https://api.github.com/users/migurski",\r            "html_url": "https://github.com/migurski",\r            "followers_url": "https://api.github.com/users/migurski/followers",\r            "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r            "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r            "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r            "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r            "organizations_url": "https://api.github.com/users/migurski/orgs",\r            "repos_url": "https://api.github.com/users/migurski/repos",\r            "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r            "received_events_url": "https://api.github.com/users/migurski/received_events",\r            "type": "User",\r            "site_admin": false\r          }\r        }'''
        
        with patch('openaddr.ci.add_files_to_queue') as add_files_to_queue:
            def job_queue_fails(*args, **kwargs):
                raise Exception('Nope')

            add_files_to_queue.side_effect = job_queue_fails

            with HTTMock(self.response_content), db_connect(self.database_url) as conn:
                task_q = db_queue(conn, TASK_QUEUE)
                success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
                self.assertFalse(success)
        
        self.assertEqual(self.last_status_state, 'error')
        self.assertTrue('us-ca-santa_clara_county' in self.last_status_message, 'Santa Clara County source should be present in error message')

        files = response['files'].items()
        smashed_contents = '\n'.join([name + '\n' + de64(b64) for (name, (b64, sha)) in files])
        self.assertTrue('us-ca-santa_clara_county' in smashed_contents, 'Santa Clara County source should be present in branch commit')
        self.assertTrue('sftp.sccgov.org' in smashed_contents, 'Santa Clara County URL should be present in branch commit')
        self.assertFalse('us-ca-contra_costa_county' in smashed_contents, 'Contra Costa County should be absent from branch commit')
        self.assertFalse('pl-dolnoslaskie' in smashed_contents, 'Polish source should be absent from branch commit')
        self.assertFalse('us-ca-san_francisco' in smashed_contents, 'San Francisco source should be absent from branch commit')
        self.assertFalse('us-ca-berkeley' in smashed_contents, 'Berkeley source should be absent from branch commit')
        
        # Verify that queued job was never created.
        last_job_url = response.get('url')
        
        self.assertIsNone(last_job_url)
        self.assertEqual(self.last_status_state, 'error')

    def test_webhook_empty_master_commit(self):
        ''' Push one empty commit directly to master.
        '''
        data = '''{\r  "ref": "refs/heads/master",\r  "before": "b450dcbb6f4c61015b0a00290e984849f7d649de",\r  "after": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r  "created": false,\r  "deleted": false,\r  "forced": false,\r  "base_ref": null,\r  "compare": "https://github.com/openaddresses/hooked-on-sources/compare/b450dcbb6f4c...3147668047a0",\r  "commits": [\r    {\r      "id": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "distinct": true,\r      "message": "Empty commit",\r      "timestamp": "2015-04-26T18:36:22-07:00",\r      "url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637",\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r\r      ]\r    }\r  ],\r  "head_commit": {\r    "id": "3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "distinct": true,\r    "message": "Empty commit",\r    "timestamp": "2015-04-26T18:36:22-07:00",\r    "url": "https://github.com/openaddresses/hooked-on-sources/commit/3147668047a0bec6d481c0e42995f7c5e5eac637",\r    "author": {\r      "name": "Michal Migurski",\r      "email": "mike@teczno.com",\r      "username": "migurski"\r    },\r    "committer": {\r      "name": "Michal Migurski",\r      "email": "mike@teczno.com",\r      "username": "migurski"\r    },\r    "added": [\r\r    ],\r    "removed": [\r\r    ],\r    "modified": [\r\r    ]\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "name": "openaddresses",\r      "email": "openaddresses@gmail.com"\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://github.com/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": 1430006167,\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": 1430098587,\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 0,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 0,\r    "mirror_url": null,\r    "open_issues_count": 1,\r    "forks": 0,\r    "open_issues": 1,\r    "watchers": 0,\r    "default_branch": "master",\r    "stargazers": 0,\r    "master_branch": "master",\r    "organization": "openaddresses"\r  },\r  "pusher": {\r    "name": "migurski",\r    "email": "mike-github@teczno.com"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)
            success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
            self.assertTrue(success)

        self.assertEqual(self.last_status_state, 'success')
        self.assertFalse('source/us-ca-contra_costa_county.json' in response['files'], 'Contra Costa County should be absent from master commit')
        self.assertFalse('source/us-ca-san_francisco.json' in response['files'], 'San Francisco source should be absent from master commit')
        self.assertFalse('source/us-ca-berkeley.json' in response['files'], 'Berkeley source should be absent from master commit')
    
    def test_webhook_delete_branch(self):
        ''' Delete a branch.
        '''
        data = '''{\r  "ref": "refs/heads/whitespace",\r  "before": "237a09603386664658fba6bcc843044a2ede79fb",\r  "after": "0000000000000000000000000000000000000000",\r  "created": false,\r  "deleted": true,\r  "forced": true,\r  "base_ref": null,\r  "compare": "https://github.com/openaddresses/openaddresses/compare/237a09603386...000000000000",\r  "commits": [\r\r  ],\r  "head_commit": null,\r  "repository": {\r    "id": 16594532,\r    "name": "openaddresses",\r    "full_name": "openaddresses/openaddresses",\r    "owner": {\r      "name": "openaddresses",\r      "email": "openaddresses@gmail.com"\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/openaddresses",\r    "description": "A repository of address data.",\r    "fork": false,\r    "url": "https://github.com/openaddresses/openaddresses",\r    "forks_url": "https://api.github.com/repos/openaddresses/openaddresses/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/openaddresses/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/openaddresses/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/openaddresses/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/openaddresses/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/openaddresses/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/openaddresses/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/openaddresses/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/openaddresses/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/openaddresses/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/openaddresses/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/openaddresses/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/openaddresses/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/openaddresses/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/openaddresses/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/openaddresses/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/openaddresses/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/openaddresses/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/openaddresses/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/openaddresses/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/openaddresses/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/openaddresses/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/openaddresses/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/openaddresses/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/openaddresses/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/openaddresses/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/openaddresses/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/openaddresses/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/openaddresses/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/openaddresses/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/openaddresses/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/openaddresses/releases{/id}",\r    "created_at": 1391722160,\r    "updated_at": "2015-06-11T11:42:47Z",\r    "pushed_at": 1434506471,\r    "git_url": "git://github.com/openaddresses/openaddresses.git",\r    "ssh_url": "git@github.com:openaddresses/openaddresses.git",\r    "clone_url": "https://github.com/openaddresses/openaddresses.git",\r    "svn_url": "https://github.com/openaddresses/openaddresses",\r    "homepage": "http://openaddresses.io/",\r    "size": 9790,\r    "stargazers_count": 275,\r    "watchers_count": 275,\r    "language": "JavaScript",\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 313,\r    "mirror_url": null,\r    "open_issues_count": 214,\r    "forks": 313,\r    "open_issues": 214,\r    "watchers": 275,\r    "default_branch": "master",\r    "stargazers": 275,\r    "master_branch": "master",\r    "organization": "openaddresses"\r  },\r  "pusher": {\r    "name": "ingalls",\r    "email": "nick@mapbox.com"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "ingalls",\r    "id": 1297009,\r    "avatar_url": "https://avatars.githubusercontent.com/u/1297009?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/ingalls",\r    "html_url": "https://github.com/ingalls",\r    "followers_url": "https://api.github.com/users/ingalls/followers",\r    "following_url": "https://api.github.com/users/ingalls/following{/other_user}",\r    "gists_url": "https://api.github.com/users/ingalls/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/ingalls/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/ingalls/subscriptions",\r    "organizations_url": "https://api.github.com/users/ingalls/orgs",\r    "repos_url": "https://api.github.com/users/ingalls/repos",\r    "events_url": "https://api.github.com/users/ingalls/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/ingalls/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)
            success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
            self.assertTrue(success)

        self.assertEqual(self.last_status_state, None, 'Status should not exist for a deleted branch push')
    
    def test_webhook_pull_request(self):
        ''' Pull request from an outside contributor.
        '''
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)

            self.last_status_state = None
            data1 = u'''{\r  "action": "opened",\r  "number": 4,\r  "pull_request": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4",\r    "id": 38716878,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/4",\r    "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.diff",\r    "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.patch",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4",\r    "number": 4,\r    "state": "open",\r    "locked": false,\r    "title": "Added La Réunion",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "body": "",\r    "created_at": "2015-06-27T22:51:14Z",\r    "updated_at": "2015-06-27T22:51:14Z",\r    "closed_at": null,\r    "merged_at": null,\r    "merge_commit_sha": null,\r    "assignee": null,\r    "milestone": null,\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits",\r    "review_comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments",\r    "review_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r    "head": {\r      "label": "migurski:master",\r      "ref": "master",\r      "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "user": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 38178103,\r        "name": "hooked-on-sources",\r        "full_name": "migurski/hooked-on-sources",\r        "owner": {\r          "login": "migurski",\r          "id": 58730,\r          "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/migurski",\r          "html_url": "https://github.com/migurski",\r          "followers_url": "https://api.github.com/users/migurski/followers",\r          "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r          "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r          "organizations_url": "https://api.github.com/users/migurski/orgs",\r          "repos_url": "https://api.github.com/users/migurski/repos",\r          "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/migurski/received_events",\r          "type": "User",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/migurski/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": true,\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/migurski/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/migurski/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/migurski/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/migurski/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/migurski/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/migurski/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/migurski/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/migurski/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/migurski/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/migurski/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/migurski/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/migurski/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/migurski/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/migurski/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/migurski/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/migurski/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/migurski/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/migurski/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/migurski/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/migurski/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/migurski/hooked-on-sources/releases{/id}",\r        "created_at": "2015-06-27T22:47:37Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:48:55Z",\r        "git_url": "git://github.com/migurski/hooked-on-sources.git",\r        "ssh_url": "git@github.com:migurski/hooked-on-sources.git",\r        "clone_url": "https://github.com/migurski/hooked-on-sources.git",\r        "svn_url": "https://github.com/migurski/hooked-on-sources",\r        "homepage": null,\r        "size": 192,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": false,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 0,\r        "mirror_url": null,\r        "open_issues_count": 0,\r        "forks": 0,\r        "open_issues": 0,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "base": {\r      "label": "openaddresses:master",\r      "ref": "master",\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "user": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 34590951,\r        "name": "hooked-on-sources",\r        "full_name": "openaddresses/hooked-on-sources",\r        "owner": {\r          "login": "openaddresses",\r          "id": 6895392,\r          "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/openaddresses",\r          "html_url": "https://github.com/openaddresses",\r          "followers_url": "https://api.github.com/users/openaddresses/followers",\r          "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r          "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r          "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r          "repos_url": "https://api.github.com/users/openaddresses/repos",\r          "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r          "type": "Organization",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/openaddresses/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": false,\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r        "created_at": "2015-04-25T23:56:07Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:49:30Z",\r        "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r        "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r        "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r        "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r        "homepage": null,\r        "size": 192,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": true,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 1,\r        "mirror_url": null,\r        "open_issues_count": 3,\r        "forks": 1,\r        "open_issues": 3,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "_links": {\r      "self": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4"\r      },\r      "html": {\r        "href": "https://github.com/openaddresses/hooked-on-sources/pull/4"\r      },\r      "issue": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4"\r      },\r      "comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments"\r      },\r      "review_comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments"\r      },\r      "review_comment": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}"\r      },\r      "commits": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits"\r      },\r      "statuses": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    },\r    "merged": false,\r    "mergeable": null,\r    "mergeable_state": "unknown",\r    "merged_by": null,\r    "comments": 0,\r    "review_comments": 0,\r    "commits": 1,\r    "additions": 22,\r    "deletions": 0,\r    "changed_files": 1\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": "2015-06-27T22:49:30Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 192,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 3,\r    "forks": 1,\r    "open_issues": 3,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
            success1, response1 = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data1), False)
            self.assertEqual(self.last_status_state, 'pending', 'Status should be pending for a newly-opened pull request')

            self.last_status_state = None
            data2 = u'''{\r  "action": "synchronize",\r  "number": 4,\r  "pull_request": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4",\r    "id": 38716878,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/4",\r    "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.diff",\r    "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.patch",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4",\r    "number": 4,\r    "state": "open",\r    "locked": false,\r    "title": "Added La Réunion",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "body": "",\r    "created_at": "2015-06-27T22:51:14Z",\r    "updated_at": "2015-06-27T22:53:18Z",\r    "closed_at": null,\r    "merged_at": null,\r    "merge_commit_sha": "5a8e302cbb901925da71ab186308aa5aa2393ebe",\r    "assignee": null,\r    "milestone": null,\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits",\r    "review_comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments",\r    "review_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add",\r    "head": {\r      "label": "migurski:master",\r      "ref": "master",\r      "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "user": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 38178103,\r        "name": "hooked-on-sources",\r        "full_name": "migurski/hooked-on-sources",\r        "owner": {\r          "login": "migurski",\r          "id": 58730,\r          "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/migurski",\r          "html_url": "https://github.com/migurski",\r          "followers_url": "https://api.github.com/users/migurski/followers",\r          "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r          "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r          "organizations_url": "https://api.github.com/users/migurski/orgs",\r          "repos_url": "https://api.github.com/users/migurski/repos",\r          "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/migurski/received_events",\r          "type": "User",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/migurski/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": true,\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/migurski/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/migurski/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/migurski/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/migurski/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/migurski/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/migurski/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/migurski/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/migurski/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/migurski/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/migurski/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/migurski/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/migurski/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/migurski/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/migurski/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/migurski/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/migurski/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/migurski/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/migurski/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/migurski/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/migurski/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/migurski/hooked-on-sources/releases{/id}",\r        "created_at": "2015-06-27T22:47:37Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:53:18Z",\r        "git_url": "git://github.com/migurski/hooked-on-sources.git",\r        "ssh_url": "git@github.com:migurski/hooked-on-sources.git",\r        "clone_url": "https://github.com/migurski/hooked-on-sources.git",\r        "svn_url": "https://github.com/migurski/hooked-on-sources",\r        "homepage": null,\r        "size": 192,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": false,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 0,\r        "mirror_url": null,\r        "open_issues_count": 0,\r        "forks": 0,\r        "open_issues": 0,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "base": {\r      "label": "openaddresses:master",\r      "ref": "master",\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "user": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 34590951,\r        "name": "hooked-on-sources",\r        "full_name": "openaddresses/hooked-on-sources",\r        "owner": {\r          "login": "openaddresses",\r          "id": 6895392,\r          "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/openaddresses",\r          "html_url": "https://github.com/openaddresses",\r          "followers_url": "https://api.github.com/users/openaddresses/followers",\r          "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r          "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r          "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r          "repos_url": "https://api.github.com/users/openaddresses/repos",\r          "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r          "type": "Organization",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/openaddresses/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": false,\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r        "created_at": "2015-04-25T23:56:07Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:51:15Z",\r        "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r        "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r        "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r        "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r        "homepage": null,\r        "size": 192,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": true,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 1,\r        "mirror_url": null,\r        "open_issues_count": 3,\r        "forks": 1,\r        "open_issues": 3,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "_links": {\r      "self": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4"\r      },\r      "html": {\r        "href": "https://github.com/openaddresses/hooked-on-sources/pull/4"\r      },\r      "issue": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4"\r      },\r      "comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments"\r      },\r      "review_comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments"\r      },\r      "review_comment": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}"\r      },\r      "commits": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits"\r      },\r      "statuses": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add"\r      }\r    },\r    "merged": false,\r    "mergeable": null,\r    "mergeable_state": "unknown",\r    "merged_by": null,\r    "comments": 0,\r    "review_comments": 0,\r    "commits": 2,\r    "additions": 23,\r    "deletions": 0,\r    "changed_files": 1\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": "2015-06-27T22:51:15Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 192,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 3,\r    "forks": 1,\r    "open_issues": 3,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
            success2, response2 = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data2), False)
            self.assertEqual(self.last_status_state, 'pending', 'Status should be pending for a pull request synch')

            self.last_status_state = None
            data3 = u'''{\r  "ref": "refs/heads/master",\r  "before": "c3c7de37f96d38534dc6297a2483c218994241b6",\r  "after": "8dd262c2f30a70b27e371869c54315b1abc32247",\r  "created": false,\r  "deleted": false,\r  "forced": false,\r  "base_ref": null,\r  "compare": "https://github.com/openaddresses/hooked-on-sources/compare/c3c7de37f96d...8dd262c2f30a",\r  "commits": [\r    {\r      "id": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "distinct": true,\r      "message": "Added La Réunion",\r      "timestamp": "2015-06-27T15:48:33-07:00",\r      "url": "https://github.com/openaddresses/hooked-on-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r        "sources/fr/la-réunion.json"\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r\r      ]\r    },\r    {\r      "id": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "distinct": true,\r      "message": "Added Latin-1 encoding",\r      "timestamp": "2015-06-27T15:53:19-07:00",\r      "url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add",\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r        "sources/fr/la-réunion.json"\r      ]\r    },\r    {\r      "id": "8dd262c2f30a70b27e371869c54315b1abc32247",\r      "distinct": true,\r      "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r      "timestamp": "2015-06-27T15:55:38-07:00",\r      "url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r        "sources/fr/la-réunion.json"\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r\r      ]\r    }\r  ],\r  "head_commit": {\r    "id": "8dd262c2f30a70b27e371869c54315b1abc32247",\r    "distinct": true,\r    "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r    "timestamp": "2015-06-27T15:55:38-07:00",\r    "url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r    "author": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "username": "migurski"\r    },\r    "committer": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "username": "migurski"\r    },\r    "added": [\r      "sources/fr/la-réunion.json"\r    ],\r    "removed": [\r\r    ],\r    "modified": [\r\r    ]\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "name": "openaddresses",\r      "email": "openaddresses@gmail.com"\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://github.com/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": 1430006167,\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": 1435445738,\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 268,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 2,\r    "forks": 1,\r    "open_issues": 2,\r    "watchers": 0,\r    "default_branch": "master",\r    "stargazers": 0,\r    "master_branch": "master",\r    "organization": "openaddresses"\r  },\r  "pusher": {\r    "name": "migurski",\r    "email": "mike-github@teczno.com"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
            success3, response3 = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data3), False)
            self.assertEqual(self.last_status_state, 'pending', 'Status should be pending for a new commit to master')

            self.last_status_state = None
            data4 = u'''{\r  "action": "closed",\r  "number": 4,\r  "pull_request": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4",\r    "id": 38716878,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/4",\r    "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.diff",\r    "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/4.patch",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4",\r    "number": 4,\r    "state": "closed",\r    "locked": false,\r    "title": "Added La Réunion",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "body": "",\r    "created_at": "2015-06-27T22:51:14Z",\r    "updated_at": "2015-06-27T22:55:38Z",\r    "closed_at": "2015-06-27T22:55:38Z",\r    "merged_at": "2015-06-27T22:55:38Z",\r    "merge_commit_sha": "a24d66f118649a3ff5bf5731f5c54933b94cac8d",\r    "assignee": null,\r    "milestone": null,\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits",\r    "review_comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments",\r    "review_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add",\r    "head": {\r      "label": "migurski:master",\r      "ref": "master",\r      "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "user": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 38178103,\r        "name": "hooked-on-sources",\r        "full_name": "migurski/hooked-on-sources",\r        "owner": {\r          "login": "migurski",\r          "id": 58730,\r          "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/migurski",\r          "html_url": "https://github.com/migurski",\r          "followers_url": "https://api.github.com/users/migurski/followers",\r          "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r          "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r          "organizations_url": "https://api.github.com/users/migurski/orgs",\r          "repos_url": "https://api.github.com/users/migurski/repos",\r          "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/migurski/received_events",\r          "type": "User",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/migurski/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": true,\r        "url": "https://api.github.com/repos/migurski/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/migurski/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/migurski/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/migurski/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/migurski/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/migurski/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/migurski/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/migurski/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/migurski/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/migurski/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/migurski/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/migurski/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/migurski/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/migurski/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/migurski/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/migurski/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/migurski/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/migurski/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/migurski/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/migurski/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/migurski/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/migurski/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/migurski/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/migurski/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/migurski/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/migurski/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/migurski/hooked-on-sources/releases{/id}",\r        "created_at": "2015-06-27T22:47:37Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:53:18Z",\r        "git_url": "git://github.com/migurski/hooked-on-sources.git",\r        "ssh_url": "git@github.com:migurski/hooked-on-sources.git",\r        "clone_url": "https://github.com/migurski/hooked-on-sources.git",\r        "svn_url": "https://github.com/migurski/hooked-on-sources",\r        "homepage": null,\r        "size": 88,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": false,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 0,\r        "mirror_url": null,\r        "open_issues_count": 0,\r        "forks": 0,\r        "open_issues": 0,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "base": {\r      "label": "openaddresses:master",\r      "ref": "master",\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "user": {\r        "login": "openaddresses",\r        "id": 6895392,\r        "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/openaddresses",\r        "html_url": "https://github.com/openaddresses",\r        "followers_url": "https://api.github.com/users/openaddresses/followers",\r        "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r        "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r        "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r        "repos_url": "https://api.github.com/users/openaddresses/repos",\r        "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r        "type": "Organization",\r        "site_admin": false\r      },\r      "repo": {\r        "id": 34590951,\r        "name": "hooked-on-sources",\r        "full_name": "openaddresses/hooked-on-sources",\r        "owner": {\r          "login": "openaddresses",\r          "id": 6895392,\r          "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r          "gravatar_id": "",\r          "url": "https://api.github.com/users/openaddresses",\r          "html_url": "https://github.com/openaddresses",\r          "followers_url": "https://api.github.com/users/openaddresses/followers",\r          "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r          "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r          "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r          "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r          "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r          "repos_url": "https://api.github.com/users/openaddresses/repos",\r          "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r          "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r          "type": "Organization",\r          "site_admin": false\r        },\r        "private": false,\r        "html_url": "https://github.com/openaddresses/hooked-on-sources",\r        "description": "Temporary repository for testing Github webhook features",\r        "fork": false,\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r        "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r        "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r        "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r        "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r        "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r        "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r        "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r        "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r        "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r        "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r        "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r        "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r        "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r        "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r        "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r        "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r        "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r        "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r        "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r        "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r        "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r        "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r        "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r        "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r        "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r        "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r        "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r        "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r        "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r        "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r        "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r        "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r        "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r        "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r        "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r        "created_at": "2015-04-25T23:56:07Z",\r        "updated_at": "2015-04-25T23:56:07Z",\r        "pushed_at": "2015-06-27T22:55:38Z",\r        "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r        "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r        "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r        "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r        "homepage": null,\r        "size": 268,\r        "stargazers_count": 0,\r        "watchers_count": 0,\r        "language": null,\r        "has_issues": true,\r        "has_downloads": true,\r        "has_wiki": true,\r        "has_pages": false,\r        "forks_count": 1,\r        "mirror_url": null,\r        "open_issues_count": 2,\r        "forks": 1,\r        "open_issues": 2,\r        "watchers": 0,\r        "default_branch": "master"\r      }\r    },\r    "_links": {\r      "self": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4"\r      },\r      "html": {\r        "href": "https://github.com/openaddresses/hooked-on-sources/pull/4"\r      },\r      "issue": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4"\r      },\r      "comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments"\r      },\r      "review_comments": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/comments"\r      },\r      "review_comment": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/comments{/number}"\r      },\r      "commits": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/4/commits"\r      },\r      "statuses": {\r        "href": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/6460668909a85d9db8df871d91e9b25bc5192add"\r      }\r    },\r    "merged": true,\r    "mergeable": null,\r    "mergeable_state": "unknown",\r    "merged_by": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "comments": 0,\r    "review_comments": 0,\r    "commits": 2,\r    "additions": 23,\r    "deletions": 0,\r    "changed_files": 1\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": "2015-06-27T22:55:38Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 268,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 2,\r    "forks": 1,\r    "open_issues": 2,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
            success4, response4 = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data4), False)
            self.assertEqual(self.last_status_state, None, 'Status should be blank for a closed pull request')

            self.assertTrue(success1)
            self.assertTrue(success2)
            self.assertTrue(success3)
            self.assertTrue(success4)
        
        # Look for the task in the task queue.
        with db_connect(self.database_url) as conn:
            task_queue = db_queue(conn, TASK_QUEUE)
            task_count = len(task_queue)
            task1 = task_queue.get()
            task2 = task_queue.get()
            task3 = task_queue.get()
            
            with db_cursor(conn) as db:
                job1 = read_job(db, task1.data['job_id'])
                job2 = read_job(db, task2.data['job_id'])
                job3 = read_job(db, task3.data['job_id'])
            
        self.assertEqual(task_count, 3, 'There should be exactly three tasks in the queue')
        self.assertEqual(task1.data['name'], u'sources/fr/la-réunion.json', u'La Réunion should be there')
        self.assertEqual(task1.data['file_id'], 'fb6936692415f70d49cc922a9cf3c53c3e9a9756')
        self.assertEqual(job1.github_comments_url, 'https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments')
        self.assertFalse(task1.data['rerun'])
        self.assertEqual(task2.data['name'], u'sources/fr/la-réunion.json', u'La Réunion should be there')
        self.assertEqual(task2.data['file_id'], 'a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9')
        self.assertEqual(job2.github_comments_url, 'https://api.github.com/repos/openaddresses/hooked-on-sources/issues/4/comments')
        self.assertFalse(task2.data['rerun'])
        self.assertEqual(task3.data['name'], u'sources/fr/la-réunion.json', u'La Réunion should be there')
        self.assertEqual(task3.data['file_id'], 'a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9')
        self.assertIsNone(job3.github_comments_url)
        self.assertFalse(task3.data['rerun'])
    
    def test_webhook_issue_comment(self):
        ''' Pull request from an outside contributor.
        '''
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)

            self.last_status_state = None
            data1 = '''{\r  "action": "created",\r  "issue": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r    "repository_url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/labels{/name}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/comments",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/events",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2",\r    "id": 72723825,\r    "number": 2,\r    "title": "Testing this time with a PR",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "labels": [\r\r    ],\r    "state": "open",\r    "locked": false,\r    "assignee": null,\r    "assignees": [\r\r    ],\r    "milestone": null,\r    "comments": 1,\r    "created_at": "2015-05-03T00:35:48Z",\r    "updated_at": "2016-09-21T02:58:43Z",\r    "closed_at": null,\r    "pull_request": {\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/2",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2",\r      "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/2.diff",\r      "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/2.patch"\r    },\r    "body": ""\r  },\r  "comment": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/248497705",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/2#issuecomment-248497705",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2",\r    "id": 248497705,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-09-21T02:58:43Z",\r    "updated_at": "2016-09-21T02:58:43Z",\r    "body": "Re-run this, please."\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "deployments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/deployments",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2015-04-25T23:56:07Z",\r    "pushed_at": "2015-06-27T22:55:38Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 230,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 2,\r    "forks": 1,\r    "open_issues": 2,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "hooks_url": "https://api.github.com/orgs/openaddresses/hooks",\r    "issues_url": "https://api.github.com/orgs/openaddresses/issues",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
            success1, response1 = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data1), False)
            self.assertEqual(self.last_status_state, 'pending', 'Status should be pending for a commented pull request')

            self.last_status_state = None
            data2 = '''{\r  "action": "created",\r  "issue": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "repository_url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/labels{/name}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/comments",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/events",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7",\r    "id": 183295970,\r    "number": 7,\r    "title": "Create méxico.json",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "labels": [\r\r    ],\r    "state": "open",\r    "locked": false,\r    "assignee": null,\r    "assignees": [\r\r    ],\r    "milestone": null,\r    "comments": 10,\r    "created_at": "2016-10-16T22:23:40Z",\r    "updated_at": "2016-11-10T16:20:23Z",\r    "closed_at": null,\r    "pull_request": {\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/7",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7",\r      "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/7.diff",\r      "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/7.patch"\r    },\r    "body": ""\r  },\r  "comment": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/259734398",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-259734398",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 259734398,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-11-10T16:20:23Z",\r    "updated_at": "2016-11-10T16:20:23Z",\r    "body": "rerun this please"\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "deployments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/deployments",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2016-10-16T19:54:18Z",\r    "pushed_at": "2016-10-16T22:23:40Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 12,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 4,\r    "forks": 1,\r    "open_issues": 4,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "hooks_url": "https://api.github.com/orgs/openaddresses/hooks",\r    "issues_url": "https://api.github.com/orgs/openaddresses/issues",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
            success2, response2 = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data2), False)
            self.assertEqual(self.last_status_state, 'pending', 'Status should be pending for a commented pull request')

            self.last_status_state = None
            data3 = '''{\r  "action": "deleted",\r  "issue": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "repository_url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/labels{/name}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/comments",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/events",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7",\r    "id": 183295970,\r    "number": 7,\r    "title": "Create méxico.json",\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "labels": [\r\r    ],\r    "state": "open",\r    "locked": false,\r    "assignee": null,\r    "assignees": [\r\r    ],\r    "milestone": null,\r    "comments": 11,\r    "created_at": "2016-10-16T22:23:40Z",\r    "updated_at": "2016-11-11T00:09:23Z",\r    "closed_at": null,\r    "pull_request": {\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls/7",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7",\r      "diff_url": "https://github.com/openaddresses/hooked-on-sources/pull/7.diff",\r      "patch_url": "https://github.com/openaddresses/hooked-on-sources/pull/7.patch"\r    },\r    "body": ""\r  },\r  "comment": {\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments/259845585",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/pull/7#issuecomment-259845585",\r    "issue_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7",\r    "id": 259845585,\r    "user": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "created_at": "2016-11-11T00:09:23Z",\r    "updated_at": "2016-11-11T00:09:23Z",\r    "body": "![México](http://s3.amazonaws.com/data-testpreviews.openaddresses.io/runs/10/preview.png)"\r  },\r  "repository": {\r    "id": 34590951,\r    "name": "hooked-on-sources",\r    "full_name": "openaddresses/hooked-on-sources",\r    "owner": {\r      "login": "openaddresses",\r      "id": 6895392,\r      "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/openaddresses",\r      "html_url": "https://github.com/openaddresses",\r      "followers_url": "https://api.github.com/users/openaddresses/followers",\r      "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r      "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r      "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r      "repos_url": "https://api.github.com/users/openaddresses/repos",\r      "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r      "type": "Organization",\r      "site_admin": false\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/hooked-on-sources",\r    "description": "Temporary repository for testing Github webhook features",\r    "fork": false,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r    "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r    "deployments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/deployments",\r    "created_at": "2015-04-25T23:56:07Z",\r    "updated_at": "2016-10-16T19:54:18Z",\r    "pushed_at": "2016-10-16T22:23:40Z",\r    "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r    "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r    "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r    "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r    "homepage": null,\r    "size": 12,\r    "stargazers_count": 0,\r    "watchers_count": 0,\r    "language": null,\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 1,\r    "mirror_url": null,\r    "open_issues_count": 4,\r    "forks": 1,\r    "open_issues": 4,\r    "watchers": 0,\r    "default_branch": "master"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "hooks_url": "https://api.github.com/orgs/openaddresses/hooks",\r    "issues_url": "https://api.github.com/orgs/openaddresses/issues",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
            success3, response3 = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data3), False)
            self.assertIsNone(self.last_status_state, 'Status should be blank for a deleted comment')

            self.assertTrue(success1)
            self.assertTrue(success2)
            self.assertTrue(success3)
        
        # Look for the task in the task queue.
        with db_connect(self.database_url) as conn:
            task_queue = db_queue(conn, TASK_QUEUE)
            task_count = len(task_queue)
            task1 = task_queue.get()
            task2 = task_queue.get()
            
            with db_cursor(conn) as db:
                job1 = read_job(db, task1.data['job_id'])
                job2 = read_job(db, task2.data['job_id'])
            
        self.assertEqual(task_count, 2, 'There should be exactly two tasks in the queue')
        self.assertEqual(task1.data['name'], u'sources/us-ca-nevada_county.json', u'Nevada County should be there')
        self.assertEqual(task1.data['file_id'], '83ba405aa5eb22e058c125ce97ea53845daa8254')
        self.assertEqual(job1.github_comments_url, 'https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/comments')
        self.assertTrue(task1.data['rerun'])
        self.assertEqual(task2.data['name'], u'sources/mx/méxico.json', u'México should be there')
        self.assertEqual(task2.data['file_id'], '45746c69c9923e753f52646c1c32b55a22b343a5')
        self.assertEqual(job2.github_comments_url, 'https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/comments')
        self.assertTrue(task2.data['rerun'])
    
    @patch('openaddr.ci.objects.read_run')
    @patch('openaddr.ci.objects.read_job')
    def test_update_job_comments_no_post(self, read_job, read_run):
        '''
        '''
        read_job.return_value = Job(-1, True, None, None, None, None, None, None,
            'https://api.github.com/repos/openaddresses/hooked-on-sources/issues/7/comments',
            None, None)

        run_state = RunState({'preview': 'http://s3.amazonaws.com/data-testpreviews.openaddresses.io/runs/10/preview.png'})
        read_run.return_value = Run(-2, 'sources/whatever.json', None, None,
            None, run_state, None, None, None, None, None, None, None, None)

        
        with HTTMock(self.response_content):
            # good enough that this does not throw an exception
            update_job_comments(mock.Mock(), -1, -2, tuple())
    
    @patch('openaddr.ci.objects.read_run')
    @patch('openaddr.ci.objects.read_job')
    def test_update_job_comments_no_url(self, read_job, read_run):
        '''
        '''
        read_job.return_value = Job(-1, True, None, None, None, None, None, None,
            None, None, None)

        run_state = RunState({'preview': 'http://s3.amazonaws.com/data-testpreviews.openaddresses.io/runs/10/preview.png'})
        read_run.return_value = Run(-2, 'sources/whatever.json', None, None,
            None, run_state, None, None, None, None, None, None, None, None)

        
        with HTTMock(self.response_content):
            # good enough that this does not throw an exception
            update_job_comments(mock.Mock(), -1, -2, tuple())
    
    @patch('openaddr.ci.objects.read_run')
    @patch('openaddr.ci.objects.read_job')
    def test_update_job_comments_yes_post(self, read_job, read_run):
        '''
        '''
        read_job.return_value = Job(-1, True, None, None, None, None, None, None,
            'https://api.github.com/repos/openaddresses/hooked-on-sources/issues/2/comments',
            None, None)

        run_state = RunState({'preview': 'http://s3.amazonaws.com/data-testpreviews.openaddresses.io/runs/10/preview.png'})
        read_run.return_value = Run(-2, 'sources/whatever.json', None, None,
            None, run_state, None, None, None, None, None, None, None, None)

        
        with HTTMock(self.response_content):
            # good enough that this does not throw an exception
            update_job_comments(mock.Mock(), -1, -2, tuple())
    
    def test_webhook_remove_existing_file(self):
        ''' Update with removal of an existing file.
        '''
        data = '''{\r  "ref": "refs/heads/master",\r  "before": "6a7b18728673fc7621bb46ed1a445611f33324f9",\r  "after": "bba8f709793f96750fed223d44ba373a92540b2a",\r  "created": false,\r  "deleted": false,\r  "forced": false,\r  "base_ref": null,\r  "compare": "https://github.com/openaddresses/openaddresses/compare/6a7b18728673...bba8f709793f",\r  "commits": [\r    {\r      "id": "e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r      "distinct": true,\r      "message": "Update San Diego County coverage (rename as county, update as county, add source details)",\r      "timestamp": "2015-06-21T12:45:12-07:00",\r      "url": "https://github.com/openaddresses/openaddresses/commit/e1af73800eb25192099c4b1dd75bf0fbec3657fd",\r      "author": {\r        "name": "Dave Guarino",\r        "email": "dave@codeforamerica.org",\r        "username": "daguar"\r      },\r      "committer": {\r        "name": "Dave Guarino",\r        "email": "dave@codeforamerica.org",\r        "username": "daguar"\r      },\r      "added": [\r        "sources/us-ca-san_diego_county.json"\r      ],\r      "removed": [\r        "sources/us-ca-san_diego.json"\r      ],\r      "modified": [\r\r      ]\r    },\r    {\r      "id": "f85074d543622ef1fac7a80a059a50176f2a6e08",\r      "distinct": true,\r      "message": "Fix San Diego County changes (key should be 'note' not 'notes')",\r      "timestamp": "2015-06-21T13:07:58-07:00",\r      "url": "https://github.com/openaddresses/openaddresses/commit/f85074d543622ef1fac7a80a059a50176f2a6e08",\r      "author": {\r        "name": "Dave Guarino",\r        "email": "dave@codeforamerica.org",\r        "username": "daguar"\r      },\r      "committer": {\r        "name": "Dave Guarino",\r        "email": "dave@codeforamerica.org",\r        "username": "daguar"\r      },\r      "added": [\r\r      ],\r      "removed": [\r\r      ],\r      "modified": [\r        "sources/us-ca-san_diego_county.json"\r      ]\r    },\r    {\r      "id": "bba8f709793f96750fed223d44ba373a92540b2a",\r      "distinct": true,\r      "message": "Merge pull request #1036 from daguar/fix-coverage-of-san-diego-county\\n\\nUpdate San Diego County coverage and details",\r      "timestamp": "2015-06-21T13:25:01-07:00",\r      "url": "https://github.com/openaddresses/openaddresses/commit/bba8f709793f96750fed223d44ba373a92540b2a",\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "username": "migurski"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "username": "migurski"\r      },\r      "added": [\r        "sources/us-ca-san_diego_county.json"\r      ],\r      "removed": [\r        "sources/us-ca-san_diego.json"\r      ],\r      "modified": [\r\r      ]\r    }\r  ],\r  "head_commit": {\r    "id": "bba8f709793f96750fed223d44ba373a92540b2a",\r    "distinct": true,\r    "message": "Merge pull request #1036 from daguar/fix-coverage-of-san-diego-county\\n\\nUpdate San Diego County coverage and details",\r    "timestamp": "2015-06-21T13:25:01-07:00",\r    "url": "https://github.com/openaddresses/openaddresses/commit/bba8f709793f96750fed223d44ba373a92540b2a",\r    "author": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "username": "migurski"\r    },\r    "committer": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "username": "migurski"\r    },\r    "added": [\r      "sources/us-ca-san_diego_county.json"\r    ],\r    "removed": [\r      "sources/us-ca-san_diego.json"\r    ],\r    "modified": [\r\r    ]\r  },\r  "repository": {\r    "id": 16594532,\r    "name": "openaddresses",\r    "full_name": "openaddresses/openaddresses",\r    "owner": {\r      "name": "openaddresses",\r      "email": "openaddresses@gmail.com"\r    },\r    "private": false,\r    "html_url": "https://github.com/openaddresses/openaddresses",\r    "description": "A repository of address data.",\r    "fork": false,\r    "url": "https://github.com/openaddresses/openaddresses",\r    "forks_url": "https://api.github.com/repos/openaddresses/openaddresses/forks",\r    "keys_url": "https://api.github.com/repos/openaddresses/openaddresses/keys{/key_id}",\r    "collaborators_url": "https://api.github.com/repos/openaddresses/openaddresses/collaborators{/collaborator}",\r    "teams_url": "https://api.github.com/repos/openaddresses/openaddresses/teams",\r    "hooks_url": "https://api.github.com/repos/openaddresses/openaddresses/hooks",\r    "issue_events_url": "https://api.github.com/repos/openaddresses/openaddresses/issues/events{/number}",\r    "events_url": "https://api.github.com/repos/openaddresses/openaddresses/events",\r    "assignees_url": "https://api.github.com/repos/openaddresses/openaddresses/assignees{/user}",\r    "branches_url": "https://api.github.com/repos/openaddresses/openaddresses/branches{/branch}",\r    "tags_url": "https://api.github.com/repos/openaddresses/openaddresses/tags",\r    "blobs_url": "https://api.github.com/repos/openaddresses/openaddresses/git/blobs{/sha}",\r    "git_tags_url": "https://api.github.com/repos/openaddresses/openaddresses/git/tags{/sha}",\r    "git_refs_url": "https://api.github.com/repos/openaddresses/openaddresses/git/refs{/sha}",\r    "trees_url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees{/sha}",\r    "statuses_url": "https://api.github.com/repos/openaddresses/openaddresses/statuses/{sha}",\r    "languages_url": "https://api.github.com/repos/openaddresses/openaddresses/languages",\r    "stargazers_url": "https://api.github.com/repos/openaddresses/openaddresses/stargazers",\r    "contributors_url": "https://api.github.com/repos/openaddresses/openaddresses/contributors",\r    "subscribers_url": "https://api.github.com/repos/openaddresses/openaddresses/subscribers",\r    "subscription_url": "https://api.github.com/repos/openaddresses/openaddresses/subscription",\r    "commits_url": "https://api.github.com/repos/openaddresses/openaddresses/commits{/sha}",\r    "git_commits_url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits{/sha}",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/comments{/number}",\r    "issue_comment_url": "https://api.github.com/repos/openaddresses/openaddresses/issues/comments{/number}",\r    "contents_url": "https://api.github.com/repos/openaddresses/openaddresses/contents/{+path}",\r    "compare_url": "https://api.github.com/repos/openaddresses/openaddresses/compare/{base}...{head}",\r    "merges_url": "https://api.github.com/repos/openaddresses/openaddresses/merges",\r    "archive_url": "https://api.github.com/repos/openaddresses/openaddresses/{archive_format}{/ref}",\r    "downloads_url": "https://api.github.com/repos/openaddresses/openaddresses/downloads",\r    "issues_url": "https://api.github.com/repos/openaddresses/openaddresses/issues{/number}",\r    "pulls_url": "https://api.github.com/repos/openaddresses/openaddresses/pulls{/number}",\r    "milestones_url": "https://api.github.com/repos/openaddresses/openaddresses/milestones{/number}",\r    "notifications_url": "https://api.github.com/repos/openaddresses/openaddresses/notifications{?since,all,participating}",\r    "labels_url": "https://api.github.com/repos/openaddresses/openaddresses/labels{/name}",\r    "releases_url": "https://api.github.com/repos/openaddresses/openaddresses/releases{/id}",\r    "created_at": 1391722160,\r    "updated_at": "2015-06-18T09:14:44Z",\r    "pushed_at": 1434918301,\r    "git_url": "git://github.com/openaddresses/openaddresses.git",\r    "ssh_url": "git@github.com:openaddresses/openaddresses.git",\r    "clone_url": "https://github.com/openaddresses/openaddresses.git",\r    "svn_url": "https://github.com/openaddresses/openaddresses",\r    "homepage": "http://openaddresses.io/",\r    "size": 10029,\r    "stargazers_count": 276,\r    "watchers_count": 276,\r    "language": "JavaScript",\r    "has_issues": true,\r    "has_downloads": true,\r    "has_wiki": true,\r    "has_pages": false,\r    "forks_count": 315,\r    "mirror_url": null,\r    "open_issues_count": 216,\r    "forks": 315,\r    "open_issues": 216,\r    "watchers": 276,\r    "default_branch": "master",\r    "stargazers": 276,\r    "master_branch": "master",\r    "organization": "openaddresses"\r  },\r  "pusher": {\r    "name": "migurski",\r    "email": "mike-github@teczno.com"\r  },\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "url": "https://api.github.com/orgs/openaddresses",\r    "repos_url": "https://api.github.com/orgs/openaddresses/repos",\r    "events_url": "https://api.github.com/orgs/openaddresses/events",\r    "members_url": "https://api.github.com/orgs/openaddresses/members{/member}",\r    "public_members_url": "https://api.github.com/orgs/openaddresses/public_members{/member}",\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "description": "The free and open global address collection "\r  },\r  "sender": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  }\r}'''
        
        with HTTMock(self.response_content), db_connect(self.database_url) as conn:
            task_q = db_queue(conn, TASK_QUEUE)
            success, response = process_github_payload(task_q, u'http://example.com', mock.Mock(), self.github_auth, json.loads(data), False)
            self.assertTrue(success)

        job_url = response.get('url')
        got_job = self.client.get(urlparse(job_url).path)
        got_jobs = self.client.get(urlparse(urljoin(job_url, u'./')).path)

        self.assertEqual(got_job.status_code, 200)
        self.assertEqual(got_jobs.status_code, 200)
        self.assertEqual(self.last_status_state, 'pending', 'Status should be pending for a valid push')
        
        # Look for the task in the task queue.
        with db_connect(self.database_url) as conn:
            task_queue = db_queue(conn, TASK_QUEUE)
            task_count = len(task_queue)
            task = task_queue.get()
            
        self.assertEqual(task_count, 1, 'There should be exactly one task in the queue')
        self.assertEqual(task.data['name'], 'sources/us-ca-san_diego_county.json', 'San Diego should be there')
        self.assertEqual(task.data['file_id'], '0c7cf2f3e4cb5f0c07818a029e1decc9797ad3a1')
    
    def test_get_latest_set(self):
        ''' 
        '''
        now = datetime.now()
        yesterday = now - timedelta(days=1)
        last_week = now - timedelta(days=7)
        
        # Old-style run predating attribution columns.
        _run_state1 = {
            'source': 'a1.json', 'skipped': 'b', 'cache': 'c', 'sample': 'd',
            'website': 'e', 'license': 'f', 'geometry type': 'g',
            'address count': 'h', 'version': 'i', 'fingerprint': 'j',
            'cache time': 'k', 'processed': 'l', 'process time': 'm',
            'output': 'n', 'code version': 'o'
            }
        run_state1 = RunState(_run_state1)
        
        # New-style run including attribution columns.
        _run_state2 = {'attribution required': 'true', 'attribution name': 'p'}
        _run_state2.update(_run_state1)
        _run_state2['source'] = 'a2.json'
        run_state2 = RunState(_run_state2)
        
        # Newer-style run including share-alike columns.
        _run_state3 = {'share-alike': 'true'}
        _run_state3.update(_run_state2)
        _run_state3['source'] = 'a3.json'
        run_state3 = RunState(_run_state3)

        # Unmerged and should never show up.
        _run_state4 = {}
        _run_state4.update(_run_state3)
        _run_state4['cache'] = 'zzz'
        run_state4 = RunState(_run_state4)
        
        # Look for the task in the task queue.
        with db_connect(self.database_url) as conn:
            with db_cursor(conn) as db:
                db.executemany('''INSERT INTO sets
                                  (id, owner, repository, datetime_start, datetime_end)
                                  VALUES (%s, %s, %s, %s, %s)''',
                               [(1, 'openaddresses', 'openaddresses', now, None),
                                (2, 'openaddresses', 'openaddresses', yesterday, now),
                                (3, 'openaddresses', 'openaddresses', last_week, now)])
                
                run_id1 = add_run(db)
                set_run(db, run_id1, 'sources/a1.json', 'abc', b'def',
                        run_state1, True, None, None, None, True, 2)
                
                run_id2 = add_run(db)
                set_run(db, run_id2, 'sources/a2.json', 'ghi', b'jkl',
                        run_state2, True, None, None, None, True, 2)
                
                run_id3 = add_run(db)
                set_run(db, run_id3, 'sources/a3.json', 'ghi', b'jkl',
                        run_state3, True, None, None, None, True, 2)
                
                # Unmerged run, as though from a separate job and not this set.
                run_id4 = add_run(db)
                set_run(db, run_id4, 'sources/a3.json', 'ghi', b'jkl',
                        run_state4, True, None, None, None, False, None)
        
                latest_set = read_latest_set(db, 'openaddresses', 'openaddresses')
                latest_set_runs = read_completed_runs_to_date(db, latest_set.id)
                set_2_runs = read_completed_runs_to_date(db, 2)
        
        for runs in (latest_set_runs, set_2_runs):
            self.assertEqual(len(runs), 3)
        
            got_state1 = json.loads(runs[0].state.to_json())
            got_state2 = json.loads(runs[1].state.to_json())
            got_state3 = json.loads(runs[2].state.to_json())
            
            self.assertEqual(runs[0].code_version, 'o')
            self.assertEqual(runs[1].code_version, 'o')
            self.assertEqual(runs[2].code_version, 'o')
        
            for key in ('source', 'cache', 'sample', 'geometry type', 'address count',
                        'version', 'fingerprint', 'cache time', 'processed', 'output',
                        'process time'):
                self.assertIn(key, got_state1)
                self.assertIn(key, got_state2)
        
            for (key, value) in got_state1.items():
                if key in _run_state1:
                    self.assertEqual(value, _run_state1[key])
        
            for (key, value) in got_state2.items():
                if key in _run_state2:
                    self.assertEqual(value, _run_state2[key])
        
            for (key, value) in got_state3.items():
                if key in _run_state3:
                    self.assertEqual(value, _run_state3[key])
    
    def test_get_latest_run(self):
        '''
        '''
        run_states = {
            'source': 'a1.json', 'skipped': 'b', 'cache': 'c', 'sample': 'd',
            'website': 'e', 'license': 'f', 'geometry type': 'g',
            'address count': 'h', 'version': 'i', 'fingerprint': 'j',
            'cache time': 'k', 'process time': 'm', 'output': 'n',
            'attribution required': 'true', 'attribution name': 'p',
            'share-alike': 'true'
            }
        
        _run_state1 = {k: v for (k, v) in run_states.items()}
        _run_state1.update({'source': 'a1.json', 'processed': 'https://s3.amazonaws.com/data.openaddresses.io/runs/1/a1.zip'})
        run_state1 = RunState(_run_state1)
        
        _run_state2 = {k: v for (k, v) in run_states.items()}
        _run_state2.update({'source': 'a2.json', 'processed': 'http://data.openaddresses.io.s3.amazonaws.com/runs/2/a2.zip'})
        run_state2 = RunState(_run_state2)
        
        _run_state3 = {k: v for (k, v) in run_states.items()}
        _run_state3.update({'source': 'a3.json', 'processed': 'http://data.openaddresses.io/runs/3/a3.zip'})
        run_state3 = RunState(_run_state3)
        
        _run_state4 = {k: v for (k, v) in run_states.items()}
        _run_state4.update({'source': 'a4.json', 'processed': 'http://future.openaddresses.io/runs/4/a4.zip'})
        run_state4 = RunState(_run_state4)
        
        _run_state5 = {k: v for (k, v) in run_states.items()}
        _run_state5.update({'source': 'a5.json', 'processed': 'http://s3.amazonaws.com/past.openaddresses.io/runs/5/a5.zip'})
        run_state5 = RunState(_run_state5)

        with db_connect(self.database_url) as conn:
            with db_cursor(conn) as db:
                db.execute('''INSERT INTO sets
                              (id, owner, repository, datetime_start, datetime_end)
                              VALUES (%s, %s, %s, %s, %s)''',
                           (1, 'openaddresses', 'openaddresses', datetime.now(), None))
                
                run_id1 = add_run(db)
                set_run(db, run_id1, 'sources/a1.json', 'abc', b'def',
                        run_state1, True, None, None, None, True, 1)
                
                run_id2 = add_run(db)
                set_run(db, run_id2, 'sources/a2.json', 'abc', b'def',
                        run_state2, True, None, None, None, True, 1)
                
                run_id3 = add_run(db)
                set_run(db, run_id3, 'sources/a3.json', 'abc', b'def',
                        run_state3, True, None, None, None, True, 1)
                
                run_id4 = add_run(db)
                set_run(db, run_id4, 'sources/a4.json', 'abc', b'def',
                        run_state4, True, None, None, None, True, 1)
                
                run_id5 = add_run(db)
                set_run(db, run_id5, 'sources/a5.json', 'abc', b'def',
                        run_state5, True, None, None, None, True, 1)

        got1 = self.client.get('/latest/run/a1.zip')
        self.assertEqual(got1.status_code, 302)
        self.assertEqual(got1.headers.get('Location'), 'http://data.openaddresses.io/runs/1/a1.zip')

        got2 = self.client.get('/latest/run/a2.zip')
        self.assertEqual(got2.status_code, 302)
        self.assertEqual(got2.headers.get('Location'), 'http://data.openaddresses.io/runs/2/a2.zip')

        got3 = self.client.get('/latest/run/a3.zip')
        self.assertEqual(got3.status_code, 302)
        self.assertEqual(got3.headers.get('Location'), 'http://data.openaddresses.io/runs/3/a3.zip')

        got4 = self.client.get('/latest/run/a4.zip')
        self.assertEqual(got4.status_code, 302)
        self.assertEqual(got4.headers.get('Location'), 'http://future.openaddresses.io/runs/4/a4.zip')

        got5 = self.client.get('/latest/run/a5.zip')
        self.assertEqual(got5.status_code, 302)
        self.assertEqual(got5.headers.get('Location'), 'http://s3.amazonaws.com/past.openaddresses.io/runs/5/a5.zip')

    def test_get_job(self):
        '''
        '''
        got1 = self.client.get('/jobs/abc')
        self.assertEqual(got1.status_code, 404, 'Job does not exist yet')

        with db_connect(self.database_url) as conn:
            with db_cursor(conn) as db:
                state1 = RunState({
                    'output': 'http://example.com/998/log.txt',
                    'sample': 'http://example.com/998/sample.json',
                    'processed': 'http://example.com/998/stuff.zip',
                    'preview': 'http://example.com/998/preview.png',
                    'slippymap': 'http://example.com/998/tiles.mbtiles'
                    })
                state2 = RunState({
                    'output': 'http://example.com/999/log.txt',
                    'sample': 'http://example.com/999/sample.json',
                    'processed': 'http://example.com/999/stuff.zip',
                    'preview': 'http://example.com/999/preview.png',
                    'slippymap': 'http://example.org/tiles.mbtiles',
                    'run id': 999
                    })
                add_job(db, 'abc', True, {'this': 'foo', 'that': 'bar'},
                       {'foo': True, 'bar': True},
                       {'foo': {'state': state1}, 'bar': {'state': state2}},
                       'oa', 'oa', None, None)

        got2 = self.client.get('/jobs/abc')
        body2 = got2.data.decode('utf8')
        self.assertEqual(got2.status_code, 200)

        self.assertIn('http://example.com/998/log.txt', body2)
        self.assertIn('http://example.com/998/sample.json', body2)
        self.assertIn('http://example.com/998/stuff.zip', body2)
        self.assertIn('http://example.com/998/preview.png', body2)
        self.assertIn('https://dotmaps.example.com/yo/998', body2, 'Should see the external URL for slippy map')

        self.assertIn('http://example.com/999/log.txt', body2)
        self.assertIn('http://example.com/999/sample.json', body2)
        self.assertIn('http://example.com/999/stuff.zip', body2)
        self.assertIn('http://example.com/999/preview.png', body2)
        self.assertIn('/slippymaps/999/top/abc', body2, 'Should see the internal frameset URL for slippy map')
    
class TestRuns (unittest.TestCase):

    def setUp(self):
        '''
        '''
        recreate_db.recreate(DATABASE_URL)
        self.database_url = DATABASE_URL
        self.output_dir = mkdtemp(prefix='TestRuns-')
        self.s3 = FakeS3()
        
        self.github_auth = 'Fake', 'Auth'
        self.last_status_state = None
        
        # fake job template url, commit sha, owner, repo, and status url.

        self.fake_queued_job_args = (
            'http://example.com/{id}',
            'ff9900ff9900ff9900ff9900ff9900ff9900',
            False,
            'openaddresses', 'fake-sources',
            'http://api.github.com/repos/openaddresses/fake-sources/statuses/ff9900',
            'https://api.github.com/repos/openaddresses/hooked-on-sources/issues/99/comments',
            )

        self.fake_queued_job_args_unmerged = (
            'http://example.com/{id}',
            '0099ff0099ff0099ff0099ff0099ff0099ff',
            False,
            'openaddresses', 'fake-sources',
            'http://api.github.com/repos/openaddresses/fake-sources/statuses/ff9900',
            'https://api.github.com/repos/openaddresses/hooked-on-sources/issues/99/comments',
            )
    
    def tearDown(self):
        '''
        '''
        rmtree(self.output_dir)
        remove(self.s3._fake_keys)
    
    def response_content(self, url, request):
        '''
        '''
        query = dict(parse_qsl(url.query))
        MHP = request.method, url.hostname, url.path
        GH, response_headers = 'api.github.com', {'Content-Type': 'application/json; charset=utf-8'}
        
        if MHP == ('GET', GH, '/'):
            data = u'''{\r  "current_user_url": "https://api.github.com/user",\r  "current_user_authorizations_html_url": "https://github.com/settings/connections/applications{/client_id}",\r  "authorizations_url": "https://api.github.com/authorizations",\r  "code_search_url": "https://api.github.com/search/code?q={query}{&page,per_page,sort,order}",\r  "emails_url": "https://api.github.com/user/emails",\r  "emojis_url": "https://api.github.com/emojis",\r  "events_url": "https://api.github.com/events",\r  "feeds_url": "https://api.github.com/feeds",\r  "following_url": "https://api.github.com/user/following{/target}",\r  "gists_url": "https://api.github.com/gists{/gist_id}",\r  "hub_url": "https://api.github.com/hub",\r  "issue_search_url": "https://api.github.com/search/issues?q={query}{&page,per_page,sort,order}",\r  "issues_url": "https://api.github.com/issues",\r  "keys_url": "https://api.github.com/user/keys",\r  "notifications_url": "https://api.github.com/notifications",\r  "organization_repositories_url": "https://api.github.com/orgs/{org}/repos{?type,page,per_page,sort}",\r  "organization_url": "https://api.github.com/orgs/{org}",\r  "public_gists_url": "https://api.github.com/gists/public",\r  "rate_limit_url": "https://api.github.com/rate_limit",\r  "repository_url": "https://api.github.com/repos/{owner}/{repo}",\r  "repository_search_url": "https://api.github.com/search/repositories?q={query}{&page,per_page,sort,order}",\r  "current_user_repositories_url": "https://api.github.com/user/repos{?type,page,per_page,sort}",\r  "starred_url": "https://api.github.com/user/starred{/owner}{/repo}",\r  "starred_gists_url": "https://api.github.com/gists/starred",\r  "team_url": "https://api.github.com/teams",\r  "user_url": "https://api.github.com/users/{user}",\r  "user_organizations_url": "https://api.github.com/user/orgs",\r  "user_repositories_url": "https://api.github.com/users/{user}/repos{?type,page,per_page,sort}",\r  "user_search_url": "https://api.github.com/search/users?q={query}{&page,per_page,sort,order}"\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/fake-sources'):
            data = u'''{\r  "id": 34590951,\r  "name": "fake-sources",\r  "full_name": "openaddresses/fake-sources",\r  "owner": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/openaddresses",\r    "html_url": "https://github.com/openaddresses",\r    "followers_url": "https://api.github.com/users/openaddresses/followers",\r    "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r    "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r    "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r    "repos_url": "https://api.github.com/users/openaddresses/repos",\r    "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r    "type": "Organization",\r    "site_admin": false\r  },\r  "private": false,\r  "html_url": "https://github.com/openaddresses/fake-sources",\r  "description": "Temporary repository for testing Github webhook features",\r  "fork": false,\r  "url": "https://api.github.com/repos/openaddresses/fake-sources",\r  "forks_url": "https://api.github.com/repos/openaddresses/fake-sources/forks",\r  "keys_url": "https://api.github.com/repos/openaddresses/fake-sources/keys{/key_id}",\r  "collaborators_url": "https://api.github.com/repos/openaddresses/fake-sources/collaborators{/collaborator}",\r  "teams_url": "https://api.github.com/repos/openaddresses/fake-sources/teams",\r  "hooks_url": "https://api.github.com/repos/openaddresses/fake-sources/hooks",\r  "issue_events_url": "https://api.github.com/repos/openaddresses/fake-sources/issues/events{/number}",\r  "events_url": "https://api.github.com/repos/openaddresses/fake-sources/events",\r  "assignees_url": "https://api.github.com/repos/openaddresses/fake-sources/assignees{/user}",\r  "branches_url": "https://api.github.com/repos/openaddresses/fake-sources/branches{/branch}",\r  "tags_url": "https://api.github.com/repos/openaddresses/fake-sources/tags",\r  "blobs_url": "https://api.github.com/repos/openaddresses/fake-sources/git/blobs{/sha}",\r  "git_tags_url": "https://api.github.com/repos/openaddresses/fake-sources/git/tags{/sha}",\r  "git_refs_url": "https://api.github.com/repos/openaddresses/fake-sources/git/refs{/sha}",\r  "trees_url": "https://api.github.com/repos/openaddresses/fake-sources/git/trees{/sha}",\r  "statuses_url": "https://api.github.com/repos/openaddresses/fake-sources/statuses/{sha}",\r  "languages_url": "https://api.github.com/repos/openaddresses/fake-sources/languages",\r  "stargazers_url": "https://api.github.com/repos/openaddresses/fake-sources/stargazers",\r  "contributors_url": "https://api.github.com/repos/openaddresses/fake-sources/contributors",\r  "subscribers_url": "https://api.github.com/repos/openaddresses/fake-sources/subscribers",\r  "subscription_url": "https://api.github.com/repos/openaddresses/fake-sources/subscription",\r  "commits_url": "https://api.github.com/repos/openaddresses/fake-sources/commits{/sha}",\r  "git_commits_url": "https://api.github.com/repos/openaddresses/fake-sources/git/commits{/sha}",\r  "comments_url": "https://api.github.com/repos/openaddresses/fake-sources/comments{/number}",\r  "issue_comment_url": "https://api.github.com/repos/openaddresses/fake-sources/issues/comments{/number}",\r  "contents_url": "https://api.github.com/repos/openaddresses/fake-sources/contents/{+path}",\r  "compare_url": "https://api.github.com/repos/openaddresses/fake-sources/compare/{base}...{head}",\r  "merges_url": "https://api.github.com/repos/openaddresses/fake-sources/merges",\r  "archive_url": "https://api.github.com/repos/openaddresses/fake-sources/{archive_format}{/ref}",\r  "downloads_url": "https://api.github.com/repos/openaddresses/fake-sources/downloads",\r  "issues_url": "https://api.github.com/repos/openaddresses/fake-sources/issues{/number}",\r  "pulls_url": "https://api.github.com/repos/openaddresses/fake-sources/pulls{/number}",\r  "milestones_url": "https://api.github.com/repos/openaddresses/fake-sources/milestones{/number}",\r  "notifications_url": "https://api.github.com/repos/openaddresses/fake-sources/notifications{?since,all,participating}",\r  "labels_url": "https://api.github.com/repos/openaddresses/fake-sources/labels{/name}",\r  "releases_url": "https://api.github.com/repos/openaddresses/fake-sources/releases{/id}",\r  "created_at": "2015-04-25T23:56:07Z",\r  "updated_at": "2015-04-25T23:56:07Z",\r  "pushed_at": "2015-06-27T22:55:38Z",\r  "git_url": "git://github.com/openaddresses/fake-sources.git",\r  "ssh_url": "git@github.com:openaddresses/fake-sources.git",\r  "clone_url": "https://github.com/openaddresses/fake-sources.git",\r  "svn_url": "https://github.com/openaddresses/fake-sources",\r  "homepage": null,\r  "size": 230,\r  "stargazers_count": 0,\r  "watchers_count": 0,\r  "language": null,\r  "has_issues": true,\r  "has_downloads": true,\r  "has_wiki": true,\r  "has_pages": false,\r  "forks_count": 1,\r  "mirror_url": null,\r  "open_issues_count": 2,\r  "forks": 1,\r  "open_issues": 2,\r  "watchers": 0,\r  "default_branch": "master",\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/openaddresses",\r    "html_url": "https://github.com/openaddresses",\r    "followers_url": "https://api.github.com/users/openaddresses/followers",\r    "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r    "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r    "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r    "repos_url": "https://api.github.com/users/openaddresses/repos",\r    "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r    "type": "Organization",\r    "site_admin": false\r  },\r  "network_count": 1,\r  "subscribers_count": 10\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/fake-sources/compare/ff9900ff9900ff9900ff9900ff9900ff9900...master'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/fake-sources/compare/ff9900ff9900ff9900ff9900ff9900ff9900...master",\r  "html_url": "https://github.com/openaddresses/fake-sources/compare/ff9900ff9900ff9900ff9900ff9900ff9900...master",\r  "permalink_url": "https://github.com/openaddresses/fake-sources/compare/openaddresses:6460668...openaddresses:8dd262c",\r  "diff_url": "https://github.com/openaddresses/fake-sources/compare/ff9900ff9900ff9900ff9900ff9900ff9900...master.diff",\r  "patch_url": "https://github.com/openaddresses/fake-sources/compare/ff9900ff9900ff9900ff9900ff9900ff9900...master.patch",\r  "base_commit": {\r    "sha": "ff9900ff9900ff9900ff9900ff9900ff9900",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "message": "Added Latin-1 encoding",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/fake-sources/git/commits/ff9900ff9900ff9900ff9900ff9900ff9900",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/ff9900ff9900ff9900ff9900ff9900ff9900",\r    "html_url": "https://github.com/openaddresses/fake-sources/commit/ff9900ff9900ff9900ff9900ff9900ff9900",\r    "comments_url": "https://api.github.com/repos/openaddresses/fake-sources/commits/ff9900ff9900ff9900ff9900ff9900ff9900/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "html_url": "https://github.com/openaddresses/fake-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "ff9900ff9900ff9900ff9900ff9900ff9900",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "message": "Added Latin-1 encoding",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/fake-sources/git/commits/ff9900ff9900ff9900ff9900ff9900ff9900",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/ff9900ff9900ff9900ff9900ff9900ff9900",\r    "html_url": "https://github.com/openaddresses/fake-sources/commit/ff9900ff9900ff9900ff9900ff9900ff9900",\r    "comments_url": "https://api.github.com/repos/openaddresses/fake-sources/commits/ff9900ff9900ff9900ff9900ff9900ff9900/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "html_url": "https://github.com/openaddresses/fake-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 1,\r  "behind_by": 0,\r  "total_commits": 1,\r  "commits": [\r    {\r      "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r      "commit": {\r        "author": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "committer": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/openaddresses/fake-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "html_url": "https://github.com/openaddresses/fake-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "comments_url": "https://api.github.com/repos/openaddresses/fake-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/fake-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        },\r        {\r          "sha": "ff9900ff9900ff9900ff9900ff9900ff9900",\r          "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/ff9900ff9900ff9900ff9900ff9900ff9900",\r          "html_url": "https://github.com/openaddresses/fake-sources/commit/ff9900ff9900ff9900ff9900ff9900ff9900"\r        }\r      ]\r    }\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/fake-sources/compare/0099ff0099ff0099ff0099ff0099ff0099ff...master'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/fake-sources/compare/0099ff0099ff0099ff0099ff0099ff0099ff...master",\r  "html_url": "https://github.com/openaddresses/fake-sources/compare/0099ff0099ff0099ff0099ff0099ff0099ff...master",\r  "permalink_url": "https://github.com/openaddresses/fake-sources/compare/openaddresses:6460668...openaddresses:8dd262c",\r  "diff_url": "https://github.com/openaddresses/fake-sources/compare/0099ff0099ff0099ff0099ff0099ff0099ff...master.diff",\r  "patch_url": "https://github.com/openaddresses/fake-sources/compare/0099ff0099ff0099ff0099ff0099ff0099ff...master.patch",\r  "base_commit": {\r    "sha": "0099ff0099ff0099ff0099ff0099ff0099ff",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "message": "Added Latin-1 encoding",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/fake-sources/git/commits/0099ff0099ff0099ff0099ff0099ff0099ff",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/0099ff0099ff0099ff0099ff0099ff0099ff",\r    "html_url": "https://github.com/openaddresses/fake-sources/commit/0099ff0099ff0099ff0099ff0099ff0099ff",\r    "comments_url": "https://api.github.com/repos/openaddresses/fake-sources/commits/0099ff0099ff0099ff0099ff0099ff0099ff/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "html_url": "https://github.com/openaddresses/fake-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "ff9900ff9900ff9900ff9900ff9900ff9900",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-06-27T22:53:19Z"\r      },\r      "message": "Added Latin-1 encoding",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/fake-sources/git/commits/ff9900ff9900ff9900ff9900ff9900ff9900",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/ff9900ff9900ff9900ff9900ff9900ff9900",\r    "html_url": "https://github.com/openaddresses/fake-sources/commit/ff9900ff9900ff9900ff9900ff9900ff9900",\r    "comments_url": "https://api.github.com/repos/openaddresses/fake-sources/commits/ff9900ff9900ff9900ff9900ff9900ff9900/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/aed74b0784f696c3cf10e8e260865ae18ffd3aa8",\r        "html_url": "https://github.com/openaddresses/fake-sources/commit/aed74b0784f696c3cf10e8e260865ae18ffd3aa8"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 1,\r  "behind_by": 0,\r  "total_commits": 1,\r  "commits": [\r    {\r      "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r      "commit": {\r        "author": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "committer": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-06-27T22:55:38Z"\r        },\r        "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r        "tree": {\r          "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r          "url": "https://api.github.com/repos/openaddresses/fake-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r        },\r        "url": "https://api.github.com/repos/openaddresses/fake-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "html_url": "https://github.com/openaddresses/fake-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "comments_url": "https://api.github.com/repos/openaddresses/fake-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r          "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r          "html_url": "https://github.com/openaddresses/fake-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r        },\r        {\r          "sha": "0099ff0099ff0099ff0099ff0099ff0099ff",\r          "url": "https://api.github.com/repos/openaddresses/fake-sources/commits/0099ff0099ff0099ff0099ff0099ff0099ff",\r          "html_url": "https://github.com/openaddresses/fake-sources/commit/0099ff0099ff0099ff0099ff0099ff0099ff"\r        }\r      ]\r    }\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('POST', GH, '/repos/openaddresses/fake-sources/statuses/ff9900') \
        or MHP == ('POST', GH, '/repos/openaddresses/fake-sources/statuses/0099ff'):
            input = json.loads(request.body)
            self.last_status_state = input['state']
            self.last_status_message = input['description']
            self.assertEqual(input['context'], 'openaddresses/hooked')
            
            data = '''{{\r              "context": "openaddresses/hooked", \r              "created_at": "2015-04-26T23:45:39Z", \r              "creator": {{\r                "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3", \r                "events_url": "https://api.github.com/users/migurski/events{{/privacy}}", \r                "followers_url": "https://api.github.com/users/migurski/followers", \r                "following_url": "https://api.github.com/users/migurski/following{{/other_user}}", \r                "gists_url": "https://api.github.com/users/migurski/gists{{/gist_id}}", \r                "gravatar_id": "", \r                "html_url": "https://github.com/migurski", \r                "id": 58730, \r                "login": "migurski", \r                "organizations_url": "https://api.github.com/users/migurski/orgs", \r                "received_events_url": "https://api.github.com/users/migurski/received_events", \r                "repos_url": "https://api.github.com/users/migurski/repos", \r                "site_admin": false, \r                "starred_url": "https://api.github.com/users/migurski/starred{{/owner}}{{/repo}}", \r                "subscriptions_url": "https://api.github.com/users/migurski/subscriptions", \r                "type": "User", \r                "url": "https://api.github.com/users/migurski"\r              }}, \r              "description": "Checking ", \r              "id": 999999999, \r              "state": "{state}", \r              "target_url": null, \r              "updated_at": "2015-04-26T23:45:39Z", \r              "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/xxxxxxxxx"\r            }}'''
            return response(201, data.format(**input).encode('utf8'), headers=response_headers)
        
        print('Unknowable Request {} "{}"'.format(request.method, url.geturl()), file=sys.stderr)
        raise ValueError('Unknowable Request {} "{}"'.format(request.method, url.geturl()))

    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=1))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    def test_working_run(self, do_work):
        ''' Test a boring successful run.
        '''
        source = b'''{
            "coverage": { "US Census": {"geoid": "0653000", "place": "Oakland city", "state": "California"} },
            "data": "http://data.openoakland.org/sites/default/files/OakParcelsGeo2013_0.zip"
            }'''
        
        source_id, source_path = '0xDEADBEEF', 'sources/us-ca-oakland.json'
        
        def returns_plausible_result(s3, run_id, source_name, content, render_preview, output_dir, mapzen_key):
            return dict(message=MAGIC_OK_MESSAGE, state=RunState({"source": "user_input.txt"}))
        
        do_work.side_effect = returns_plausible_result

        # Do the work.
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)

            files = {source_path: (en64(source), source_id)}
            job_id = create_queued_job(task_Q, files, *self.fake_queued_job_args_unmerged)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing yet')
            
            # Work done! 
            pop_task_from_donequeue(done_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'success', 'Should be "success" now')

            # Should do nothing, because no Due task is yet scheduled.
            pop_task_from_duequeue(due_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'success', 'Should be unchanged')

            sleep(2.1)
            
            # Should do nothing, because Due task data will be found in runs table.
            pop_task_from_duequeue(due_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'success', 'Should be unchanged')
            
            # Find a record of this run.
            with done_Q as db:
                db.execute('SELECT source_path, source_id, source_data, is_merged FROM runs')
                ((db_source_path, db_source_id, db_source_data, is_merged), ) = db.fetchall()
                self.assertEqual(db_source_path, source_path)
                self.assertEqual(db_source_id, source_id)
                self.assertTrue(de64(bytes(db_source_data)).startswith('{'))
                self.assertIs(is_merged, False, 'Needs to be unmerged')

            flush_heartbeat_queue(beat_Q)
            
            with beat_Q as db:
                recent_workers = get_recent_workers(db)
                self.assertEqual(len(recent_workers), 1)
     
    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=2))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=1))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('subprocess.check_output')
    def test_failing_run(self, check_output):
        ''' Test a run that fails.
        '''
        def raises_unexpected_error(cmd, timeout, stderr):
            raise NotImplementedError('Everything is ruined.')

        check_output.side_effect = raises_unexpected_error

        source = b'''{
            "coverage": { "US Census": {"geoid": "0653000", "place": "Oakland city", "state": "California"} },
            "data": "http://data.openoakland.org/sites/default/files/OakParcelsGeo2013_0.zip"
            }'''
        
        source_id, source_path = '0xDEADBEEF', 'sources/us-ca-oakland.json'
        
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)

            files = {source_path: (en64(source), source_id)}
            job_id = create_queued_job(task_Q, files, *self.fake_queued_job_args)
        
            # Bad things will happen and the job will fail.
            with self.assertRaises(NotImplementedError) as e:
                pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)

            # Should do nothing, because a Done task was never sent.
            pop_task_from_donequeue(done_Q, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing yet')

            # Should do nothing, because no Due task is yet scheduled.
            pop_task_from_duequeue(due_Q, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing yet')
            
            # Check for result
            with db_cursor(conn) as db:
                job = read_job(db, job_id)
                self.assertEqual(job.status, None, 'Status should be null at this early stage')

            sleep(2.1)
            
            # Now handle the later due task
            # Unclear why it's necessary to hit the due queue twice here?
            pop_task_from_duequeue(due_Q, None)
            pop_task_from_duequeue(due_Q, None)
            self.assertEqual(self.last_status_state, 'failure', 'Should be "failure" now')
            
            # Check for result
            with db_cursor(conn) as db:
                job = read_job(db, job_id)
                self.assertEqual(job.status, False, 'Status should be false after unexpected error')
            
            # Find a record of this run.
            with done_Q as db:
                db.execute('SELECT source_path, source_id, source_data FROM runs')
                ((db_source_path, db_source_id, db_source_data), ) = db.fetchall()
                self.assertEqual(db_source_path, source_path)
                self.assertEqual(db_source_id, source_id)
                self.assertTrue(de64(bytes(db_source_data)).startswith('{'))

            flush_heartbeat_queue(beat_Q)
            
            with beat_Q as db:
                recent_workers = get_recent_workers(db)
                self.assertEqual(len(recent_workers), 1)
     
    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=1))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    def test_overdue_run(self, do_work):
        ''' Test a run that succeeds past its due date.
        '''
        def returns_plausible_result(s3, run_id, source_name, content, render_preview, output_dir, mapzen_key):
            return dict(message=MAGIC_OK_MESSAGE, state=RunState({"source": "user_input.txt"}))

        do_work.side_effect = returns_plausible_result

        source = b'''{
            "coverage": { "US Census": {"geoid": "0653000", "place": "Oakland city", "state": "California"} },
            "data": "http://data.openoakland.org/sites/default/files/OakParcelsGeo2013_0.zip"
            }'''
        
        source_id, source_path = '0xDEADBEEF', 'sources/us-ca-oakland.json'
        
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)

            files = {source_path: (en64(source), source_id)}
            job_id = create_queued_job(task_Q, files, *self.fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)

            # Should do nothing, because no Due task is yet scheduled.
            pop_task_from_duequeue(due_Q, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing yet')

            sleep(2.1)
            
            # Handle the due task
            pop_task_from_duequeue(due_Q, None)
            self.assertEqual(self.last_status_state, 'failure', 'Should be "failure" now')
            
            # Check for result
            with db_cursor(conn) as db:
                job = read_job(db, job_id)
                self.assertEqual(job.status, False, 'Status should be false since it took so long')

            # The job eventually completes, but it's too late
            pop_task_from_donequeue(done_Q, None)
            self.assertEqual(self.last_status_state, 'failure', 'Should be unchanged')
            
            # Check for result
            with db_cursor(conn) as db:
                job = read_job(db, job_id)
                self.assertEqual(job.status, False, 'Status should still be false no matter what')
            
            # Find a record of this run.
            with done_Q as db:
                db.execute('SELECT source_path, source_id, source_data, is_merged FROM runs')
                ((db_source_path, db_source_id, db_source_data, is_merged), ) = db.fetchall()
                self.assertEqual(db_source_path, source_path)
                self.assertEqual(db_source_id, source_id)
                self.assertTrue(de64(bytes(db_source_data)).startswith('{'))
                self.assertTrue(is_merged)

            flush_heartbeat_queue(beat_Q)
            
            with beat_Q as db:
                recent_workers = get_recent_workers(db)
                self.assertEqual(len(recent_workers), 1)
     
    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=1))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('subprocess.check_output')
    def test_timeout_logging_run(self, check_output):
        ''' Test a run that times out after producing logging output.
        '''
        def takes_a_long_time(cmd, timeout, stderr):
            with open(cmd[2], 'w') as file:
                file.write('Took too long.\n')
            raise subprocess.TimeoutExpired(cmd, timeout, 'Took too long')

        check_output.side_effect = takes_a_long_time

        source = b'''{
            "coverage": { "US Census": {"geoid": "0653000", "place": "Oakland city", "state": "California"} },
            "data": "http://data.openoakland.org/sites/default/files/OakParcelsGeo2013_0.zip"
            }'''
        
        source_id, source_path = '0xDEADBEEF', 'sources/us-ca-oakland.json'
        
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)

            files = {source_path: (en64(source), source_id)}
            job_id = create_queued_job(task_Q, files, *self.fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)

            # The job eventually completes, but it's too late
            pop_task_from_donequeue(done_Q, None)
            self.assertEqual(self.last_status_state, 'failure', 'Should have failed')
            
            # Find a record of this run.
            with done_Q as db:
                db.execute('SELECT state FROM runs')
                ((state, ), ) = db.fetchall()
            
            # Look for log file message in output.
            self.assertIn(b'Took too long.', self.s3._read_fake_key(urlparse(state['output']).path[len('/fake-bucket'):]))

    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=1))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('subprocess.check_output')
    def test_timeout_nonlogging_run(self, check_output):
        ''' Test a run that times out without producing logging output.
        '''
        def takes_a_long_time(cmd, timeout, stderr):
            raise subprocess.TimeoutExpired(cmd, timeout, 'Took too long')

        check_output.side_effect = takes_a_long_time

        source = b'''{
            "coverage": { "US Census": {"geoid": "0653000", "place": "Oakland city", "state": "California"} },
            "data": "http://data.openoakland.org/sites/default/files/OakParcelsGeo2013_0.zip"
            }'''
        
        source_id, source_path = '0xDEADBEEF', 'sources/us-ca-oakland.json'
        
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)

            files = {source_path: (en64(source), source_id)}
            job_id = create_queued_job(task_Q, files, *self.fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)

            # The job eventually completes, but it's too late
            pop_task_from_donequeue(done_Q, None)
            self.assertEqual(self.last_status_state, 'failure', 'Should have failed')
            
            # Find a record of this run.
            with done_Q as db:
                db.execute('SELECT state FROM runs')
                ((state, ), ) = db.fetchall()
            
            # Look for log file message in output.
            self.assertNotIn('output', state)
        
        # Briefly sleep to account for an intermittent Postgres deadlock
        # between this test and test_working_run(), that is reproducible
        # only on Circle CI.
        sleep(1)

    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=1))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    def test_failing_double_run(self, do_work):
        ''' Test repeated failing run that's fast enough to take advantage of reuse.
        '''
        source = b'''{
            "coverage": { "US Census": {"geoid": "0653000", "place": "Oakland city", "state": "California"} },
            "data": "http://data.openoakland.org/sites/default/files/OakParcelsGeo2013_0.zip"
            }'''
        
        source_id, source_path = '0xDEADBEEF', 'sources/us-ca-oakland.json'
        fprint = itertools.count(1)
        
        def returns_plausible_result(s3, run_id, source_name, content, render_preview, output_dir, mapzen_key):
            return dict(message='Something went wrong', result_code=0, result_stdout='...',
                        state=RunState({"source": "user_input.txt", "fingerprint": next(fprint)}))
        
        def raises_an_error(s3, run_id, source_name, content, output_dir):
            raise Exception('Worker did not know to re-use previous run')
        
        # Do the work.
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)

            do_work.side_effect = returns_plausible_result

            files = {source_path: (en64(source), source_id)}
            create_queued_job(task_Q, files, *self.fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing yet')
            
            # Work done!
            pop_task_from_donequeue(done_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'failure', 'Should be "failure" now')
            
            # Find a record of this run.
            with done_Q as db:
                db.execute("SELECT id, copy_of, state->>'fingerprint', is_merged, source_path, source_id, source_data FROM runs")
                ((first_run_id, first_copyof, first_fprint, first_is_merged, db_source_path, db_source_id, db_source_data), ) = db.fetchall()
                self.assertEqual(db_source_path, source_path)
                self.assertEqual(db_source_id, source_id)
                self.assertTrue(de64(bytes(db_source_data)).startswith('{'))
                self.assertTrue(first_copyof is None)
                self.assertTrue(first_is_merged)
     
            do_work.side_effect = raises_an_error # won't be called anyway
            self.last_status_state = None

            create_queued_job(task_Q, files, *self.fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing still')
            
            # Work done again!
            pop_task_from_donequeue(done_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'failure', 'Should be "failure" again')
            
            # Ensure that no new run was created
            with done_Q as db:
                db.execute('SELECT count(id) FROM runs')
                (count, ) = db.fetchone()
                self.assertEqual(count, 2, 'There should have been two runs')

                db.execute('''SELECT id, copy_of, state->>'fingerprint', is_merged FROM runs
                              ORDER BY id DESC LIMIT 1''')

                ((second_run_id, second_copyof, second_fprint, second_is_merged), ) = db.fetchall()
                self.assertNotEqual(second_run_id, first_run_id, 'The two runs should be distinct')
                self.assertEqual(second_fprint, first_fprint, 'The two runs should share the same fingerprint')
                self.assertEqual(second_copyof, first_run_id, 'The second run should be a copy of the first')
                self.assertEqual(second_is_merged, first_is_merged, 'The second run should also be merged')

            self.last_status_state = None

            create_queued_job(task_Q, files, *self.fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing still')
            
            # Work done a third time!
            pop_task_from_donequeue(done_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'failure', 'Should be "failure" again')
            
            # Ensure that no new run was created
            with done_Q as db:
                db.execute('SELECT count(id) FROM runs')
                (count, ) = db.fetchone()
                self.assertEqual(count, 3, 'There should have been three runs')

                db.execute('''SELECT id, copy_of, state->>'fingerprint', is_merged FROM runs
                              ORDER BY id DESC LIMIT 1''')

                ((third_run_id, third_copyof, third_fprint, third_is_merged), ) = db.fetchall()
                self.assertNotEqual(third_run_id, first_run_id, 'The two runs should be distinct')
                self.assertEqual(third_fprint, second_fprint, 'The two runs should share the same fingerprint')
                self.assertEqual(third_copyof, first_run_id, 'The third run should be a copy of the first')
                self.assertEqual(third_is_merged, first_is_merged, 'The third run should also be merged')

            flush_heartbeat_queue(beat_Q)
            
            with beat_Q as db:
                recent_workers = get_recent_workers(db)
                self.assertEqual(len(recent_workers), 1)

    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=1))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    def test_working_double_rerun(self, do_work):
        ''' Test repeated working run that's configured to not take advantage of reuse.
        '''
        source = b'''{
            "coverage": { "US Census": {"geoid": "0653000", "place": "Oakland city", "state": "California"} },
            "data": "http://data.openoakland.org/sites/default/files/OakParcelsGeo2013_0.zip"
            }'''
        
        source_id, source_path = '0xDEADBEEF', 'sources/us-ca-oakland.json'
        fprint = itertools.count(1)
        
        def returns_plausible_result(s3, run_id, source_name, content, render_preview, output_dir, mapzen_key):
            return dict(message=MAGIC_OK_MESSAGE, state=RunState({"source": "user_input.txt", "fingerprint": next(fprint)}))
        
        fake_queued_job_args = list(self.fake_queued_job_args[:])
        fake_queued_job_args[2] = True # rerun is true
        
        # Do the work.
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)

            do_work.side_effect = returns_plausible_result

            files = {source_path: (en64(source), source_id)}
            create_queued_job(task_Q, files, *fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing yet')
            
            # Work done!
            pop_task_from_donequeue(done_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'success', 'Should be "success" now')
            
            # Find a record of this run.
            with done_Q as db:
                db.execute("SELECT id, copy_of, state->>'fingerprint', is_merged, source_path, source_id, source_data FROM runs")
                ((first_run_id, first_copyof, first_fprint, first_is_merged, db_source_path, db_source_id, db_source_data), ) = db.fetchall()
                self.assertEqual(db_source_path, source_path)
                self.assertEqual(db_source_id, source_id)
                self.assertTrue(de64(bytes(db_source_data)).startswith('{'))
                self.assertTrue(first_copyof is None)
                self.assertTrue(first_is_merged)
     
            self.last_status_state = None

            create_queued_job(task_Q, files, *fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing still')
            
            # Work done again!
            pop_task_from_donequeue(done_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'success', 'Should be "success" again')
            
            # Ensure that a new run was created
            with done_Q as db:
                db.execute('SELECT count(id) FROM runs')
                (count, ) = db.fetchone()
                self.assertEqual(count, 2, 'There should have been two runs')

                db.execute('''SELECT id, copy_of, state->>'fingerprint', is_merged FROM runs
                              ORDER BY id DESC LIMIT 1''')

                ((second_run_id, second_copyof, second_fprint, second_is_merged), ) = db.fetchall()
                self.assertNotEqual(second_run_id, first_run_id, 'The two runs should be distinct')
                self.assertNotEqual(second_fprint, first_fprint, 'The two runs should not share the same fingerprint')
                self.assertIsNone(second_copyof, 'The second run should not be a copy of the first')
                self.assertEqual(second_is_merged, first_is_merged, 'The second run should also be merged')

    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=1))
    @patch('openaddr.ci.RUN_REUSE_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    def test_slow_double_run(self, do_work):
        ''' Test repeated run that's too slow to take advantage of reuse.
        '''
        source = b'''{
            "coverage": { "US Census": {"geoid": "0653000", "place": "Oakland city", "state": "California"} },
            "data": "http://data.openoakland.org/sites/default/files/OakParcelsGeo2013_0.zip"
            }'''
        
        source_id, source_path = '0xDEADBEEF', 'sources/us-ca-oakland.json'
        fprint = itertools.count(1)
        
        def returns_plausible_result(s3, run_id, source_name, content, render_preview, output_dir, mapzen_key):
            return dict(message=MAGIC_OK_MESSAGE, result_code=0, result_stdout='...',
                        state=RunState({"source": "user_input.txt", "fingerprint": next(fprint)}))
        
        do_work.side_effect = returns_plausible_result

        # Do the work.
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)

            files = {source_path: (en64(source), source_id)}
            create_queued_job(task_Q, files, *self.fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing yet')
            
            # Work done!
            pop_task_from_donequeue(done_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'success', 'Should be "success" now')
            
            # Find a record of this run.
            with done_Q as db:
                db.execute('SELECT source_path, source_id, source_data, is_merged FROM runs')
                ((db_source_path, db_source_id, db_source_data, is_merged), ) = db.fetchall()
                self.assertEqual(db_source_path, source_path)
                self.assertEqual(db_source_id, source_id)
                self.assertTrue(de64(bytes(db_source_data)).startswith('{'))
                self.assertTrue(is_merged)
     
            self.last_status_state = None
            sleep(1.5)

            create_queued_job(task_Q, files, *self.fake_queued_job_args)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            self.assertEqual(self.last_status_state, None, 'Should be nothing still')
            
            # Work done again!
            pop_task_from_donequeue(done_Q, self.github_auth)
            self.assertEqual(self.last_status_state, 'success', 'Should be "success" again')
            
            # Verify that two runs now exist.
            with done_Q as db:
                db.execute("SELECT state->>'fingerprint' FROM runs")
                (fprint1, ), (fprint2, ) = db.fetchall()
                self.assertNotEqual(fprint1, fprint2, 'There should have been two different runs')

            flush_heartbeat_queue(beat_Q)
            
            with beat_Q as db:
                recent_workers = get_recent_workers(db)
                self.assertEqual(len(recent_workers), 1)

class TestWorker (unittest.TestCase):

    def setUp(self):
        '''
        '''
        recreate_db.recreate(DATABASE_URL)
        self.database_url = DATABASE_URL
        self.output_dir = mkdtemp(prefix='TestWorker-')
        self.s3 = FakeS3()
    
    def tearDown(self):
        '''
        '''
        rmtree(self.output_dir)
        remove(self.s3._fake_keys)
    
    def test_make_source_filename(self):
        '''
        '''
        self.assertEqual(make_source_filename(u'yo'), u'yo.txt')
        self.assertEqual(make_source_filename(u'yo-yo'), u'yo-yo.txt')
        self.assertEqual(make_source_filename(u'yo/yo'), u'yo--yo.txt')
        self.assertEqual(make_source_filename(u'yó/yó'), u'yó--yó.txt')
    
    def test_assemble_runstate(self):
        ''' Test that assemble_runstate() puts the right values in RunState.
        '''
        s3 = mock.Mock()
        s3.new_key.return_value.md5 = b'0xWHATEVER'
        s3.new_key.return_value.name = 'a-key'
        s3.new_key.return_value.bucket.name = 'a-bucket'

        input1 = {'cache': False, 'sample': False, 'processed': False, 'output': False, 'preview': False, 'slippymap': False}
        state1 = assemble_runstate(s3, input1, 'xx/f', 1, 'dir')

        self.assertEqual(state1.run_id, 1)
        self.assertEqual(state1.cache, input1['cache'])
        self.assertEqual(state1.sample, input1['sample'])
        self.assertEqual(state1.processed, input1['processed'])
        self.assertEqual(state1.output, input1['output'])
        self.assertEqual(state1.preview, input1['preview'])
        self.assertEqual(state1.slippymap, input1['slippymap'])

        input2 = {'cache': 'cache.csv', 'sample': False, 'processed': False, 'output': False, 'preview': False, 'slippymap': False}
        state2 = assemble_runstate(s3, input2, 'xx/f', 2, 'dir')

        self.assertEqual(state2.run_id, 2)
        self.assertEqual(state2.cache, 'https://s3.amazonaws.com/a-bucket/a-key')
        self.assertEqual(state2.fingerprint, '0xWHATEVER')
        self.assertEqual(state2.sample, input2['sample'])
        self.assertEqual(state2.processed, input2['processed'])
        self.assertEqual(state2.output, input2['output'])
        self.assertEqual(state2.preview, input2['preview'])
        self.assertEqual(state2.slippymap, input2['slippymap'])
        self.assertEqual(s3.new_key.mock_calls[-2], mock.call('/runs/2/cache.csv'))

        input3 = {'cache': False, 'sample': 'sample.json', 'processed': False, 'output': False, 'preview': False, 'slippymap': False}
        state3 = assemble_runstate(s3, input3, 'xx/f', 3, 'dir')

        self.assertEqual(state3.run_id, 3)
        self.assertEqual(state3.cache, input3['cache'])
        self.assertEqual(state3.sample, 'https://s3.amazonaws.com/a-bucket/a-key')
        self.assertEqual(state3.processed, input3['processed'])
        self.assertEqual(state3.output, input3['output'])
        self.assertEqual(state3.preview, input3['preview'])
        self.assertEqual(state3.slippymap, input3['slippymap'])
        self.assertEqual(s3.new_key.mock_calls[-2], mock.call('/runs/3/sample.json'))

        input4 = {'cache': False, 'sample': False, 'processed': False, 'output': 'out.txt', 'preview': False, 'slippymap': False}
        state4 = assemble_runstate(s3, input4, 'xx/f', 4, 'dir')

        self.assertEqual(state4.run_id, 4)
        self.assertEqual(state4.cache, input4['cache'])
        self.assertEqual(state4.sample, input4['sample'])
        self.assertEqual(state4.processed, input4['processed'])
        self.assertEqual(state4.output, 'https://s3.amazonaws.com/a-bucket/a-key')
        self.assertEqual(state4.preview, input4['preview'])
        self.assertEqual(state4.slippymap, input4['slippymap'])
        self.assertEqual(s3.new_key.mock_calls[-2], mock.call('/runs/4/out.txt'))

        with patch('openaddr.util.package_output') as package_output:
            package_output.return_value = 'nothing.zip'
            input5 = {'cache': False, 'sample': False, 'processed': 'data.zip', 'output': False, 'preview': False, 'slippymap': False}
            state5 = assemble_runstate(s3, input5, 'xx/f', 5, 'dir')

        self.assertEqual(state5.run_id, 5)
        self.assertEqual(state5.cache, input5['cache'])
        self.assertEqual(state5.sample, input5['sample'])
        self.assertEqual(state5.processed, 'https://s3.amazonaws.com/a-bucket/a-key')
        self.assertEqual(state5.process_hash, '0xWHATEVER')
        self.assertEqual(state5.output, input5['output'])
        self.assertEqual(state5.preview, input5['preview'])
        self.assertEqual(state5.slippymap, input5['slippymap'])
        self.assertEqual(s3.new_key.mock_calls[-2], mock.call('/runs/5/xx/f.zip'))

        input6 = {'cache': False, 'sample': False, 'processed': False, 'output': False, 'preview': 'preview.png', 'slippymap': False}
        state6 = assemble_runstate(s3, input6, 'xx/f', 6, 'dir')

        self.assertEqual(state6.run_id, 6)
        self.assertEqual(state6.cache, input6['cache'])
        self.assertEqual(state6.sample, input6['sample'])
        self.assertEqual(state6.processed, input6['processed'])
        self.assertEqual(state6.output, input6['output'])
        self.assertEqual(state6.preview, 'https://s3.amazonaws.com/a-bucket/a-key')
        self.assertEqual(state6.slippymap, input6['slippymap'])
        self.assertEqual(s3.new_key.mock_calls[-2], mock.call('/runs/6/preview.png'))

        input7 = {'cache': False, 'sample': False, 'processed': False, 'output': False, 'preview': False, 'slippymap': 'slippymap.mbtiles'}
        state7 = assemble_runstate(s3, input7, 'xx/f', 7, 'dir')

        self.assertEqual(state7.run_id, 7)
        self.assertEqual(state7.cache, input7['cache'])
        self.assertEqual(state7.sample, input7['sample'])
        self.assertEqual(state7.processed, input7['processed'])
        self.assertEqual(state7.output, input7['output'])
        self.assertEqual(state7.preview, input7['preview'])
        self.assertEqual(state7.slippymap, 'https://s3.amazonaws.com/a-bucket/a-key')
        self.assertEqual(s3.new_key.mock_calls[-2], mock.call('/runs/7/slippymap.mbtiles'))

    @patch('tempfile.mkdtemp')
    @patch('subprocess.check_output')
    def test_happy_worker(self, check_output, mkdtemp):
        '''
        '''
        def does_what_its_told(cmd, timeout, stderr):
            index_path = '{id}/out/user_input/index.json'.format(**task_data)
            index_filename = os.path.join(self.output_dir, index_path)
            index_dirname = os.path.dirname(index_filename)
            os.makedirs(index_dirname)
            
            with open(index_filename, 'w') as file:
                file.write('''[ ["skipped", "source", "cache", "sample", "website", "license", "geometry type", "address count", "version", "fingerprint", "cache time", "processed", "process time", "process hash", "output", "preview", "slippymap"], [false, "user_input.txt", "cache.zip", "sample.json", "http://example.com", "GPL", "Point", 62384, null, "6c4852b8c7b0f1c7dd9af289289fb70f", "0:00:01.345149", "out.csv", "0:00:33.808682", "dd9af289289fb70f6c4852b8c7b0f1c7", "output.txt", "preview.png", "slippymap.mbtiles"] ]''')
            
            for name in ('cache.zip', 'sample.json', 'out.csv', 'output.txt', 'preview.png', 'slippymap.mbtiles'):
                with open(os.path.join(index_dirname, name), 'w') as file:
                    file.write('Yo')
            
            return index_filename
        
        def same_tempdir_every_time(prefix, dir):
            os.mkdir(join(dir, 'work'))
            return join(dir, 'work')
        
        task_data = dict(id='0xDEADBEEF', content='{ }', name='Dead Beef', url=None)
        check_output.side_effect = does_what_its_told
        mkdtemp.side_effect = same_tempdir_every_time
        
        job_id, content = task_data['id'], task_data['content']
        result = work.do_work(self.s3, -1, u'so/exalté', content, True, self.output_dir, mapzen_key='mapzen-XXXX')
        
        self.assertEqual(check_output.mock_calls[-1][1][0], (
            'openaddr-process-one', '-l',
            os.path.join(self.output_dir, 'work/logfile.txt'),
            os.path.join(self.output_dir, u'work/so--exalté.txt'),
            os.path.join(self.output_dir, 'work/out'),
            '--render-preview',
            '--mapzen-key', 'mapzen-XXXX'
            ))
        
        self.assertEqual(check_output.mock_calls[-1][2]['timeout'],
                         JOB_TIMEOUT.seconds + JOB_TIMEOUT.days * 86400)
        
        self.assertEqual(result['message'], MAGIC_OK_MESSAGE)
        self.assertEqual(result['result_code'], 0)

        self.assertFalse(result['state'].skipped)
        self.assertTrue(result['state'].cache.endswith('/cache.zip'))
        self.assertTrue(result['state'].sample.endswith('/sample.json'))
        self.assertTrue(result['state'].output.endswith('/output.txt'))
        self.assertTrue(result['state'].preview.endswith('/preview.png'))
        self.assertTrue(result['state'].processed.endswith(u'/so/exalté.zip'))
        self.assertEqual(result['state'].website, 'http://example.com')
        self.assertEqual(result['state'].license, 'GPL')
        self.assertEqual(result['state'].run_id, -1)
        
        zip_path = urlparse(result['state'].processed).path
        zip_bytes = self.s3._read_fake_key(zip_path[len('/fake-bucket'):])
        zip_file = ZipFile(BytesIO(zip_bytes), mode='r')
        self.assertTrue(u'README.txt' in zip_file.namelist())
        self.assertTrue(u'so/exalté.csv' in zip_file.namelist())
        self.assertTrue(u'so/exalté.vrt' in zip_file.namelist())
        
        vrt_content = zip_file.open(u'so/exalté.vrt').read().decode('utf8')
        self.assertTrue(u'<OGRVRTLayer name="exalté">' in vrt_content)
        self.assertTrue(u'<SrcDataSource relativeToVRT="1">exalté.csv' in vrt_content)
        
        readme_content = zip_file.open(u'README.txt').read().decode('utf8')
        self.assertTrue(u'Website: http://example.com\n' in readme_content)
        self.assertTrue(u'License: GPL\n' in readme_content)
    
    @patch('tempfile.mkdtemp')
    @patch('subprocess.check_output')
    def test_angry_worker(self, check_output, mkdtemp):
        '''
        '''
        def raises_called_process_error(cmd, timeout, stderr):
            raise subprocess.CalledProcessError(1, cmd, 'Everything is ruined.\n')
        
        def same_tempdir_every_time(prefix, dir):
            os.mkdir(join(dir, 'work'))
            return join(dir, 'work')
        
        task_data = dict(id='0xDEADBEEF', content='{ }', name='Dead Beef', url=None)
        check_output.side_effect = raises_called_process_error
        mkdtemp.side_effect = same_tempdir_every_time
        
        job_id, content = task_data['id'], task_data['content']
        result = work.do_work(self.s3, -1, 'angry', content, True, self.output_dir, mapzen_key=None)
        
        self.assertEqual(check_output.mock_calls[-1][1][0], (
            'openaddr-process-one', '-l',
            os.path.join(self.output_dir, 'work/logfile.txt'),
            os.path.join(self.output_dir, 'work/angry.txt'),
            os.path.join(self.output_dir, 'work/out'),
            '--skip-preview'
            ))
        
        self.assertEqual(check_output.mock_calls[-1][2]['timeout'],
                         JOB_TIMEOUT.seconds + JOB_TIMEOUT.days * 86400)
        
        self.assertEqual(result['message'], 'Something went wrong in openaddr-process-one')
        self.assertEqual(result['result_stdout'], 'Everything is ruined.\n')
        self.assertEqual(result['result_code'], 1)

    @patch('tempfile.mkdtemp')
    @patch('subprocess.check_output')
    def test_skippy_worker(self, check_output, mkdtemp):
        '''
        '''
        def does_what_its_told(cmd, timeout, stderr):
            index_path = '{id}/out/user_input/index.json'.format(**task_data)
            index_filename = os.path.join(self.output_dir, index_path)
            index_dirname = os.path.dirname(index_filename)
            os.makedirs(index_dirname)
            
            with open(index_filename, 'w') as file:
                file.write('''[ ["skipped", "source", "cache", "sample", "website", "license", "geometry type", "address count", "version", "fingerprint", "cache time", "processed", "process time", "process hash", "output", "preview", "slippymap"], [true, "user_input.txt", null, null, null, null, null, null, null, null, null, null, null, null, "output.txt", null, null] ]''')
            
            with open(os.path.join(index_dirname, 'output.txt'), 'w') as file:
                file.write('Yo')
            
            return index_filename
        
        def same_tempdir_every_time(prefix, dir):
            os.mkdir(join(dir, 'work'))
            return join(dir, 'work')
        
        task_data = dict(id='0xDEADBEEF', content='{ }', name='Dead Beef', url=None)
        check_output.side_effect = does_what_its_told
        mkdtemp.side_effect = same_tempdir_every_time
        
        job_id, content = task_data['id'], task_data['content']
        result = work.do_work(self.s3, -1, u'so/exalté', content, True, self.output_dir, mapzen_key='mapzen-XXXX')
        
        self.assertEqual(check_output.mock_calls[-1][1][0], (
            'openaddr-process-one', '-l',
            os.path.join(self.output_dir, 'work/logfile.txt'),
            os.path.join(self.output_dir, u'work/so--exalté.txt'),
            os.path.join(self.output_dir, 'work/out'),
            '--render-preview',
            '--mapzen-key', 'mapzen-XXXX'
            ))
        
        self.assertEqual(check_output.mock_calls[-1][2]['timeout'],
                         JOB_TIMEOUT.seconds + JOB_TIMEOUT.days * 86400)
        
        self.assertEqual(result['message'], MAGIC_OK_MESSAGE)
        self.assertEqual(result['result_code'], 0)

        self.assertTrue(result['state'].skipped)
        self.assertIsNone(result['state'].cache)
        self.assertIsNone(result['state'].sample)
        self.assertIsNone(result['state'].license)
        self.assertIsNone(result['state'].processed)
        self.assertEqual(result['state'].run_id, -1)

class TestBatch (unittest.TestCase):

    def setUp(self):
        '''
        '''
        os.environ['GITHUB_TOKEN'] = ''
        os.environ['DATABASE_URL'] = DATABASE_URL
        os.environ['WEBHOOK_SECRETS'] = 'hello,world'
        os.environ['AWS_ACCESS_KEY_ID'] = '12345'
        os.environ['AWS_SECRET_ACCESS_KEY'] = '67890'
        
        config = load_config()

        recreate_db.recreate(config['DATABASE_URL'])
        self.s3 = FakeS3()

        self.output_dir = mkdtemp(prefix='TestBatch-')
        self.database_url = config['DATABASE_URL']
        self.github_auth = config['GITHUB_AUTH']
        
        self.request_index = 0
    
    def tearDown(self):
        '''
        '''
        del os.environ['GITHUB_TOKEN']
        del os.environ['DATABASE_URL']
        del os.environ['WEBHOOK_SECRETS']
        del os.environ['AWS_ACCESS_KEY_ID']
        del os.environ['AWS_SECRET_ACCESS_KEY']

        rmtree(self.output_dir)
        remove(self.s3._fake_keys)
    
    def response_content(self, url, request):
        '''
        '''
        self.request_index += 1
        
        query = dict(parse_qsl(url.query))
        MHP = request.method, url.hostname, url.path
        GH, response_headers = 'api.github.com', {'Content-Type': 'application/json; charset=utf-8'}
        
        if url.hostname == 'fake-s3.local':
            return response(200, self.s3._read_fake_key(url.path))
        
        if url.hostname == 's3.amazonaws.com' and url.path.startswith('/fake-bucket/'):
            return response(200, self.s3._read_fake_key(url.path[len('/fake-bucket'):]))
        
        if MHP == ('GET', GH, '/'):
            data = u'''{\r  "current_user_url": "https://api.github.com/user",\r  "current_user_authorizations_html_url": "https://github.com/settings/connections/applications{/client_id}",\r  "authorizations_url": "https://api.github.com/authorizations",\r  "code_search_url": "https://api.github.com/search/code?q={query}{&page,per_page,sort,order}",\r  "emails_url": "https://api.github.com/user/emails",\r  "emojis_url": "https://api.github.com/emojis",\r  "events_url": "https://api.github.com/events",\r  "feeds_url": "https://api.github.com/feeds",\r  "following_url": "https://api.github.com/user/following{/target}",\r  "gists_url": "https://api.github.com/gists{/gist_id}",\r  "hub_url": "https://api.github.com/hub",\r  "issue_search_url": "https://api.github.com/search/issues?q={query}{&page,per_page,sort,order}",\r  "issues_url": "https://api.github.com/issues",\r  "keys_url": "https://api.github.com/user/keys",\r  "notifications_url": "https://api.github.com/notifications",\r  "organization_repositories_url": "https://api.github.com/orgs/{org}/repos{?type,page,per_page,sort}",\r  "organization_url": "https://api.github.com/orgs/{org}",\r  "public_gists_url": "https://api.github.com/gists/public",\r  "rate_limit_url": "https://api.github.com/rate_limit",\r  "repository_url": "https://api.github.com/repos/{owner}/{repo}",\r  "repository_search_url": "https://api.github.com/search/repositories?q={query}{&page,per_page,sort,order}",\r  "current_user_repositories_url": "https://api.github.com/user/repos{?type,page,per_page,sort}",\r  "starred_url": "https://api.github.com/user/starred{/owner}{/repo}",\r  "starred_gists_url": "https://api.github.com/gists/starred",\r  "team_url": "https://api.github.com/teams",\r  "user_url": "https://api.github.com/users/{user}",\r  "user_organizations_url": "https://api.github.com/user/orgs",\r  "user_repositories_url": "https://api.github.com/users/{user}/repos{?type,page,per_page,sort}",\r  "user_search_url": "https://api.github.com/search/users?q={query}{&page,per_page,sort,order}"\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources'):
            data = u'''{\r  "id": 34590951,\r  "name": "hooked-on-sources",\r  "full_name": "openaddresses/hooked-on-sources",\r  "owner": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/openaddresses",\r    "html_url": "https://github.com/openaddresses",\r    "followers_url": "https://api.github.com/users/openaddresses/followers",\r    "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r    "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r    "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r    "repos_url": "https://api.github.com/users/openaddresses/repos",\r    "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r    "type": "Organization",\r    "site_admin": false\r  },\r  "private": false,\r  "html_url": "https://github.com/openaddresses/hooked-on-sources",\r  "description": "Temporary repository for testing Github webhook features",\r  "fork": false,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources",\r  "forks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/forks",\r  "keys_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/keys{/key_id}",\r  "collaborators_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/collaborators{/collaborator}",\r  "teams_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/teams",\r  "hooks_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/hooks",\r  "issue_events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/events{/number}",\r  "events_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/events",\r  "assignees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/assignees{/user}",\r  "branches_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/branches{/branch}",\r  "tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/tags",\r  "blobs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs{/sha}",\r  "git_tags_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/tags{/sha}",\r  "git_refs_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/refs{/sha}",\r  "trees_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees{/sha}",\r  "statuses_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/statuses/{sha}",\r  "languages_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/languages",\r  "stargazers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/stargazers",\r  "contributors_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contributors",\r  "subscribers_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscribers",\r  "subscription_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/subscription",\r  "commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits{/sha}",\r  "git_commits_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits{/sha}",\r  "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/comments{/number}",\r  "issue_comment_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues/comments{/number}",\r  "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/{+path}",\r  "compare_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/{base}...{head}",\r  "merges_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/merges",\r  "archive_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/{archive_format}{/ref}",\r  "downloads_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/downloads",\r  "issues_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/issues{/number}",\r  "pulls_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/pulls{/number}",\r  "milestones_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/milestones{/number}",\r  "notifications_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/notifications{?since,all,participating}",\r  "labels_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/labels{/name}",\r  "releases_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/releases{/id}",\r  "created_at": "2015-04-25T23:56:07Z",\r  "updated_at": "2015-04-25T23:56:07Z",\r  "pushed_at": "2015-06-27T22:55:38Z",\r  "git_url": "git://github.com/openaddresses/hooked-on-sources.git",\r  "ssh_url": "git@github.com:openaddresses/hooked-on-sources.git",\r  "clone_url": "https://github.com/openaddresses/hooked-on-sources.git",\r  "svn_url": "https://github.com/openaddresses/hooked-on-sources",\r  "homepage": null,\r  "size": 230,\r  "stargazers_count": 0,\r  "watchers_count": 0,\r  "language": null,\r  "has_issues": true,\r  "has_downloads": true,\r  "has_wiki": true,\r  "has_pages": false,\r  "forks_count": 1,\r  "mirror_url": null,\r  "open_issues_count": 2,\r  "forks": 1,\r  "open_issues": 2,\r  "watchers": 0,\r  "default_branch": "master",\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/openaddresses",\r    "html_url": "https://github.com/openaddresses",\r    "followers_url": "https://api.github.com/users/openaddresses/followers",\r    "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r    "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r    "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r    "repos_url": "https://api.github.com/users/openaddresses/repos",\r    "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r    "type": "Organization",\r    "site_admin": false\r  },\r  "network_count": 1,\r  "subscribers_count": 10\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/openaddresses'):
            data = u'''{\r  "id": 16594532,\r  "name": "openaddresses",\r  "full_name": "openaddresses/openaddresses",\r  "owner": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/openaddresses",\r    "html_url": "https://github.com/openaddresses",\r    "followers_url": "https://api.github.com/users/openaddresses/followers",\r    "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r    "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r    "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r    "repos_url": "https://api.github.com/users/openaddresses/repos",\r    "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r    "type": "Organization",\r    "site_admin": false\r  },\r  "private": false,\r  "html_url": "https://github.com/openaddresses/openaddresses",\r  "description": "A repository of address data.",\r  "fork": false,\r  "url": "https://api.github.com/repos/openaddresses/openaddresses",\r  "forks_url": "https://api.github.com/repos/openaddresses/openaddresses/forks",\r  "keys_url": "https://api.github.com/repos/openaddresses/openaddresses/keys{/key_id}",\r  "collaborators_url": "https://api.github.com/repos/openaddresses/openaddresses/collaborators{/collaborator}",\r  "teams_url": "https://api.github.com/repos/openaddresses/openaddresses/teams",\r  "hooks_url": "https://api.github.com/repos/openaddresses/openaddresses/hooks",\r  "issue_events_url": "https://api.github.com/repos/openaddresses/openaddresses/issues/events{/number}",\r  "events_url": "https://api.github.com/repos/openaddresses/openaddresses/events",\r  "assignees_url": "https://api.github.com/repos/openaddresses/openaddresses/assignees{/user}",\r  "branches_url": "https://api.github.com/repos/openaddresses/openaddresses/branches{/branch}",\r  "tags_url": "https://api.github.com/repos/openaddresses/openaddresses/tags",\r  "blobs_url": "https://api.github.com/repos/openaddresses/openaddresses/git/blobs{/sha}",\r  "git_tags_url": "https://api.github.com/repos/openaddresses/openaddresses/git/tags{/sha}",\r  "git_refs_url": "https://api.github.com/repos/openaddresses/openaddresses/git/refs{/sha}",\r  "trees_url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees{/sha}",\r  "statuses_url": "https://api.github.com/repos/openaddresses/openaddresses/statuses/{sha}",\r  "languages_url": "https://api.github.com/repos/openaddresses/openaddresses/languages",\r  "stargazers_url": "https://api.github.com/repos/openaddresses/openaddresses/stargazers",\r  "contributors_url": "https://api.github.com/repos/openaddresses/openaddresses/contributors",\r  "subscribers_url": "https://api.github.com/repos/openaddresses/openaddresses/subscribers",\r  "subscription_url": "https://api.github.com/repos/openaddresses/openaddresses/subscription",\r  "commits_url": "https://api.github.com/repos/openaddresses/openaddresses/commits{/sha}",\r  "git_commits_url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits{/sha}",\r  "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/comments{/number}",\r  "issue_comment_url": "https://api.github.com/repos/openaddresses/openaddresses/issues/comments{/number}",\r  "contents_url": "https://api.github.com/repos/openaddresses/openaddresses/contents/{+path}",\r  "compare_url": "https://api.github.com/repos/openaddresses/openaddresses/compare/{base}...{head}",\r  "merges_url": "https://api.github.com/repos/openaddresses/openaddresses/merges",\r  "archive_url": "https://api.github.com/repos/openaddresses/openaddresses/{archive_format}{/ref}",\r  "downloads_url": "https://api.github.com/repos/openaddresses/openaddresses/downloads",\r  "issues_url": "https://api.github.com/repos/openaddresses/openaddresses/issues{/number}",\r  "pulls_url": "https://api.github.com/repos/openaddresses/openaddresses/pulls{/number}",\r  "milestones_url": "https://api.github.com/repos/openaddresses/openaddresses/milestones{/number}",\r  "notifications_url": "https://api.github.com/repos/openaddresses/openaddresses/notifications{?since,all,participating}",\r  "labels_url": "https://api.github.com/repos/openaddresses/openaddresses/labels{/name}",\r  "releases_url": "https://api.github.com/repos/openaddresses/openaddresses/releases{/id}",\r  "created_at": "2014-02-06T21:29:20Z",\r  "updated_at": "2015-12-27T20:49:47Z",\r  "pushed_at": "2015-12-29T19:57:58Z",\r  "git_url": "git://github.com/openaddresses/openaddresses.git",\r  "ssh_url": "git@github.com:openaddresses/openaddresses.git",\r  "clone_url": "https://github.com/openaddresses/openaddresses.git",\r  "svn_url": "https://github.com/openaddresses/openaddresses",\r  "homepage": "http://openaddresses.io/",\r  "size": 6498,\r  "stargazers_count": 362,\r  "watchers_count": 362,\r  "language": "JavaScript",\r  "has_issues": true,\r  "has_downloads": true,\r  "has_wiki": true,\r  "has_pages": false,\r  "forks_count": 490,\r  "mirror_url": null,\r  "open_issues_count": 144,\r  "forks": 490,\r  "open_issues": 144,\r  "watchers": 362,\r  "default_branch": "master",\r  "organization": {\r    "login": "openaddresses",\r    "id": 6895392,\r    "avatar_url": "https://avatars.githubusercontent.com/u/6895392?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/openaddresses",\r    "html_url": "https://github.com/openaddresses",\r    "followers_url": "https://api.github.com/users/openaddresses/followers",\r    "following_url": "https://api.github.com/users/openaddresses/following{/other_user}",\r    "gists_url": "https://api.github.com/users/openaddresses/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/openaddresses/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/openaddresses/subscriptions",\r    "organizations_url": "https://api.github.com/users/openaddresses/orgs",\r    "repos_url": "https://api.github.com/users/openaddresses/repos",\r    "events_url": "https://api.github.com/users/openaddresses/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/openaddresses/received_events",\r    "type": "Organization",\r    "site_admin": false\r  },\r  "network_count": 490,\r  "subscribers_count": 45\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/commits/master'):
            data = u'''{\r  "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r  "commit": {\r    "author": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "date": "2015-06-27T22:55:38Z"\r    },\r    "committer": {\r      "name": "migurski",\r      "email": "mike-github@teczno.com",\r      "date": "2015-06-27T22:55:38Z"\r    },\r    "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r    "tree": {\r      "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r    "comment_count": 0\r  },\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r  "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r  "author": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  },\r  "committer": {\r    "login": "migurski",\r    "id": 58730,\r    "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r    "gravatar_id": "",\r    "url": "https://api.github.com/users/migurski",\r    "html_url": "https://github.com/migurski",\r    "followers_url": "https://api.github.com/users/migurski/followers",\r    "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r    "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r    "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r    "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r    "organizations_url": "https://api.github.com/users/migurski/orgs",\r    "repos_url": "https://api.github.com/users/migurski/repos",\r    "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r    "received_events_url": "https://api.github.com/users/migurski/received_events",\r    "type": "User",\r    "site_admin": false\r  },\r  "parents": [\r    {\r      "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r    },\r    {\r      "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r      "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add"\r    }\r  ],\r  "stats": {\r    "total": 23,\r    "additions": 23,\r    "deletions": 0\r  },\r  "files": [\r    {\r      "sha": "a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r      "filename": "sources/fr/la-réunion.json",\r      "status": "added",\r      "additions": 23,\r      "deletions": 0,\r      "changes": 23,\r      "blob_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r      "raw_url": "https://github.com/openaddresses/hooked-on-sources/raw/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r      "contents_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "patch": "@@ -0,0 +1,23 @@\\n+{\\n+    \\"coverage\\": {\\n+        \\"ISO 3166\\": {\\n+            \\"alpha2\\": \\"FR-974\\"\\n+        }\\n+    },\\n+    \\"website\\": \\"http://adresse.data.gouv.fr/download/\\",\\n+    \\"note\\": \\"Downloaded and cached 2015-06-18\\",\\n+    \\"data\\": \\"http://data.openaddresses.io/cache/fr/BAN_licence_gratuite_repartage_974.zip\\",\\n+    \\"type\\": \\"http\\",\\n+    \\"compression\\": \\"zip\\",\\n+    \\"conform\\": {\\n+        \\"type\\": \\"csv\\",\\n+        \\"csvsplit\\": \\";\\",\\n+        \\"number\\": \\"numero\\",\\n+        \\"street\\": \\"nom_voie\\",\\n+        \\"lon\\": \\"lon\\",\\n+        \\"lat\\": \\"lat\\",\\n+        \\"city\\": \\"nom_commune\\",\\n+        \\"postcode\\": \\"code_post\\",\\n+        \\"encoding\\": \\"ISO-8859-1\\"\\n+    }\\n+}\\n\\\\ No newline at end of file"\r    }\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources') and query.get('ref', '').startswith('8dd262'):
            data = u'''[\r  {\r    "name": "fr",\r    "path": "sources/fr",\r    "sha": "6dbcdcdb66c96a597e6a9c0cd8becd50697a1455",\r    "size": 0,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/tree/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr",\r    "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/6dbcdcdb66c96a597e6a9c0cd8becd50697a1455",\r    "download_url": null,\r    "type": "dir",\r    "_links": {\r      "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/6dbcdcdb66c96a597e6a9c0cd8becd50697a1455",\r      "html": "https://github.com/openaddresses/hooked-on-sources/tree/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr"\r    }\r  },\r  {\r    "name": "us-ca-alameda_county.json",\r    "path": "sources/us-ca-alameda_county.json",\r    "sha": "c9cd0ed30256ae64d5924b03b0423346501b92d8",\r    "size": 745,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-alameda_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-alameda_county.json",\r    "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r    "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-alameda_county.json",\r    "type": "file",\r    "_links": {\r      "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-alameda_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r      "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-alameda_county.json"\r    }\r  },\r  {\r    "name": "us-ca-berkeley.json",\r    "path": "sources/us-ca-berkeley.json",\r    "sha": "16464c39b59b5a09c6526da3afa9a5f57caabcad",\r    "size": 779,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-berkeley.json",\r    "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/16464c39b59b5a09c6526da3afa9a5f57caabcad",\r    "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-berkeley.json",\r    "type": "file",\r    "_links": {\r      "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/16464c39b59b5a09c6526da3afa9a5f57caabcad",\r      "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-berkeley.json"\r    }\r  },\r  {\r    "name": "us-ca-contra_costa_county.json",\r    "path": "sources/us-ca-contra_costa_county.json",\r    "sha": "8010fecfae4eac9187e9e6a5c8f7dfcb2534e17c",\r    "size": 902,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-contra_costa_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json",\r    "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/8010fecfae4eac9187e9e6a5c8f7dfcb2534e17c",\r    "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json",\r    "type": "file",\r    "_links": {\r      "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-contra_costa_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/8010fecfae4eac9187e9e6a5c8f7dfcb2534e17c",\r      "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json"\r    }\r  },\r  {\r    "name": "us-ca-nevada_county.json",\r    "path": "sources/us-ca-nevada_county.json",\r    "sha": "2dc45c5b21b9149d16b47142ee06d5238be8bfd9",\r    "size": 659,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json",\r    "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/2dc45c5b21b9149d16b47142ee06d5238be8bfd9",\r    "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json",\r    "type": "file",\r    "_links": {\r      "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/2dc45c5b21b9149d16b47142ee06d5238be8bfd9",\r      "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json"\r    }\r  },\r  {\r    "name": "us-ca-san_francisco.json",\r    "path": "sources/us-ca-san_francisco.json",\r    "sha": "cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r    "size": 519,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-san_francisco.json",\r    "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r    "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-san_francisco.json",\r    "type": "file",\r    "_links": {\r      "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r      "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-san_francisco.json"\r    }\r  }\r]'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/fr') and query.get('ref', '').startswith('8dd262'):
            data = u'''[\r  {\r    "name": "la-réunion.json",\r    "path": "sources/fr/la-réunion.json",\r    "sha": "a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r    "size": 603,\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r    "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r    "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r    "type": "file",\r    "_links": {\r      "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r      "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r      "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json"\r    }\r  }\r]'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-contra_costa_county.json') and query.get('ref', '').startswith('8dd262'):
            data = u'''{\r  "name": "us-ca-contra_costa_county.json",\r  "path": "sources/us-ca-contra_costa_county.json",\r  "sha": "8010fecfae4eac9187e9e6a5c8f7dfcb2534e17c",\r  "size": 902,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-contra_costa_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/8010fecfae4eac9187e9e6a5c8f7dfcb2534e17c",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAgICJnZW9pZCI6ICIwNjAxMyIsCiAgICAgICAgICAgICJuYW1l\\nIjogIkNvbnRyYSBDb3N0YSBDb3VudHkiLAogICAgICAgICAgICAic3RhdGUi\\nOiAiQ2FsaWZvcm5pYSIKICAgICAgICB9LAogICAgICAgICJjb3VudHJ5Ijog\\nInVzIiwKICAgICAgICAic3RhdGUiOiAiY2EiLAogICAgICAgICJjb3VudHki\\nOiAiQ29udHJhIENvc3RhIgogICAgfSwKICAgICJkYXRhIjogImh0dHA6Ly93\\nd3cuY2NtYXAudXMvZG93bmxvYWQvbWFpbi5hc3A/aWRQcm9kdWN0PTEzNDQ5\\nMiIsCiAgICAid2Vic2l0ZSI6ICJodHRwOi8vd3d3LmNjbWFwLnVzL2NhdGFs\\nb2cuYXNwP1VzZXJDaG9pY2U9MSZMYXllcmNudHJsPTAwMDAwMDAwMDAwMDAw\\nMDAwMDAwMDAjMSIsCiAgICAibGljZW5zZSI6ICJodHRwOi8vd3d3LmNjbWFw\\nLnVzL2luZm9ybWF0aW9uLmFzcCIsCiAgICAiYXR0cmlidXRpb24iOiAiQ29u\\ndHJhIENvc3RhIENvdW50eSIsCiAgICAidHlwZSI6ICJodHRwIiwKICAgICJj\\nb21wcmVzc2lvbiI6ICJ6aXAiLAogICAgInllYXIiOiAiMjAxNCIsCiAgICAi\\nbm90ZSI6ICJEZXRhaWxzIGZvciB0aGUgZGF0YXNldCAoZWcsIHByb2plY3Rp\\nb24pIGNhbiBiZSBmb3VuZCBoZXJlIGh0dHA6Ly93d3cuY2NtYXAudXMvRGV0\\nYWlscy5hc3A/UHJvZHVjdD0xMzQ0OTIiLAogICAgImNvbmZvcm0iOiB7CiAg\\nICAgICAgImxvbiI6ICJ4IiwKICAgICAgICAibGF0IjogInkiLAogICAgICAg\\nICJudW1iZXIiOiAiU19TVFJfTkJSIiwKICAgICAgICAibWVyZ2UiOiBbIlNf\\nU1RSX05NIiwgIlNfU1RSX1NVRiJdLAogICAgICAgICJzdHJlZXQiOiAiYXV0\\nb19zdHJlZXQiLAogICAgICAgICJ0eXBlIjogInNoYXBlZmlsZSIKICAgIH0K\\nfQo=\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-contra_costa_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/8010fecfae4eac9187e9e6a5c8f7dfcb2534e17c",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-contra_costa_county.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json') and query.get('ref', '').startswith('8dd262'):
            data = u'''{\r  "name": "us-ca-berkeley.json",\r  "path": "sources/us-ca-berkeley.json",\r  "sha": "16464c39b59b5a09c6526da3afa9a5f57caabcad",\r  "size": 779,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-berkeley.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/16464c39b59b5a09c6526da3afa9a5f57caabcad",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-berkeley.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAgICJnZW9pZCI6ICIwNjA2MDAwIiwKICAgICAgICAgICAgInBs\\nYWNlIjogIkJlcmtlbGV5IiwKICAgICAgICAgICAgInN0YXRlIjogIkNhbGlm\\nb3JuaWEiCiAgICAgICAgfSwKICAgICAgICAiY291bnRyeSI6ICJ1cyIsCiAg\\nICAgICAgInN0YXRlIjogImNhIiwKICAgICAgICAicGxhY2UiOiAiQmVya2Vs\\nZXkiCiAgICB9LAogICAgImF0dHJpYnV0aW9uIjogIkNpdHkgb2YgQmVya2Vs\\nZXkiLAogICAgImRhdGEiOiAiaHR0cDovL3d3dy5jaS5iZXJrZWxleS5jYS51\\ncy91cGxvYWRlZEZpbGVzL0lUL0dJUy9QYXJjZWxzLnppcCIsCiAgICAid2Vi\\nc2l0ZSI6ICJodHRwOi8vd3d3LmNpLmJlcmtlbGV5LmNhLnVzL2RhdGFjYXRh\\nbG9nLyIsCiAgICAidHlwZSI6ICJodHRwIiwKICAgICJjb21wcmVzc2lvbiI6\\nICJ6aXAiLAogICAgIm5vdGUiOiAiTWV0YWRhdGEgYXQgaHR0cDovL3d3dy5j\\naS5iZXJrZWxleS5jYS51cy91cGxvYWRlZEZpbGVzL0lUL0dJUy9QYXJjZWxz\\nLnNocCgxKS54bWwiLAogICAgImNvbmZvcm0iOiB7CiAgICAgICAgImxvbiI6\\nICJ4IiwKICAgICAgICAibGF0IjogInkiLAogICAgICAgICJudW1iZXIiOiAi\\nU3RyZWV0TnVtIiwKICAgICAgICAibWVyZ2UiOiBbIlN0cmVldE5hbWUiLCAi\\nU3RyZWV0U3VmeCIsICJEaXJlY3Rpb24iXSwKICAgICAgICAic3RyZWV0Ijog\\nImF1dG9fc3RyZWV0IiwKICAgICAgICAidHlwZSI6ICJzaGFwZWZpbGUtcG9s\\neWdvbiIKICAgIH0KfQo=\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-berkeley.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/16464c39b59b5a09c6526da3afa9a5f57caabcad",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-berkeley.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-alameda_county.json') and query.get('ref', '').startswith('8dd262'):
            if self.request_index % 2:
                raise ConnectionError('Something-or-other went wrong')
        
            data = u'''{\r  "name": "us-ca-alameda_county.json",\r  "path": "sources/us-ca-alameda_county.json",\r  "sha": "c9cd0ed30256ae64d5924b03b0423346501b92d8",\r  "size": 745,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-alameda_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-alameda_county.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-alameda_county.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAgICJnZW9pZCI6ICIwNjAwMSIsCiAgICAgICAgICAgICJuYW1l\\nIjogIkFsYW1lZGEgQ291bnR5IiwKICAgICAgICAgICAgInN0YXRlIjogIkNh\\nbGlmb3JuaWEiCiAgICAgICAgfSwKICAgICAgICAiY291bnRyeSI6ICJ1cyIs\\nCiAgICAgICAgInN0YXRlIjogImNhIiwKICAgICAgICAiY291bnR5IjogIkFs\\nYW1lZGEiCiAgICB9LAogICAgImRhdGEiOiAiaHR0cHM6Ly9kYXRhLmFjZ292\\nLm9yZy9hcGkvZ2Vvc3BhdGlhbC84ZTRzLTdmNHY/bWV0aG9kPWV4cG9ydCZm\\nb3JtYXQ9T3JpZ2luYWwiLAogICAgImxpY2Vuc2UiOiAiaHR0cDovL3d3dy5h\\nY2dvdi5vcmcvYWNkYXRhL3Rlcm1zLmh0bSIsCiAgICAiYXR0cmlidXRpb24i\\nOiAiQWxhbWVkYSBDb3VudHkiLAogICAgInllYXIiOiAiIiwKICAgICJ0eXBl\\nIjogImh0dHAiLAogICAgImNvbXByZXNzaW9uIjogInppcCIsCiAgICAiY29u\\nZm9ybSI6IHsKICAgICAgICAibWVyZ2UiOiBbCiAgICAgICAgICAgICJmZWFu\\nbWUiLAogICAgICAgICAgICAiZmVhdHlwIgogICAgICAgIF0sCiAgICAgICAg\\nImxvbiI6ICJ4IiwKICAgICAgICAibGF0IjogInkiLAogICAgICAgICJudW1i\\nZXIiOiAic3RfbnVtIiwKICAgICAgICAic3RyZWV0IjogImF1dG9fc3RyZWV0\\nIiwKICAgICAgICAidHlwZSI6ICJzaGFwZWZpbGUiLAogICAgICAgICJwb3N0\\nY29kZSI6ICJ6aXBjb2RlIgogICAgfQp9Cg==\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-alameda_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/c9cd0ed30256ae64d5924b03b0423346501b92d8",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-alameda_county.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json') and query.get('ref', '').startswith('8dd262'):
            if self.request_index % 2:
                raise ConnectionError('Something-or-other went wrong')
        
            data = u'''{\r  "name": "la-réunion.json",\r  "path": "sources/fr/la-réunion.json",\r  "sha": "a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r  "size": 603,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJJU08gMzE2NiI6IHsKICAg\\nICAgICAgICAgImFscGhhMiI6ICJGUi05NzQiCiAgICAgICAgfQogICAgfSwK\\nICAgICJ3ZWJzaXRlIjogImh0dHA6Ly9hZHJlc3NlLmRhdGEuZ291di5mci9k\\nb3dubG9hZC8iLAogICAgIm5vdGUiOiAiRG93bmxvYWRlZCBhbmQgY2FjaGVk\\nIDIwMTUtMDYtMTgiLAogICAgImRhdGEiOiAiaHR0cDovL2RhdGEub3BlbmFk\\nZHJlc3Nlcy5pby9jYWNoZS9mci9CQU5fbGljZW5jZV9ncmF0dWl0ZV9yZXBh\\ncnRhZ2VfOTc0LnppcCIsCiAgICAidHlwZSI6ICJodHRwIiwKICAgICJjb21w\\ncmVzc2lvbiI6ICJ6aXAiLAogICAgImNvbmZvcm0iOiB7CiAgICAgICAgInR5\\ncGUiOiAiY3N2IiwKICAgICAgICAiY3N2c3BsaXQiOiAiOyIsCiAgICAgICAg\\nIm51bWJlciI6ICJudW1lcm8iLAogICAgICAgICJzdHJlZXQiOiAibm9tX3Zv\\naWUiLAogICAgICAgICJsb24iOiAibG9uIiwKICAgICAgICAibGF0IjogImxh\\ndCIsCiAgICAgICAgImNpdHkiOiAibm9tX2NvbW11bmUiLAogICAgICAgICJw\\nb3N0Y29kZSI6ICJjb2RlX3Bvc3QiLAogICAgICAgICJlbmNvZGluZyI6ICJJ\\nU08tODg1OS0xIgogICAgfQp9\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/fr/la-r%C3%A9union.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/a8ccd9b403c39e9e9150470cb6b0d4c6515f82a9",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/fr/la-r%C3%A9union.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json') and query.get('ref', '').startswith('8dd262'):
            if self.request_index % 2:
                raise ConnectionError('Something-or-other went wrong')
        
            data = u'''{\r  "name": "us-ca-san_francisco.json",\r  "path": "sources/us-ca-san_francisco.json",\r  "sha": "cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r  "size": 519,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-san_francisco.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-san_francisco.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJjb3VudHJ5IjogInVzIiwK\\nICAgICAgICAic3RhdGUiOiAiY2EiLAogICAgICAgICJjaXR5IjogIlNhbiBG\\ncmFuY2lzY28iCiAgICB9LAogICAgImF0dHJpYnV0aW9uIjogIkNpdHkgb2Yg\\nU2FuIEZyYW5jaXNjbyIsCiAgICAiZGF0YSI6ICJodHRwczovL2RhdGEuc2Zn\\nb3Yub3JnL2Rvd25sb2FkL2t2ZWotdzVrYi9aSVBQRUQlMjBTSEFQRUZJTEUi\\nLAogICAgImxpY2Vuc2UiOiAiIiwKICAgICJ5ZWFyIjogIiIsCiAgICAidHlw\\nZSI6ICJodHRwIiwKICAgICJjb21wcmVzc2lvbiI6ICJ6aXAiLAogICAgImNv\\nbmZvcm0iOiB7Cgkic3BsaXQiOiAiQUREUkVTUyIsCiAgICAgICAgImxvbiI6\\nICJ4IiwKICAgICAgICAibGF0IjogInkiLAogICAgICAgICJudW1iZXIiOiAi\\nYXV0b19udW1iZXIiLAogICAgICAgICJzdHJlZXQiOiAiYXV0b19zdHJlZXQi\\nLAogICAgICAgICJ0eXBlIjogInNoYXBlZmlsZSIsCiAgICAgICAgInBvc3Rj\\nb2RlIjogInppcGNvZGUiCiAgICB9Cn0K\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-san_francisco.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/cbf1f900ac072b6a2e728819a97e74bc772e79ff",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-san_francisco.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json') and query.get('ref', '').startswith('8dd262'):
            if self.request_index % 2:
                raise ConnectionError('Something-or-other went wrong')
        
            data = u'''{\r  "name": "us-ca-nevada_county.json",\r  "path": "sources/us-ca-nevada_county.json",\r  "sha": "2dc45c5b21b9149d16b47142ee06d5238be8bfd9",\r  "size": 659,\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json",\r  "git_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/2dc45c5b21b9149d16b47142ee06d5238be8bfd9",\r  "download_url": "https://raw.githubusercontent.com/openaddresses/hooked-on-sources/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json",\r  "type": "file",\r  "content": "ewogICAgImNvdmVyYWdlIjogewogICAgICAgICJVUyBDZW5zdXMiOiB7CiAg\\nICAgICAgICAgICJnZW9pZCI6ICIwNjA1NyIsCiAgICAgICAgICAgICJuYW1l\\nIjogIk5ldmFkYSBDb3VudHkiLAogICAgICAgICAgICAic3RhdGUiOiAiQ2Fs\\naWZvcm5pYSIKICAgICAgICB9LAogICAgICAgICJjb3VudHJ5IjogInVzIiwK\\nICAgICAgICAic3RhdGUiOiAiY2EiLAogICAgICAgICJjb3VudHkiOiAiTmV2\\nYWRhIgogICAgfSwKICAgICJhdHRyaWJ1dGlvbiI6ICJOZXZhZGEgQ291bnR5\\nIiwKICAgICJkYXRhIjogImh0dHA6Ly93d3cubXluZXZhZGFjb3VudHkuY29t\\nL25jL2lncy9naXMvZG9jcy9EaWdpdGFsJTIwRGF0YSUyMExpYnJhcnkvQWRk\\ncmVzc1BvaW50LnppcCIsCiAgICAid2Vic2l0ZSI6ICJodHRwOi8vd3d3Lm15\\nbmV2YWRhY291bnR5LmNvbS9uYy9pZ3MvZ2lzL1BhZ2VzL01ldGFEYXRhLmFz\\ncHgiLAogICAgInR5cGUiOiAiaHR0cCIsCiAgICAiY29tcHJlc3Npb24iOiAi\\nemlwIiwKICAgICJjb25mb3JtIjogewogICAgICAgICJsb24iOiAieCIsCiAg\\nICAgICAgImxhdCI6ICJ5IiwKICAgICAgICAibnVtYmVyIjogInN0cmVldE51\\nbSIsCiAgICAgICAgInN0cmVldCI6ICJzdHJlZXROYW1lIiwKICAgICAgICAi\\ndHlwZSI6ICJzaGFwZWZpbGUiCiAgICB9Cn0KCgo=\\n",\r  "encoding": "base64",\r  "_links": {\r    "self": "https://api.github.com/repos/openaddresses/hooked-on-sources/contents/sources/us-ca-nevada_county.json?ref=8dd262c2f30a70b27e371869c54315b1abc32247",\r    "git": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/blobs/2dc45c5b21b9149d16b47142ee06d5238be8bfd9",\r    "html": "https://github.com/openaddresses/hooked-on-sources/blob/8dd262c2f30a70b27e371869c54315b1abc32247/sources/us-ca-nevada_county.json"\r  }\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/hooked-on-sources/compare/8dd262c2f30a70b27e371869c54315b1abc32247...master'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/compare/8dd262c2f30a70b27e371869c54315b1abc32247...master",\r  "html_url": "https://github.com/openaddresses/hooked-on-sources/compare/8dd262c2f30a70b27e371869c54315b1abc32247...master",\r  "permalink_url": "https://github.com/openaddresses/hooked-on-sources/compare/openaddresses:8dd262c...openaddresses:8dd262c",\r  "diff_url": "https://github.com/openaddresses/hooked-on-sources/compare/8dd262c2f30a70b27e371869c54315b1abc32247...master.diff",\r  "patch_url": "https://github.com/openaddresses/hooked-on-sources/compare/8dd262c2f30a70b27e371869c54315b1abc32247...master.patch",\r  "base_commit": {\r    "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r    "commit": {\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-06-27T22:55:38Z"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-06-27T22:55:38Z"\r      },\r      "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r      },\r      {\r        "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "8dd262c2f30a70b27e371869c54315b1abc32247",\r    "commit": {\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-06-27T22:55:38Z"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-06-27T22:55:38Z"\r      },\r      "message": "Merge pull request #4 from migurski/master\\n\\nAdded La Réunion",\r      "tree": {\r        "sha": "55f5da58da7b14f02da8f1214fd72d1bc8f02ba3",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/trees/55f5da58da7b14f02da8f1214fd72d1bc8f02ba3"\r      },\r      "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/git/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247",\r    "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/8dd262c2f30a70b27e371869c54315b1abc32247",\r    "comments_url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/8dd262c2f30a70b27e371869c54315b1abc32247/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "c3c7de37f96d38534dc6297a2483c218994241b6",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/c3c7de37f96d38534dc6297a2483c218994241b6",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/c3c7de37f96d38534dc6297a2483c218994241b6"\r      },\r      {\r        "sha": "6460668909a85d9db8df871d91e9b25bc5192add",\r        "url": "https://api.github.com/repos/openaddresses/hooked-on-sources/commits/6460668909a85d9db8df871d91e9b25bc5192add",\r        "html_url": "https://github.com/openaddresses/hooked-on-sources/commit/6460668909a85d9db8df871d91e9b25bc5192add"\r      }\r    ]\r  },\r  "status": "identical",\r  "ahead_by": 0,\r  "behind_by": 0,\r  "total_commits": 0,\r  "commits": [\r\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/openaddresses/compare/e38df23...master'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/openaddresses/compare/e38df23...master",\r  "html_url": "https://github.com/openaddresses/openaddresses/compare/e38df23...master",\r  "permalink_url": "https://github.com/openaddresses/openaddresses/compare/openaddresses:e38df23...openaddresses:01d394f",\r  "diff_url": "https://github.com/openaddresses/openaddresses/compare/e38df23...master.diff",\r  "patch_url": "https://github.com/openaddresses/openaddresses/compare/e38df23...master.patch",\r  "base_commit": {\r    "sha": "e38df23ad1a316b70ee9d2d0ee59ad47390cfb8b",\r    "commit": {\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-12-28T17:15:50Z"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-12-28T17:15:50Z"\r      },\r      "message": "Moved Canberra to ESRI hosting",\r      "tree": {\r        "sha": "5ccf79066a45fbea145cc4ce4fe0447924212414",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees/5ccf79066a45fbea145cc4ce4fe0447924212414"\r      },\r      "url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits/e38df23ad1a316b70ee9d2d0ee59ad47390cfb8b",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/e38df23ad1a316b70ee9d2d0ee59ad47390cfb8b",\r    "html_url": "https://github.com/openaddresses/openaddresses/commit/e38df23ad1a316b70ee9d2d0ee59ad47390cfb8b",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/commits/e38df23ad1a316b70ee9d2d0ee59ad47390cfb8b/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/01d394fa1049da1ed889acb3c645cbb9d9c7f228"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r    "commit": {\r      "author": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-12-27T21:49:29Z"\r      },\r      "committer": {\r        "name": "migurski",\r        "email": "mike-github@teczno.com",\r        "date": "2015-12-27T21:49:29Z"\r      },\r      "message": "Merge pull request #1494 from openaddresses/fix-some-conforms\\n\\nFixed some conforms",\r      "tree": {\r        "sha": "0d57a16fc7dd61481443082f40b8cc4bc879e288",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees/0d57a16fc7dd61481443082f40b8cc4bc879e288"\r      },\r      "url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits/01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r    "html_url": "https://github.com/openaddresses/openaddresses/commit/01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/commits/01d394fa1049da1ed889acb3c645cbb9d9c7f228/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "8ca86315dfb9f695dde0c19f95c97dee1d044523",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/8ca86315dfb9f695dde0c19f95c97dee1d044523",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/8ca86315dfb9f695dde0c19f95c97dee1d044523"\r      },\r      {\r        "sha": "a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/a7266f30ed85a0ed6ea2372d40992e0c9b49310b"\r      }\r    ]\r  },\r  "status": "behind",\r  "ahead_by": 0,\r  "behind_by": 1,\r  "total_commits": 0,\r  "commits": [\r\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/openaddresses/compare/a7266f30...master'):
            data = u'''{\r  "url": "https://api.github.com/repos/openaddresses/openaddresses/compare/a7266f30...master",\r  "html_url": "https://github.com/openaddresses/openaddresses/compare/a7266f30...master",\r  "permalink_url": "https://github.com/openaddresses/openaddresses/compare/openaddresses:a7266f3...openaddresses:01d394f",\r  "diff_url": "https://github.com/openaddresses/openaddresses/compare/a7266f30...master.diff",\r  "patch_url": "https://github.com/openaddresses/openaddresses/compare/a7266f30...master.patch",\r  "base_commit": {\r    "sha": "a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-12-27T21:41:10Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-12-27T21:45:26Z"\r      },\r      "message": "Tweaked conform tests",\r      "tree": {\r        "sha": "0d57a16fc7dd61481443082f40b8cc4bc879e288",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees/0d57a16fc7dd61481443082f40b8cc4bc879e288"\r      },\r      "url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits/a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r    "html_url": "https://github.com/openaddresses/openaddresses/commit/a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/commits/a7266f30ed85a0ed6ea2372d40992e0c9b49310b/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "9bba7a057f7a3600ae35142be1b561615654f7a1",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/9bba7a057f7a3600ae35142be1b561615654f7a1",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/9bba7a057f7a3600ae35142be1b561615654f7a1"\r      }\r    ]\r  },\r  "merge_base_commit": {\r    "sha": "a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r    "commit": {\r      "author": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-12-27T21:41:10Z"\r      },\r      "committer": {\r        "name": "Michal Migurski",\r        "email": "mike@teczno.com",\r        "date": "2015-12-27T21:45:26Z"\r      },\r      "message": "Tweaked conform tests",\r      "tree": {\r        "sha": "0d57a16fc7dd61481443082f40b8cc4bc879e288",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees/0d57a16fc7dd61481443082f40b8cc4bc879e288"\r      },\r      "url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits/a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r      "comment_count": 0\r    },\r    "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r    "html_url": "https://github.com/openaddresses/openaddresses/commit/a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r    "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/commits/a7266f30ed85a0ed6ea2372d40992e0c9b49310b/comments",\r    "author": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "committer": {\r      "login": "migurski",\r      "id": 58730,\r      "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r      "gravatar_id": "",\r      "url": "https://api.github.com/users/migurski",\r      "html_url": "https://github.com/migurski",\r      "followers_url": "https://api.github.com/users/migurski/followers",\r      "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r      "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r      "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r      "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r      "organizations_url": "https://api.github.com/users/migurski/orgs",\r      "repos_url": "https://api.github.com/users/migurski/repos",\r      "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r      "received_events_url": "https://api.github.com/users/migurski/received_events",\r      "type": "User",\r      "site_admin": false\r    },\r    "parents": [\r      {\r        "sha": "9bba7a057f7a3600ae35142be1b561615654f7a1",\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/9bba7a057f7a3600ae35142be1b561615654f7a1",\r        "html_url": "https://github.com/openaddresses/openaddresses/commit/9bba7a057f7a3600ae35142be1b561615654f7a1"\r      }\r    ]\r  },\r  "status": "ahead",\r  "ahead_by": 1,\r  "behind_by": 0,\r  "total_commits": 1,\r  "commits": [\r    {\r      "sha": "01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r      "commit": {\r        "author": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-12-27T21:49:29Z"\r        },\r        "committer": {\r          "name": "migurski",\r          "email": "mike-github@teczno.com",\r          "date": "2015-12-27T21:49:29Z"\r        },\r        "message": "Merge pull request #1494 from openaddresses/fix-some-conforms\\n\\nFixed some conforms",\r        "tree": {\r          "sha": "0d57a16fc7dd61481443082f40b8cc4bc879e288",\r          "url": "https://api.github.com/repos/openaddresses/openaddresses/git/trees/0d57a16fc7dd61481443082f40b8cc4bc879e288"\r        },\r        "url": "https://api.github.com/repos/openaddresses/openaddresses/git/commits/01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r        "comment_count": 0\r      },\r      "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r      "html_url": "https://github.com/openaddresses/openaddresses/commit/01d394fa1049da1ed889acb3c645cbb9d9c7f228",\r      "comments_url": "https://api.github.com/repos/openaddresses/openaddresses/commits/01d394fa1049da1ed889acb3c645cbb9d9c7f228/comments",\r      "author": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "committer": {\r        "login": "migurski",\r        "id": 58730,\r        "avatar_url": "https://avatars.githubusercontent.com/u/58730?v=3",\r        "gravatar_id": "",\r        "url": "https://api.github.com/users/migurski",\r        "html_url": "https://github.com/migurski",\r        "followers_url": "https://api.github.com/users/migurski/followers",\r        "following_url": "https://api.github.com/users/migurski/following{/other_user}",\r        "gists_url": "https://api.github.com/users/migurski/gists{/gist_id}",\r        "starred_url": "https://api.github.com/users/migurski/starred{/owner}{/repo}",\r        "subscriptions_url": "https://api.github.com/users/migurski/subscriptions",\r        "organizations_url": "https://api.github.com/users/migurski/orgs",\r        "repos_url": "https://api.github.com/users/migurski/repos",\r        "events_url": "https://api.github.com/users/migurski/events{/privacy}",\r        "received_events_url": "https://api.github.com/users/migurski/received_events",\r        "type": "User",\r        "site_admin": false\r      },\r      "parents": [\r        {\r          "sha": "8ca86315dfb9f695dde0c19f95c97dee1d044523",\r          "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/8ca86315dfb9f695dde0c19f95c97dee1d044523",\r          "html_url": "https://github.com/openaddresses/openaddresses/commit/8ca86315dfb9f695dde0c19f95c97dee1d044523"\r        },\r        {\r          "sha": "a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r          "url": "https://api.github.com/repos/openaddresses/openaddresses/commits/a7266f30ed85a0ed6ea2372d40992e0c9b49310b",\r          "html_url": "https://github.com/openaddresses/openaddresses/commit/a7266f30ed85a0ed6ea2372d40992e0c9b49310b"\r        }\r      ]\r    }\r  ],\r  "files": [\r\r  ]\r}'''
            return response(200, data.encode('utf8'), headers=response_headers)
        
        if MHP == ('GET', GH, '/repos/openaddresses/openaddresses/compare/gobbledygook...master'):
            data = u'''{\r  "message": "Not Found",\r  "documentation_url": "https://developer.github.com/v3/repos/commits/#compare-two-commits"\r}'''
            return response(404, data.encode('utf8'), headers=response_headers)
        
        print('Unknowable Request {} "{}"'.format(request.method, url.geturl()), file=sys.stderr)
        raise ValueError('Unknowable Request {} "{}"'.format(request.method, url.geturl()))
    
    def test_get_batch_run_times(self):
        '''
        '''
        _ = mock.Mock()
        
        with patch('openaddr.ci.objects.read_latest_set') as read_latest_set, patch('openaddr.ci.objects.read_completed_runs_to_date') as read_completed_runs_to_date:
            read_completed_runs_to_date.return_value = [
                Run(_, 'sources/foo.json', _, b'', _, RunState({'cache time': '0:00:01.0', 'process time': '0:01:00.0'}), _, _, _, _, _, _, _, _),
                Run(_, 'sources/bar.json', _, b'', _, RunState({'cache time': '0:00:01.0', 'process time': '0:00:00.0'}), _, _, _, _, _, _, _, _),
                Run(_, 'sources/baz.json', _, b'', _, RunState({'cache time': '0:00:00.0', 'process time': '0:00:01.0'}), _, _, _, _, _, _, _, _),
                Run(_, 'sources/one.json', _, b'', _, RunState({'cache time':        None, 'process time': '0:00:01.0'}), _, _, _, _, _, _, _, _),
                Run(_, 'sources/two.json', _, b'', _, RunState({'cache time': '0:00:01.0', 'process time':        None}), _, _, _, _, _, _, _, _),
                Run(_, 'sources/meh.json', _, b'', _, RunState({'cache time':        None, 'process time':        None}), _, _, _, _, _, _, _, _),
                ]

            run_times = get_batch_run_times(_, 'openaddresses', 'openaddresses')
            
            self.assertEqual(run_times['sources/foo.json'], '0:01:01')
            self.assertEqual(run_times['sources/bar.json'], '0:00:01')
            self.assertEqual(run_times['sources/baz.json'], '0:00:01')
            self.assertEqual(run_times['sources/one.json'], None)
            self.assertEqual(run_times['sources/two.json'], None)
            self.assertEqual(run_times['sources/meh.json'], None)
            self.assertEqual(len(run_times), 6)
    
    def test_is_merged_to_master(self):
        '''
        '''
        _ = mock.Mock()
        
        with patch('openaddr.ci.objects.read_set') as read_set, patch('openaddr.ci.objects.read_job') as read_job:

            read_set.return_value, read_job.return_value = None, None
            self.assertIsNone(is_merged_to_master(_, _, _, _, _), 'No merged status with missing set and job')
        
            read_set.return_value, read_job.return_value = mock.Mock(), None
            self.assertIs(is_merged_to_master(_, _, _, _, _), True, 'Merged is true for any valid set')

            read_set.return_value, read_job.return_value = mock.Mock(), mock.Mock()
            self.assertIs(is_merged_to_master(_, _, _, _, _), True, 'Merged is true for any valid set')
        
            read_set.return_value, read_job.return_value = None, mock.Mock()
            read_job.return_value.github_owner = 'openaddresses'
            read_job.return_value.github_repository = 'openaddresses'

            with HTTMock(self.response_content):
                self.assertIs(is_merged_to_master(_, _, _, 'e38df23', _), False, 'This commit is unmerged')
                self.assertIs(is_merged_to_master(_, _, _, 'a7266f30', _), True, 'This commit is merged')
                self.assertIsNone(is_merged_to_master(_, _, _, 'gobbledygook', _), 'This commit is unknown')
    
    @patch('openaddr.ci.GITHUB_RETRY_DELAY', new=timedelta(seconds=0))
    def test_batch_runs(self):
        ''' Show that the right tasks are enqueued in a batch context.
        '''
        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            owner, repository = 'openaddresses', 'hooked-on-sources'
            sources = find_batch_sources(owner, repository, self.github_auth)
            task_Q = db_queue(conn, TASK_QUEUE)

            with task_Q as db: new_set = add_set(db, owner, repository)
            enqueued = enqueue_sources(task_Q, new_set, sources)
            file_names = set()
            
            for _ in enqueued:
                # There is a task for us in the queue, get it out.
                task = task_Q.get()
                if task:
                    self.assertEqual(task.data['commit_sha'][:6], '8dd262')
                    self.assertTrue(task.data['job_id'] is None, 'There should be no job ID')
                    self.assertTrue(task.data['url'] is None, 'There should be no job URL')
                    self.assertFalse(task.data['render_preview'], 'No previews for batches')
                    file_names.add(task.data['name'])
                    with task_Q as db:
                        set_run(db, add_run(db), task.data['name'], None, None,
                                RunState(None), True, None, None, None, False, task.data['set_id'])
        
            # Find a record of the one set.
            with task_Q as db:
                db.execute('SELECT commit_sha, datetime_start, datetime_end FROM sets')
                ((commit_sha, datetime_start, datetime_end), ) = db.fetchall()
                self.assertEqual(commit_sha[:6], '8dd262')
                self.assertTrue(datetime_start is not None)
                self.assertTrue(datetime_end is not None)
        
        expected_names = set([
            u'sources/us-ca-contra_costa_county.json', u'sources/fr/la-réunion.json',
            u'sources/us-ca-berkeley.json', u'sources/us-ca-alameda_county.json',
            u'sources/us-ca-san_francisco.json', u'sources/us-ca-nevada_county.json'
            ])
        
        self.assertEqual(file_names, expected_names)
    
    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=0))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.GITHUB_RETRY_DELAY', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    def test_single_run(self, do_work):
        ''' Show that the tasks enqueued in a batch context can be run.
        '''
        def returns_plausible_result(s3, run_id, source_name, content, render_preview, output_dir, mapzen_key):
            return dict(message=MAGIC_OK_MESSAGE, state=RunState({"source": "user_input.txt"}))
        
        do_work.side_effect = returns_plausible_result

        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)
            
            owner, repository = 'openaddresses', 'hooked-on-sources'
            with task_Q as db: new_set = add_set(db, owner, repository)
            sources = find_batch_sources(owner, repository, self.github_auth)
            enqueued = enqueue_sources(task_Q, new_set, sources)

            #
            # There is a task for us in the queue, run it successfully.
            #
            next(enqueued)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            pop_task_from_donequeue(done_Q, self.github_auth)
            
            sleep(1.1)
            pop_task_from_duequeue(due_Q, self.github_auth)

            #
            # There is a task for us in the queue, make it take too long.
            #
            next(enqueued)
            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
            
            sleep(1.1)
            pop_task_from_duequeue(due_Q, self.github_auth)
            pop_task_from_donequeue(done_Q, self.github_auth)
            
            # Find a record of the two runs.
            with done_Q as db:
                db.execute('SELECT id, commit_sha, datetime_start, datetime_end FROM sets')
                ((set_id, commit_sha, datetime_start, datetime_end), ) = db.fetchall()
                self.assertIsNone(commit_sha, 'Commit SHA should not be in sets table yet')
                self.assertTrue(datetime_start is not None)
                self.assertTrue(datetime_end is None, 'Set should not have completed')

                db.execute('SELECT set_id, status, commit_sha FROM runs ORDER BY datetime_tz ASC')
                (set1, status1, commit_sha1), (set2, status2, commit_sha2) = db.fetchall()
                self.assertEqual(set1, set_id)
                self.assertEqual(set2, set_id)
                self.assertEqual(status1, True)
                self.assertEqual(status2, False)
                self.assertEqual(commit_sha1[:6], '8dd262')
                self.assertEqual(commit_sha2[:6], '8dd262')
    
    @patch('openaddr.jobs.JOB_TIMEOUT', new=timedelta(seconds=1))
    @patch('openaddr.ci.DUETASK_DELAY', new=timedelta(seconds=0))
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.GITHUB_RETRY_DELAY', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    def test_run_with_renders(self, do_work):
        ''' Show that a batch context will result in rendered maps.
        '''
        def returns_plausible_result(s3, run_id, source_name, content, render_preview, output_dir, mapzen_key):
            return dict(message=MAGIC_OK_MESSAGE, state=RunState({"source": "user_input.txt", "address count": 999}))
        
        do_work.side_effect = returns_plausible_result

        with db_connect(self.database_url) as conn, HTTMock(self.response_content):
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q = db_queue(conn, DONE_QUEUE)
            due_Q = db_queue(conn, DUE_QUEUE)
            beat_Q = db_queue(conn, HEARTBEAT_QUEUE)
            
            owner, repository = 'openaddresses', 'hooked-on-sources'
            with task_Q as db: new_set = add_set(db, owner, repository)
            sources = find_batch_sources(owner, repository, self.github_auth)
            enqueued = enqueue_sources(task_Q, new_set, sources)
            
            # Burn through all the runs
            for _ in enqueued:
                pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, beat_Q, self.output_dir, None)
                pop_task_from_donequeue(done_Q, self.github_auth)
                pop_task_from_duequeue(due_Q, self.github_auth)
            
            # Render images and see that the set is done.
            with done_Q as db:
                render_set_maps(self.s3, db, new_set)
                the_set = read_set(db, new_set.id)
    
            self.assertEqual(the_set.commit_sha[:6], '8dd262')
            self.assertIsNotNone(the_set.datetime_start)
            self.assertIsNotNone(the_set.datetime_end)
            
            self.assertEqual(the_set.owner, owner)
            self.assertEqual(the_set.repository, repository)
            self.assertEqual(get(the_set.render_usa).status_code, 200)
            self.assertEqual(get(the_set.render_europe).status_code, 200)
            self.assertEqual(get(the_set.render_world).status_code, 200)
            self.assertEqual(get(the_set.render_geojson).status_code, 200)
            
            geojson = json.loads(get(the_set.render_geojson).content.decode('utf8'))
            properties = [feat['properties'] for feat in geojson['features']]
            
            self.assertEqual(properties[0]['name'], 'Contra Costa')
            self.assertEqual(properties[0]['address count'], 999)
            self.assertEqual(properties[0]['source count'], 1)
            self.assertEqual(properties[1]['name'], 'Nevada')
            self.assertEqual(properties[1]['address count'], 999)
            self.assertEqual(properties[1]['source count'], 1)
            self.assertEqual(properties[2]['name'], 'Alameda')
            self.assertEqual(properties[2]['address count'], 999)
            self.assertEqual(properties[2]['source count'], 1)
    
    def test_render_index_maps(self):
        ''' Show that front page maps get rendered correctly.
        '''
        with HTTMock(self.response_content):
            render_index_maps(self.s3, [])

            self.assertEqual(get('http://fake-s3.local/render-usa.png').status_code, 200)
            self.assertEqual(get('http://fake-s3.local/render-europe.png').status_code, 200)
            self.assertEqual(get('http://fake-s3.local/render-world.png').status_code, 200)
            self.assertEqual(get('http://fake-s3.local/render-world.geojson').status_code, 200)

class TestQueue (unittest.TestCase):
    
    def setUp(self):
        '''
        '''
        os.environ['GITHUB_TOKEN'] = ''
        os.environ['DATABASE_URL'] = DATABASE_URL
        os.environ['AWS_ACCESS_KEY_ID'] = '12345'
        os.environ['AWS_SECRET_ACCESS_KEY'] = '67890'
        
        config = load_config()

        recreate_db.recreate(config['DATABASE_URL'])
        self.s3 = FakeS3()

        self.output_dir = mkdtemp(prefix='TestQueue-')
        self.database_url = config['DATABASE_URL']
    
    def tearDown(self):
        '''
        '''
        del os.environ['GITHUB_TOKEN']
        del os.environ['DATABASE_URL']
        del os.environ['AWS_ACCESS_KEY_ID']
        del os.environ['AWS_SECRET_ACCESS_KEY']

        rmtree(self.output_dir)
        remove(self.s3._fake_keys)
    
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    def test_task_queue(self, do_work):
        do_work.return_value = {str(uuid4()): str(uuid4())}
    
        task_data = dict(job_id='j', url='u', name='sources/xx/f.json',
                         content_b64='Li4u', file_id='iii', commit_sha='sss')

        with db_connect(self.database_url) as conn:
            task_Q = db_queue(conn, TASK_QUEUE)
            done_Q, due_Q, heartbeat_Q = mock.Mock(), mock.Mock(), mock.Mock()
            task_Q.put(task_data)

            pop_task_from_taskqueue(self.s3, task_Q, done_Q, due_Q, heartbeat_Q, self.output_dir, None)
            done_data = done_Q.put.mock_calls[0][1][0]
        
        for (key, value) in task_data.items():
            self.assertEqual(value, done_data.get(key))
        
        self.assertEqual(done_data['result'], do_work.return_value)

    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.update_job_status')
    @patch('openaddr.ci.objects.set_run')
    @patch('openaddr.ci.is_merged_to_master')
    def test_done_queue(self, is_merged_to_master, set_run, update_job_status):
        output_data = {'source': 'sources/xx/f.json', 'process hash': 'f00'}
    
        done_data = dict(job_id='j', url='u', name='sources/xx/f.json',
                         content_b64='Li4u', file_id='iii', commit_sha='sss',
                         run_id=1, result=dict(message='Yo', output=output_data))

        with db_connect(self.database_url) as conn:
            done_Q = db_queue(conn, TASK_QUEUE)
            done_Q.put(done_data)

            pop_task_from_donequeue(done_Q, mock.Mock())
        
        run_data = set_run.mock_calls[0][1]
        self.assertEqual(run_data[1:5], (1, 'sources/xx/f.json', 'iii', 'Li4u'))
        self.assertEqual(run_data[6:], (False, 'j', None, 'sss', is_merged_to_master.return_value, None))
        
        job_data = update_job_status.mock_calls[0][1]
        self.assertEqual(job_data[1:5], ('j', 'u', 'sources/xx/f.json', False))
        self.assertEqual(job_data[5]['message'], 'Yo')
        self.assertEqual(job_data[5]['state'].source, 'sources/xx/f.json')
        self.assertEqual(job_data[5]['state'].process_hash, 'f00')
    
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    @patch('openaddr.ci.objects.get_completed_file_run')
    @patch('openaddr.ci.objects.add_run')
    def test_pop_task_from_taskqueue_no_data(self, add_run, get_completed_file_run, do_work):
        '''
        '''
        add_run.return_value = 999
        get_completed_file_run.return_value = None

        s3, task_queue, done_queue = mock.Mock(), mock.Mock(), mock.Mock()
        due_queue, heartbeat_queue = mock.Mock(), mock.Mock()
        task_queue.__enter__, task_queue.__exit__ = mock.Mock(), mock.Mock()
        
        task_queue.get.return_value = None
        pop_task_from_taskqueue(s3, task_queue, done_queue, due_queue, heartbeat_queue, '', '')
        
        self.assertEqual(len(get_completed_file_run.mock_calls), 0, 'Should not have checked for a previous run')
        self.assertEqual(len(done_queue.mock_calls), 0, 'Should not have pushed to the done queue')
        self.assertEqual(len(due_queue.mock_calls), 0, 'Should not have pushed to the due queue')
    
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    @patch('openaddr.ci.objects.get_completed_file_run')
    @patch('openaddr.ci.objects.add_run')
    def test_pop_task_from_taskqueue_new_run(self, add_run, get_completed_file_run, do_work):
        '''
        '''
        add_run.return_value = 999
        get_completed_file_run.return_value = None

        s3, task_queue, done_queue = mock.Mock(), mock.Mock(), mock.Mock()
        due_queue, heartbeat_queue = mock.Mock(), mock.Mock()
        task_queue.__enter__, task_queue.__exit__ = mock.Mock(), mock.Mock()
        
        task_queue.get.return_value.data = dict(job_id='J', url='U', name='N', content_b64='Qw==', commit_sha='S', file_id='F')
        pop_task_from_taskqueue(s3, task_queue, done_queue, due_queue, heartbeat_queue, '', '')
        
        self.assertEqual(len(get_completed_file_run.mock_calls), 1, 'Should have checked for a previous run')
        self.assertGreaterEqual(len(do_work.mock_calls), 1, 'Should have done some real work')
        self.assertEqual(len(add_run.mock_calls), 1, 'Should have added a new run')
        
        (done_data, ) = done_queue.mock_calls[0][1]
        (due_data, ) = due_queue.mock_calls[0][1]
        
        # All items from task data were passed through to done and due queues
        for (key, value) in task_queue.get.return_value.data.items():
            self.assertEqual(done_data[key], value)
            self.assertEqual(due_data[key], value)
        
        # Run ID and work results were also passed through correctly
        self.assertEqual(done_data['run_id'], add_run.return_value)
        self.assertEqual(due_data['run_id'], add_run.return_value)
        self.assertEqual(done_data['result'], do_work.return_value)
        self.assertNotIn('result', due_data)
        
        # Additional values were not added
        for key in ('set_id', 'rerun'):
            self.assertIsNone(done_data.get(key, None))
            self.assertIsNone(due_data.get(key, None))
    
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    @patch('openaddr.ci.objects.get_completed_file_run')
    @patch('openaddr.ci.objects.add_run')
    def test_pop_task_from_taskqueue_no_rerun(self, add_run, get_completed_file_run, do_work):
        '''
        '''
        add_run.return_value = 999
        get_completed_file_run.return_value = None

        s3, task_queue, done_queue = mock.Mock(), mock.Mock(), mock.Mock()
        due_queue, heartbeat_queue = mock.Mock(), mock.Mock()
        task_queue.__enter__, task_queue.__exit__ = mock.Mock(), mock.Mock()
        
        task_queue.get.return_value.data = dict(rerun=True, job_id='J', url='U', name='N', content_b64='Qw==', commit_sha='S', file_id='F')
        pop_task_from_taskqueue(s3, task_queue, done_queue, due_queue, heartbeat_queue, '', '')
        
        self.assertEqual(len(get_completed_file_run.mock_calls), 0, 'Should not have checked for a previous run')
        self.assertGreaterEqual(len(do_work.mock_calls), 1, 'Should have done some real work')
        self.assertEqual(len(add_run.mock_calls), 1, 'Should have added a new run')
        
        (done_data, ) = done_queue.mock_calls[0][1]
        (due_data, ) = due_queue.mock_calls[0][1]
        
        # All items from task data were passed through to done and due queues
        for (key, value) in task_queue.get.return_value.data.items():
            self.assertEqual(done_data[key], value)
            self.assertEqual(due_data[key], value)
        
        # Run ID and work results were also passed through correctly
        self.assertEqual(done_data['run_id'], add_run.return_value)
        self.assertEqual(due_data['run_id'], add_run.return_value)
        self.assertEqual(done_data['result'], do_work.return_value)
        self.assertNotIn('result', due_data)
        
        # Additional values were not added
        self.assertIsNone(done_data.get('set_id', None))
        self.assertIsNone(due_data.get('set_id', None))
    
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    @patch('openaddr.ci.objects.get_completed_file_run')
    @patch('openaddr.ci.objects.add_run')
    def test_pop_task_from_taskqueue_with_setid(self, add_run, get_completed_file_run, do_work):
        '''
        '''
        add_run.return_value = 999
        get_completed_file_run.return_value = None

        s3, task_queue, done_queue = mock.Mock(), mock.Mock(), mock.Mock()
        due_queue, heartbeat_queue = mock.Mock(), mock.Mock()
        task_queue.__enter__, task_queue.__exit__ = mock.Mock(), mock.Mock()
        
        task_queue.get.return_value.data = dict(set_id=123, job_id='J', url='U', name='N', content_b64='Qw==', commit_sha='S', file_id='F')
        pop_task_from_taskqueue(s3, task_queue, done_queue, due_queue, heartbeat_queue, '', '')
        
        self.assertEqual(len(get_completed_file_run.mock_calls), 1, 'Should have checked for a previous run')
        self.assertGreaterEqual(len(do_work.mock_calls), 1, 'Should have done some real work')
        self.assertEqual(len(add_run.mock_calls), 1, 'Should have added a new run')
        
        (done_data, ) = done_queue.mock_calls[0][1]
        (due_data, ) = due_queue.mock_calls[0][1]
        
        # All items from task data were passed through to done and due queues
        for (key, value) in task_queue.get.return_value.data.items():
            self.assertEqual(done_data[key], value)
            self.assertEqual(due_data[key], value)
        
        # Run ID and work results were also passed through correctly
        self.assertEqual(done_data['run_id'], add_run.return_value)
        self.assertEqual(due_data['run_id'], add_run.return_value)
        self.assertEqual(done_data['result'], do_work.return_value)
        self.assertNotIn('result', due_data)
        
        # Additional values were not added
        self.assertIsNone(done_data.get('rerun', None))
        self.assertIsNone(due_data.get('rerun', None))
    
    @patch('openaddr.ci.WORKER_COOLDOWN', new=timedelta(seconds=0))
    @patch('openaddr.ci.work.do_work')
    @patch('openaddr.ci.objects.copy_run')
    @patch('openaddr.ci.objects.get_completed_file_run')
    @patch('openaddr.ci.objects.add_run')
    def test_pop_task_from_taskqueue_previous_run(self, add_run, get_completed_file_run, copy_run, do_work):
        '''
        '''
        copy_run.return_value = 999
        get_completed_file_run.return_value = (321, RunState({}), True)

        s3, task_queue, done_queue = mock.Mock(), mock.Mock(), mock.Mock()
        due_queue, heartbeat_queue = mock.Mock(), mock.Mock()
        task_queue.__enter__, task_queue.__exit__ = mock.Mock(), mock.Mock()
        
        task_queue.get.return_value.data = dict(job_id='J', url='U', name='N', content_b64='Qw==', commit_sha='S', file_id='F')
        pop_task_from_taskqueue(s3, task_queue, done_queue, due_queue, heartbeat_queue, '', '')
        
        self.assertEqual(len(get_completed_file_run.mock_calls), 1, 'Should have checked for a previous run')
        self.assertEqual(len(add_run.mock_calls), 0, 'Should not have added a new run')
        self.assertEqual(len(do_work.mock_calls), 0, 'Should not have done any real work')
        self.assertEqual(len(copy_run.mock_calls), 1, 'Should have copied the previous run')
        self.assertEqual(len(due_queue.mock_calls), 0, 'Should not have pushed to the due queue')
        
        db = task_queue.__enter__.return_value
        copy_run.assert_called_once_with(db, 321, 'J', 'S', None)
        
        (done_data, ) = done_queue.mock_calls[0][1]
        
        # All items from task data were passed through to done queue
        for (key, value) in task_queue.get.return_value.data.items():
            self.assertEqual(done_data[key], value)
        
        # Run ID and work results were also passed through correctly
        self.assertEqual(done_data['run_id'], copy_run.return_value)
        self.assertEqual(done_data['result'], {'message': 'Everything is fine', 'reused_run': 321, 'state': {}})
        
        # Additional values were not added
        for key in ('set_id', 'rerun'):
            self.assertIsNone(done_data.get(key, None))

class TestCollect (unittest.TestCase):

    def setUp(self):
        '''
        '''
        self.output_dir = mkdtemp(prefix='TestCollect-')
        self.s3 = FakeS3()
    
    def tearDown(self):
        '''
        '''
        rmtree(self.output_dir)
        remove(self.s3._fake_keys)
    
    def test_preparation(self):
        '''
        '''
        set = mock.Mock()
        set.owner, set.repository, set.commit_sha = 'oa', 'oa', 'ff9900'
        
        tests = {'nothing': lambda result: False, 'everything': lambda result: True}
        collections = prepare_collections(self.s3, set, self.output_dir, tests, tests)
        
        for (collection, test) in collections:
            self.assertIn('README.txt', collection.zip.namelist())
            self.assertIn(b'oa/oa', collection.zip.read('README.txt'))
            self.assertIn(b'ff9900', collection.zip.read('README.txt'))

            if '-nothing' not in collection.zip.filename:
                self.assertTrue(test(None), test(None))
            else:
                self.assertFalse(test(None), test(None))

    def test_collector_publisher(self):
        '''
        '''
        S3, db, collected_zip = mock.Mock(), mock.Mock(), mock.Mock()
        collected_zip.filename = 'collected-local.zip'
        
        with patch('openaddr.ci.collect.add_source_to_zipfile') as add_source_to_zipfile:
            collector_publisher = CollectorPublisher(S3, collected_zip, 'everywhere', 'yo')
            
            s1 = {'license': 'ODbL', 'attribution name': 'ABC Co.'}
            s2 = {'website': 'http://example.com', 'attribution flag': 'false'}
            s3 = {'attribution flag': 'true', 'attribution name': ''}
            r1 = LocalProcessedResult('abc', 'abc.zip', RunState(s1), None)
            r2 = LocalProcessedResult('def', 'def.zip', RunState(s2), None)
            r3 = LocalProcessedResult('ghi', 'ghi.zip', RunState(s3), None)
            
            collector_publisher.collect(r1)
            collector_publisher.collect(r2)
            collector_publisher.collect(r3)

            with patch('openaddr.ci.collect.write_to_s3') as write_to_s3:
                s3_key_mock = mock.Mock()
                s3_key_mock.name = 'collected-local.zip'
                s3_key_mock.bucket.name = 'a-bucket'
                write_to_s3.return_value = s3_key_mock

                with patch('openaddr.util.summarize_result_licenses') as summarize_result_licenses:
                    summarize_result_licenses.return_value = str(uuid4())
                    collector_publisher.publish(db)

            write_to_s3.assert_has_calls([
                mock.call(S3.bucket, collected_zip.filename, collected_zip.filename)
                ])

            add_source_to_zipfile.assert_has_calls([
                mock.call(collected_zip, r1),
                mock.call(collected_zip, r2),
                mock.call(collected_zip, r3)
                ])
        
        self.assertEqual(len(collected_zip.writestr.mock_calls), 1)
        filename, content = collected_zip.writestr.mock_calls[0][1]
        self.assertEqual(filename, 'LICENSE.txt')
        self.assertTrue(content.decode('utf8'), summarize_result_licenses.return_value)

        collected_zip.close.assert_called_once_with()

        self.assertEqual(db.execute.mock_calls, [
            mock.call('DELETE FROM zips WHERE url = %s',
                      ('https://s3.amazonaws.com/a-bucket/collected-local.zip',)),
            mock.call('''INSERT INTO zips
                      (url, datetime, is_current, content_length, collection, license_attr)
                      VALUES (%s, NOW(), true, %s, %s, %s)''',
                      ('https://s3.amazonaws.com/a-bucket/collected-local.zip', None, 'everywhere', 'yo'))])

    def test_collector_publisher_multipart_s3_one_part(self):
        '''
        '''
        handle, filename1 = mkstemp(suffix='.csv')
        close(handle)

        bucket, collected_zip, mp_upload = mock.Mock(), mock.Mock(), mock.Mock()
        bucket.initiate_multipart_upload.return_value = mp_upload
        bucket.get_all_multipart_uploads.return_value = [mp_upload]
        collected_zip.filename = filename1

        # Write a sample file just at the chunk size cutoff
        with open(filename1, 'wb') as f:
            f.seek(MULTIPART_CHUNK_SIZE - 1)
            f.write(b'\0')

        mp_upload.get_all_parts.return_value = [None]
        write_to_s3(bucket, collected_zip.filename, 'keyname.csv', content_type='text/csv')
        remove(filename1)
        
        self.assertEqual(len(mp_upload.upload_part_from_file.mock_calls), 1, 'Should have uploaded one part')
        self.assertEqual(mp_upload.upload_part_from_file.mock_calls[0][2]['fp'].mode, 'rb', 'Should be binary')
        bucket.initiate_multipart_upload.assert_has_calls([mock.call('keyname.csv', headers={'Content-Type': 'text/csv'})])
        self.assertEqual(bucket.get_key.mock_calls[0][1], ('keyname.csv', ), 'Should upload a correctly-named key')
        self.assertEqual(bucket.get_key.mock_calls[1][1], ('public-read', ), 'Should upload a publicly-readable key')

    def test_collector_publisher_multipart_s3_two_parts(self):
        '''
        '''
        handle, filename1 = mkstemp(suffix='.csv')
        close(handle)

        bucket, collected_zip, mp_upload = mock.Mock(), mock.Mock(), mock.Mock()
        bucket.initiate_multipart_upload.return_value = mp_upload
        bucket.get_all_multipart_uploads.return_value = [mp_upload]
        collected_zip.filename = filename1

        # Write a sample file just above the chunk size cutoff
        with open(filename1, 'wb') as f:
            f.seek(MULTIPART_CHUNK_SIZE + 1)
            f.write(b'\0')

        mp_upload.get_all_parts.return_value = [None, None]
        write_to_s3(bucket, collected_zip.filename, 'keyname.csv', content_type='text/csv')
        remove(filename1)
        
        self.assertEqual(len(mp_upload.upload_part_from_file.mock_calls), 2, 'Should have uploaded two parts')
        self.assertEqual(mp_upload.upload_part_from_file.mock_calls[0][2]['fp'].mode, 'rb', 'Should be binary')
        self.assertEqual(mp_upload.upload_part_from_file.mock_calls[1][2]['fp'].mode, 'rb', 'Should be binary')
        bucket.initiate_multipart_upload.assert_has_calls([mock.call('keyname.csv', headers={'Content-Type': 'text/csv'})])
        self.assertEqual(bucket.get_key.mock_calls[0][1], ('keyname.csv', ), 'Should upload a correctly-named key')
        self.assertEqual(bucket.get_key.mock_calls[1][1], ('public-read', ), 'Should upload a publicly-readable key')

    def test_collection_checks(self):
        '''
        '''
        _ = None
        test_funcs = is_us_northeast, is_us_midwest, is_us_south, is_us_west, \
                     is_europe, is_asia, is_south_america, is_north_america
        
        for abbr in ('ct', 'me', 'ma', 'nh', 'ri', 'vt', 'nj', 'ny', 'pa'):
            for source_base in ('us/{}'.format(abbr), 'us/{}.---'.format(abbr), 'us/{}/---'.format(abbr)):
                result = LocalProcessedResult(source_base, None, RunState(None), None)
                self.assertTrue(is_us_northeast(result), 'is_us_northeast("{}") should be true'.format(source_base))
            
                for test_func in test_funcs:
                    if test_func is not is_us_northeast:
                        self.assertFalse(test_func(result), '{}("{}") should be false'.format(test_func.__name__, source_base))

        for abbr in ('il', 'in', 'mi', 'oh', 'wi', 'ia', 'ks', 'mn', 'mo', 'ne', 'nd', 'sd'):
            for source_base in ('us/{}'.format(abbr), 'us/{}.---'.format(abbr), 'us/{}/---'.format(abbr)):
                result = LocalProcessedResult(source_base, None, RunState(None), None)
                self.assertTrue(is_us_midwest(result), 'is_us_midwest("{}") should be true'.format(source_base))
            
                for test_func in test_funcs:
                    if test_func is not is_us_midwest:
                        self.assertFalse(test_func(result), '{}("{}") should be false'.format(test_func.__name__, source_base))

        for abbr in ('de', 'fl', 'ga', 'md', 'nc', 'sc', 'va', 'dc', 'wv', 'al',
                     'ky', 'ms', 'ar', 'la', 'ok', 'tx', 'tn'):
            for source_base in ('us/{}'.format(abbr), 'us/{}.---'.format(abbr), 'us/{}/---'.format(abbr)):
                result = LocalProcessedResult(source_base, None, RunState(None), None)
                self.assertTrue(is_us_south(result), 'is_us_south("{}") should be true'.format(source_base))
            
                for test_func in test_funcs:
                    if test_func is not is_us_south:
                        self.assertFalse(test_func(result), '{}("{}") should be false'.format(test_func.__name__, source_base))

        for abbr in ('az', 'co', 'id', 'mt', 'nv', 'nm', 'ut', 'wy', 'ak', 'ca', 'hi', 'or', 'wa'):
            for source_base in ('us/{}'.format(abbr), 'us/{}.---'.format(abbr), 'us/{}/---'.format(abbr)):
                result = LocalProcessedResult(source_base, None, RunState(None), None)
                self.assertTrue(is_us_west(result), 'is_us_west("{}") should be true'.format(source_base))
            
                for test_func in test_funcs:
                    if test_func is not is_us_west:
                        self.assertFalse(test_func(result), '{}("{}") should be false'.format(test_func.__name__, source_base))

        for iso in ('be', 'bg', 'cz', 'dk', 'de', 'ee', 'ie', 'el', 'es', 'fr',
                    'hr', 'it', 'cy', 'lv', 'lt', 'lu', 'hu', 'mt', 'nl', 'at',
                    'pl', 'pt', 'ro', 'si', 'sk', 'fi', 'se', 'uk', 'gr', 'gb'):
            for source_base in (iso, '{}.---'.format(iso), '{}/---'.format(iso)):
                result = LocalProcessedResult(source_base, None, RunState(None), None)
                self.assertTrue(is_europe(result), 'is_europe("{}") should be true'.format(source_base))
            
                for test_func in test_funcs:
                    if test_func is not is_europe:
                        self.assertFalse(test_func(result), '{}("{}") should be false'.format(test_func.__name__, source_base))

        for iso in ('af', 'am', 'az', 'bh', 'bd', 'bt', 'bn', 'kh', 'cn', 'cx',
                    'cc', 'io', 'ge', 'hk', 'in', 'id', 'ir', 'iq', 'il', 'jp',
                    'jo', 'kz', 'kp', 'kr', 'kw', 'kg', 'la', 'lb', 'mo', 'my',
                    'mv', 'mn', 'mm', 'np', 'om', 'pk', 'ph', 'qa', 'sa', 'sg',
                    'lk', 'sy', 'tw', 'tj', 'th', 'tr', 'tm', 'ae', 'uz', 'vn',
                    'ye', 'ps',
                    
                    'as', 'au', 'nz', 'ck', 'fj', 'pf', 'gu', 'ki', 'mp', 'mh',
                    'fm', 'um', 'nr', 'nc', 'nz', 'nu', 'nf', 'pw', 'pg', 'mp',
                    'sb', 'tk', 'to', 'tv', 'vu', 'um', 'wf', 'ws', 'is'):
            for source_base in (iso, '{}.---'.format(iso), '{}/---'.format(iso)):
                result = LocalProcessedResult(source_base, None, RunState(None), None)
                self.assertTrue(is_asia(result), 'is_asia("{}") should be true'.format(source_base))
            
                for test_func in test_funcs:
                    if test_func is not is_asia:
                        self.assertFalse(test_func(result), '{}("{}") should be false'.format(test_func.__name__, source_base))

        for iso in ('ar', 'bo', 'br', 'cl', 'co', 'ec', 'gf', 'gy', 'pe', 'py', 'sr', 'uy', 've'):
            for source_base in (iso, '{}.---'.format(iso), '{}/---'.format(iso)):
                result = LocalProcessedResult(source_base, None, RunState(None), None)
                self.assertTrue(is_south_america(result), 'is_south_america("{}") should be true'.format(source_base))
            
                for test_func in test_funcs:
                    if test_func is not is_south_america:
                        self.assertFalse(test_func(result), '{}("{}") should be false'.format(test_func.__name__, source_base))

        for iso in ('ai', 'ag', 'aw', 'bs', 'bb', 'bz', 'bm', 'bq', 'vg', 'ca',
                    'ky', 'cr', 'cu', 'cw', 'dm', 'do', 'sv', 'gl', 'gd', 'gp',
                    'gt', 'ht', 'hn', 'jm', 'mq', 'mx', 'pm', 'ms', 'cw', 'kn',
                    'ni', 'pa', 'pr', 'bq', 'bq', 'sx', 'kn', 'lc', 'pm', 'vc',
                    'tt', 'tc', 'vi'):
            for source_base in (iso, '{}.---'.format(iso), '{}/---'.format(iso)):
                result = LocalProcessedResult(source_base, None, RunState(None), None)
                self.assertTrue(is_north_america(result), 'is_north_america("{}") should be true'.format(source_base))
            
                for test_func in test_funcs:
                    if test_func is not is_north_america:
                        self.assertFalse(test_func(result), '{}("{}") should be false'.format(test_func.__name__, source_base))

    def test_add_source_to_zipfile(self):
        '''
        '''
        handle, filename1 = mkstemp(suffix='.csv')
        utime(filename1, (1234567890, 1234567890))
        close(handle)
        
        handle, filename2 = mkstemp(suffix='.zip')
        zipfile3 = ZipFile(filename2, 'w')
        zipfile3.writestr('README.txt', b'hello world')
        zipfile3.writestr('us/ca/oakland.vrt', b'vrt data')
        zipfile3.writestr('us/ca/oakland.csv', b'csv data')
        zipfile3.close()
        utime(filename2, (987654321, 987654321))
        close(handle)

        output_write_contents = list()
        def remember_write_contents(fn, _):
            with open(fn) as file:
                output_write_contents.append(file.read())
        output = mock.Mock()
        output.write.side_effect = remember_write_contents
        
        with patch('openaddr.ci.collect.add_csv_to_zipfile') as add_csv_to_zipfile:
            add_source_to_zipfile(output, LocalProcessedResult('us/ca/oakland', 'temp', RunState({}), '2.0.0'))
            add_source_to_zipfile(output, LocalProcessedResult('us/ca/oakland', filename1, RunState({}), '2.12.0'))
            add_source_to_zipfile(output, LocalProcessedResult('us/ca/oakland', filename2, RunState({}), '2.13.0'))
            add_source_to_zipfile(output, LocalProcessedResult('us/ca/oakland', filename1, RunState({}), '3'))
            add_source_to_zipfile(output, LocalProcessedResult('ca/bc/vancouver', filename1, RunState({}), '3'))
            add_source_to_zipfile(output, LocalProcessedResult('us/ca/oakland', filename1, RunState({}), None))
        
        self.assertEqual(len(add_csv_to_zipfile.mock_calls), 5)
        self.assertEqual(add_csv_to_zipfile.mock_calls[0][1][1], 'us/ca/oakland.csv')
        self.assertEqual(add_csv_to_zipfile.mock_calls[1][1][1], 'us/ca/oakland.csv')
        self.assertEqual(add_csv_to_zipfile.mock_calls[3][1][1], 'ca/bc/vancouver.csv')
        
        self.assertEqual(len(output.writestr.mock_calls), 1)
        self.assertEqual(output.writestr.mock_calls[0][1][0].filename, 'us/ca/oakland.vrt')
        self.assertEqual(output.writestr.mock_calls[0][1][1], b'vrt data')
        
        remove(filename1)
        remove(filename2)
    
    def test_add_csv_to_zipfile(self):
        '''
        '''
        output = mock.Mock()
        output_write_contents = list()
        output_writestr_contents = list()

        def remember_write_contents(fn, _):
            with open(fn) as file:
                # Python 2.7 and 3 use different line endings in csv module:
                output_write_contents.append([line.strip() for line in file])

        def remember_writestr_contents(_, bytes):
            output_writestr_contents.append(bytes)

        output.write.side_effect = remember_write_contents
        output.writestr.side_effect = remember_writestr_contents
        
        # Addresses that should trigger expansion.
        input1 = u'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID,HASH\n-122.2359742,37.7362507,85,MAITLAND DR,A,ALAMEDA,,,94502,74-1035-77,h4sh\n-122.2353881,37.7223605,1360,S LOOP RD,,ALAMEDA,,,94502,74-1339-11,h4sh\n-122.2385597,37.7284071,3508,CATALINA AV,,ALAMEDA,,,94502,74-1033-146,h4sh\n-122.2368942,37.7305041,3512,MCSHERRY WY,,ALAMEDA,,,94502,74-1033-122,h4sh\n-122.2349371,37.7357455,514,FLOWER LA,,ALAMEDA,,,94502,74-1036-26,h4sh\n-122.2367819,37.7342157,1014,HOLLY ST,,ALAMEDA,,,94502,74-1075-222,h4sh\n'
        add_csv_to_zipfile(output, u'us/ca/älameda.csv', BytesIO(input1.encode('utf8')))

        # Collections with missing columns and non-ASCII characters.
        input2 = u'LON,LAT,NUMBER,STREET,CITY,DISTRICT,REGION,POSTCODE\n-122.2359742,37.7362507,85,MAITLAND DR,ALAMEDA,,,94502\n-122.2353881,37.7223605,1360,S LOOP RD,ALAMEDA,,,94502\n-122.2385597,37.7284071,3508,CATALINA AV,ALAMEDA,,,94502\n-122.2368942,37.7305041,3512,MCSHERRY WY,ALAMEDA,,,94502\n-122.2349371,37.7357455,514,FLOWER LA,ALAMEDA,,,94502\n-122.2367819,37.7342157,1014,HOLLY ST,ALAMEDA,,,94502\n'
        add_csv_to_zipfile(output, u'us/ca/älameda.csv', BytesIO(input2.encode('utf8')))
        input3 = u'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID\n8.6885893,50.1042197,12,Abtsgäßchen,,Frankfurt am Main,,,60594,\n8.6885485,50.1041506,14,Abtsgäßchen,,Frankfurt am Main,,,60594,\n'
        add_csv_to_zipfile(output, 'de/he/frankfurt.csv', BytesIO(input3.encode('utf8')))

        # Collection with extra columns.
        input4 = u'LON,LAT,NUMBER,STREET,CITY,DISTRICT,REGION,POSTCODE,GOODTIMES\n-122.2359742,37.7362507,85,MAITLAND DR,ALAMEDA,,,94502,goodtimes\n-122.2353881,37.7223605,1360,S LOOP RD,ALAMEDA,,,94502,goodtimes\n-122.2385597,37.7284071,3508,CATALINA AV,ALAMEDA,,,94502,goodtimes\n-122.2368942,37.7305041,3512,MCSHERRY WY,ALAMEDA,,,94502,goodtimes\n-122.2349371,37.7357455,514,FLOWER LA,ALAMEDA,,,94502,goodtimes\n-122.2367819,37.7342157,1014,HOLLY ST,ALAMEDA,,,94502,goodtimes\n'
        add_csv_to_zipfile(output, u'us/ca/älameda.csv', BytesIO(input4.encode('utf8')))
        
        # Collection with illegal lat/lon value.
        input5 = u'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID,HASH\n-104.6843547,39.5793748,26050,E JAMISON CIR N,, CO,,,80016-2056,,629e0367e92b4c47\n-1.79769313486e+308,-1.79769313486e+308,26900,E COLFAX AVE,428,,,,,,8764a6de3c9f688c\n-104.1139093,39.6761295,2050,S PEORIA CROSSING RD,, CO,,,,,28b370f54c8e40ef\n'
        add_csv_to_zipfile(output, u'us/co/arapahoe.csv', BytesIO(input5.encode('utf8')))
        
        self.assertEqual(len(output.write.mock_calls), 10)

        self.assertEqual(output.write.mock_calls[0][1][1], u'us/ca/älameda.csv')
        self.assertEqual(output.write.mock_calls[1][1][1], u'summary/us/ca/älameda-summary.csv')
        self.assertEqual(output.write.mock_calls[2][1][1], output.write.mock_calls[0][1][1])
        self.assertEqual(output.write.mock_calls[3][1][1], output.write.mock_calls[1][1][1])
        self.assertEqual(output.write.mock_calls[4][1][1], 'de/he/frankfurt.csv')
        self.assertEqual(output.write.mock_calls[5][1][1], 'summary/de/he/frankfurt-summary.csv')
        self.assertEqual(output.write.mock_calls[6][1][1], output.write.mock_calls[0][1][1])
        self.assertEqual(output.write.mock_calls[7][1][1], output.write.mock_calls[1][1][1])
        self.assertEqual(output.write.mock_calls[8][1][1], 'us/co/arapahoe.csv')
        self.assertEqual(output.write.mock_calls[9][1][1], 'summary/us/co/arapahoe-summary.csv')
        
        self.assertIn(u'älameda'.encode('utf8'), output_writestr_contents[0])
        self.assertIn(u'älameda'.encode('utf8'), output_writestr_contents[1])

        # input1
        self.assertEqual(output_write_contents[0],
            [
            'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID,HASH',
            '-122.2359742,37.7362507,85,MAITLAND DR,A,ALAMEDA,,,94502,74-1035-77,h4sh',
            '-122.2353881,37.7223605,1360,S LOOP RD,,ALAMEDA,,,94502,74-1339-11,h4sh',
            '-122.2385597,37.7284071,3508,CATALINA AV,,ALAMEDA,,,94502,74-1033-146,h4sh',
            '-122.2368942,37.7305041,3512,MCSHERRY WY,,ALAMEDA,,,94502,74-1033-122,h4sh',
            '-122.2349371,37.7357455,514,FLOWER LA,,ALAMEDA,,,94502,74-1036-26,h4sh',
            '-122.2367819,37.7342157,1014,HOLLY ST,,ALAMEDA,,,94502,74-1075-222,h4sh',
            ])
        self.assertEqual(output_write_contents[1],
            [
            'count,lon,lat,area',
            '6,-122.3,37.7,"POLYGON((-122.3 37.7,-122.3 37.8,-122.2 37.8,-122.2 37.7,-122.3 37.7))"',
            ])
        
        # input2
        self.assertEqual(output_write_contents[2],
            [
            'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID,HASH',
            '-122.2359742,37.7362507,85,MAITLAND DR,,ALAMEDA,,,94502,,',
            '-122.2353881,37.7223605,1360,S LOOP RD,,ALAMEDA,,,94502,,',
            '-122.2385597,37.7284071,3508,CATALINA AV,,ALAMEDA,,,94502,,',
            '-122.2368942,37.7305041,3512,MCSHERRY WY,,ALAMEDA,,,94502,,',
            '-122.2349371,37.7357455,514,FLOWER LA,,ALAMEDA,,,94502,,',
            '-122.2367819,37.7342157,1014,HOLLY ST,,ALAMEDA,,,94502,,',
            ])
        self.assertEqual(output_write_contents[3], output_write_contents[1])
        
        # input3
        self.assertEqual(output_write_contents[4],
            [
            'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID,HASH',
            '8.6885893,50.1042197,12,Abtsgäßchen,,Frankfurt am Main,,,60594,,',
            '8.6885485,50.1041506,14,Abtsgäßchen,,Frankfurt am Main,,,60594,,',
            ])
        self.assertEqual(output_write_contents[5],
            [
            'count,lon,lat,area',
            '2,8.6,50.1,"POLYGON((8.6 50.1,8.6 50.2,8.7 50.2,8.7 50.1,8.6 50.1))"',
            ])
        
        # input4
        self.assertEqual(output_write_contents[6],
            [
            'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID,HASH',
            '-122.2359742,37.7362507,85,MAITLAND DR,,ALAMEDA,,,94502,,',
            '-122.2353881,37.7223605,1360,S LOOP RD,,ALAMEDA,,,94502,,',
            '-122.2385597,37.7284071,3508,CATALINA AV,,ALAMEDA,,,94502,,',
            '-122.2368942,37.7305041,3512,MCSHERRY WY,,ALAMEDA,,,94502,,',
            '-122.2349371,37.7357455,514,FLOWER LA,,ALAMEDA,,,94502,,',
            '-122.2367819,37.7342157,1014,HOLLY ST,,ALAMEDA,,,94502,,',
            ])
        
        # input5
        self.assertEqual(output_write_contents[8],
            [
            'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID,HASH',
            '-104.6843547,39.5793748,26050,E JAMISON CIR N,, CO,,,80016-2056,,629e0367e92b4c47',
            '-104.1139093,39.6761295,2050,S PEORIA CROSSING RD,, CO,,,,,28b370f54c8e40ef'
            ])
        self.assertEqual(output_write_contents[9],
            [
            'count,lon,lat,area',
            '1,-104.7,39.5,"POLYGON((-104.7 39.5,-104.7 39.6,-104.6 39.6,-104.6 39.5,-104.7 39.5))"',
            '1,-104.2,39.6,"POLYGON((-104.2 39.6,-104.2 39.7,-104.1 39.7,-104.1 39.6,-104.2 39.6))"'
            ])

class TestTileIndex (unittest.TestCase):

    def setUp(self):
        '''
        '''
        self.output_dir = mkdtemp(prefix='TestTileIndex-')
        self.s3 = FakeS3()

        _ = mock.Mock()
        state1 = RunState({"website": None, "attribution required": "true", "skipped": False, "share-alike": "", "license": "http://www.acgov.org/acdata/terms.htm", "cache": "http://s3.amazonaws.com/data.openaddresses.io/runs/65018/cache.zip", "sample": "http://s3.amazonaws.com/data.openaddresses.io/runs/65018/sample.json", "source": "us--ca--alameda.txt", "version": None, "geometry type": "Point", "fingerprint": "177cd91707ab2c022304130849849255", "address count": 530524, "output": "http://s3.amazonaws.com/data.openaddresses.io/runs/65018/output.txt", "cache time": "0:00:17.432042", "attribution name": "Alameda County", "process time": "0:46:52.644191", "processed": "http://s3.amazonaws.com/data.openaddresses.io/runs/65018/us/ca/alameda.zip"})
        state2 = RunState({"website": "https://sftp.sccgov.org/courier/web/1000@/wmLogin.html", "process hash": "e4e98759bfde43880240a1e8fe3be2e1", "attribution required": "true", "skipped": False, "share-alike": "", "license": None, "cache": "http://s3.amazonaws.com/data.openaddresses.io/runs/117966/cache.obj", "sample": "http://s3.amazonaws.com/data.openaddresses.io/runs/117966/sample.json", "source": "us--ca--santa_clara.txt", "version": None, "geometry type": "Point", "fingerprint": "a8486c25d4865ee091dacc8bb9c88554", "address count": 491270, "output": "http://s3.amazonaws.com/data.openaddresses.io/runs/117966/output.txt", "cache time": "0:00:01.883910", "attribution name": "Santa Clara County", "process time": "0:06:24.772217", "processed": "http://s3.amazonaws.com/data.openaddresses.io/runs/117966/us/ca/santa_clara.zip"})
        state3 = RunState({"website": None, "process hash": "81a1c96beb9a0649a0c9eabc36a93124", "attribution required": "true", "skipped": False, "share-alike": "true", "license": "Open Database License (ODbL) v1.0", "cache": "http://data.openaddresses.io/runs/120133/cache.zip", "sample": "http://data.openaddresses.io/runs/120133/sample.json", "source": "us--or--portland_metro.txt", "version": '3.2.1', "geometry type": "Point", "fingerprint": "a394a7b0e5f2422ba466872856fef98e", "address count": 767617, "output": "http://data.openaddresses.io/runs/120133/output.txt", "cache time": "0:00:14.959910", "attribution name": "Oregon Metro", "process time": "0:03:31.185286", "processed": "http://data.openaddresses.io/runs/120133/us/or/portland_metro.zip"})
        run1 = Run(_, 'sources/us/ca/alameda.json', _, None, None, state1, _, _, '2.16.1', _, _, _, _, _)
        run2 = Run(_, 'sources/us/ca/santa_clara.json', _, None, None, state2, _, _, '2.34.1', _, _, _, _, _)
        run3 = Run(_, 'sources/us/or/portland_metro.json', _, None, None, state3, _, _, '3.2.1', _, _, _, _, _)
        self.runs = run1, run2, run3
    
    def tearDown(self):
        '''
        '''
        rmtree(self.output_dir)
        remove(self.s3._fake_keys)
    
    def response_content(self, url, request):
        ''' Fake HTTP responses for use with HTTMock in tests.
        '''
        scheme, host, path, _, query, _ = urlparse(url.geturl())
        local_path = None
        
        if (host, path) == ('s3.amazonaws.com', '/data.openaddresses.io/runs/65018/us/ca/alameda.zip'):
            local_path = os.path.join(os.path.dirname(__file__), 'outputs', 'alameda.zip')
            headers = {'Last-Modified': 'Sun, 28 Feb 2016 21:27:51 GMT', 'Content-Type': 'application/zip'}
        
        if (host, path) == ('s3.amazonaws.com', '/data.openaddresses.io/runs/117966/us/ca/santa_clara.zip'):
            local_path = os.path.join(os.path.dirname(__file__), 'outputs', 'santa_clara.zip')
            headers = {'Last-Modified': 'Sun, 09 Oct 2016 06:41:32 GMT', 'Content-Type': 'application/zip'}
        
        if (host, path) == ('data.openaddresses.io', '/runs/120133/us/or/portland_metro.zip'):
            local_path = os.path.join(os.path.dirname(__file__), 'outputs', 'portland_metro.zip')
            headers = {'Last-Modified': 'Sun, 23 Oct 2016 03:40:47 GMT', 'Content-Type': 'application/zip'}
        
        if local_path:
            with open(local_path, 'rb') as file:
                return response(200, file.read(), headers=headers)
        
        raise NotImplementedError(url.geturl())
    
    def test_iterate_runs_points(self):
        '''
        '''
        with HTTMock(self.response_content):
            addresses1 = list(iterate_runs_points(self.runs[:1]))
            self.assertEqual(len(addresses1), 5305, 'Should equal first output')
            self.assertEqual(addresses1[0].result.source_base, 'us/ca/alameda')

        with HTTMock(self.response_content):
            addresses2 = list(iterate_runs_points(self.runs[1:]))
            self.assertEqual(len(addresses2), 4912, 'Should equal second output')
            self.assertEqual(addresses2[0].result.source_base, 'us/ca/santa_clara')

        with HTTMock(self.response_content):
            addresses3 = list(iterate_runs_points(self.runs))
            self.assertEqual(len(addresses3), 5305 + 4912, 'Should add up to the lengths of both outputs')
            self.assertEqual(addresses3[0].result.source_base, 'us/ca/alameda')
            self.assertEqual(addresses3[-1].result.source_base, 'us/ca/santa_clara')

    def test_iterate_point_blocks(self):
        '''
        '''
        with HTTMock(self.response_content):
            total1, addresses1 = 0, iterate_runs_points(self.runs[:1])
            for (key, points) in iterate_point_blocks(addresses1):
                self.assertIn(key, ((-123, 37), (-122, 37)), 'Alameda county is north of 37.0')
                total1 += len(list(points))
            self.assertEqual(total1, 5305, 'Should equal first output')

        with HTTMock(self.response_content):
            total2, addresses2 = 0, iterate_runs_points(self.runs)
            for (key, points) in iterate_point_blocks(addresses2):
                self.assertIn(key, ((-123, 37), (-122, 36), (-122, 37)))
                total2 += len(list(points))
            self.assertEqual(total2, 5305 + 4912, 'Should add up to the lengths of both outputs')
    
    def test_populate_tiles(self):
        '''
        '''
        with HTTMock(self.response_content):
            addresses = iterate_runs_points(self.runs)
            point_blocks = iterate_point_blocks(addresses)
            tiles = populate_tiles(self.output_dir, point_blocks)
            self.assertEqual(len(tiles), 3)
            self.assertIn((-122, 36), tiles)
            self.assertIn((-122, 37), tiles)
            self.assertIn((-123, 37), tiles)
            
            tile1 = tiles[(-122, 36)]
            with gzip.open(tile1.filename, 'rt', encoding='utf8') as file1:
                # El-Cheapo CSV parser.
                next(file1)
                row1 = next(file1).strip().split(',')
                (lon1, lat1), source1 = map(float, row1[:2]), row1[-1]

            self.assertEqual(lonlat_key(lon1, lat1), (-122, 36))
            self.assertEqual(source1, 'us/ca/santa_clara')

            tile2 = tiles[(-122, 37)]
            with gzip.open(tile2.filename, 'rt', encoding='utf8') as file2:
                # El-Cheapo CSV parser.
                next(file2)
                row2 = next(file2).strip().split(',')
                (lon2, lat2), source2 = map(float, row2[:2]), row2[-1]

            self.assertEqual(lonlat_key(lon2, lat2), (-122, 37))
            self.assertEqual(source2, 'us/ca/alameda')
            
            tile1_sources = [result.source_base for result in tile1.results]
            tile2_sources = [result.source_base for result in tile2.results]
            self.assertNotIn('us/ca/alameda', tile1_sources, 'Alameda is strictly north of 37.0')
            self.assertIn('us/ca/alameda', tile2_sources)
            self.assertIn('us/ca/santa_clara', tile2_sources)
            
            for result in tile2.results:
                if result.source_base == 'us/ca/santa_clara':
                    self.assertEqual(result.run_state.website, 'https://sftp.sccgov.org/courier/web/1000@/wmLogin.html')
                    self.assertIsNone(result.run_state.license)
                    self.assertFalse(result.run_state.share_alike)
                    self.assertEqual(result.run_state.attribution_required, 'true')
                    self.assertEqual(result.run_state.attribution_name, 'Santa Clara County')
                    self.assertIsNone(result.run_state.attribution_flag)
    
    def test_tile_publish(self):
        '''
        '''
        result, s3 = mock.Mock(), mock.Mock()
        result.source_base = 'xx/anytown'
        point = Point(0., 0., result, dict(LAT='0.0', LON='0.0'))
        
        tile = Tile((0, 0), self.output_dir)
        tile.add_points([point])
        
        with patch('openaddr.ci.collect.write_to_s3') as write_to_s3:
            with patch('openaddr.util.summarize_result_licenses') as summarize_result_licenses:
                summarize_result_licenses.return_value = str(uuid4())
                tile.publish(s3)
        
        _s3, _zip_file, _keyname = write_to_s3.mock_calls[0][1]
        zipfile = ZipFile(_zip_file, 'r')
        names = zipfile.namelist()
        
        self.assertEqual(len(write_to_s3.mock_calls), 1, 'Write to S3 called just once')
        self.assertIs(_s3, s3, 'S3 bucket should be first arg')
        self.assertEqual(_keyname, 'tiles/0.0/0.0.zip')
        self.assertEqual(names, ['addresses.csv', 'LICENSE.txt'])
        
        lines = zipfile.read('addresses.csv').decode('utf8').split()
        self.assertEqual(lines[0], 'LON,LAT,NUMBER,STREET,UNIT,CITY,DISTRICT,REGION,POSTCODE,ID,HASH,OA:Source')
        
        license = zipfile.read('LICENSE.txt').decode('utf8')
        self.assertEqual(license, summarize_result_licenses.return_value)

if __name__ == '__main__':
    unittest.main()
